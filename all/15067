From bugs+caf_=bugs=bugs.plt-scheme.org@plt-scheme.org Mon May 18 13:17:33 2015
Received: from mail-ie0-f181.google.com (mail-ie0-f181.google.com [209.85.223.181])
	by winooski.ccs.neu.edu (8.14.7/8.14.7) with ESMTP id t4IHHMjI026548
	for <bugs@bugs.plt-scheme.org>; Mon, 18 May 2015 13:17:22 -0400
Message-Id: <201505181717.t4IHHIic026534@winooski.ccs.neu.edu>
Date: Mon, 18 May 2015 13:17:18 -0400
From: jvanderhyde@benedictine.edu
To: bugs@racket-lang.org
Subject: Image display darker in DrRacket on Mac

>Number:         15067
>Category:       all
>Synopsis:       Image display darker in DrRacket on Mac
>Class:          sw-bug
>Responsible:    nobody
>Severity:       serious
>Priority:       medium
>State:          open
>Confidential:   no
>Arrival-Date:   Mon May 18 13:20:01 -0400 2015
>Last-Modified:  Mon May 18 17:20:01 -0400 2015
>Originator:     James Vanderhyde
>Organization:
plt
>Submitter-Id:   unknown
>Release:        6.1.1
>Environment:
macosx "Darwin admnclass408.benedictine.edu 14.3.0 Darwin Kernel Version 14.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5/RELEASE_X86_64 x86_64" (x86_64-macosx/3m) (get-display-depth) = 32
Human Language: english
(current-memory-use) 691041968
raco pkg (show):
Installation-wide:
 Package              Checksum                                    Source
 main-distribution    84a366a8c2b2908babe6c2811b0ada036bb159df    (catalog main-distribution)
 racket-lib           436f0928598fc1a8abf27422e8e6588bef45f652    (catalog racket-lib)
 [184 auto-installed packages not shown]
User-specific for installation "6.1.1":
 Package    Checksum                                    Source
 rsound     9fe5992ff7f473aba87ab6dc3efe17fbb3536a22    (catalog rsound)
 [2 auto-installed packages not shown]



Collections:
("/Users/jvanderhyde/Library/Racket/6.1.1/collects"
 (non-existent-path))
("/Applications/Racket v6.1.1/collects"
 (".gitignore" "acks" "compiler" "data" "db" "dynext" "ffi" "file" "info" "info-domain" "json" "launcher" "net" "openssl" "pkg" "planet" "racket" "raco" "reader" "realm" "s-exp" "setup" "syntax" "unstable" "version" "xml"))

Recent Internal Errors: 
Computer Language: (("Teaching Languages" "How to Design Programs" "Intermediate Student") (#(#t constructor repeating-decimal #f #t none) #f ()))
>Description:
I have discovered a problem with the color output of images in the Interactions pane of DrRacket in Mac OS X.

Colors appear darker than they should. This is easiest to see with code like the following:
(beside (rectangle 50 50 "solid" (make-color 0 255 255))
        (rectangle 50 50 "solid" (make-color 128 255 255)))
The two rectangles look very similar on Mac but very different on Windows. In fact, using the built-in "Digital Color Meter" app I am able to see that the 128 value for the red channel has been adjusted to 72.

If I save an image from Racket (Mac or Windows) and open the PNG file in Preview on Mac, it looks the same (darker, wrong). The same file looks correct when opened in Paint on Windows Vista.

I also wrote a native C++ program with Cairo to save out a PNG file to see if that was an issue. I tried running the Cairo program both in Windows and Mac, and the resulting file is the same as the Racket result--it looks fine when opened in Windows but wrong on Mac.

I created a similar image using a Java program. The resulting PNG file looks correct on both platforms. Upon examinging the files, I discovered that the Java PNG has an embedded ICC profile, and the Cairo PNG does not.  
It appears that the Mac OS has some kind of "standard" conversion for displaying PNG images that do not have Color Profiles embedded.
If I load the Java PNG into Racket, the file looks wrong (i.e., the same as the image generated by Racket in the first place). 

So, it appears that DrRacket
1. Does not respect the color profile embedded in a PNG file when it displays the image.
2. Does not generate a color profile when it creates a PNG file.
3. Uses some kind of "standard" conversion (presumably from the OS) when displaying images that results in the colors showing up darker than they should be.

I consider this a bug because when I create a rectangle with color 128, I want it to be 128, or at least close.
>How-To-Repeat:
(require picturing-programs)
(rectangle 50 50 "solid" (make-color 128 255 255))

Examine the displayed image on a Mac and you can see the red value is 72 instead of 128.
>Fix:
>Audit-Trail:
From: =?UTF-8?Q?Jens_Axel_S=C3=B8gaard?= <jensaxel@soegaard.net>
To: James Vanderhyde <jvanderhyde@benedictine.edu>,
        bugs <bugs@racket-lang.org>
Cc: nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/15067: Image display darker in DrRacket on Mac
Date: Mon, 18 May 2015 20:28:22 +0200

 --001a113cc266d723a505165f5ba9
 Content-Type: text/plain; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 It does look as if adding color profiles to png would make an improvement.
 
 Here is a few (I hope) relevant links (this subject was more complicated
 than
 expected).
 
 On color spaces and pngs in specific:
 https://hsivonen.fi/png-gamma/
 
 Some background on different on how to use the builtin OS X colorsync
 to measure colors on the screen in different color spaces:
 http://stackoverflow.com/questions/30050879/color-picker-on-mac-os-x-select=
 s-wrong-colors
 [Note: Turn off f.lux if you are using it.]
 
 [Note: that different monitors display colors differently, so OS X uses the
 monitor specs
 to correct for this - so don't expect the RGB colors on screen to match the
 rgb colors
 in the program to match exactly - unless you choose a generic (s?)RGB color
 profile for your screen.]
 
 On the state of color spaces in Cairo:
 http://libregraphicsworld.org/blog/entry/color-managed-cairo-is-slipping-aw=
 ay
 
 Here is a discussion on adding support of color spaces on FireFox (lesson:
 it is complicated):
 https://bugzilla.mozilla.org/show_bug.cgi?id=3D16769
 
 
 
 
 2015-05-18 19:20 GMT+02:00 <jvanderhyde@benedictine.edu>:
 
 > A new problem report is waiting at
 >   http://bugs.racket-lang.org/query/?cmd=3Dview&pr=3D15067
 >
 > Reported by James Vanderhyde for release: 6.1.1
 >
 > *** Description:
 > I have discovered a problem with the color output of images in the
 > Interactions pane of DrRacket in Mac OS X.
 >
 > Colors appear darker than they should. This is easiest to see with code
 > like the following:
 > (beside (rectangle 50 50 "solid" (make-color 0 255 255))
 >         (rectangle 50 50 "solid" (make-color 128 255 255)))
 > The two rectangles look very similar on Mac but very different on Windows=
 .
 > In fact, using the built-in "Digital Color Meter" app I am able to see th=
 at
 > the 128 value for the red channel has been adjusted to 72.
 >
 > If I save an image from Racket (Mac or Windows) and open the PNG file in
 > Preview on Mac, it looks the same (darker, wrong). The same file looks
 > correct when opened in Paint on Windows Vista.
 >
 > I also wrote a native C++ program with Cairo to save out a PNG file to se=
 e
 > if that was an issue. I tried running the Cairo program both in Windows a=
 nd
 > Mac, and the resulting file is the same as the Racket result--it looks fi=
 ne
 > when opened in Windows but wrong on Mac.
 >
 > I created a similar image using a Java program. The resulting PNG file
 > looks correct on both platforms. Upon examinging the files, I discovered
 > that the Java PNG has an embedded ICC profile, and the Cairo PNG does not=
 .
 > It appears that the Mac OS has some kind of "standard" conversion for
 > displaying PNG images that do not have Color Profiles embedded.
 > If I load the Java PNG into Racket, the file looks wrong (i.e., the same
 > as the image generated by Racket in the first place).
 >
 > So, it appears that DrRacket
 > 1. Does not respect the color profile embedded in a PNG file when it
 > displays the image.
 > 2. Does not generate a color profile when it creates a PNG file.
 > 3. Uses some kind of "standard" conversion (presumably from the OS) when
 > displaying images that results in the colors showing up darker than they
 > should be.
 >
 > I consider this a bug because when I create a rectangle with color 128, I
 > want it to be 128, or at least close.
 >
 > *** How to repeat:
 > (require picturing-programs)
 > (rectangle 50 50 "solid" (make-color 128 255 255))
 >
 > Examine the displayed image on a Mac and you can see the red value is 72
 > instead of 128.
 >
 > *** Environment:
 > macosx "Darwin admnclass408.benedictine.edu 14.3.0 Darwin Kernel Version
 > 14.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5/RELEASE_X86_6=
 4
 > x86_64" (x86_64-macosx/3m) (get-display-depth) =3D 32
 > Human Language: english
 > (current-memory-use) 691041968
 > raco pkg (show):
 > Installation-wide:
 >  Package              Checksum                                    Source
 >  main-distribution    84a366a8c2b2908babe6c2811b0ada036bb159df    (catalo=
 g
 > main-distribution)
 >  racket-lib           436f0928598fc1a8abf27422e8e6588bef45f652    (catalo=
 g
 > racket-lib)
 >  [184 auto-installed packages not shown]
 > User-specific for installation "6.1.1":
 >  Package    Checksum                                    Source
 >  rsound     9fe5992ff7f473aba87ab6dc3efe17fbb3536a22    (catalog rsound)
 >  [2 auto-installed packages not shown]
 >
 >
 >
 > Collections:
 > ("/Users/jvanderhyde/Library/Racket/6.1.1/collects"
 >  (non-existent-path))
 > ("/Applications/Racket v6.1.1/collects"
 >  (".gitignore" "acks" "compiler" "data" "db" "dynext" "ffi" "file" "info"
 > "info-domain" "json" "launcher" "net" "openssl" "pkg" "planet" "racket"
 > "raco" "reader" "realm" "s-exp" "setup" "syntax" "unstable" "version"
 > "xml"))
 >
 > Recent Internal Errors:
 > Computer Language: (("Teaching Languages" "How to Design Programs"
 > "Intermediate Student") (#(#t constructor repeating-decimal #f #t none) #=
 f
 > ()))
 >
 >
 
 
 --=20
 --=20
 Jens Axel S=C3=B8gaard
 
 --001a113cc266d723a505165f5ba9
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">It does look as if adding color profiles to png would make=
  an improvement.<div><br></div><div>Here is a few (I hope) relevant links (=
 this subject was more complicated than</div><div>expected).</div><div><br><=
 /div><div><div>On color spaces and pngs in specific:</div><div><a href=3D"h=
 ttps://hsivonen.fi/png-gamma/">https://hsivonen.fi/png-gamma/</a><br></div>=
 </div><div><br></div><div>Some background on different on how to use the bu=
 iltin OS X colorsync</div><div>to measure colors on the screen in different=
  color spaces:</div><div><a href=3D"http://stackoverflow.com/questions/3005=
 0879/color-picker-on-mac-os-x-selects-wrong-colors">http://stackoverflow.co=
 m/questions/30050879/color-picker-on-mac-os-x-selects-wrong-colors</a><br><=
 /div><div>[Note: Turn off f.lux if you are using it.]</div><div><br></div><=
 div>[Note: that different monitors display colors differently, so OS X uses=
  the monitor specs=C2=A0</div><div>to correct for this - so don&#39;t expec=
 t the RGB colors on screen to match the rgb colors</div><div>in the program=
  to match exactly - unless you choose a generic (s?)RGB color profile for y=
 our screen.]</div><div><br></div><div>On the state of color spaces in Cairo=
 :</div><div><a href=3D"http://libregraphicsworld.org/blog/entry/color-manag=
 ed-cairo-is-slipping-away">http://libregraphicsworld.org/blog/entry/color-m=
 anaged-cairo-is-slipping-away</a><br></div><div><br></div><div>Here is a di=
 scussion on adding support of color spaces on FireFox (lesson: it is compli=
 cated):</div><div><a href=3D"https://bugzilla.mozilla.org/show_bug.cgi?id=
 =3D16769">https://bugzilla.mozilla.org/show_bug.cgi?id=3D16769</a><br></div=
 ><div><br></div><div><br></div><div><br></div></div><div class=3D"gmail_ext=
 ra"><br><div class=3D"gmail_quote">2015-05-18 19:20 GMT+02:00  <span dir=3D=
 "ltr">&lt;<a href=3D"mailto:jvanderhyde@benedictine.edu" target=3D"_blank">=
 jvanderhyde@benedictine.edu</a>&gt;</span>:<br><blockquote class=3D"gmail_q=
 uote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1e=
 x">A new problem report is waiting at<br>
 =C2=A0 <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D15=
 067" target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=
 =3D15067</a><br>
 <br>
 Reported by James Vanderhyde for release: 6.1.1<br>
 <br>
 *** Description:<br>
 I have discovered a problem with the color output of images in the Interact=
 ions pane of DrRacket in Mac OS X.<br>
 <br>
 Colors appear darker than they should. This is easiest to see with code lik=
 e the following:<br>
 (beside (rectangle 50 50 &quot;solid&quot; (make-color 0 255 255))<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (rectangle 50 50 &quot;solid&quot; (make-color =
 128 255 255)))<br>
 The two rectangles look very similar on Mac but very different on Windows. =
 In fact, using the built-in &quot;Digital Color Meter&quot; app I am able t=
 o see that the 128 value for the red channel has been adjusted to 72.<br>
 <br>
 If I save an image from Racket (Mac or Windows) and open the PNG file in Pr=
 eview on Mac, it looks the same (darker, wrong). The same file looks correc=
 t when opened in Paint on Windows Vista.<br>
 <br>
 I also wrote a native C++ program with Cairo to save out a PNG file to see =
 if that was an issue. I tried running the Cairo program both in Windows and=
  Mac, and the resulting file is the same as the Racket result--it looks fin=
 e when opened in Windows but wrong on Mac.<br>
 <br>
 I created a similar image using a Java program. The resulting PNG file look=
 s correct on both platforms. Upon examinging the files, I discovered that t=
 he Java PNG has an embedded ICC profile, and the Cairo PNG does not.<br>
 It appears that the Mac OS has some kind of &quot;standard&quot; conversion=
  for displaying PNG images that do not have Color Profiles embedded.<br>
 If I load the Java PNG into Racket, the file looks wrong (i.e., the same as=
  the image generated by Racket in the first place).<br>
 <br>
 So, it appears that DrRacket<br>
 1. Does not respect the color profile embedded in a PNG file when it displa=
 ys the image.<br>
 2. Does not generate a color profile when it creates a PNG file.<br>
 3. Uses some kind of &quot;standard&quot; conversion (presumably from the O=
 S) when displaying images that results in the colors showing up darker than=
  they should be.<br>
 <br>
 I consider this a bug because when I create a rectangle with color 128, I w=
 ant it to be 128, or at least close.<br>
 <br>
 *** How to repeat:<br>
 (require picturing-programs)<br>
 (rectangle 50 50 &quot;solid&quot; (make-color 128 255 255))<br>
 <br>
 Examine the displayed image on a Mac and you can see the red value is 72 in=
 stead of 128.<br>
 <br>
 *** Environment:<br>
 macosx &quot;Darwin <a href=3D"http://admnclass408.benedictine.edu" target=
 =3D"_blank">admnclass408.benedictine.edu</a> 14.3.0 Darwin Kernel Version 1=
 4.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5/RELEASE_X86_64 x=
 86_64&quot; (x86_64-macosx/3m) (get-display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 691041968<br>
 raco pkg (show):<br>
 Installation-wide:<br>
 =C2=A0Package=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checksum=C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Source<br>
 =C2=A0main-distribution=C2=A0 =C2=A0 84a366a8c2b2908babe6c2811b0ada036bb159=
 df=C2=A0 =C2=A0 (catalog main-distribution)<br>
 =C2=A0racket-lib=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0436f0928598fc1a8ab=
 f27422e8e6588bef45f652=C2=A0 =C2=A0 (catalog racket-lib)<br>
 =C2=A0[184 auto-installed packages not shown]<br>
 User-specific for installation &quot;6.1.1&quot;:<br>
 =C2=A0Package=C2=A0 =C2=A0 Checksum=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 Source<br>
 =C2=A0rsound=C2=A0 =C2=A0 =C2=A09fe5992ff7f473aba87ab6dc3efe17fbb3536a22=C2=
 =A0 =C2=A0 (catalog rsound)<br>
 =C2=A0[2 auto-installed packages not shown]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/Users/jvanderhyde/Library/Racket/6.1.1/collects&quot;<br>
 =C2=A0(non-existent-path))<br>
 (&quot;/Applications/Racket v6.1.1/collects&quot;<br>
 =C2=A0(&quot;.gitignore&quot; &quot;acks&quot; &quot;compiler&quot; &quot;d=
 ata&quot; &quot;db&quot; &quot;dynext&quot; &quot;ffi&quot; &quot;file&quot=
 ; &quot;info&quot; &quot;info-domain&quot; &quot;json&quot; &quot;launcher&=
 quot; &quot;net&quot; &quot;openssl&quot; &quot;pkg&quot; &quot;planet&quot=
 ; &quot;racket&quot; &quot;raco&quot; &quot;reader&quot; &quot;realm&quot; =
 &quot;s-exp&quot; &quot;setup&quot; &quot;syntax&quot; &quot;unstable&quot;=
  &quot;version&quot; &quot;xml&quot;))<br>
 <br>
 Recent Internal Errors:<br>
 Computer Language: ((&quot;Teaching Languages&quot; &quot;How to Design Pro=
 grams&quot; &quot;Intermediate Student&quot;) (#(#t constructor repeating-d=
 ecimal #f #t none) #f ()))<br>
 <br>
 </blockquote></div><br><br clear=3D"all"><div><br></div>-- <br><div class=
 =3D"gmail_signature">-- <br>Jens Axel S=C3=B8gaard<br><br></div>
 </div>
 
 --001a113cc266d723a505165f5ba9--
From: James Vanderhyde <jvanderhyde@benedictine.edu>
To: =?iso-8859-1?Q?Jens_Axel_S=F8gaard?= <jensaxel@soegaard.net>,
        bugs
	<bugs@racket-lang.org>
Cc: nobody <nobody@racket-lang.org>,
        bug-notification
	<bug-notification@racket-lang.org>
Subject: RE: [racket-bug] all/15067: Image display darker in DrRacket on Mac
Date: Mon, 18 May 2015 20:14:54 +0000

 --_000_2A1B3601A8B0004486DB9EE3B8BBE79EB50B6391BCEXCHANGEbened_
 Content-Type: text/plain; charset="iso-8859-1"
 Content-Transfer-Encoding: quoted-printable
 
 I checked one more thing. My Mac is running Mac OS X Yosemite 10.10. I just=
  checked the same images in OS X Snow Leopard (10.6). The Racket PNG file l=
 ooks correct, while the Java PNG file (the one with the ICC profile) is bri=
 ghter (red channel 128 became 157). So this problem is due to a fairly rece=
 nt change in the way Mac OS X displays PNGs with and without ICC profiles.
 
 Here is a possibly relevant thread at Apple Support Communities:
 https://discussions.apple.com/thread/5477494?start=3D0&tstart=3D0
 
 James
 --
 James Vanderhyde
 jvanderhyde@benedictine.edu
 ________________________________
 From: jensaxelsoegaard@gmail.com [jensaxelsoegaard@gmail.com] on behalf of =
 Jens Axel S=F8gaard [jensaxel@soegaard.net]
 Sent: Monday, May 18, 2015 1:28 PM
 To: James Vanderhyde; bugs
 Cc: nobody; bug-notification
 Subject: Re: [racket-bug] all/15067: Image display darker in DrRacket on Ma=
 c
 
 It does look as if adding color profiles to png would make an improvement.
 
 Here is a few (I hope) relevant links (this subject was more complicated th=
 an
 expected).
 
 On color spaces and pngs in specific:
 https://hsivonen.fi/png-gamma/
 
 Some background on different on how to use the builtin OS X colorsync
 to measure colors on the screen in different color spaces:
 http://stackoverflow.com/questions/30050879/color-picker-on-mac-os-x-select=
 s-wrong-colors
 [Note: Turn off f.lux if you are using it.]
 
 [Note: that different monitors display colors differently, so OS X uses the=
  monitor specs
 to correct for this - so don't expect the RGB colors on screen to match the=
  rgb colors
 in the program to match exactly - unless you choose a generic (s?)RGB color=
  profile for your screen.]
 
 On the state of color spaces in Cairo:
 http://libregraphicsworld.org/blog/entry/color-managed-cairo-is-slipping-aw=
 ay
 
 Here is a discussion on adding support of color spaces on FireFox (lesson: =
 it is complicated):
 https://bugzilla.mozilla.org/show_bug.cgi?id=3D16769
 
 
 
 
 2015-05-18 19:20 GMT+02:00 <jvanderhyde@benedictine.edu<mailto:jvanderhyde@=
 benedictine.edu>>:
 A new problem report is waiting at
   http://bugs.racket-lang.org/query/?cmd=3Dview&pr=3D15067
 
 Reported by James Vanderhyde for release: 6.1.1
 
 *** Description:
 I have discovered a problem with the color output of images in the Interact=
 ions pane of DrRacket in Mac OS X.
 
 Colors appear darker than they should. This is easiest to see with code lik=
 e the following:
 (beside (rectangle 50 50 "solid" (make-color 0 255 255))
         (rectangle 50 50 "solid" (make-color 128 255 255)))
 The two rectangles look very similar on Mac but very different on Windows. =
 In fact, using the built-in "Digital Color Meter" app I am able to see that=
  the 128 value for the red channel has been adjusted to 72.
 
 If I save an image from Racket (Mac or Windows) and open the PNG file in Pr=
 eview on Mac, it looks the same (darker, wrong). The same file looks correc=
 t when opened in Paint on Windows Vista.
 
 I also wrote a native C++ program with Cairo to save out a PNG file to see =
 if that was an issue. I tried running the Cairo program both in Windows and=
  Mac, and the resulting file is the same as the Racket result--it looks fin=
 e when opened in Windows but wrong on Mac.
 
 I created a similar image using a Java program. The resulting PNG file look=
 s correct on both platforms. Upon examinging the files, I discovered that t=
 he Java PNG has an embedded ICC profile, and the Cairo PNG does not.
 It appears that the Mac OS has some kind of "standard" conversion for displ=
 aying PNG images that do not have Color Profiles embedded.
 If I load the Java PNG into Racket, the file looks wrong (i.e., the same as=
  the image generated by Racket in the first place).
 
 So, it appears that DrRacket
 1. Does not respect the color profile embedded in a PNG file when it displa=
 ys the image.
 2. Does not generate a color profile when it creates a PNG file.
 3. Uses some kind of "standard" conversion (presumably from the OS) when di=
 splaying images that results in the colors showing up darker than they shou=
 ld be.
 
 I consider this a bug because when I create a rectangle with color 128, I w=
 ant it to be 128, or at least close.
 
 *** How to repeat:
 (require picturing-programs)
 (rectangle 50 50 "solid" (make-color 128 255 255))
 
 Examine the displayed image on a Mac and you can see the red value is 72 in=
 stead of 128.
 
 *** Environment:
 macosx "Darwin admnclass408.benedictine.edu<http://admnclass408.benedictine=
 .edu> 14.3.0 Darwin Kernel Version 14.3.0: Mon Mar 23 11:59:05 PDT 2015; ro=
 ot:xnu-2782.20.48~5/RELEASE_X86_64 x86_64" (x86_64-macosx/3m) (get-display-=
 depth) =3D 32
 Human Language: english
 (current-memory-use) 691041968
 raco pkg (show):
 Installation-wide:
  Package              Checksum                                    Source
  main-distribution    84a366a8c2b2908babe6c2811b0ada036bb159df    (catalog =
 main-distribution)
  racket-lib           436f0928598fc1a8abf27422e8e6588bef45f652    (catalog =
 racket-lib)
  [184 auto-installed packages not shown]
 User-specific for installation "6.1.1":
  Package    Checksum                                    Source
  rsound     9fe5992ff7f473aba87ab6dc3efe17fbb3536a22    (catalog rsound)
  [2 auto-installed packages not shown]
 
 
 
 Collections:
 ("/Users/jvanderhyde/Library/Racket/6.1.1/collects"
  (non-existent-path))
 ("/Applications/Racket v6.1.1/collects"
  (".gitignore" "acks" "compiler" "data" "db" "dynext" "ffi" "file" "info" "=
 info-domain" "json" "launcher" "net" "openssl" "pkg" "planet" "racket" "rac=
 o" "reader" "realm" "s-exp" "setup" "syntax" "unstable" "version" "xml"))
 
 Recent Internal Errors:
 Computer Language: (("Teaching Languages" "How to Design Programs" "Interme=
 diate Student") (#(#t constructor repeating-decimal #f #t none) #f ()))
 
 
 
 
 --
 --
 Jens Axel S=F8gaard
 
 
 --_000_2A1B3601A8B0004486DB9EE3B8BBE79EB50B6391BCEXCHANGEbened_
 Content-Type: text/html; charset="iso-8859-1"
 Content-Transfer-Encoding: quoted-printable
 
 <html dir=3D"ltr">
 <head>
 <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Diso-8859-=
 1">
 <style type=3D"text/css" id=3D"owaParaStyle"></style>
 </head>
 <body fpstyle=3D"1" ocsi=3D"0">
 <div style=3D"direction: ltr;font-family: Tahoma;color: #000000;font-size: =
 10pt;">
 <div style=3D"direction:ltr; font-family:Tahoma; color:#000000; font-size:1=
 0pt">I checked one more thing. My Mac is running Mac OS X Yosemite 10.10. I=
  just checked the same images in OS X Snow Leopard (10.6). The Racket PNG f=
 ile looks correct, while the Java
  PNG file (the one with the ICC profile) is brighter (red channel 128 becam=
 e 157). So this problem is due to a fairly recent change in the way Mac OS =
 X displays PNGs with and without ICC profiles.</div>
 <div style=3D"direction:ltr; font-family:Tahoma; color:#000000; font-size:1=
 0pt"><br>
 </div>
 <div style=3D"direction:ltr; font-family:Tahoma; color:#000000; font-size:1=
 0pt">Here is a possibly relevant thread at Apple Support Communities:</div>
 <div style=3D"direction:ltr; font-family:Tahoma; color:#000000; font-size:1=
 0pt">https://discussions.apple.com/thread/5477494?start=3D0&amp;tstart=3D0<=
 br>
 <div><br>
 </div>
 <div>James<br>
 <div class=3D"BodyFragment"><font size=3D"2">
 <div class=3D"PlainText">--<br>
 James Vanderhyde<br>
 jvanderhyde@benedictine.edu</div>
 </font></div>
 </div>
 <div style=3D"font-family:Times New Roman; color:#000000; font-size:16px">
 <hr tabindex=3D"-1">
 <div id=3D"divRpF822755" style=3D"direction:ltr"><font face=3D"Tahoma" size=
 =3D"2" color=3D"#000000"><b>From:</b> jensaxelsoegaard@gmail.com [jensaxels=
 oegaard@gmail.com] on behalf of Jens Axel S=F8gaard [jensaxel@soegaard.net]=
 <br>
 <b>Sent:</b> Monday, May 18, 2015 1:28 PM<br>
 <b>To:</b> James Vanderhyde; bugs<br>
 <b>Cc:</b> nobody; bug-notification<br>
 <b>Subject:</b> Re: [racket-bug] all/15067: Image display darker in DrRacke=
 t on Mac<br>
 </font><br>
 </div>
 <div></div>
 <div>
 <div dir=3D"ltr">It does look as if adding color profiles to png would make=
  an improvement.
 <div><br>
 </div>
 <div>Here is a few (I hope) relevant links (this subject was more complicat=
 ed than</div>
 <div>expected).</div>
 <div><br>
 </div>
 <div>
 <div>On color spaces and pngs in specific:</div>
 <div><a href=3D"https://hsivonen.fi/png-gamma/" target=3D"_blank">https://h=
 sivonen.fi/png-gamma/</a><br>
 </div>
 </div>
 <div><br>
 </div>
 <div>Some background on different on how to use the builtin OS X colorsync<=
 /div>
 <div>to measure colors on the screen in different color spaces:</div>
 <div><a href=3D"http://stackoverflow.com/questions/30050879/color-picker-on=
 -mac-os-x-selects-wrong-colors" target=3D"_blank">http://stackoverflow.com/=
 questions/30050879/color-picker-on-mac-os-x-selects-wrong-colors</a><br>
 </div>
 <div>[Note: Turn off f.lux if you are using it.]</div>
 <div><br>
 </div>
 <div>[Note: that different monitors display colors differently, so OS X use=
 s the monitor specs&nbsp;</div>
 <div>to correct for this - so don't expect the RGB colors on screen to matc=
 h the rgb colors</div>
 <div>in the program to match exactly - unless you choose a generic (s?)RGB =
 color profile for your screen.]</div>
 <div><br>
 </div>
 <div>On the state of color spaces in Cairo:</div>
 <div><a href=3D"http://libregraphicsworld.org/blog/entry/color-managed-cair=
 o-is-slipping-away" target=3D"_blank">http://libregraphicsworld.org/blog/en=
 try/color-managed-cairo-is-slipping-away</a><br>
 </div>
 <div><br>
 </div>
 <div>Here is a discussion on adding support of color spaces on FireFox (les=
 son: it is complicated):</div>
 <div><a href=3D"https://bugzilla.mozilla.org/show_bug.cgi?id=3D16769" targe=
 t=3D"_blank">https://bugzilla.mozilla.org/show_bug.cgi?id=3D16769</a><br>
 </div>
 <div><br>
 </div>
 <div><br>
 </div>
 <div><br>
 </div>
 </div>
 <div class=3D"gmail_extra"><br>
 <div class=3D"gmail_quote">2015-05-18 19:20 GMT&#43;02:00 <span dir=3D"ltr"=
 >&lt;<a href=3D"mailto:jvanderhyde@benedictine.edu" target=3D"_blank">jvand=
 erhyde@benedictine.edu</a>&gt;</span>:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex; border-left:1=
 px #ccc solid; padding-left:1ex">
 A new problem report is waiting at<br>
 &nbsp; <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D15=
 067" target=3D"_blank">
 http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D15067</a><br>
 <br>
 Reported by James Vanderhyde for release: 6.1.1<br>
 <br>
 *** Description:<br>
 I have discovered a problem with the color output of images in the Interact=
 ions pane of DrRacket in Mac OS X.<br>
 <br>
 Colors appear darker than they should. This is easiest to see with code lik=
 e the following:<br>
 (beside (rectangle 50 50 &quot;solid&quot; (make-color 0 255 255))<br>
 &nbsp; &nbsp; &nbsp; &nbsp; (rectangle 50 50 &quot;solid&quot; (make-color =
 128 255 255)))<br>
 The two rectangles look very similar on Mac but very different on Windows. =
 In fact, using the built-in &quot;Digital Color Meter&quot; app I am able t=
 o see that the 128 value for the red channel has been adjusted to 72.<br>
 <br>
 If I save an image from Racket (Mac or Windows) and open the PNG file in Pr=
 eview on Mac, it looks the same (darker, wrong). The same file looks correc=
 t when opened in Paint on Windows Vista.<br>
 <br>
 I also wrote a native C&#43;&#43; program with Cairo to save out a PNG file=
  to see if that was an issue. I tried running the Cairo program both in Win=
 dows and Mac, and the resulting file is the same as the Racket result--it l=
 ooks fine when opened in Windows but wrong
  on Mac.<br>
 <br>
 I created a similar image using a Java program. The resulting PNG file look=
 s correct on both platforms. Upon examinging the files, I discovered that t=
 he Java PNG has an embedded ICC profile, and the Cairo PNG does not.<br>
 It appears that the Mac OS has some kind of &quot;standard&quot; conversion=
  for displaying PNG images that do not have Color Profiles embedded.<br>
 If I load the Java PNG into Racket, the file looks wrong (i.e., the same as=
  the image generated by Racket in the first place).<br>
 <br>
 So, it appears that DrRacket<br>
 1. Does not respect the color profile embedded in a PNG file when it displa=
 ys the image.<br>
 2. Does not generate a color profile when it creates a PNG file.<br>
 3. Uses some kind of &quot;standard&quot; conversion (presumably from the O=
 S) when displaying images that results in the colors showing up darker than=
  they should be.<br>
 <br>
 I consider this a bug because when I create a rectangle with color 128, I w=
 ant it to be 128, or at least close.<br>
 <br>
 *** How to repeat:<br>
 (require picturing-programs)<br>
 (rectangle 50 50 &quot;solid&quot; (make-color 128 255 255))<br>
 <br>
 Examine the displayed image on a Mac and you can see the red value is 72 in=
 stead of 128.<br>
 <br>
 *** Environment:<br>
 macosx &quot;Darwin <a href=3D"http://admnclass408.benedictine.edu" target=
 =3D"_blank">admnclass408.benedictine.edu</a> 14.3.0 Darwin Kernel Version 1=
 4.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5/RELEASE_X86_64 x=
 86_64&quot; (x86_64-macosx/3m) (get-display-depth)
  =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 691041968<br>
 raco pkg (show):<br>
 Installation-wide:<br>
 &nbsp;Package&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Checksum&nbsp=
 ; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nb=
 sp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Source<br>
 &nbsp;main-distribution&nbsp; &nbsp; 84a366a8c2b2908babe6c2811b0ada036bb159=
 df&nbsp; &nbsp; (catalog main-distribution)<br>
 &nbsp;racket-lib&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;436f0928598fc1a8ab=
 f27422e8e6588bef45f652&nbsp; &nbsp; (catalog racket-lib)<br>
 &nbsp;[184 auto-installed packages not shown]<br>
 User-specific for installation &quot;6.1.1&quot;:<br>
 &nbsp;Package&nbsp; &nbsp; Checksum&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp=
 ; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nb=
 sp; &nbsp; Source<br>
 &nbsp;rsound&nbsp; &nbsp; &nbsp;9fe5992ff7f473aba87ab6dc3efe17fbb3536a22&nb=
 sp; &nbsp; (catalog rsound)<br>
 &nbsp;[2 auto-installed packages not shown]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/Users/jvanderhyde/Library/Racket/6.1.1/collects&quot;<br>
 &nbsp;(non-existent-path))<br>
 (&quot;/Applications/Racket v6.1.1/collects&quot;<br>
 &nbsp;(&quot;.gitignore&quot; &quot;acks&quot; &quot;compiler&quot; &quot;d=
 ata&quot; &quot;db&quot; &quot;dynext&quot; &quot;ffi&quot; &quot;file&quot=
 ; &quot;info&quot; &quot;info-domain&quot; &quot;json&quot; &quot;launcher&=
 quot; &quot;net&quot; &quot;openssl&quot; &quot;pkg&quot; &quot;planet&quot=
 ; &quot;racket&quot; &quot;raco&quot; &quot;reader&quot; &quot;realm&quot; =
 &quot;s-exp&quot; &quot;setup&quot; &quot;syntax&quot; &quot;unstable&quot;=
  &quot;version&quot; &quot;xml&quot;))<br>
 <br>
 Recent Internal Errors:<br>
 Computer Language: ((&quot;Teaching Languages&quot; &quot;How to Design Pro=
 grams&quot; &quot;Intermediate Student&quot;) (#(#t constructor repeating-d=
 ecimal #f #t none) #f ()))<br>
 <br>
 </blockquote>
 </div>
 <br>
 <br clear=3D"all">
 <div><br>
 </div>
 -- <br>
 <div class=3D"gmail_signature">-- <br>
 Jens Axel S=F8gaard<br>
 <br>
 </div>
 </div>
 </div>
 </div>
 </div>
 </div>
 </body>
 </html>
 
 --_000_2A1B3601A8B0004486DB9EE3B8BBE79EB50B6391BCEXCHANGEbened_--
From: James Vanderhyde <jvanderhyde@benedictine.edu>
To: "bugs@racket-lang.org" <bugs@racket-lang.org>,
        "bug-notification@racket-lang.org" <bug-notification@racket-lang.org>
Cc: 
Subject: Re: [racket-bug] all/15067: Image display darker in DrRacket on Mac
Date: Mon, 18 May 2015 21:17:52 +0000

 One more clarification:
 
 I stated “The Java PNG has an embedded ICC profile.” That’s not exactly accurate. It was few months ago and I had forgotten how I created that Java image. I found my Java code—it draws rectangles to an image and then displays the image in a window. I must have taken a screenshot of that window to show what I wanted it to look like. Evidently the system screenshot utility embeds the ICC profile in the PNG. 
 
 Java’s ImageIO does not embed an ICC profile and the PNG output files look the same as Racket’s (Cairo’s).
 
 James
 --
 Dr. James Vanderhyde
 Math and Computer Science
 Benedictine College
 jvanderhyde@benedictine.edu
 http://vanderhyde.us/~james/pro/
 
 
