From bugs+caf_=bugs=bugs.plt-scheme.org@plt-scheme.org Thu Apr 11 16:10:05 2013
Received: from mail-oa0-f46.google.com (mail-oa0-f46.google.com [209.85.219.46])
	by champlain.ccs.neu.edu (8.14.4/8.14.4) with ESMTP id r3BKA1Y3009708
	for <bugs@bugs.plt-scheme.org>; Thu, 11 Apr 2013 16:10:02 -0400
Message-Id: <201304112009.r3BK9tEZ009694@champlain.ccs.neu.edu>
Date: Thu, 11 Apr 2013 16:09:55 -0400
From: asumu@ccs.neu.edu
To: bugs@racket-lang.org
Subject: recursive-contract just prints syntax instead of a nice representation

>Number:         13686
>Category:       all
>Synopsis:       recursive-contract just prints syntax instead of a nice representation
>Class:          sw-bug
>Responsible:    robby
>Severity:       serious
>Priority:       medium
>State:          closed
>Confidential:   no
>Arrival-Date:   Thu Apr 11 16:12:02 -0400 2013
>Closed-Date:    Thu Apr 11 23:45:08 -0400 2013
>Last-Modified:  Thu Apr 11 23:45:08 -0400 2013
>Originator:     Asumu Takikawa
>Organization:
plt
>Submitter-Id:   unknown
>Release:        5.3.4.2--2013-04-10(6e0492df/d)
>Environment:
unix "Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC 2012 x86_64 GNU/Linux" (x86_64-linux/3m) (get-display-depth) = 32
Human Language: english
(current-memory-use) 338450700
Links: (links) = ("pict-utils" "x11-racket" "rwind" "drracket-vim-tool" "tr-both" "Acquire"); (links #:user? #f) = (); (links #:root? #t) = (#<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/lang-slide> #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/sweet-racket> #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/taglib> #<path:/home/asumu/code/contract-repl>); (links #:user? #f #:root? #t) = ()
raco pkg (show):
Installation-wide:
 [none]
User-specific, all-version:
 Package[*=auto]    Checksum                                    Source
 contract-repl      #f                                          (link /home/asumu/code/contract-repl)
 lang-slide         40f30a8ce128493c887dc0c0bb0798fab6514837    (pns lang-slide)
 taglib             305a3ca74c2437e2bf6acabd2d130c0b0e59e304    (pnr taglib)
User-specific, version-specific (5.3.4.2):
 [none]



Collections:
("/home/asumu/plt/racket-git/add-on/5.3.4.2/collects"
 (non-existent-path))
("/home/asumu/plt/racket-git/collects"
 ("graphics" "future-visualizer" "frtime" "framework" "make" "sgl" "0001-Remove-duplicate-non-terminals-in-define-extended-la.patch" "waterworld" "launcher" "compiler" "planet2" "mred" "srfi" "setup" "wxme" "honu" "mrlib" "scriblib" "r5rs" "trace" "info-domain" "typed-racket" "racket" "net" "file" "slideshow" "string-constants" "racklog" "openssl" "macro-debugger" "xml" "combinator-parser" "foo2.gif" "mysterx" "html" "drscheme" "at-exp" "hierlist" "profile" "icons" "sirmail" "readline" "config" "syntax" "scribble" "texpict" "mzlib" "realm" "math" "typed" "web-server" "plai" "handin-client" "rnrs" "eopl" "drracket" "handin-server" "planet" "syntax-color" "repo-time-stamp" "test-engine" "games" "picturing-programs" "ffi" "xrepl" "tex2page" "images" "errortrace" "json" "foo.gif" "data" "unstable" "NormalizationTest.txt" "r6rs" "browser" "2htdp" "parser-tools" "slatex" "scheme" "compatibility" "algol60" "scribblings" "pkg" "stepper" "lazy" "rackunit" "gui-debugger" "plot" "help"!
  "meta" "redex" "version" "defaults" "s-exp" "test-box-recovery" "srpersist" "tests" "swindle" "mzscheme" "guibuilder" "deinprogramm" "raco" "preprocessor" "typed-scheme" "db" "embedded-gui" "lang" "dynext" "reader" ".gitignore" "htdp" "schemeunit" "teachpack" "mzcom" "datalog"))

Computer Language: (("Determine language from source") (#(#t print mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main) (test))))
>Description:
Consider the following example:

#lang racket

(contract (recursive-contract (flat-named-contract 'foo integer?))
          "foo"
          'pos
          'neg)

The resulting error is

unsaved-editor752:3:0: broke its contract
 promised: foo
 produced: "foo"
 in: (recursive-contract
       (flat-named-contract 'foo integer?))
 contract from: pos
 blaming: pos

Notice that the "in:" line just prints the quoted syntax of
the contract and not a nice representation (e.g., the flat
part should be "foo").
>How-To-Repeat:

>Fix:
>Audit-Trail:
From: Robby Findler <robby@eecs.northwestern.edu>
To: "asumu@ccs.neu.edu" <asumu@ccs.neu.edu>,
        "bugs@racket-lang.org" <bugs@racket-lang.org>
Cc: "nobody@racket-lang.org" <nobody@racket-lang.org>,
        "bug-notification@racket-lang.org" <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13686: recursive-contract just prints syntax
 instead of a nice representation
Date: Thu, 11 Apr 2013 19:29:06 -0500

 --f46d043749e1ab952204da1efd2b
 Content-Type: text/plain; charset=UTF-8
 
 How do you suggest I accomplish this?
 
 Robby
 
 On Thursday, April 11, 2013, wrote:
 
 > A new problem report is waiting at
 >   http://bugs.racket-lang.org/query/?cmd=view&pr=13686
 >
 > Reported by Asumu Takikawa for release: 5.3.4.2--2013-04-10(6e0492df/d)
 >
 > *** Description:
 > Consider the following example:
 >
 > #lang racket
 >
 > (contract (recursive-contract (flat-named-contract 'foo integer?))
 >           "foo"
 >           'pos
 >           'neg)
 >
 > The resulting error is
 >
 > unsaved-editor752:3:0: broke its contract
 >  promised: foo
 >  produced: "foo"
 >  in: (recursive-contract
 >        (flat-named-contract 'foo integer?))
 >  contract from: pos
 >  blaming: pos
 >
 > Notice that the "in:" line just prints the quoted syntax of
 > the contract and not a nice representation (e.g., the flat
 > part should be "foo").
 >
 > *** How to repeat:
 >
 >
 > *** Environment:
 > unix "Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC 2012
 > x86_64 GNU/Linux" (x86_64-linux/3m) (get-display-depth) = 32
 > Human Language: english
 > (current-memory-use) 338450700
 > Links: (links) = ("pict-utils" "x11-racket" "rwind" "drracket-vim-tool"
 > "tr-both" "Acquire"); (links #:user? #f) = (); (links #:root? #t) =
 > (#<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/lang-slide>
 > #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/sweet-racket>
 > #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/taglib>
 > #<path:/home/asumu/code/contract-repl>); (links #:user? #f #:root? #t) = ()
 > raco pkg (show):
 > Installation-wide:
 >  [none]
 > User-specific, all-version:
 >  Package[*=auto]    Checksum                                    Source
 >  contract-repl      #f                                          (link
 > /home/asumu/code/contract-repl)
 >  lang-slide         40f30a8ce128493c887dc0c0bb0798fab6514837    (pns
 > lang-slide)
 >  taglib             305a3ca74c2437e2bf6acabd2d130c0b0e59e304    (pnr
 > taglib)
 > User-specific, version-specific (5.3.4.2):
 >  [none]
 >
 >
 >
 > Collections:
 > ("/home/asumu/plt/racket-git/add-on/5.3.4.2/collects"
 >  (non-existent-path))
 > ("/home/asumu/plt/racket-git/collects"
 >  ("graphics" "future-visualizer" "frtime" "framework" "make" "sgl"
 > "0001-Remove-duplicate-non-terminals-in-define-extended-la.patch"
 > "waterworld" "launcher" "compiler" "planet2" "mred" "srfi" "setup" "wxme"
 > "honu" "mrlib" "scriblib" "r5rs" "trace" "info-domain" "typed-racket"
 > "racket" "net" "file" "slideshow" "string-constants" "racklog" "openssl"
 > "macro-debugger" "xml" "combinator-parser" "foo2.gif" "mysterx" "html"
 > "drscheme" "at-exp" "hierlist" "profile" "icons" "sirmail" "readline"
 > "config" "syntax" "scribble" "texpict" "mzlib" "realm" "math" "typed"
 > "web-server" "plai" "handin-client" "rnrs" "eopl" "drracket"
 > "handin-server" "planet" "syntax-color" "repo-time-stamp" "test-engine"
 > "games" "picturing-programs" "ffi" "xrepl" "tex2page" "images" "errortrace"
 > "json" "foo.gif" "data" "unstable" "NormalizationTest.txt" "r6rs" "browser"
 > "2htdp" "parser-tools" "slatex" "scheme" "compatibility" "algol60"
 > "scribblings" "pkg" "stepper" "lazy" "rackunit" "gui-debugger" "plot"
 > "help"!
 >   "meta" "redex" "version" "defaults" "s-exp" "test-box-recovery"
 > "srpersist" "tests" "swindle" "mzscheme" "guibuilder" "deinprogramm" "raco"
 > "preprocessor" "typed-scheme" "db" "embedded-gui" "lang" "dynext" "reader"
 > ".gitignore" "htdp" "schemeunit" "teachpack" "mzcom" "datalog"))
 >
 > Computer Language: (("Determine language from source") (#(#t print
 > mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main)
 > (test))))
 >
 >
 >
 
 --f46d043749e1ab952204da1efd2b
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div>How do you suggest I accomplish this?</div><div><br></div><div>Robby<b=
 r><br>On Thursday, April 11, 2013,   wrote:<br><blockquote class=3D"gmail_q=
 uote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1e=
 x">
 A new problem report is waiting at<br>
 =C2=A0 <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D13=
 686" target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=
 =3D13686</a><br>
 <br>
 Reported by Asumu Takikawa for release: 5.3.4.2--2013-04-10(6e0492df/d)<br>
 <br>
 *** Description:<br>
 Consider the following example:<br>
 <br>
 #lang racket<br>
 <br>
 (contract (recursive-contract (flat-named-contract &#39;foo integer?))<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;foo&quot;<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &#39;pos<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &#39;neg)<br>
 <br>
 The resulting error is<br>
 <br>
 unsaved-editor752:3:0: broke its contract<br>
 =C2=A0promised: foo<br>
 =C2=A0produced: &quot;foo&quot;<br>
 =C2=A0in: (recursive-contract<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0(flat-named-contract &#39;foo integer?))<br>
 =C2=A0contract from: pos<br>
 =C2=A0blaming: pos<br>
 <br>
 Notice that the &quot;in:&quot; line just prints the quoted syntax of<br>
 the contract and not a nice representation (e.g., the flat<br>
 part should be &quot;foo&quot;).<br>
 <br>
 *** How to repeat:<br>
 <br>
 <br>
 *** Environment:<br>
 unix &quot;Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC 20=
 12 x86_64 GNU/Linux&quot; (x86_64-linux/3m) (get-display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 338450700<br>
 Links: (links) =3D (&quot;pict-utils&quot; &quot;x11-racket&quot; &quot;rwi=
 nd&quot; &quot;drracket-vim-tool&quot; &quot;tr-both&quot; &quot;Acquire&qu=
 ot;); (links #:user? #f) =3D (); (links #:root? #t) =3D (#&lt;path:/home/as=
 umu/plt/racket-git/add-on/pkgs/installed/lang-slide&gt; #&lt;path:/home/asu=
 mu/plt/racket-git/add-on/pkgs/installed/sweet-racket&gt; #&lt;path:/home/as=
 umu/plt/racket-git/add-on/pkgs/installed/taglib&gt; #&lt;path:/home/asumu/c=
 ode/contract-repl&gt;); (links #:user? #f #:root? #t) =3D ()<br>
 
 raco pkg (show):<br>
 Installation-wide:<br>
 =C2=A0[none]<br>
 User-specific, all-version:<br>
 =C2=A0Package[*=3Dauto] =C2=A0 =C2=A0Checksum =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0Source<br>
 =C2=A0contract-repl =C2=A0 =C2=A0 =C2=A0#f =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(link /home/asumu/code/contract-re=
 pl)<br>
 =C2=A0lang-slide =C2=A0 =C2=A0 =C2=A0 =C2=A0 40f30a8ce128493c887dc0c0bb0798=
 fab6514837 =C2=A0 =C2=A0(pns lang-slide)<br>
 =C2=A0taglib =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 305a3ca74c2437e2bf6a=
 cabd2d130c0b0e59e304 =C2=A0 =C2=A0(pnr taglib)<br>
 User-specific, version-specific (5.3.4.2):<br>
 =C2=A0[none]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/home/asumu/plt/racket-git/add-on/<a href=3D"http://5.3.4.2/collects=
 " target=3D"_blank">5.3.4.2/collects</a>&quot;<br>
 =C2=A0(non-existent-path))<br>
 (&quot;/home/asumu/plt/racket-git/collects&quot;<br>
 =C2=A0(&quot;graphics&quot; &quot;future-visualizer&quot; &quot;frtime&quot=
 ; &quot;framework&quot; &quot;make&quot; &quot;sgl&quot; &quot;0001-Remove-=
 duplicate-non-terminals-in-define-extended-la.patch&quot; &quot;waterworld&=
 quot; &quot;launcher&quot; &quot;compiler&quot; &quot;planet2&quot; &quot;m=
 red&quot; &quot;srfi&quot; &quot;setup&quot; &quot;wxme&quot; &quot;honu&qu=
 ot; &quot;mrlib&quot; &quot;scriblib&quot; &quot;r5rs&quot; &quot;trace&quo=
 t; &quot;info-domain&quot; &quot;typed-racket&quot; &quot;racket&quot; &quo=
 t;net&quot; &quot;file&quot; &quot;slideshow&quot; &quot;string-constants&q=
 uot; &quot;racklog&quot; &quot;openssl&quot; &quot;macro-debugger&quot; &qu=
 ot;xml&quot; &quot;combinator-parser&quot; &quot;foo2.gif&quot; &quot;myste=
 rx&quot; &quot;html&quot; &quot;drscheme&quot; &quot;at-exp&quot; &quot;hie=
 rlist&quot; &quot;profile&quot; &quot;icons&quot; &quot;sirmail&quot; &quot=
 ;readline&quot; &quot;config&quot; &quot;syntax&quot; &quot;scribble&quot; =
 &quot;texpict&quot; &quot;mzlib&quot; &quot;realm&quot; &quot;math&quot; &q=
 uot;typed&quot; &quot;web-server&quot; &quot;plai&quot; &quot;handin-client=
 &quot; &quot;rnrs&quot; &quot;eopl&quot; &quot;drracket&quot; &quot;handin-=
 server&quot; &quot;planet&quot; &quot;syntax-color&quot; &quot;repo-time-st=
 amp&quot; &quot;test-engine&quot; &quot;games&quot; &quot;picturing-program=
 s&quot; &quot;ffi&quot; &quot;xrepl&quot; &quot;tex2page&quot; &quot;images=
 &quot; &quot;errortrace&quot; &quot;json&quot; &quot;foo.gif&quot; &quot;da=
 ta&quot; &quot;unstable&quot; &quot;NormalizationTest.txt&quot; &quot;r6rs&=
 quot; &quot;browser&quot; &quot;2htdp&quot; &quot;parser-tools&quot; &quot;=
 slatex&quot; &quot;scheme&quot; &quot;compatibility&quot; &quot;algol60&quo=
 t; &quot;scribblings&quot; &quot;pkg&quot; &quot;stepper&quot; &quot;lazy&q=
 uot; &quot;rackunit&quot; &quot;gui-debugger&quot; &quot;plot&quot; &quot;h=
 elp&quot;!<br>
 
 =C2=A0 &quot;meta&quot; &quot;redex&quot; &quot;version&quot; &quot;default=
 s&quot; &quot;s-exp&quot; &quot;test-box-recovery&quot; &quot;srpersist&quo=
 t; &quot;tests&quot; &quot;swindle&quot; &quot;mzscheme&quot; &quot;guibuil=
 der&quot; &quot;deinprogramm&quot; &quot;raco&quot; &quot;preprocessor&quot=
 ; &quot;typed-scheme&quot; &quot;db&quot; &quot;embedded-gui&quot; &quot;la=
 ng&quot; &quot;dynext&quot; &quot;reader&quot; &quot;.gitignore&quot; &quot=
 ;htdp&quot; &quot;schemeunit&quot; &quot;teachpack&quot; &quot;mzcom&quot; =
 &quot;datalog&quot;))<br>
 
 <br>
 Computer Language: ((&quot;Determine language from source&quot;) (#(#t prin=
 t mixed-fraction-e #f #t debug) (default) #() &quot;#lang racket\n&quot; #t=
  #t ((main) (test))))<br>
 <br><br>
 </blockquote></div>
 
 --f46d043749e1ab952204da1efd2b--
From: Matthias Felleisen <matthias@ccs.neu.edu>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: "asumu@ccs.neu.edu" <asumu@ccs.neu.edu>,
        "bugs@racket-lang.org" <bugs@racket-lang.org>,
        "nobody@racket-lang.org" <nobody@racket-lang.org>,
        "bug-notification@racket-lang.org" <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13686: recursive-contract just prints syntax instead of a nice representation
Date: Thu, 11 Apr 2013 21:32:32 -0400

 --Apple-Mail=_41609D99-2988-4213-B0D5-768A0633E4D2
 Content-Transfer-Encoding: quoted-printable
 Content-Type: text/plain;
 	charset=us-ascii
 
 
 Asumu, can you make an example of what it should look like.  As in foo =3D=
  ... foo ... without dots.=20
 
 
 
 On Apr 11, 2013, at 8:29 PM, Robby Findler wrote:
 
 > How do you suggest I accomplish this?
 >=20
 > Robby
 >=20
 > On Thursday, April 11, 2013, wrote:
 > A new problem report is waiting at
 >   http://bugs.racket-lang.org/query/?cmd=3Dview&pr=3D13686
 >=20
 > Reported by Asumu Takikawa for release: =
 5.3.4.2--2013-04-10(6e0492df/d)
 >=20
 > *** Description:
 > Consider the following example:
 >=20
 > #lang racket
 >=20
 > (contract (recursive-contract (flat-named-contract 'foo integer?))
 >           "foo"
 >           'pos
 >           'neg)
 >=20
 > The resulting error is
 >=20
 > unsaved-editor752:3:0: broke its contract
 >  promised: foo
 >  produced: "foo"
 >  in: (recursive-contract
 >        (flat-named-contract 'foo integer?))
 >  contract from: pos
 >  blaming: pos
 >=20
 > Notice that the "in:" line just prints the quoted syntax of
 > the contract and not a nice representation (e.g., the flat
 > part should be "foo").
 >=20
 > *** How to repeat:
 >=20
 >=20
 > *** Environment:
 > unix "Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC =
 2012 x86_64 GNU/Linux" (x86_64-linux/3m) (get-display-depth) =3D 32
 > Human Language: english
 > (current-memory-use) 338450700
 > Links: (links) =3D ("pict-utils" "x11-racket" "rwind" =
 "drracket-vim-tool" "tr-both" "Acquire"); (links #:user? #f) =3D (); =
 (links #:root? #t) =3D =
 (#<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/lang-slide> =
 #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/sweet-racket> =
 #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/taglib> =
 #<path:/home/asumu/code/contract-repl>); (links #:user? #f #:root? #t) =3D=
  ()
 > raco pkg (show):
 > Installation-wide:
 >  [none]
 > User-specific, all-version:
 >  Package[*=3Dauto]    Checksum                                    =
 Source
 >  contract-repl      #f                                          (link =
 /home/asumu/code/contract-repl)
 >  lang-slide         40f30a8ce128493c887dc0c0bb0798fab6514837    (pns =
 lang-slide)
 >  taglib             305a3ca74c2437e2bf6acabd2d130c0b0e59e304    (pnr =
 taglib)
 > User-specific, version-specific (5.3.4.2):
 >  [none]
 >=20
 >=20
 >=20
 > Collections:
 > ("/home/asumu/plt/racket-git/add-on/5.3.4.2/collects"
 >  (non-existent-path))
 > ("/home/asumu/plt/racket-git/collects"
 >  ("graphics" "future-visualizer" "frtime" "framework" "make" "sgl" =
 "0001-Remove-duplicate-non-terminals-in-define-extended-la.patch" =
 "waterworld" "launcher" "compiler" "planet2" "mred" "srfi" "setup" =
 "wxme" "honu" "mrlib" "scriblib" "r5rs" "trace" "info-domain" =
 "typed-racket" "racket" "net" "file" "slideshow" "string-constants" =
 "racklog" "openssl" "macro-debugger" "xml" "combinator-parser" =
 "foo2.gif" "mysterx" "html" "drscheme" "at-exp" "hierlist" "profile" =
 "icons" "sirmail" "readline" "config" "syntax" "scribble" "texpict" =
 "mzlib" "realm" "math" "typed" "web-server" "plai" "handin-client" =
 "rnrs" "eopl" "drracket" "handin-server" "planet" "syntax-color" =
 "repo-time-stamp" "test-engine" "games" "picturing-programs" "ffi" =
 "xrepl" "tex2page" "images" "errortrace" "json" "foo.gif" "data" =
 "unstable" "NormalizationTest.txt" "r6rs" "browser" "2htdp" =
 "parser-tools" "slatex" "scheme" "compatibility" "algol60" "scribblings" =
 "pkg" "stepper" "lazy" "rackunit" "gui-debugger" "plot" "help"!
 >   "meta" "redex" "version" "defaults" "s-exp" "test-box-recovery" =
 "srpersist" "tests" "swindle" "mzscheme" "guibuilder" "deinprogramm" =
 "raco" "preprocessor" "typed-scheme" "db" "embedded-gui" "lang" "dynext" =
 "reader" ".gitignore" "htdp" "schemeunit" "teachpack" "mzcom" =
 "datalog"))
 >=20
 > Computer Language: (("Determine language from source") (#(#t print =
 mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t =
 ((main) (test))))
 >=20
 >=20
 
 
 --Apple-Mail=_41609D99-2988-4213-B0D5-768A0633E4D2
 Content-Transfer-Encoding: quoted-printable
 Content-Type: text/html;
 	charset=us-ascii
 
 <html><head></head><body style=3D"word-wrap: break-word; =
 -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; =
 "><div><br></div><div>Asumu, can you make an example of what it should =
 look like. &nbsp;As in foo =3D ... foo ... without =
 dots.&nbsp;</div><div><br></div><div><br></div><br><div><div>On Apr 11, =
 2013, at 8:29 PM, Robby Findler wrote:</div><br =
 class=3D"Apple-interchange-newline"><blockquote type=3D"cite"><div>How =
 do you suggest I accomplish =
 this?</div><div><br></div><div>Robby<br><br>On Thursday, April 11, 2013, =
   wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 =
 .8ex;border-left:1px #ccc solid;padding-left:1ex">
 A new problem report is waiting at<br>
 &nbsp; <a =
 href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D13686" =
 target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D1=
 3686</a><br>
 <br>
 Reported by Asumu Takikawa for release: =
 5.3.4.2--2013-04-10(6e0492df/d)<br>
 <br>
 *** Description:<br>
 Consider the following example:<br>
 <br>
 #lang racket<br>
 <br>
 (contract (recursive-contract (flat-named-contract 'foo integer?))<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "foo"<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'pos<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'neg)<br>
 <br>
 The resulting error is<br>
 <br>
 unsaved-editor752:3:0: broke its contract<br>
 &nbsp;promised: foo<br>
 &nbsp;produced: "foo"<br>
 &nbsp;in: (recursive-contract<br>
 &nbsp; &nbsp; &nbsp; &nbsp;(flat-named-contract 'foo integer?))<br>
 &nbsp;contract from: pos<br>
 &nbsp;blaming: pos<br>
 <br>
 Notice that the "in:" line just prints the quoted syntax of<br>
 the contract and not a nice representation (e.g., the flat<br>
 part should be "foo").<br>
 <br>
 *** How to repeat:<br>
 <br>
 <br>
 *** Environment:<br>
 unix "Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC 2012 =
 x86_64 GNU/Linux" (x86_64-linux/3m) (get-display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 338450700<br>
 Links: (links) =3D ("pict-utils" "x11-racket" "rwind" =
 "drracket-vim-tool" "tr-both" "Acquire"); (links #:user? #f) =3D (); =
 (links #:root? #t) =3D =
 (#&lt;path:/home/asumu/plt/racket-git/add-on/pkgs/installed/lang-slide&gt;=
  =
 #&lt;path:/home/asumu/plt/racket-git/add-on/pkgs/installed/sweet-racket&gt=
 ; #&lt;path:/home/asumu/plt/racket-git/add-on/pkgs/installed/taglib&gt; =
 #&lt;path:/home/asumu/code/contract-repl&gt;); (links #:user? #f #:root? =
 #t) =3D ()<br>
 
 raco pkg (show):<br>
 Installation-wide:<br>
 &nbsp;[none]<br>
 User-specific, all-version:<br>
 &nbsp;Package[*=3Dauto] &nbsp; &nbsp;Checksum &nbsp; &nbsp; &nbsp; =
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Source<br>
 &nbsp;contract-repl &nbsp; &nbsp; &nbsp;#f &nbsp; &nbsp; &nbsp; &nbsp; =
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(link =
 /home/asumu/code/contract-repl)<br>
 &nbsp;lang-slide &nbsp; &nbsp; &nbsp; &nbsp; =
 40f30a8ce128493c887dc0c0bb0798fab6514837 &nbsp; &nbsp;(pns =
 lang-slide)<br>
 &nbsp;taglib &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
 305a3ca74c2437e2bf6acabd2d130c0b0e59e304 &nbsp; &nbsp;(pnr taglib)<br>
 User-specific, version-specific (5.3.4.2):<br>
 &nbsp;[none]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 ("/home/asumu/plt/racket-git/add-on/<a href=3D"http://5.3.4.2/collects" =
 target=3D"_blank">5.3.4.2/collects</a>"<br>
 &nbsp;(non-existent-path))<br>
 ("/home/asumu/plt/racket-git/collects"<br>
 &nbsp;("graphics" "future-visualizer" "frtime" "framework" "make" "sgl" =
 "0001-Remove-duplicate-non-terminals-in-define-extended-la.patch" =
 "waterworld" "launcher" "compiler" "planet2" "mred" "srfi" "setup" =
 "wxme" "honu" "mrlib" "scriblib" "r5rs" "trace" "info-domain" =
 "typed-racket" "racket" "net" "file" "slideshow" "string-constants" =
 "racklog" "openssl" "macro-debugger" "xml" "combinator-parser" =
 "foo2.gif" "mysterx" "html" "drscheme" "at-exp" "hierlist" "profile" =
 "icons" "sirmail" "readline" "config" "syntax" "scribble" "texpict" =
 "mzlib" "realm" "math" "typed" "web-server" "plai" "handin-client" =
 "rnrs" "eopl" "drracket" "handin-server" "planet" "syntax-color" =
 "repo-time-stamp" "test-engine" "games" "picturing-programs" "ffi" =
 "xrepl" "tex2page" "images" "errortrace" "json" "foo.gif" "data" =
 "unstable" "NormalizationTest.txt" "r6rs" "browser" "2htdp" =
 "parser-tools" "slatex" "scheme" "compatibility" "algol60" "scribblings" =
 "pkg" "stepper" "lazy" "rackunit" "gui-debugger" "plot" "help"!<br>
 
 &nbsp; "meta" "redex" "version" "defaults" "s-exp" "test-box-recovery" =
 "srpersist" "tests" "swindle" "mzscheme" "guibuilder" "deinprogramm" =
 "raco" "preprocessor" "typed-scheme" "db" "embedded-gui" "lang" "dynext" =
 "reader" ".gitignore" "htdp" "schemeunit" "teachpack" "mzcom" =
 "datalog"))<br>
 
 <br>
 Computer Language: (("Determine language from source") (#(#t print =
 mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t =
 ((main) (test))))<br>
 <br><br>
 </blockquote></div>
 </blockquote></div><br></body></html>=
 
 --Apple-Mail=_41609D99-2988-4213-B0D5-768A0633E4D2--
From: Robby Findler <robby@eecs.northwestern.edu>
To: Matthias Felleisen <matthias@ccs.neu.edu>
Cc: "asumu@ccs.neu.edu" <asumu@ccs.neu.edu>,
        "bugs@racket-lang.org" <bugs@racket-lang.org>,
        "nobody@racket-lang.org" <nobody@racket-lang.org>,
        "bug-notification@racket-lang.org" <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13686: recursive-contract just prints syntax
 instead of a nice representation
Date: Thu, 11 Apr 2013 21:01:59 -0500

 --047d7b33c98adb035b04da20493b
 Content-Type: text/plain; charset=UTF-8
 
 You want to see the printed form look like a letrec or something?
 
 Before sending my other message, I experimented with something where the
 name would change after the contract was checked the first time, but I
 didn't like what I ended up with.
 
 Robby
 
 
 On Thu, Apr 11, 2013 at 8:32 PM, Matthias Felleisen <matthias@ccs.neu.edu>wrote:
 
 >
 > Asumu, can you make an example of what it should look like.  As in foo =
 > ... foo ... without dots.
 >
 >
 >
 > On Apr 11, 2013, at 8:29 PM, Robby Findler wrote:
 >
 > How do you suggest I accomplish this?
 >
 > Robby
 >
 > On Thursday, April 11, 2013, wrote:
 >
 >> A new problem report is waiting at
 >>   http://bugs.racket-lang.org/query/?cmd=view&pr=13686
 >>
 >> Reported by Asumu Takikawa for release: 5.3.4.2--2013-04-10(6e0492df/d)
 >>
 >> *** Description:
 >> Consider the following example:
 >>
 >> #lang racket
 >>
 >> (contract (recursive-contract (flat-named-contract 'foo integer?))
 >>           "foo"
 >>           'pos
 >>           'neg)
 >>
 >> The resulting error is
 >>
 >> unsaved-editor752:3:0: broke its contract
 >>  promised: foo
 >>  produced: "foo"
 >>  in: (recursive-contract
 >>        (flat-named-contract 'foo integer?))
 >>  contract from: pos
 >>  blaming: pos
 >>
 >> Notice that the "in:" line just prints the quoted syntax of
 >> the contract and not a nice representation (e.g., the flat
 >> part should be "foo").
 >>
 >> *** How to repeat:
 >>
 >>
 >> *** Environment:
 >> unix "Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC 2012
 >> x86_64 GNU/Linux" (x86_64-linux/3m) (get-display-depth) = 32
 >> Human Language: english
 >> (current-memory-use) 338450700
 >> Links: (links) = ("pict-utils" "x11-racket" "rwind" "drracket-vim-tool"
 >> "tr-both" "Acquire"); (links #:user? #f) = (); (links #:root? #t) =
 >> (#<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/lang-slide>
 >> #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/sweet-racket>
 >> #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/taglib>
 >> #<path:/home/asumu/code/contract-repl>); (links #:user? #f #:root? #t) = ()
 >> raco pkg (show):
 >> Installation-wide:
 >>  [none]
 >> User-specific, all-version:
 >>  Package[*=auto]    Checksum                                    Source
 >>  contract-repl      #f                                          (link
 >> /home/asumu/code/contract-repl)
 >>  lang-slide         40f30a8ce128493c887dc0c0bb0798fab6514837    (pns
 >> lang-slide)
 >>  taglib             305a3ca74c2437e2bf6acabd2d130c0b0e59e304    (pnr
 >> taglib)
 >> User-specific, version-specific (5.3.4.2):
 >>  [none]
 >>
 >>
 >>
 >> Collections:
 >> ("/home/asumu/plt/racket-git/add-on/5.3.4.2/collects"
 >>  (non-existent-path))
 >> ("/home/asumu/plt/racket-git/collects"
 >>  ("graphics" "future-visualizer" "frtime" "framework" "make" "sgl"
 >> "0001-Remove-duplicate-non-terminals-in-define-extended-la.patch"
 >> "waterworld" "launcher" "compiler" "planet2" "mred" "srfi" "setup" "wxme"
 >> "honu" "mrlib" "scriblib" "r5rs" "trace" "info-domain" "typed-racket"
 >> "racket" "net" "file" "slideshow" "string-constants" "racklog" "openssl"
 >> "macro-debugger" "xml" "combinator-parser" "foo2.gif" "mysterx" "html"
 >> "drscheme" "at-exp" "hierlist" "profile" "icons" "sirmail" "readline"
 >> "config" "syntax" "scribble" "texpict" "mzlib" "realm" "math" "typed"
 >> "web-server" "plai" "handin-client" "rnrs" "eopl" "drracket"
 >> "handin-server" "planet" "syntax-color" "repo-time-stamp" "test-engine"
 >> "games" "picturing-programs" "ffi" "xrepl" "tex2page" "images" "errortrace"
 >> "json" "foo.gif" "data" "unstable" "NormalizationTest.txt" "r6rs" "browser"
 >> "2htdp" "parser-tools" "slatex" "scheme" "compatibility" "algol60"
 >> "scribblings" "pkg" "stepper" "lazy" "rackunit" "gui-debugger" "plot"
 >> "help"!
 >>   "meta" "redex" "version" "defaults" "s-exp" "test-box-recovery"
 >> "srpersist" "tests" "swindle" "mzscheme" "guibuilder" "deinprogramm" "raco"
 >> "preprocessor" "typed-scheme" "db" "embedded-gui" "lang" "dynext" "reader"
 >> ".gitignore" "htdp" "schemeunit" "teachpack" "mzcom" "datalog"))
 >>
 >> Computer Language: (("Determine language from source") (#(#t print
 >> mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main)
 >> (test))))
 >>
 >>
 >>
 >
 
 --047d7b33c98adb035b04da20493b
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">You want to see the printed form look like a letrec or som=
 ething?<div><br></div><div style>Before sending my other message, I experim=
 ented with something where the name would change after the contract was che=
 cked the first time, but I didn&#39;t like what I ended up with.</div>
 <div><br></div><div style>Robby</div></div><div class=3D"gmail_extra"><br><=
 br><div class=3D"gmail_quote">On Thu, Apr 11, 2013 at 8:32 PM, Matthias Fel=
 leisen <span dir=3D"ltr">&lt;<a href=3D"mailto:matthias@ccs.neu.edu" target=
 =3D"_blank">matthias@ccs.neu.edu</a>&gt;</span> wrote:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex"><div style=3D"word-wrap:break-word"><div><br=
 ></div><div>Asumu, can you make an example of what it should look like. =C2=
 =A0As in foo =3D ... foo ... without dots.=C2=A0</div>
 <div><div class=3D"h5"><div><br></div><div><br></div><br><div><div>On Apr 1=
 1, 2013, at 8:29 PM, Robby Findler wrote:</div><br><blockquote type=3D"cite=
 "><div>How do you suggest I accomplish this?</div><div><br></div><div>Robby=
 <br>
 <br>On Thursday, April 11, 2013,   wrote:<br><blockquote class=3D"gmail_quo=
 te" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"=
 >
 A new problem report is waiting at<br>
 =C2=A0 <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D13=
 686" target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=
 =3D13686</a><br>
 <br>
 Reported by Asumu Takikawa for release: 5.3.4.2--2013-04-10(6e0492df/d)<br>
 <br>
 *** Description:<br>
 Consider the following example:<br>
 <br>
 #lang racket<br>
 <br>
 (contract (recursive-contract (flat-named-contract &#39;foo integer?))<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;foo&quot;<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &#39;pos<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &#39;neg)<br>
 <br>
 The resulting error is<br>
 <br>
 unsaved-editor752:3:0: broke its contract<br>
 =C2=A0promised: foo<br>
 =C2=A0produced: &quot;foo&quot;<br>
 =C2=A0in: (recursive-contract<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0(flat-named-contract &#39;foo integer?))<br>
 =C2=A0contract from: pos<br>
 =C2=A0blaming: pos<br>
 <br>
 Notice that the &quot;in:&quot; line just prints the quoted syntax of<br>
 the contract and not a nice representation (e.g., the flat<br>
 part should be &quot;foo&quot;).<br>
 <br>
 *** How to repeat:<br>
 <br>
 <br>
 *** Environment:<br>
 unix &quot;Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC 20=
 12 x86_64 GNU/Linux&quot; (x86_64-linux/3m) (get-display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 338450700<br>
 Links: (links) =3D (&quot;pict-utils&quot; &quot;x11-racket&quot; &quot;rwi=
 nd&quot; &quot;drracket-vim-tool&quot; &quot;tr-both&quot; &quot;Acquire&qu=
 ot;); (links #:user? #f) =3D (); (links #:root? #t) =3D (#&lt;path:/home/as=
 umu/plt/racket-git/add-on/pkgs/installed/lang-slide&gt; #&lt;path:/home/asu=
 mu/plt/racket-git/add-on/pkgs/installed/sweet-racket&gt; #&lt;path:/home/as=
 umu/plt/racket-git/add-on/pkgs/installed/taglib&gt; #&lt;path:/home/asumu/c=
 ode/contract-repl&gt;); (links #:user? #f #:root? #t) =3D ()<br>
 
 
 raco pkg (show):<br>
 Installation-wide:<br>
 =C2=A0[none]<br>
 User-specific, all-version:<br>
 =C2=A0Package[*=3Dauto] =C2=A0 =C2=A0Checksum =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0Source<br>
 =C2=A0contract-repl =C2=A0 =C2=A0 =C2=A0#f =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(link /home/asumu/code/contract-re=
 pl)<br>
 =C2=A0lang-slide =C2=A0 =C2=A0 =C2=A0 =C2=A0 40f30a8ce128493c887dc0c0bb0798=
 fab6514837 =C2=A0 =C2=A0(pns lang-slide)<br>
 =C2=A0taglib =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 305a3ca74c2437e2bf6a=
 cabd2d130c0b0e59e304 =C2=A0 =C2=A0(pnr taglib)<br>
 User-specific, version-specific (5.3.4.2):<br>
 =C2=A0[none]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/home/asumu/plt/racket-git/add-on/<a href=3D"http://5.3.4.2/collects=
 " target=3D"_blank">5.3.4.2/collects</a>&quot;<br>
 =C2=A0(non-existent-path))<br>
 (&quot;/home/asumu/plt/racket-git/collects&quot;<br>
 =C2=A0(&quot;graphics&quot; &quot;future-visualizer&quot; &quot;frtime&quot=
 ; &quot;framework&quot; &quot;make&quot; &quot;sgl&quot; &quot;0001-Remove-=
 duplicate-non-terminals-in-define-extended-la.patch&quot; &quot;waterworld&=
 quot; &quot;launcher&quot; &quot;compiler&quot; &quot;planet2&quot; &quot;m=
 red&quot; &quot;srfi&quot; &quot;setup&quot; &quot;wxme&quot; &quot;honu&qu=
 ot; &quot;mrlib&quot; &quot;scriblib&quot; &quot;r5rs&quot; &quot;trace&quo=
 t; &quot;info-domain&quot; &quot;typed-racket&quot; &quot;racket&quot; &quo=
 t;net&quot; &quot;file&quot; &quot;slideshow&quot; &quot;string-constants&q=
 uot; &quot;racklog&quot; &quot;openssl&quot; &quot;macro-debugger&quot; &qu=
 ot;xml&quot; &quot;combinator-parser&quot; &quot;foo2.gif&quot; &quot;myste=
 rx&quot; &quot;html&quot; &quot;drscheme&quot; &quot;at-exp&quot; &quot;hie=
 rlist&quot; &quot;profile&quot; &quot;icons&quot; &quot;sirmail&quot; &quot=
 ;readline&quot; &quot;config&quot; &quot;syntax&quot; &quot;scribble&quot; =
 &quot;texpict&quot; &quot;mzlib&quot; &quot;realm&quot; &quot;math&quot; &q=
 uot;typed&quot; &quot;web-server&quot; &quot;plai&quot; &quot;handin-client=
 &quot; &quot;rnrs&quot; &quot;eopl&quot; &quot;drracket&quot; &quot;handin-=
 server&quot; &quot;planet&quot; &quot;syntax-color&quot; &quot;repo-time-st=
 amp&quot; &quot;test-engine&quot; &quot;games&quot; &quot;picturing-program=
 s&quot; &quot;ffi&quot; &quot;xrepl&quot; &quot;tex2page&quot; &quot;images=
 &quot; &quot;errortrace&quot; &quot;json&quot; &quot;foo.gif&quot; &quot;da=
 ta&quot; &quot;unstable&quot; &quot;NormalizationTest.txt&quot; &quot;r6rs&=
 quot; &quot;browser&quot; &quot;2htdp&quot; &quot;parser-tools&quot; &quot;=
 slatex&quot; &quot;scheme&quot; &quot;compatibility&quot; &quot;algol60&quo=
 t; &quot;scribblings&quot; &quot;pkg&quot; &quot;stepper&quot; &quot;lazy&q=
 uot; &quot;rackunit&quot; &quot;gui-debugger&quot; &quot;plot&quot; &quot;h=
 elp&quot;!<br>
 
 
 =C2=A0 &quot;meta&quot; &quot;redex&quot; &quot;version&quot; &quot;default=
 s&quot; &quot;s-exp&quot; &quot;test-box-recovery&quot; &quot;srpersist&quo=
 t; &quot;tests&quot; &quot;swindle&quot; &quot;mzscheme&quot; &quot;guibuil=
 der&quot; &quot;deinprogramm&quot; &quot;raco&quot; &quot;preprocessor&quot=
 ; &quot;typed-scheme&quot; &quot;db&quot; &quot;embedded-gui&quot; &quot;la=
 ng&quot; &quot;dynext&quot; &quot;reader&quot; &quot;.gitignore&quot; &quot=
 ;htdp&quot; &quot;schemeunit&quot; &quot;teachpack&quot; &quot;mzcom&quot; =
 &quot;datalog&quot;))<br>
 
 
 <br>
 Computer Language: ((&quot;Determine language from source&quot;) (#(#t prin=
 t mixed-fraction-e #f #t debug) (default) #() &quot;#lang racket\n&quot; #t=
  #t ((main) (test))))<br>
 <br><br>
 </blockquote></div>
 </blockquote></div><br></div></div></div></blockquote></div><br></div>
 
 --047d7b33c98adb035b04da20493b--
From: Robby Findler <robby@eecs.northwestern.edu>
To: Matthias Felleisen <matthias@ccs.neu.edu>
Cc: "asumu@ccs.neu.edu" <asumu@ccs.neu.edu>,
        "bugs@racket-lang.org" <bugs@racket-lang.org>,
        "nobody@racket-lang.org" <nobody@racket-lang.org>,
        "bug-notification@racket-lang.org" <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13686: recursive-contract just prints syntax
 instead of a nice representation
Date: Thu, 11 Apr 2013 21:11:20 -0500

 --e89a8ff1cd48476fd204da206ba7
 Content-Type: text/plain; charset=UTF-8
 
 I tried again and the diff below is the best I've got (it is a bit better
 than what I'd tried before). I'm not sure it is better than what's
 currently happening, tho.
 
 [robby@yanpu] ~/git/plt/collects$ git diff
 diff --git a/collects/racket/contract/private/base.rkt
 b/collects/racket/contract/private/base.rkt
 index 938123f..120b09e 100644
 --- a/collects/racket/contract/private/base.rkt
 +++ b/collects/racket/contract/private/base.rkt
 @@ -95,6 +95,8 @@
      [current current]
      [else
       (define thunk (recursive-contract-thunk ctc))
 +     (define name 'ctc)
 +     (set-recursive-contract-name! ctc name)
       (define forced-ctc
         (cond
           [(flat-recursive-contract? ctc)
 @@ -104,6 +106,9 @@
           [(impersonator-recursive-contract? ctc)
            (coerce-contract 'recursive-contract (thunk))]))
       (set-recursive-contract-ctc! ctc forced-ctc)
 +     (set-recursive-contract-name! ctc
 +                                   `(letrec ([,name (recursive-contract
 ,(contract-name forced-ctc))])
 +                                      ,name))
       forced-ctc]))
  (define ((recursive-contract-projection ctc) blame)
    (define r-ctc (force-recursive-contract ctc))
 @@ -121,7 +126,16 @@
    (contract-first-order-passes? (force-recursive-contract ctc)
                                  val))
 
 -(struct recursive-contract (name thunk [ctc #:mutable]))
 +(struct recursive-contract ([name #:mutable] thunk [ctc #:mutable]))
 +
 +(define (compute-recursive-contract-name a-recursive-contract)
 +  (cond
 +    [(recursive-contract-ctc a-recursive-contract)
 +     =>
 +     contract-name]
 +    [else
 +     (recursive-contract-name a-recursive-contract)]))
 +
  (struct flat-recursive-contract recursive-contract ()
    #:property prop:flat-contract
    (build-flat-contract-property
 @@ -142,4 +156,4 @@
     #:name recursive-contract-name
     #:first-order recursive-contract-first-order
     #:projection recursive-contract-projection
 -   #:stronger recursive-contract-stronger))
 +   #:stronger recursive-contract-stronger))
 \ No newline at end of file
 [robby@yanpu] ~/git/plt/collects$
 
 
 
 
 On Thu, Apr 11, 2013 at 9:01 PM, Robby Findler
 <robby@eecs.northwestern.edu>wrote:
 
 > You want to see the printed form look like a letrec or something?
 >
 > Before sending my other message, I experimented with something where the
 > name would change after the contract was checked the first time, but I
 > didn't like what I ended up with.
 >
 > Robby
 >
 >
 > On Thu, Apr 11, 2013 at 8:32 PM, Matthias Felleisen <matthias@ccs.neu.edu>wrote:
 >
 >>
 >> Asumu, can you make an example of what it should look like.  As in foo =
 >> ... foo ... without dots.
 >>
 >>
 >>
 >> On Apr 11, 2013, at 8:29 PM, Robby Findler wrote:
 >>
 >> How do you suggest I accomplish this?
 >>
 >> Robby
 >>
 >> On Thursday, April 11, 2013, wrote:
 >>
 >>> A new problem report is waiting at
 >>>   http://bugs.racket-lang.org/query/?cmd=view&pr=13686
 >>>
 >>> Reported by Asumu Takikawa for release: 5.3.4.2--2013-04-10(6e0492df/d)
 >>>
 >>> *** Description:
 >>> Consider the following example:
 >>>
 >>> #lang racket
 >>>
 >>> (contract (recursive-contract (flat-named-contract 'foo integer?))
 >>>           "foo"
 >>>           'pos
 >>>           'neg)
 >>>
 >>> The resulting error is
 >>>
 >>> unsaved-editor752:3:0: broke its contract
 >>>  promised: foo
 >>>  produced: "foo"
 >>>  in: (recursive-contract
 >>>        (flat-named-contract 'foo integer?))
 >>>  contract from: pos
 >>>  blaming: pos
 >>>
 >>> Notice that the "in:" line just prints the quoted syntax of
 >>> the contract and not a nice representation (e.g., the flat
 >>> part should be "foo").
 >>>
 >>> *** How to repeat:
 >>>
 >>>
 >>> *** Environment:
 >>> unix "Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC 2012
 >>> x86_64 GNU/Linux" (x86_64-linux/3m) (get-display-depth) = 32
 >>> Human Language: english
 >>> (current-memory-use) 338450700
 >>> Links: (links) = ("pict-utils" "x11-racket" "rwind" "drracket-vim-tool"
 >>> "tr-both" "Acquire"); (links #:user? #f) = (); (links #:root? #t) =
 >>> (#<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/lang-slide>
 >>> #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/sweet-racket>
 >>> #<path:/home/asumu/plt/racket-git/add-on/pkgs/installed/taglib>
 >>> #<path:/home/asumu/code/contract-repl>); (links #:user? #f #:root? #t) = ()
 >>> raco pkg (show):
 >>> Installation-wide:
 >>>  [none]
 >>> User-specific, all-version:
 >>>  Package[*=auto]    Checksum                                    Source
 >>>  contract-repl      #f                                          (link
 >>> /home/asumu/code/contract-repl)
 >>>  lang-slide         40f30a8ce128493c887dc0c0bb0798fab6514837    (pns
 >>> lang-slide)
 >>>  taglib             305a3ca74c2437e2bf6acabd2d130c0b0e59e304    (pnr
 >>> taglib)
 >>> User-specific, version-specific (5.3.4.2):
 >>>  [none]
 >>>
 >>>
 >>>
 >>> Collections:
 >>> ("/home/asumu/plt/racket-git/add-on/5.3.4.2/collects"
 >>>  (non-existent-path))
 >>> ("/home/asumu/plt/racket-git/collects"
 >>>  ("graphics" "future-visualizer" "frtime" "framework" "make" "sgl"
 >>> "0001-Remove-duplicate-non-terminals-in-define-extended-la.patch"
 >>> "waterworld" "launcher" "compiler" "planet2" "mred" "srfi" "setup" "wxme"
 >>> "honu" "mrlib" "scriblib" "r5rs" "trace" "info-domain" "typed-racket"
 >>> "racket" "net" "file" "slideshow" "string-constants" "racklog" "openssl"
 >>> "macro-debugger" "xml" "combinator-parser" "foo2.gif" "mysterx" "html"
 >>> "drscheme" "at-exp" "hierlist" "profile" "icons" "sirmail" "readline"
 >>> "config" "syntax" "scribble" "texpict" "mzlib" "realm" "math" "typed"
 >>> "web-server" "plai" "handin-client" "rnrs" "eopl" "drracket"
 >>> "handin-server" "planet" "syntax-color" "repo-time-stamp" "test-engine"
 >>> "games" "picturing-programs" "ffi" "xrepl" "tex2page" "images" "errortrace"
 >>> "json" "foo.gif" "data" "unstable" "NormalizationTest.txt" "r6rs" "browser"
 >>> "2htdp" "parser-tools" "slatex" "scheme" "compatibility" "algol60"
 >>> "scribblings" "pkg" "stepper" "lazy" "rackunit" "gui-debugger" "plot"
 >>> "help"!
 >>>   "meta" "redex" "version" "defaults" "s-exp" "test-box-recovery"
 >>> "srpersist" "tests" "swindle" "mzscheme" "guibuilder" "deinprogramm" "raco"
 >>> "preprocessor" "typed-scheme" "db" "embedded-gui" "lang" "dynext" "reader"
 >>> ".gitignore" "htdp" "schemeunit" "teachpack" "mzcom" "datalog"))
 >>>
 >>> Computer Language: (("Determine language from source") (#(#t print
 >>> mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main)
 >>> (test))))
 >>>
 >>>
 >>>
 >>
 >
 
 --e89a8ff1cd48476fd204da206ba7
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">I tried again and the diff below is the best I&#39;ve got =
 (it is a bit better than what I&#39;d tried before). I&#39;m not sure it is=
  better than what&#39;s currently happening, tho.<div><br></div><div><div>
 [robby@yanpu] ~/git/plt/collects$ git diff</div><div>diff --git a/collects/=
 racket/contract/private/base.rkt b/collects/racket/contract/private/base.rk=
 t</div><div>index 938123f..120b09e 100644</div><div>--- a/collects/racket/c=
 ontract/private/base.rkt</div>
 <div>+++ b/collects/racket/contract/private/base.rkt</div><div>@@ -95,6 +95=
 ,8 @@</div><div>=C2=A0 =C2=A0 =C2=A0[current current]</div><div>=C2=A0 =C2=
 =A0 =C2=A0[else</div><div>=C2=A0 =C2=A0 =C2=A0 (define thunk (recursive-con=
 tract-thunk ctc))</div><div>+ =C2=A0 =C2=A0 (define name &#39;ctc)</div>
 <div>+ =C2=A0 =C2=A0 (set-recursive-contract-name! ctc name)</div><div>=C2=
 =A0 =C2=A0 =C2=A0 (define forced-ctc</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 (cond</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 [(flat-recursive-contrac=
 t? ctc)</div><div>@@ -104,6 +106,9 @@</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0=
  =C2=A0 [(impersonator-recursive-contract? ctc)</div>
 <div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(coerce-contract &#39;recursi=
 ve-contract (thunk))]))</div><div>=C2=A0 =C2=A0 =C2=A0 (set-recursive-contr=
 act-ctc! ctc forced-ctc)</div><div>+ =C2=A0 =C2=A0 (set-recursive-contract-=
 name! ctc=C2=A0</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 `=
 (letrec ([,name (recursive-contract ,(contract-name forced-ctc))])</div>
 <div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0,name))</=
 div><div>=C2=A0 =C2=A0 =C2=A0 forced-ctc]))</div><div>=C2=A0(define ((recur=
 sive-contract-projection ctc) blame)</div><div>=C2=A0 =C2=A0(define r-ctc (=
 force-recursive-contract ctc))</div><div>@@ -121,7 +126,16 @@</div>
 <div>=C2=A0 =C2=A0(contract-first-order-passes? (force-recursive-contract c=
 tc)</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0val))</div><div>=
 =C2=A0</div><div>-(struct recursive-contract (name thunk [ctc #:mutable]))<=
 /div><div>+(struct recursive-contract ([name #:mutable] thunk [ctc #:mutabl=
 e]))</div>
 <div>+</div><div>+(define (compute-recursive-contract-name a-recursive-cont=
 ract)</div><div>+ =C2=A0(cond</div><div>+ =C2=A0 =C2=A0[(recursive-contract=
 -ctc a-recursive-contract)</div><div>+ =C2=A0 =C2=A0 =3D&gt;</div><div>+ =
 =C2=A0 =C2=A0 contract-name]</div><div>
 + =C2=A0 =C2=A0[else</div><div>+ =C2=A0 =C2=A0 (recursive-contract-name a-r=
 ecursive-contract)]))</div><div>+</div><div>=C2=A0(struct flat-recursive-co=
 ntract recursive-contract ()</div><div>=C2=A0 =C2=A0#:property prop:flat-co=
 ntract</div><div>=C2=A0 =C2=A0(build-flat-contract-property</div>
 <div>@@ -142,4 +156,4 @@</div><div>=C2=A0 =C2=A0 #:name recursive-contract-=
 name</div><div>=C2=A0 =C2=A0 #:first-order recursive-contract-first-order</=
 div><div>=C2=A0 =C2=A0 #:projection recursive-contract-projection</div><div=
 >- =C2=A0 #:stronger recursive-contract-stronger))</div>
 <div>+ =C2=A0 #:stronger recursive-contract-stronger))</div><div>\ No newli=
 ne at end of file</div><div>[robby@yanpu] ~/git/plt/collects$=C2=A0</div><d=
 iv><br></div><div><br></div></div><div class=3D"gmail_extra"><br><br><div c=
 lass=3D"gmail_quote">
 On Thu, Apr 11, 2013 at 9:01 PM, Robby Findler <span dir=3D"ltr">&lt;<a hre=
 f=3D"mailto:robby@eecs.northwestern.edu" target=3D"_blank">robby@eecs.north=
 western.edu</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" styl=
 e=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">
 <div dir=3D"ltr">You want to see the printed form look like a letrec or som=
 ething?<div><br></div><div>Before sending my other message, I experimented =
 with something where the name would change after the contract was checked t=
 he first time, but I didn&#39;t like what I ended up with.</div>
 <span class=3D"HOEnZb"><font color=3D"#888888">
 <div><br></div><div>Robby</div></font></span></div><div class=3D"HOEnZb"><d=
 iv class=3D"h5"><div class=3D"gmail_extra"><br><br><div class=3D"gmail_quot=
 e">On Thu, Apr 11, 2013 at 8:32 PM, Matthias Felleisen <span dir=3D"ltr">&l=
 t;<a href=3D"mailto:matthias@ccs.neu.edu" target=3D"_blank">matthias@ccs.ne=
 u.edu</a>&gt;</span> wrote:<br>
 
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex"><div style=3D"word-wrap:break-word"><div><br=
 ></div><div>Asumu, can you make an example of what it should look like. =C2=
 =A0As in foo =3D ... foo ... without dots.=C2=A0</div>
 
 <div><div><div><br></div><div><br></div><br><div><div>On Apr 11, 2013, at 8=
 :29 PM, Robby Findler wrote:</div><br><blockquote type=3D"cite"><div>How do=
  you suggest I accomplish this?</div><div><br></div><div>Robby<br>
 <br>On Thursday, April 11, 2013,   wrote:<br><blockquote class=3D"gmail_quo=
 te" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"=
 >
 A new problem report is waiting at<br>
 =C2=A0 <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D13=
 686" target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=
 =3D13686</a><br>
 <br>
 Reported by Asumu Takikawa for release: 5.3.4.2--2013-04-10(6e0492df/d)<br>
 <br>
 *** Description:<br>
 Consider the following example:<br>
 <br>
 #lang racket<br>
 <br>
 (contract (recursive-contract (flat-named-contract &#39;foo integer?))<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;foo&quot;<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &#39;pos<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &#39;neg)<br>
 <br>
 The resulting error is<br>
 <br>
 unsaved-editor752:3:0: broke its contract<br>
 =C2=A0promised: foo<br>
 =C2=A0produced: &quot;foo&quot;<br>
 =C2=A0in: (recursive-contract<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0(flat-named-contract &#39;foo integer?))<br>
 =C2=A0contract from: pos<br>
 =C2=A0blaming: pos<br>
 <br>
 Notice that the &quot;in:&quot; line just prints the quoted syntax of<br>
 the contract and not a nice representation (e.g., the flat<br>
 part should be &quot;foo&quot;).<br>
 <br>
 *** How to repeat:<br>
 <br>
 <br>
 *** Environment:<br>
 unix &quot;Linux willamette 3.2.0-2-amd64 #1 SMP Mon May 21 17:45:41 UTC 20=
 12 x86_64 GNU/Linux&quot; (x86_64-linux/3m) (get-display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 338450700<br>
 Links: (links) =3D (&quot;pict-utils&quot; &quot;x11-racket&quot; &quot;rwi=
 nd&quot; &quot;drracket-vim-tool&quot; &quot;tr-both&quot; &quot;Acquire&qu=
 ot;); (links #:user? #f) =3D (); (links #:root? #t) =3D (#&lt;path:/home/as=
 umu/plt/racket-git/add-on/pkgs/installed/lang-slide&gt; #&lt;path:/home/asu=
 mu/plt/racket-git/add-on/pkgs/installed/sweet-racket&gt; #&lt;path:/home/as=
 umu/plt/racket-git/add-on/pkgs/installed/taglib&gt; #&lt;path:/home/asumu/c=
 ode/contract-repl&gt;); (links #:user? #f #:root? #t) =3D ()<br>
 
 
 
 raco pkg (show):<br>
 Installation-wide:<br>
 =C2=A0[none]<br>
 User-specific, all-version:<br>
 =C2=A0Package[*=3Dauto] =C2=A0 =C2=A0Checksum =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0Source<br>
 =C2=A0contract-repl =C2=A0 =C2=A0 =C2=A0#f =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(link /home/asumu/code/contract-re=
 pl)<br>
 =C2=A0lang-slide =C2=A0 =C2=A0 =C2=A0 =C2=A0 40f30a8ce128493c887dc0c0bb0798=
 fab6514837 =C2=A0 =C2=A0(pns lang-slide)<br>
 =C2=A0taglib =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 305a3ca74c2437e2bf6a=
 cabd2d130c0b0e59e304 =C2=A0 =C2=A0(pnr taglib)<br>
 User-specific, version-specific (5.3.4.2):<br>
 =C2=A0[none]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/home/asumu/plt/racket-git/add-on/<a href=3D"http://5.3.4.2/collects=
 " target=3D"_blank">5.3.4.2/collects</a>&quot;<br>
 =C2=A0(non-existent-path))<br>
 (&quot;/home/asumu/plt/racket-git/collects&quot;<br>
 =C2=A0(&quot;graphics&quot; &quot;future-visualizer&quot; &quot;frtime&quot=
 ; &quot;framework&quot; &quot;make&quot; &quot;sgl&quot; &quot;0001-Remove-=
 duplicate-non-terminals-in-define-extended-la.patch&quot; &quot;waterworld&=
 quot; &quot;launcher&quot; &quot;compiler&quot; &quot;planet2&quot; &quot;m=
 red&quot; &quot;srfi&quot; &quot;setup&quot; &quot;wxme&quot; &quot;honu&qu=
 ot; &quot;mrlib&quot; &quot;scriblib&quot; &quot;r5rs&quot; &quot;trace&quo=
 t; &quot;info-domain&quot; &quot;typed-racket&quot; &quot;racket&quot; &quo=
 t;net&quot; &quot;file&quot; &quot;slideshow&quot; &quot;string-constants&q=
 uot; &quot;racklog&quot; &quot;openssl&quot; &quot;macro-debugger&quot; &qu=
 ot;xml&quot; &quot;combinator-parser&quot; &quot;foo2.gif&quot; &quot;myste=
 rx&quot; &quot;html&quot; &quot;drscheme&quot; &quot;at-exp&quot; &quot;hie=
 rlist&quot; &quot;profile&quot; &quot;icons&quot; &quot;sirmail&quot; &quot=
 ;readline&quot; &quot;config&quot; &quot;syntax&quot; &quot;scribble&quot; =
 &quot;texpict&quot; &quot;mzlib&quot; &quot;realm&quot; &quot;math&quot; &q=
 uot;typed&quot; &quot;web-server&quot; &quot;plai&quot; &quot;handin-client=
 &quot; &quot;rnrs&quot; &quot;eopl&quot; &quot;drracket&quot; &quot;handin-=
 server&quot; &quot;planet&quot; &quot;syntax-color&quot; &quot;repo-time-st=
 amp&quot; &quot;test-engine&quot; &quot;games&quot; &quot;picturing-program=
 s&quot; &quot;ffi&quot; &quot;xrepl&quot; &quot;tex2page&quot; &quot;images=
 &quot; &quot;errortrace&quot; &quot;json&quot; &quot;foo.gif&quot; &quot;da=
 ta&quot; &quot;unstable&quot; &quot;NormalizationTest.txt&quot; &quot;r6rs&=
 quot; &quot;browser&quot; &quot;2htdp&quot; &quot;parser-tools&quot; &quot;=
 slatex&quot; &quot;scheme&quot; &quot;compatibility&quot; &quot;algol60&quo=
 t; &quot;scribblings&quot; &quot;pkg&quot; &quot;stepper&quot; &quot;lazy&q=
 uot; &quot;rackunit&quot; &quot;gui-debugger&quot; &quot;plot&quot; &quot;h=
 elp&quot;!<br>
 
 
 
 =C2=A0 &quot;meta&quot; &quot;redex&quot; &quot;version&quot; &quot;default=
 s&quot; &quot;s-exp&quot; &quot;test-box-recovery&quot; &quot;srpersist&quo=
 t; &quot;tests&quot; &quot;swindle&quot; &quot;mzscheme&quot; &quot;guibuil=
 der&quot; &quot;deinprogramm&quot; &quot;raco&quot; &quot;preprocessor&quot=
 ; &quot;typed-scheme&quot; &quot;db&quot; &quot;embedded-gui&quot; &quot;la=
 ng&quot; &quot;dynext&quot; &quot;reader&quot; &quot;.gitignore&quot; &quot=
 ;htdp&quot; &quot;schemeunit&quot; &quot;teachpack&quot; &quot;mzcom&quot; =
 &quot;datalog&quot;))<br>
 
 
 
 <br>
 Computer Language: ((&quot;Determine language from source&quot;) (#(#t prin=
 t mixed-fraction-e #f #t debug) (default) #() &quot;#lang racket\n&quot; #t=
  #t ((main) (test))))<br>
 <br><br>
 </blockquote></div>
 </blockquote></div><br></div></div></div></blockquote></div><br></div>
 </div></div></blockquote></div><br></div></div>
 
 --e89a8ff1cd48476fd204da206ba7--
From: Asumu Takikawa <asumu@ccs.neu.edu>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: "bugs@racket-lang.org" <bugs@racket-lang.org>,
        "nobody@racket-lang.org" <nobody@racket-lang.org>,
        "bug-notification@racket-lang.org" <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13686: recursive-contract just prints syntax
 instead of a nice representation
Date: Thu, 11 Apr 2013 22:12:36 -0400

 --2NLGdgz3UMHa/lqP
 Content-Type: text/plain; charset=us-ascii
 Content-Disposition: inline
 
 On 2013-04-11 19:29:06 -0500, Robby Findler wrote:
 >    How do you suggest I accomplish this?
 
 Here's an example of what I was thinking of:
 
   -> (define rec/c
        (recursive-contract
         (or/c (flat-named-contract 'foo integer?)
               (listof rec/c))))
   -> (contract rec/c "bar" 'pos 'neg)
   ; readline-input:2:0: broke its contract
   ;  promised: list produced "bar"
   ;  in: a disjunct of
   ;       (or/c foo (listof <recursive-contract>))
   ;  contract from: pos
   ;  blaming: pos
   ; [,bt for context]
 
 I've attached a (mostly untested) patch that produces the interaction
 above.
 
 Cheers,
 Asumu
 
 --2NLGdgz3UMHa/lqP
 Content-Type: text/x-diff; charset=utf-8
 Content-Disposition: attachment; filename="0001-Change-contract-name-of-recursive-contract.patch"
 Content-Transfer-Encoding: 8bit
 
 From fe7070e21a2f6597c7bb037fe609a5cbad17a235 Mon Sep 17 00:00:00 2001
 From: Asumu Takikawa <asumu@ccs.neu.edu>
 Date: Thu, 11 Apr 2013 22:10:23 -0400
 Subject: [PATCH] Change contract name of `recursive-contract`
 
 ---
  collects/racket/contract/private/base.rkt |   18 +++++++++++++-----
  1 file changed, 13 insertions(+), 5 deletions(-)
 
 diff --git a/collects/racket/contract/private/base.rkt b/collects/racket/contract/private/base.rkt
 index 938123f..5d4220b 100644
 --- a/collects/racket/contract/private/base.rkt
 +++ b/collects/racket/contract/private/base.rkt
 @@ -81,7 +81,7 @@
                                                 "type must be one of #:impersonator, #:chaperone, or #:flat"
                                                 stx
                                                 type)])])
 -      #`(maker '#,name ( () #,arg) #f)))
 +      #`(maker '#,name ( () #,arg) (recursive-contract-placeholder))))
    (syntax-case stx ()
      [(_ arg type)
       (keyword? (syntax-e #'type))
 @@ -92,7 +92,7 @@
  (define (force-recursive-contract ctc)
    (define current (recursive-contract-ctc ctc))
    (cond
 -    [current current]
 +    [(not (recursive-contract-placeholder? current)) current]
      [else
       (define thunk (recursive-contract-thunk ctc))
       (define forced-ctc
 @@ -121,25 +121,33 @@
    (contract-first-order-passes? (force-recursive-contract ctc)
                                  val))
  
 +(define (build-recursive-contract-name ctc)
 +  (contract-name (recursive-contract-ctc ctc)))
 +
 +(struct recursive-contract-placeholder ()
 +        #:property prop:flat-contract
 +        (build-flat-contract-property
 +         #:name ( (ctc) '<recursive-contract>)))
 +
  (struct recursive-contract (name thunk [ctc #:mutable]))
  (struct flat-recursive-contract recursive-contract ()
    #:property prop:flat-contract
    (build-flat-contract-property
 -   #:name recursive-contract-name
 +   #:name build-recursive-contract-name
     #:first-order recursive-contract-first-order
     #:projection recursive-contract-projection
     #:stronger recursive-contract-stronger))
  (struct chaperone-recursive-contract recursive-contract ()
    #:property prop:chaperone-contract
    (build-chaperone-contract-property
 -   #:name recursive-contract-name
 +   #:name build-recursive-contract-name
     #:first-order recursive-contract-first-order
     #:projection recursive-contract-projection
     #:stronger recursive-contract-stronger))
  (struct impersonator-recursive-contract recursive-contract ()
    #:property prop:contract
    (build-contract-property
 -   #:name recursive-contract-name
 +   #:name build-recursive-contract-name
     #:first-order recursive-contract-first-order
     #:projection recursive-contract-projection
     #:stronger recursive-contract-stronger))
 -- 
 1.7.10.4
 
 
 --2NLGdgz3UMHa/lqP--
From: Robby Findler <robby@eecs.northwestern.edu>
To: Asumu Takikawa <asumu@ccs.neu.edu>
Cc: "bugs@racket-lang.org" <bugs@racket-lang.org>,
        "nobody@racket-lang.org" <nobody@racket-lang.org>,
        "bug-notification@racket-lang.org" <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13686: recursive-contract just prints syntax
 instead of a nice representation
Date: Thu, 11 Apr 2013 21:23:10 -0500

 --e89a8ff1cd4897c75a04da209513
 Content-Type: text/plain; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 Our emails mostly crossed, but this is similar to what I'd done, but
 without the letrec wrapper.
 
 And it gives me an idea: how about we use the locally inferred name, if
 present?
 
 Here's a diff:
 
 [robby@yanpu] ~/git/plt/collects$ git diff | cat
 diff --git a/collects/racket/contract/private/base.rkt
 b/collects/racket/contract/private/base.rkt
 index 938123f..cc62aa7 100644
 --- a/collects/racket/contract/private/base.rkt
 +++ b/collects/racket/contract/private/base.rkt
 @@ -72,6 +72,7 @@
 
  (define-syntax (-recursive-contract stx)
    (define (do-recursive-contract arg type name)
 +    (define local-name (syntax-local-infer-name stx))
      (with-syntax ([maker
                     (case (syntax-e type)
                       [(#:impersonator) #'impersonator-recursive-contract]
 @@ -81,7 +82,7 @@
                                                 "type must be one of
 #:impersonator, #:chaperone, or #:flat"
                                                 stx
                                                 type)])])
 -      #`(maker '#,name (=CE=BB () #,arg) #f)))
 +      #`(maker '#,name (=CE=BB () #,arg) '#,local-name)))
    (syntax-case stx ()
      [(_ arg type)
       (keyword? (syntax-e #'type))
 @@ -92,9 +93,10 @@
  (define (force-recursive-contract ctc)
    (define current (recursive-contract-ctc ctc))
    (cond
 -    [current current]
 -    [else
 +    [(symbol? current)
       (define thunk (recursive-contract-thunk ctc))
 +     (define name 'ctc)
 +     (set-recursive-contract-name! ctc (or current '<recursive-contract>))
       (define forced-ctc
         (cond
           [(flat-recursive-contract? ctc)
 @@ -104,7 +106,10 @@
           [(impersonator-recursive-contract? ctc)
            (coerce-contract 'recursive-contract (thunk))]))
       (set-recursive-contract-ctc! ctc forced-ctc)
 -     forced-ctc]))
 +     (set-recursive-contract-name! ctc `(recursive-contract
 ,(contract-name forced-ctc)))
 +     forced-ctc]
 +    [else current]))
 +
  (define ((recursive-contract-projection ctc) blame)
    (define r-ctc (force-recursive-contract ctc))
    (define f (contract-projection r-ctc))
 @@ -121,7 +126,16 @@
    (contract-first-order-passes? (force-recursive-contract ctc)
                                  val))
 
 -(struct recursive-contract (name thunk [ctc #:mutable]))
 +(struct recursive-contract ([name #:mutable] thunk [ctc #:mutable]))
 +
 +(define (compute-recursive-contract-name a-recursive-contract)
 +  (cond
 +    [(recursive-contract-ctc a-recursive-contract)
 +     =3D>
 +     contract-name]
 +    [else
 +     (recursive-contract-name a-recursive-contract)]))
 +
  (struct flat-recursive-contract recursive-contract ()
    #:property prop:flat-contract
    (build-flat-contract-property
 @@ -142,4 +156,4 @@
     #:name recursive-contract-name
     #:first-order recursive-contract-first-order
     #:projection recursive-contract-projection
 -   #:stronger recursive-contract-stronger))
 +   #:stronger recursive-contract-stronger))
 \ No newline at end of file
 [robby@yanpu] ~/git/plt/collects$
 
 --e89a8ff1cd4897c75a04da209513
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">Our emails mostly crossed, but this is similar to what I&#=
 39;d done, but without the letrec wrapper.<div><br></div><div style>And it =
 gives me an idea: how about we use the locally inferred name, if present?=
 =C2=A0</div>
 <div style><br></div><div style>Here&#39;s a diff:</div><div style><br></di=
 v><div style><div>[robby@yanpu] ~/git/plt/collects$ git diff | cat</div><di=
 v>diff --git a/collects/racket/contract/private/base.rkt b/collects/racket/=
 contract/private/base.rkt</div>
 <div>index 938123f..cc62aa7 100644</div><div>--- a/collects/racket/contract=
 /private/base.rkt</div><div>+++ b/collects/racket/contract/private/base.rkt=
 </div><div>@@ -72,6 +72,7 @@</div><div>=C2=A0</div><div>=C2=A0(define-synta=
 x (-recursive-contract stx)</div>
 <div>=C2=A0 =C2=A0(define (do-recursive-contract arg type name)</div><div>+=
  =C2=A0 =C2=A0(define local-name (syntax-local-infer-name stx))</div><div>=
 =C2=A0 =C2=A0 =C2=A0(with-syntax ([maker</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (case (syntax-e type)</div><d=
 iv>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 [(#:impersonator) #&#39;impersonator-recursive-contract]</div>
 <div>@@ -81,7 +82,7 @@</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &quot;type must be one=
  of #:impersonator, #:chaperone, or #:flat&quot;</div><div>=C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 stx</div><div>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 type)])])</div><div>- =C2=A0 =C2=A0 =C2=A0#`(maker &#3=
 9;#,name (=CE=BB () #,arg) #f)))</div><div>+ =C2=A0 =C2=A0 =C2=A0#`(maker &=
 #39;#,name (=CE=BB () #,arg) &#39;#,local-name)))</div><div>=C2=A0 =C2=A0(s=
 yntax-case stx ()</div>
 <div>=C2=A0 =C2=A0 =C2=A0[(_ arg type)</div><div>=C2=A0 =C2=A0 =C2=A0 (keyw=
 ord? (syntax-e #&#39;type))</div><div>@@ -92,9 +93,10 @@</div><div>=C2=A0(d=
 efine (force-recursive-contract ctc)</div><div>=C2=A0 =C2=A0(define current=
  (recursive-contract-ctc ctc))</div><div>
 =C2=A0 =C2=A0(cond</div><div>- =C2=A0 =C2=A0[current current]</div><div>- =
 =C2=A0 =C2=A0[else</div><div>+ =C2=A0 =C2=A0[(symbol? current)</div><div>=
 =C2=A0 =C2=A0 =C2=A0 (define thunk (recursive-contract-thunk ctc))</div><di=
 v>+ =C2=A0 =C2=A0 (define name &#39;ctc)</div><div>+ =C2=A0 =C2=A0 (set-rec=
 ursive-contract-name! ctc (or current &#39;&lt;recursive-contract&gt;))</di=
 v>
 <div>=C2=A0 =C2=A0 =C2=A0 (define forced-ctc</div><div>=C2=A0 =C2=A0 =C2=A0=
  =C2=A0 (cond</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 [(flat-recursive=
 -contract? ctc)</div><div>@@ -104,7 +106,10 @@</div><div>=C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 [(impersonator-recursive-contract? ctc)</div><div>=C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(coerce-contract &#39;recursive-contract =
 (thunk))]))</div>
 <div>=C2=A0 =C2=A0 =C2=A0 (set-recursive-contract-ctc! ctc forced-ctc)</div=
 ><div>- =C2=A0 =C2=A0 forced-ctc]))</div><div>+ =C2=A0 =C2=A0 (set-recursiv=
 e-contract-name! ctc `(recursive-contract ,(contract-name forced-ctc)))</di=
 v><div>+ =C2=A0 =C2=A0 forced-ctc]</div><div>
 + =C2=A0 =C2=A0[else current]))</div><div>+</div><div>=C2=A0(define ((recur=
 sive-contract-projection ctc) blame)</div><div>=C2=A0 =C2=A0(define r-ctc (=
 force-recursive-contract ctc))</div><div>=C2=A0 =C2=A0(define f (contract-p=
 rojection r-ctc))</div><div>@@ -121,7 +126,16 @@</div>
 <div>=C2=A0 =C2=A0(contract-first-order-passes? (force-recursive-contract c=
 tc)</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0val))</div><div>=
 =C2=A0</div><div>-(struct recursive-contract (name thunk [ctc #:mutable]))<=
 /div><div>+(struct recursive-contract ([name #:mutable] thunk [ctc #:mutabl=
 e]))</div>
 <div>+</div><div>+(define (compute-recursive-contract-name a-recursive-cont=
 ract)</div><div>+ =C2=A0(cond</div><div>+ =C2=A0 =C2=A0[(recursive-contract=
 -ctc a-recursive-contract)</div><div>+ =C2=A0 =C2=A0 =3D&gt;</div><div>+ =
 =C2=A0 =C2=A0 contract-name]</div><div>
 + =C2=A0 =C2=A0[else</div><div>+ =C2=A0 =C2=A0 (recursive-contract-name a-r=
 ecursive-contract)]))</div><div>+</div><div>=C2=A0(struct flat-recursive-co=
 ntract recursive-contract ()</div><div>=C2=A0 =C2=A0#:property prop:flat-co=
 ntract</div><div>=C2=A0 =C2=A0(build-flat-contract-property</div>
 <div>@@ -142,4 +156,4 @@</div><div>=C2=A0 =C2=A0 #:name recursive-contract-=
 name</div><div>=C2=A0 =C2=A0 #:first-order recursive-contract-first-order</=
 div><div>=C2=A0 =C2=A0 #:projection recursive-contract-projection</div><div=
 >- =C2=A0 #:stronger recursive-contract-stronger))</div>
 <div>+ =C2=A0 #:stronger recursive-contract-stronger))</div><div>\ No newli=
 ne at end of file</div><div>[robby@yanpu] ~/git/plt/collects$=C2=A0</div><d=
 iv><br></div></div></div>
 
 --e89a8ff1cd4897c75a04da209513--
From: Asumu Takikawa <asumu@ccs.neu.edu>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: "bugs@racket-lang.org" <bugs@racket-lang.org>,
        "nobody@racket-lang.org" <nobody@racket-lang.org>,
        "bug-notification@racket-lang.org" <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13686: recursive-contract just prints syntax
 instead of a nice representation
Date: Thu, 11 Apr 2013 22:45:49 -0400

 On 2013-04-11 21:23:10 -0500, Robby Findler wrote:
 > And it gives me an idea: how about we use the locally inferred name, if
 > present?
 
 Great idea! I like how that prints:
 
   -> (contract rec/c "bar" 'pos 'neg)
   ; readline-input:2:0: broke its contract
   ;  promised: list produced "bar"
   ;  in: a disjunct of
   ;       (recursive-contract
   ;        (or/c foo (listof rec/c)))
   ;  contract from: pos
   ;  blaming: pos
   ; [,bt for context]
 
 Cheers,
 Asumu
Responsible changed from "nobody" to "robby" by robby@racket-lang.org at Thu, 11 Apr 2013 23:45:08 -0400
Reason>>> A commit by robby@racket-lang.org has resolved this report
  http://git.racket-lang.org/plt/commit/a425ee5207
State changed from "open" to "closed" by robby@racket-lang.org at Thu, 11 Apr 2013 23:45:08 -0400
Reason>>> A commit by robby@racket-lang.org has resolved this report
  http://git.racket-lang.org/plt/commit/a425ee5207
  | improve the name of recursive-contract (thanks, Asumu!)
  | 
  | closes PR 13686

