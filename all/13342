From bugs+caf_=bugs=bugs.plt-scheme.org@plt-scheme.org Tue Dec  4 00:26:47 2012
Received: from mail-ie0-f173.google.com (mail-ie0-f173.google.com [209.85.223.173])
	by champlain.ccs.neu.edu (8.14.4/8.14.4) with ESMTP id qB45QiGN016455
	for <bugs@bugs.plt-scheme.org>; Tue, 4 Dec 2012 00:26:44 -0500
Message-Id: <201212040526.qB45QfPG016448@champlain.ccs.neu.edu>
Date: Tue, 4 Dec 2012 00:26:41 -0500
From: neil.toronto@gmail.com
To: bugs@racket-lang.org
Subject: Selection box sometimes grows wrongly in response to shift-arrow presses

>Number:         13342
>Category:       all
>Synopsis:       Selection box sometimes grows wrongly in response to shift-arrow presses
>Class:          sw-bug
>Responsible:    nobody
>Severity:       serious
>Priority:       medium
>State:          open
>Confidential:   no
>Arrival-Date:   Tue Dec 04 00:28:01 -0500 2012
>Last-Modified:  Thu Jan 17 17:04:01 -0500 2013
>Originator:     Neil Toronto
>Organization:
plt
>Submitter-Id:   unknown
>Release:        5.3.1.9--2012-12-03(f1b47bb4/d)
>Environment:
unix "Linux schroder 2.6.38-15-generic #66-Ubuntu SMP Tue Aug 14 17:24:44 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux" (x86_64-linux/3m) (get-display-depth) = 32
Human Language: english
(current-memory-use) 207173848
Links: (links) = (); (links #:user? #f) = (); (links #:root? #t) = (); (links #:user? #f #:root? #t) = ()


Collections:
("/home/neil/.racket/5.3.1.9/collects"
 (non-existent-path))
("/home/neil/plt/collects"
 ("wxme" "texpict" "compiler" "typed" "games" "algol60" "browser" "file" "readline" "dynext" "scribblings" "mzcom" "compatibility" "trace" "profile" "data" "sirmail" "json" "parser-tools" "math" "tex2page" "scriblib" "swindle" "schemeunit" "r6rs" "xrepl" "mzlib" "handin-client" "repo-time-stamp" "mysterx" "mrlib" "scheme" "combinator-parser" "html" "test-engine" "planet2" "version" ".gitignore" "make" "ffi" "mzscheme" "picturing-programs" "hierlist" "teachpack" "at-exp" "lazy" "scribble" "openssl" "defaults" "racket" "handin-server" "2htdp" "drscheme" "help" "eopl" "racklog" "drracket" "icons" "db" "errortrace" "preprocessor" "rackunit" "rnrs" "string-constants" "meta" "slatex" "graphics" "redex" "reader" "plai" "honu" "config" "stepper" "frtime" "unstable" "r5rs" "planet" "tests" "s-exp" "embedded-gui" "info-domain" "syntax" "launcher" "typed-scheme" "syntax-color" "srfi" "test-box-recovery" "xml" "images" "future-visualizer" "plot" "datalog" "sgl" "htdp" "setup" "lang" "ra!
 co" "gui-debugger" "framework" "web-server" "deinprogramm" "slideshow" "macro-debugger" "typed-racket" "net" "mred"))

Computer Language: (("Determine language from source") (#(#t print mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main) (test))))
>Description:
I can't provide steps to reproduce.

Sometimes the code editor gets into a weird state in which, with the shift key held down to select a block of text, it only grows the selection from the beginning when up/left is pressed, and only grows the selection from the end when down/right is pressed. It should always grow or shrink the selection from the last caret location.

It seemed to start happening after the changes to auto parens, which I don't use yet.
>How-To-Repeat:

>Fix:
>Audit-Trail:
From: Neil Toronto <neil.toronto@gmail.com>
To: neil.toronto@gmail.com, bugs@racket-lang.org
Cc: nobody@racket-lang.org, bug-notification@racket-lang.org
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly
 in response to shift-arrow presses
Date: Tue, 08 Jan 2013 13:58:55 -0700

 On 12/03/2012 10:28 PM, neil.toronto@gmail.com wrote:
 > A new problem report is waiting at
 >    http://bugs.racket-lang.org/query/?cmd=view&pr=13342
 >
 > Reported by Neil Toronto for release: 5.3.1.9--2012-12-03(f1b47bb4/d)
 >
 > *** Description:
 > I can't provide steps to reproduce.
 >
 > Sometimes the code editor gets into a weird state in which, with the shift key held down to select a block of text, it only grows the selection from the beginning when up/left is pressed, and only grows the selection from the end when down/right is pressed. It should always grow or shrink the selection from the last caret location.
 >
 > It seemed to start happening after the changes to auto parens, which I don't use yet.
 
 Is anybody else getting this? My editor is in this state about half the 
 time and it's driving me crazy. If I select more text than I want, I 
 can't select less without starting over.
 
 I've had to retrain myself in how to move text to the previous line. I 
 used to be able to do this, where "." represents text, "*" represents 
 selected text, and "|" is the caret:
 
      (..........
       |....)
 
      (|**********       Shift-Up
 *****....)
 
      (..........|       [Holding Shift] End
 *****....)
 
      (.......... ....)  Space (replaces selected text, including newline)
 
 The "(Holding Shift) End" step doesn't work anymore half the time. It 
 does this instead:
 
      (..........
       |....)
 
      (|**********       Shift-Up
 *****....)
 
      (**********        [Holding Shift] End
 **********|
 
 Since Shift-Up/Shift-End/Space doesn't work, I've had to learn 
 Shift-Home/Delete/Delete/Space, which works consistently.
 
 Something related, which I think only happens when the editor is in this 
 weird forgetful state: it also forgets the caret position when cursoring 
 down past short lines and back into long ones. IOW, it should act like 
 this when cursoring down:
 
      ..........|
      .....
      ...............
 
      ..........
      .....|
      ...............
 
      ..........
      .....
      ..........|.....
 
 But it acts like this sometimes:
 
      ..........|
      .....
      ...............
 
      ..........
      .....|
      ...............
 
      ..........
      .....
      .....|..........
 
 This also makes it difficult to select and delete text, since it 
 sometimes does this when Shift is held.
 
 Neil ‚ä•
 
From: Robby Findler <robby@eecs.northwestern.edu>
To: Neil Toronto <neil.toronto@gmail.com>
Cc: bugs <bugs@racket-lang.org>, nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Tue, 8 Jan 2013 15:27:21 -0600

 --14dae93b608e77a35a04d2cd9c5a
 Content-Type: text/plain; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 That is the way selection used to work way back before it was fixed to work
 as you wish it to work. I believe there is a bit of state saying "this is
 the original position to grow/shrink from" somewhere in text% and it looks
 like it is getting lost. Maybe the thing to do is to add a printf when that
 state changes and then for you to edit and keep an eye on that printf. I
 bet that'll let you be able to tell us how to reproduce it and then it'll
 probably be easy to fix.
 
 Robby
 
 
 On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto <neil.toronto@gmail.com> wrote=
 :
 
 > On 12/03/2012 10:28 PM, neil.toronto@gmail.com wrote:
 >
 >> A new problem report is waiting at
 >>    http://bugs.racket-lang.org/**query/?cmd=3Dview&pr=3D13342<http://bug=
 s.racket-lang.org/query/?cmd=3Dview&pr=3D13342>
 >>
 >> Reported by Neil Toronto for release: 5.3.1.9--2012-12-03(f1b47bb4/**d)
 >>
 >> *** Description:
 >> I can't provide steps to reproduce.
 >>
 >> Sometimes the code editor gets into a weird state in which, with the
 >> shift key held down to select a block of text, it only grows the selecti=
 on
 >> from the beginning when up/left is pressed, and only grows the selection
 >> from the end when down/right is pressed. It should always grow or shrink
 >> the selection from the last caret location.
 >>
 >> It seemed to start happening after the changes to auto parens, which I
 >> don't use yet.
 >>
 >
 > Is anybody else getting this? My editor is in this state about half the
 > time and it's driving me crazy. If I select more text than I want, I can'=
 t
 > select less without starting over.
 >
 > I've had to retrain myself in how to move text to the previous line. I
 > used to be able to do this, where "." represents text, "*" represents
 > selected text, and "|" is the caret:
 >
 >     (..........
 >      |....)
 >
 >     (|**********       Shift-Up
 > *****....)
 >
 >     (..........|       [Holding Shift] End
 > *****....)
 >
 >     (.......... ....)  Space (replaces selected text, including newline)
 >
 > The "(Holding Shift) End" step doesn't work anymore half the time. It doe=
 s
 > this instead:
 >
 >     (..........
 >      |....)
 >
 >     (|**********       Shift-Up
 > *****....)
 >
 >     (**********        [Holding Shift] End
 > **********|
 >
 > Since Shift-Up/Shift-End/Space doesn't work, I've had to learn
 > Shift-Home/Delete/Delete/**Space, which works consistently.
 >
 > Something related, which I think only happens when the editor is in this
 > weird forgetful state: it also forgets the caret position when cursoring
 > down past short lines and back into long ones. IOW, it should act like th=
 is
 > when cursoring down:
 >
 >     ..........|
 >     .....
 >     ...............
 >
 >     ..........
 >     .....|
 >     ...............
 >
 >     ..........
 >     .....
 >     ..........|.....
 >
 > But it acts like this sometimes:
 >
 >     ..........|
 >     .....
 >     ...............
 >
 >     ..........
 >     .....|
 >     ...............
 >
 >     ..........
 >     .....
 >     .....|..........
 >
 > This also makes it difficult to select and delete text, since it sometime=
 s
 > does this when Shift is held.
 >
 > Neil =E2=8A=A5
 >
 >
 
 --14dae93b608e77a35a04d2cd9c5a
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">That is the way selection used to work way back before it =
 was fixed to work as you wish it to work. I believe there is a bit of state=
  saying &quot;this is the original position to grow/shrink from&quot; somew=
 here in text% and it looks like it is getting lost. Maybe the thing to do i=
 s to add a printf when that state changes and then for you to edit and keep=
  an eye on that printf. I bet that&#39;ll let you be able to tell us how to=
  reproduce it and then it&#39;ll probably be easy to fix.<div>
 <br></div><div>Robby</div></div><div class=3D"gmail_extra"><br><br><div cla=
 ss=3D"gmail_quote">On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto <span dir=
 =3D"ltr">&lt;<a href=3D"mailto:neil.toronto@gmail.com" target=3D"_blank">ne=
 il.toronto@gmail.com</a>&gt;</span> wrote:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex"><div class=3D"im">On 12/03/2012 10:28 PM, <a=
  href=3D"mailto:neil.toronto@gmail.com" target=3D"_blank">neil.toronto@gmai=
 l.com</a> wrote:<br>
 
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex">
 A new problem report is waiting at<br>
 =C2=A0 =C2=A0<a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;p=
 r=3D13342" target=3D"_blank">http://bugs.racket-lang.org/<u></u>query/?cmd=
 =3Dview&amp;pr=3D13342</a><br>
 <br>
 Reported by Neil Toronto for release: 5.3.1.9--2012-12-03(f1b47bb4/<u></u>d=
 )<br>
 <br>
 *** Description:<br>
 I can&#39;t provide steps to reproduce.<br>
 <br>
 Sometimes the code editor gets into a weird state in which, with the shift =
 key held down to select a block of text, it only grows the selection from t=
 he beginning when up/left is pressed, and only grows the selection from the=
  end when down/right is pressed. It should always grow or shrink the select=
 ion from the last caret location.<br>
 
 <br>
 It seemed to start happening after the changes to auto parens, which I don&=
 #39;t use yet.<br>
 </blockquote>
 <br></div>
 Is anybody else getting this? My editor is in this state about half the tim=
 e and it&#39;s driving me crazy. If I select more text than I want, I can&#=
 39;t select less without starting over.<br>
 <br>
 I&#39;ve had to retrain myself in how to move text to the previous line. I =
 used to be able to do this, where &quot;.&quot; represents text, &quot;*&qu=
 ot; represents selected text, and &quot;|&quot; is the caret:<br>
 <br>
 =C2=A0 =C2=A0 (..........<br>
 =C2=A0 =C2=A0 =C2=A0|....)<br>
 <br>
 =C2=A0 =C2=A0 (|********** =C2=A0 =C2=A0 =C2=A0 Shift-Up<br>
 *****....)<br>
 <br>
 =C2=A0 =C2=A0 (..........| =C2=A0 =C2=A0 =C2=A0 [Holding Shift] End<br>
 *****....)<br>
 <br>
 =C2=A0 =C2=A0 (.......... ....) =C2=A0Space (replaces selected text, includ=
 ing newline)<br>
 <br>
 The &quot;(Holding Shift) End&quot; step doesn&#39;t work anymore half the =
 time. It does this instead:<br>
 <br>
 =C2=A0 =C2=A0 (..........<br>
 =C2=A0 =C2=A0 =C2=A0|....)<br>
 <br>
 =C2=A0 =C2=A0 (|********** =C2=A0 =C2=A0 =C2=A0 Shift-Up<br>
 *****....)<br>
 <br>
 =C2=A0 =C2=A0 (********** =C2=A0 =C2=A0 =C2=A0 =C2=A0[Holding Shift] End<br=
 >
 **********|<br>
 <br>
 Since Shift-Up/Shift-End/Space doesn&#39;t work, I&#39;ve had to learn Shif=
 t-Home/Delete/Delete/<u></u>Space, which works consistently.<br>
 <br>
 Something related, which I think only happens when the editor is in this we=
 ird forgetful state: it also forgets the caret position when cursoring down=
  past short lines and back into long ones. IOW, it should act like this whe=
 n cursoring down:<br>
 
 <br>
 =C2=A0 =C2=A0 ..........|<br>
 =C2=A0 =C2=A0 .....<br>
 =C2=A0 =C2=A0 ...............<br>
 <br>
 =C2=A0 =C2=A0 ..........<br>
 =C2=A0 =C2=A0 .....|<br>
 =C2=A0 =C2=A0 ...............<br>
 <br>
 =C2=A0 =C2=A0 ..........<br>
 =C2=A0 =C2=A0 .....<br>
 =C2=A0 =C2=A0 ..........|.....<br>
 <br>
 But it acts like this sometimes:<br>
 <br>
 =C2=A0 =C2=A0 ..........|<br>
 =C2=A0 =C2=A0 .....<br>
 =C2=A0 =C2=A0 ...............<br>
 <br>
 =C2=A0 =C2=A0 ..........<br>
 =C2=A0 =C2=A0 .....|<br>
 =C2=A0 =C2=A0 ...............<br>
 <br>
 =C2=A0 =C2=A0 ..........<br>
 =C2=A0 =C2=A0 .....<br>
 =C2=A0 =C2=A0 .....|..........<br>
 <br>
 This also makes it difficult to select and delete text, since it sometimes =
 does this when Shift is held.<span class=3D"HOEnZb"><font color=3D"#888888"=
 ><br>
 <br>
 Neil =E2=8A=A5<br>
 <br>
 </font></span></blockquote></div><br></div>
 
 --14dae93b608e77a35a04d2cd9c5a--
From: Neil Toronto <neil.toronto@gmail.com>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: bugs <bugs@racket-lang.org>, nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly
 in response to shift-arrow presses
Date: Tue, 08 Jan 2013 14:28:30 -0700

 Cool. Where do I put the printf?
 
 On 01/08/2013 02:27 PM, Robby Findler wrote:
 > That is the way selection used to work way back before it was fixed to
 > work as you wish it to work. I believe there is a bit of state saying
 > "this is the original position to grow/shrink from" somewhere in text%
 > and it looks like it is getting lost. Maybe the thing to do is to add a
 > printf when that state changes and then for you to edit and keep an eye
 > on that printf. I bet that'll let you be able to tell us how to
 > reproduce it and then it'll probably be easy to fix.
 >
 > Robby
 >
 >
 > On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto <neil.toronto@gmail.com
 > <mailto:neil.toronto@gmail.com>> wrote:
 >
 >     On 12/03/2012 10:28 PM, neil.toronto@gmail.com
 >     <mailto:neil.toronto@gmail.com> wrote:
 >
 >         A new problem report is waiting at
 >         http://bugs.racket-lang.org/__query/?cmd=view&pr=13342
 >         <http://bugs.racket-lang.org/query/?cmd=view&pr=13342>
 >
 >         Reported by Neil Toronto for release:
 >         5.3.1.9--2012-12-03(f1b47bb4/__d)
 >
 >         *** Description:
 >         I can't provide steps to reproduce.
 >
 >         Sometimes the code editor gets into a weird state in which, with
 >         the shift key held down to select a block of text, it only grows
 >         the selection from the beginning when up/left is pressed, and
 >         only grows the selection from the end when down/right is
 >         pressed. It should always grow or shrink the selection from the
 >         last caret location.
 >
 >         It seemed to start happening after the changes to auto parens,
 >         which I don't use yet.
 >
 >
 >     Is anybody else getting this? My editor is in this state about half
 >     the time and it's driving me crazy. If I select more text than I
 >     want, I can't select less without starting over.
 >
 >     I've had to retrain myself in how to move text to the previous line.
 >     I used to be able to do this, where "." represents text, "*"
 >     represents selected text, and "|" is the caret:
 >
 >          (..........
 >           |....)
 >
 >          (|**********       Shift-Up
 >     *****....)
 >
 >          (..........|       [Holding Shift] End
 >     *****....)
 >
 >          (.......... ....)  Space (replaces selected text, including
 >     newline)
 >
 >     The "(Holding Shift) End" step doesn't work anymore half the time.
 >     It does this instead:
 >
 >          (..........
 >           |....)
 >
 >          (|**********       Shift-Up
 >     *****....)
 >
 >          (**********        [Holding Shift] End
 >     **********|
 >
 >     Since Shift-Up/Shift-End/Space doesn't work, I've had to learn
 >     Shift-Home/Delete/Delete/__Space, which works consistently.
 >
 >     Something related, which I think only happens when the editor is in
 >     this weird forgetful state: it also forgets the caret position when
 >     cursoring down past short lines and back into long ones. IOW, it
 >     should act like this when cursoring down:
 >
 >          ..........|
 >          .....
 >          ...............
 >
 >          ..........
 >          .....|
 >          ...............
 >
 >          ..........
 >          .....
 >          ..........|.....
 >
 >     But it acts like this sometimes:
 >
 >          ..........|
 >          .....
 >          ...............
 >
 >          ..........
 >          .....|
 >          ...............
 >
 >          ..........
 >          .....
 >          .....|..........
 >
 >     This also makes it difficult to select and delete text, since it
 >     sometimes does this when Shift is held.
 >
 >     Neil ‚ä•
 >
 >
 
From: Robby Findler <robby@eecs.northwestern.edu>
To: Neil Toronto <neil.toronto@gmail.com>
Cc: bugs <bugs@racket-lang.org>, nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Tue, 8 Jan 2013 15:54:01 -0600

 --bcaec54a367ac8acbb04d2cdfbf8
 Content-Type: text/plain; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 The move-position method in mred/private/wxme/text.rkt is the relevant code
 I believe.
 
 This isn't code that I wrote so I could be missing something, but  it sure
 looks like you want to watch the variables extendstartpos extendendpos
 and extend-streak?.
 
 Matthew may know better; he wrote the code.
 
 Robby
 
 
 On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto <neil.toronto@gmail.com> wrote=
 :
 
 > Cool. Where do I put the printf?
 >
 >
 > On 01/08/2013 02:27 PM, Robby Findler wrote:
 >
 >> That is the way selection used to work way back before it was fixed to
 >> work as you wish it to work. I believe there is a bit of state saying
 >> "this is the original position to grow/shrink from" somewhere in text%
 >> and it looks like it is getting lost. Maybe the thing to do is to add a
 >> printf when that state changes and then for you to edit and keep an eye
 >> on that printf. I bet that'll let you be able to tell us how to
 >> reproduce it and then it'll probably be easy to fix.
 >>
 >> Robby
 >>
 >>
 >> On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto <neil.toronto@gmail.com
 >> <mailto:neil.toronto@gmail.com**>> wrote:
 >>
 >>     On 12/03/2012 10:28 PM, neil.toronto@gmail.com
 >>     <mailto:neil.toronto@gmail.com**> wrote:
 >>
 >>         A new problem report is waiting at
 >>         http://bugs.racket-lang.org/__**query/?cmd=3Dview&pr=3D13342<htt=
 p://bugs.racket-lang.org/__query/?cmd=3Dview&pr=3D13342>
 >>
 >>         <http://bugs.racket-lang.org/**query/?cmd=3Dview&pr=3D13342<http=
 ://bugs.racket-lang.org/query/?cmd=3Dview&pr=3D13342>
 >> >
 >>
 >>         Reported by Neil Toronto for release:
 >>         5.3.1.9--2012-12-03(f1b47bb4/_**_d)
 >>
 >>
 >>         *** Description:
 >>         I can't provide steps to reproduce.
 >>
 >>         Sometimes the code editor gets into a weird state in which, with
 >>         the shift key held down to select a block of text, it only grows
 >>         the selection from the beginning when up/left is pressed, and
 >>         only grows the selection from the end when down/right is
 >>         pressed. It should always grow or shrink the selection from the
 >>         last caret location.
 >>
 >>         It seemed to start happening after the changes to auto parens,
 >>         which I don't use yet.
 >>
 >>
 >>     Is anybody else getting this? My editor is in this state about half
 >>     the time and it's driving me crazy. If I select more text than I
 >>     want, I can't select less without starting over.
 >>
 >>     I've had to retrain myself in how to move text to the previous line.
 >>     I used to be able to do this, where "." represents text, "*"
 >>     represents selected text, and "|" is the caret:
 >>
 >>          (..........
 >>           |....)
 >>
 >>          (|**********       Shift-Up
 >>     *****....)
 >>
 >>          (..........|       [Holding Shift] End
 >>     *****....)
 >>
 >>          (.......... ....)  Space (replaces selected text, including
 >>     newline)
 >>
 >>     The "(Holding Shift) End" step doesn't work anymore half the time.
 >>     It does this instead:
 >>
 >>          (..........
 >>           |....)
 >>
 >>          (|**********       Shift-Up
 >>     *****....)
 >>
 >>          (**********        [Holding Shift] End
 >>     **********|
 >>
 >>     Since Shift-Up/Shift-End/Space doesn't work, I've had to learn
 >>     Shift-Home/Delete/Delete/__**Space, which works consistently.
 >>
 >>
 >>     Something related, which I think only happens when the editor is in
 >>     this weird forgetful state: it also forgets the caret position when
 >>     cursoring down past short lines and back into long ones. IOW, it
 >>     should act like this when cursoring down:
 >>
 >>          ..........|
 >>          .....
 >>          ...............
 >>
 >>          ..........
 >>          .....|
 >>          ...............
 >>
 >>          ..........
 >>          .....
 >>          ..........|.....
 >>
 >>     But it acts like this sometimes:
 >>
 >>          ..........|
 >>          .....
 >>          ...............
 >>
 >>          ..........
 >>          .....|
 >>          ...............
 >>
 >>          ..........
 >>          .....
 >>          .....|..........
 >>
 >>     This also makes it difficult to select and delete text, since it
 >>     sometimes does this when Shift is held.
 >>
 >>     Neil =E2=8A=A5
 >>
 >>
 >>
 >
 
 --bcaec54a367ac8acbb04d2cdfbf8
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr"><div style>The move-position method in mred/private/wxme/t=
 ext.rkt is the relevant code I believe.</div><div><br></div>This isn&#39;t =
 code that I wrote so I could be missing something, but =C2=A0it sure looks =
 like you want to watch the variables=C2=A0extendstartpos=C2=A0extendendpos =
 and=C2=A0extend-streak?.<div>
 <br></div><div style>Matthew may know better; he wrote the code.</div><div>=
 <br></div><div>Robby</div></div><div class=3D"gmail_extra"><br><br><div cla=
 ss=3D"gmail_quote">On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto <span dir=
 =3D"ltr">&lt;<a href=3D"mailto:neil.toronto@gmail.com" target=3D"_blank">ne=
 il.toronto@gmail.com</a>&gt;</span> wrote:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex">Cool. Where do I put the printf?<div class=
 =3D"im"><br>
 <br>
 On 01/08/2013 02:27 PM, Robby Findler wrote:<br>
 </div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-l=
 eft:1px #ccc solid;padding-left:1ex"><div class=3D"im">
 That is the way selection used to work way back before it was fixed to<br>
 work as you wish it to work. I believe there is a bit of state saying<br>
 &quot;this is the original position to grow/shrink from&quot; somewhere in =
 text%<br>
 and it looks like it is getting lost. Maybe the thing to do is to add a<br>
 printf when that state changes and then for you to edit and keep an eye<br>
 on that printf. I bet that&#39;ll let you be able to tell us how to<br>
 reproduce it and then it&#39;ll probably be easy to fix.<br>
 <br>
 Robby<br>
 <br>
 <br>
 On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto &lt;<a href=3D"mailto:neil.tor=
 onto@gmail.com" target=3D"_blank">neil.toronto@gmail.com</a><br></div><div =
 class=3D"im">
 &lt;mailto:<a href=3D"mailto:neil.toronto@gmail.com" target=3D"_blank">neil=
 .toronto@gmail.com</a><u></u>&gt;&gt; wrote:<br>
 <br>
 =C2=A0 =C2=A0 On 12/03/2012 10:28 PM, <a href=3D"mailto:neil.toronto@gmail.=
 com" target=3D"_blank">neil.toronto@gmail.com</a><br></div><div class=3D"im=
 ">
 =C2=A0 =C2=A0 &lt;mailto:<a href=3D"mailto:neil.toronto@gmail.com" target=
 =3D"_blank">neil.toronto@gmail.com</a><u></u>&gt; wrote:<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 A new problem report is waiting at<br></div>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 <a href=3D"http://bugs.racket-lang.org/__query/=
 ?cmd=3Dview&amp;pr=3D13342" target=3D"_blank">http://bugs.racket-lang.org/_=
 _<u></u>query/?cmd=3Dview&amp;pr=3D13342</a><div class=3D"im"><br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 &lt;<a href=3D"http://bugs.racket-lang.org/quer=
 y/?cmd=3Dview&amp;pr=3D13342" target=3D"_blank">http://bugs.racket-lang.org=
 /<u></u>query/?cmd=3Dview&amp;pr=3D13342</a>&gt;<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Reported by Neil Toronto for release:<br></div>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 5.3.1.9--2012-12-03(f1b47bb4/_<u></u>_d)<div><d=
 iv class=3D"h5"><br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 *** Description:<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 I can&#39;t provide steps to reproduce.<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Sometimes the code editor gets into a weird sta=
 te in which, with<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 the shift key held down to select a block of te=
 xt, it only grows<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 the selection from the beginning when up/left i=
 s pressed, and<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 only grows the selection from the end when down=
 /right is<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 pressed. It should always grow or shrink the se=
 lection from the<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 last caret location.<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 It seemed to start happening after the changes =
 to auto parens,<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 which I don&#39;t use yet.<br>
 <br>
 <br>
 =C2=A0 =C2=A0 Is anybody else getting this? My editor is in this state abou=
 t half<br>
 =C2=A0 =C2=A0 the time and it&#39;s driving me crazy. If I select more text=
  than I<br>
 =C2=A0 =C2=A0 want, I can&#39;t select less without starting over.<br>
 <br>
 =C2=A0 =C2=A0 I&#39;ve had to retrain myself in how to move text to the pre=
 vious line.<br>
 =C2=A0 =C2=A0 I used to be able to do this, where &quot;.&quot; represents =
 text, &quot;*&quot;<br>
 =C2=A0 =C2=A0 represents selected text, and &quot;|&quot; is the caret:<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(..........<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 |....)<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(|********** =C2=A0 =C2=A0 =C2=A0 Shift-U=
 p<br>
 =C2=A0 =C2=A0 *****....)<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(..........| =C2=A0 =C2=A0 =C2=A0 [Holdin=
 g Shift] End<br>
 =C2=A0 =C2=A0 *****....)<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(.......... ....) =C2=A0Space (replaces s=
 elected text, including<br>
 =C2=A0 =C2=A0 newline)<br>
 <br>
 =C2=A0 =C2=A0 The &quot;(Holding Shift) End&quot; step doesn&#39;t work any=
 more half the time.<br>
 =C2=A0 =C2=A0 It does this instead:<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(..........<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 |....)<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(|********** =C2=A0 =C2=A0 =C2=A0 Shift-U=
 p<br>
 =C2=A0 =C2=A0 *****....)<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(********** =C2=A0 =C2=A0 =C2=A0 =C2=A0[H=
 olding Shift] End<br>
 =C2=A0 =C2=A0 **********|<br>
 <br>
 =C2=A0 =C2=A0 Since Shift-Up/Shift-End/Space doesn&#39;t work, I&#39;ve had=
  to learn<br></div></div>
 =C2=A0 =C2=A0 Shift-Home/Delete/Delete/__<u></u>Space, which works consiste=
 ntly.<div><div class=3D"h5"><br>
 <br>
 =C2=A0 =C2=A0 Something related, which I think only happens when the editor=
  is in<br>
 =C2=A0 =C2=A0 this weird forgetful state: it also forgets the caret positio=
 n when<br>
 =C2=A0 =C2=A0 cursoring down past short lines and back into long ones. IOW,=
  it<br>
 =C2=A0 =C2=A0 should act like this when cursoring down:<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........|<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0...............<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0...............<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........|.....<br>
 <br>
 =C2=A0 =C2=A0 But it acts like this sometimes:<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........|<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0...............<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0...............<br>
 <br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|..........<br>
 <br>
 =C2=A0 =C2=A0 This also makes it difficult to select and delete text, since=
  it<br>
 =C2=A0 =C2=A0 sometimes does this when Shift is held.<br>
 <br>
 =C2=A0 =C2=A0 Neil =E2=8A=A5<br>
 <br>
 <br>
 </div></div></blockquote>
 <br>
 </blockquote></div><br></div>
 
 --bcaec54a367ac8acbb04d2cdfbf8--
From: Eli Barzilay <eli@barzilay.org>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: Neil Toronto <neil.toronto@gmail.com>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Tue, 8 Jan 2013 17:02:12 -0500

 30 minutes ago, Robby Findler wrote:
 > That is the way selection used to work way back before it was fixed
 > to work as you wish it to work.
 
 Yeah, it annoyed me too -- and it's still there like Neil says...
 
 
 > I believe there is a bit of state saying "this is the original
 > position to grow/shrink from" somewhere in text% and it looks like
 > it is getting lost.
 
 IIRC, it used to do this after a M-left/right which is fixed now, but
 it still does it on a double-click now: write "foo bar baz",
 double-click the middle word, and use S-left/right to see it happen.
 
 (And speaking about editor things, there's also the ancient bug where
 C-left can't skip over an empty line...)
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                     http://barzilay.org/                   Maze is Life!
From: Robby Findler <robby@eecs.northwestern.edu>
To: Eli Barzilay <eli@barzilay.org>
Cc: Neil Toronto <neil.toronto@gmail.com>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Tue, 8 Jan 2013 16:41:25 -0600

 --14dae93b608e4ac98c04d2cea521
 Content-Type: text/plain; charset=UTF-8
 
 On Tue, Jan 8, 2013 at 4:02 PM, Eli Barzilay <eli@barzilay.org> wrote:
 
 > (And speaking about editor things, there's also the ancient bug where
 > C-left can't skip over an empty line...)
 >
 >
 This one looks like a bug in find-wordbreak:
 
 #lang racket/gui
 (define t (new text%))
 (send t insert "a\n\nb")
 (define b (box 3))
 (send t find-wordbreak b #f 'caret)
 (unbox b) ;; = 3
 
 But 3 is probably not the right answer (if I'm not getting mixed up) -- 0
 is.
 
 Robby
 
 --14dae93b608e4ac98c04d2cea521
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">On Tue, Jan 8, 2013 at 4:02 PM, Eli Barzilay <span dir=3D"=
 ltr">&lt;<a href=3D"mailto:eli@barzilay.org" target=3D"_blank">eli@barzilay=
 .org</a>&gt;</span> wrote:<br><div class=3D"gmail_extra"><div class=3D"gmai=
 l_quote">
 <blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-=
 left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;p=
 adding-left:1ex"><div class=3D"im">(And speaking about editor things, there=
 &#39;s also the ancient bug where<br>
 </div>
 C-left can&#39;t skip over an empty line...)<br><br></blockquote><div style=
 ><br></div><div style>This one looks like a bug in find-wordbreak:</div><di=
 v style><br></div><div>#lang racket/gui</div><div>(define t (new text%))</d=
 iv>
 <div>(send t insert &quot;a\n\nb&quot;)</div><div>(define b (box 3))</div><=
 div>(send t find-wordbreak b #f &#39;caret)</div><div>(unbox b) ;; =3D 3</d=
 iv><div><br></div><div style>But 3 is probably not the right answer (if I&#=
 39;m not getting mixed up) -- 0 is.</div>
 <div style><br></div><div style>Robby</div><div style><br></div><div style>=
 =C2=A0</div></div><br></div></div>
 
 --14dae93b608e4ac98c04d2cea521--
From: Robby Findler <robby@eecs.northwestern.edu>
To: Matthew Flatt <mflatt@cs.utah.edu>
Cc: Neil Toronto <neil.toronto@gmail.com>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Tue, 8 Jan 2013 17:11:27 -0600

 --f46d04447ecfc0f7e404d2cf10bd
 Content-Type: text/plain; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 Ah, right. And that would indeed be an easy fix as soon as we can reproduce
 the bug.
 
 Robby
 
 
 On Tue, Jan 8, 2013 at 5:10 PM, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 
 > Yes.
 >
 > It may be that a `begin-edit-sequence' somewhere needs a #f second
 > argument, which means "don't interrupt the current streak".
 >
 > At Tue, 8 Jan 2013 15:54:01 -0600, Robby Findler wrote:
 > > The move-position method in mred/private/wxme/text.rkt is the relevant
 > code
 > > I believe.
 > >
 > > This isn't code that I wrote so I could be missing something, but  it
 > sure
 > > looks like you want to watch the variables extendstartpos extendendpos
 > > and extend-streak?.
 > >
 > > Matthew may know better; he wrote the code.
 > >
 > > Robby
 > >
 > >
 > > On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto <neil.toronto@gmail.com>
 > wrote:
 > >
 > > > Cool. Where do I put the printf?
 > > >
 > > >
 > > > On 01/08/2013 02:27 PM, Robby Findler wrote:
 > > >
 > > >> That is the way selection used to work way back before it was fixed =
 to
 > > >> work as you wish it to work. I believe there is a bit of state sayin=
 g
 > > >> "this is the original position to grow/shrink from" somewhere in tex=
 t%
 > > >> and it looks like it is getting lost. Maybe the thing to do is to ad=
 d
 > a
 > > >> printf when that state changes and then for you to edit and keep an
 > eye
 > > >> on that printf. I bet that'll let you be able to tell us how to
 > > >> reproduce it and then it'll probably be easy to fix.
 > > >>
 > > >> Robby
 > > >>
 > > >>
 > > >> On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto <neil.toronto@gmail.com
 > > >> <mailto:neil.toronto@gmail.com**>> wrote:
 > > >>
 > > >>     On 12/03/2012 10:28 PM, neil.toronto@gmail.com
 > > >>     <mailto:neil.toronto@gmail.com**> wrote:
 > > >>
 > > >>         A new problem report is waiting at
 > > >>
 > > http://bugs.racket-lang.org/__**query/?cmd=3Dview&pr=3D13342<
 > http://bugs.racket-lang
 > > .org/__query/?cmd=3Dview&pr=3D13342>
 > > >>
 > > >>
 > > <http://bugs.racket-lang.org/**query/?cmd=3Dview&pr=3D13342<
 > http://bugs.racket-lang.
 > > org/query/?cmd=3Dview&pr=3D13342>
 > > >> >
 > > >>
 > > >>         Reported by Neil Toronto for release:
 > > >>         5.3.1.9--2012-12-03(f1b47bb4/_**_d)
 > > >>
 > > >>
 > > >>         *** Description:
 > > >>         I can't provide steps to reproduce.
 > > >>
 > > >>         Sometimes the code editor gets into a weird state in which,
 > with
 > > >>         the shift key held down to select a block of text, it only
 > grows
 > > >>         the selection from the beginning when up/left is pressed, an=
 d
 > > >>         only grows the selection from the end when down/right is
 > > >>         pressed. It should always grow or shrink the selection from
 > the
 > > >>         last caret location.
 > > >>
 > > >>         It seemed to start happening after the changes to auto paren=
 s,
 > > >>         which I don't use yet.
 > > >>
 > > >>
 > > >>     Is anybody else getting this? My editor is in this state about
 > half
 > > >>     the time and it's driving me crazy. If I select more text than I
 > > >>     want, I can't select less without starting over.
 > > >>
 > > >>     I've had to retrain myself in how to move text to the previous
 > line.
 > > >>     I used to be able to do this, where "." represents text, "*"
 > > >>     represents selected text, and "|" is the caret:
 > > >>
 > > >>          (..........
 > > >>           |....)
 > > >>
 > > >>          (|**********       Shift-Up
 > > >>     *****....)
 > > >>
 > > >>          (..........|       [Holding Shift] End
 > > >>     *****....)
 > > >>
 > > >>          (.......... ....)  Space (replaces selected text, including
 > > >>     newline)
 > > >>
 > > >>     The "(Holding Shift) End" step doesn't work anymore half the tim=
 e.
 > > >>     It does this instead:
 > > >>
 > > >>          (..........
 > > >>           |....)
 > > >>
 > > >>          (|**********       Shift-Up
 > > >>     *****....)
 > > >>
 > > >>          (**********        [Holding Shift] End
 > > >>     **********|
 > > >>
 > > >>     Since Shift-Up/Shift-End/Space doesn't work, I've had to learn
 > > >>     Shift-Home/Delete/Delete/__**Space, which works consistently.
 > > >>
 > > >>
 > > >>     Something related, which I think only happens when the editor is
 > in
 > > >>     this weird forgetful state: it also forgets the caret position
 > when
 > > >>     cursoring down past short lines and back into long ones. IOW, it
 > > >>     should act like this when cursoring down:
 > > >>
 > > >>          ..........|
 > > >>          .....
 > > >>          ...............
 > > >>
 > > >>          ..........
 > > >>          .....|
 > > >>          ...............
 > > >>
 > > >>          ..........
 > > >>          .....
 > > >>          ..........|.....
 > > >>
 > > >>     But it acts like this sometimes:
 > > >>
 > > >>          ..........|
 > > >>          .....
 > > >>          ...............
 > > >>
 > > >>          ..........
 > > >>          .....|
 > > >>          ...............
 > > >>
 > > >>          ..........
 > > >>          .....
 > > >>          .....|..........
 > > >>
 > > >>     This also makes it difficult to select and delete text, since it
 > > >>     sometimes does this when Shift is held.
 > > >>
 > > >>     Neil =E2=8A=A5
 > > >>
 > > >>
 > > >>
 > > >
 >
 
 --f46d04447ecfc0f7e404d2cf10bd
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">Ah, right. And that would indeed be an easy fix as soon as=
  we can reproduce the bug.<div><br></div><div>Robby</div></div><div class=
 =3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Tue, Jan 8, 2013 at =
 5:10 PM, Matthew Flatt <span dir=3D"ltr">&lt;<a href=3D"mailto:mflatt@cs.ut=
 ah.edu" target=3D"_blank">mflatt@cs.utah.edu</a>&gt;</span> wrote:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex">Yes.<br>
 <br>
 It may be that a `begin-edit-sequence&#39; somewhere needs a #f second<br>
 argument, which means &quot;don&#39;t interrupt the current streak&quot;.<b=
 r>
 <div class=3D"im"><br>
 At Tue, 8 Jan 2013 15:54:01 -0600, Robby Findler wrote:<br>
 &gt; The move-position method in mred/private/wxme/text.rkt is the relevant=
  code<br>
 &gt; I believe.<br>
 &gt;<br>
 &gt; This isn&#39;t code that I wrote so I could be missing something, but =
 =C2=A0it sure<br>
 &gt; looks like you want to watch the variables extendstartpos extendendpos=
 <br>
 &gt; and extend-streak?.<br>
 &gt;<br>
 &gt; Matthew may know better; he wrote the code.<br>
 &gt;<br>
 &gt; Robby<br>
 &gt;<br>
 &gt;<br>
 &gt; On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto &lt;<a href=3D"mailto:nei=
 l.toronto@gmail.com">neil.toronto@gmail.com</a>&gt; wrote:<br>
 &gt;<br>
 &gt; &gt; Cool. Where do I put the printf?<br>
 &gt; &gt;<br>
 &gt; &gt;<br>
 &gt; &gt; On 01/08/2013 02:27 PM, Robby Findler wrote:<br>
 &gt; &gt;<br>
 &gt; &gt;&gt; That is the way selection used to work way back before it was=
  fixed to<br>
 &gt; &gt;&gt; work as you wish it to work. I believe there is a bit of stat=
 e saying<br>
 &gt; &gt;&gt; &quot;this is the original position to grow/shrink from&quot;=
  somewhere in text%<br>
 &gt; &gt;&gt; and it looks like it is getting lost. Maybe the thing to do i=
 s to add a<br>
 &gt; &gt;&gt; printf when that state changes and then for you to edit and k=
 eep an eye<br>
 &gt; &gt;&gt; on that printf. I bet that&#39;ll let you be able to tell us =
 how to<br>
 &gt; &gt;&gt; reproduce it and then it&#39;ll probably be easy to fix.<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; Robby<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto &lt;<a href=3D"m=
 ailto:neil.toronto@gmail.com">neil.toronto@gmail.com</a><br>
 </div><div class=3D"im">&gt; &gt;&gt; &lt;mailto:<a href=3D"mailto:neil.tor=
 onto@gmail.com">neil.toronto@gmail.com</a>**&gt;&gt; wrote:<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 On 12/03/2012 10:28 PM, <a href=3D"mailto:neil.=
 toronto@gmail.com">neil.toronto@gmail.com</a><br>
 </div><div class=3D"im">&gt; &gt;&gt; =C2=A0 =C2=A0 &lt;mailto:<a href=3D"m=
 ailto:neil.toronto@gmail.com">neil.toronto@gmail.com</a>**&gt; wrote:<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 A new problem report is waiting a=
 t<br>
 &gt; &gt;&gt;<br>
 </div>&gt; <a href=3D"http://bugs.racket-lang.org/__**query/?cmd=3Dview&amp=
 ;pr=3D13342" target=3D"_blank">http://bugs.racket-lang.org/__**query/?cmd=
 =3Dview&amp;pr=3D13342</a>&lt;<a href=3D"http://bugs.racket-lang" target=3D=
 "_blank">http://bugs.racket-lang</a><br>
 
 &gt; .org/__query/?cmd=3Dview&amp;pr=3D13342&gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &lt;<a href=3D"http://bugs.racket-lang.org/**query/?cmd=3Dview&amp;pr=
 =3D13342" target=3D"_blank">http://bugs.racket-lang.org/**query/?cmd=3Dview=
 &amp;pr=3D13342</a>&lt;<a href=3D"http://bugs.racket-lang" target=3D"_blank=
 ">http://bugs.racket-lang</a>.<br>
 
 <div class=3D"im">&gt; org/query/?cmd=3Dview&amp;pr=3D13342&gt;<br>
 &gt; &gt;&gt; &gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 Reported by Neil Toronto for rele=
 ase:<br>
 </div>&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 5.3.1.9--2012-12-03(f1b47bb=
 4/_**_d)<br>
 <div><div class=3D"h5">&gt; &gt;&gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 *** Description:<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 I can&#39;t provide steps to repr=
 oduce.<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 Sometimes the code editor gets in=
 to a weird state in which, with<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 the shift key held down to select=
  a block of text, it only grows<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 the selection from the beginning =
 when up/left is pressed, and<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 only grows the selection from the=
  end when down/right is<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 pressed. It should always grow or=
  shrink the selection from the<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 last caret location.<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 It seemed to start happening afte=
 r the changes to auto parens,<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 which I don&#39;t use yet.<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 Is anybody else getting this? My editor is in t=
 his state about half<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 the time and it&#39;s driving me crazy. If I se=
 lect more text than I<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 want, I can&#39;t select less without starting =
 over.<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 I&#39;ve had to retrain myself in how to move t=
 ext to the previous line.<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 I used to be able to do this, where &quot;.&quo=
 t; represents text, &quot;*&quot;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 represents selected text, and &quot;|&quot; is =
 the caret:<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(..........<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 |....)<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(|********** =C2=A0 =C2=A0 =
 =C2=A0 Shift-Up<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 *****....)<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(..........| =C2=A0 =C2=A0 =
 =C2=A0 [Holding Shift] End<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 *****....)<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(.......... ....) =C2=A0Spa=
 ce (replaces selected text, including<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 newline)<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 The &quot;(Holding Shift) End&quot; step doesn&=
 #39;t work anymore half the time.<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 It does this instead:<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(..........<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 |....)<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(|********** =C2=A0 =C2=A0 =
 =C2=A0 Shift-Up<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 *****....)<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(********** =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0[Holding Shift] End<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 **********|<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 Since Shift-Up/Shift-End/Space doesn&#39;t work=
 , I&#39;ve had to learn<br>
 </div></div>&gt; &gt;&gt; =C2=A0 =C2=A0 Shift-Home/Delete/Delete/__**Space,=
  which works consistently.<br>
 <div class=3D"HOEnZb"><div class=3D"h5">&gt; &gt;&gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 Something related, which I think only happens w=
 hen the editor is in<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 this weird forgetful state: it also forgets the=
  caret position when<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 cursoring down past short lines and back into l=
 ong ones. IOW, it<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 should act like this when cursoring down:<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........|<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0...............<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0...............<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........|.....<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 But it acts like this sometimes:<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........|<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0...............<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0...............<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0..........<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|..........<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 This also makes it difficult to select and dele=
 te text, since it<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 sometimes does this when Shift is held.<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt; =C2=A0 =C2=A0 Neil =E2=8A=A5<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;&gt;<br>
 &gt; &gt;<br>
 </div></div></blockquote></div><br></div>
 
 --f46d04447ecfc0f7e404d2cf10bd--
From: Matthew Flatt <mflatt@cs.utah.edu>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: Neil Toronto <neil.toronto@gmail.com>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Tue, 8 Jan 2013 16:10:21 -0700

 Yes.
 
 It may be that a `begin-edit-sequence' somewhere needs a #f second
 argument, which means "don't interrupt the current streak".
 
 At Tue, 8 Jan 2013 15:54:01 -0600, Robby Findler wrote:
 > The move-position method in mred/private/wxme/text.rkt is the relevant code
 > I believe.
 > 
 > This isn't code that I wrote so I could be missing something, but  it sure
 > looks like you want to watch the variables extendstartpos extendendpos
 > and extend-streak?.
 > 
 > Matthew may know better; he wrote the code.
 > 
 > Robby
 > 
 > 
 > On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto <neil.toronto@gmail.com> wrote:
 > 
 > > Cool. Where do I put the printf?
 > >
 > >
 > > On 01/08/2013 02:27 PM, Robby Findler wrote:
 > >
 > >> That is the way selection used to work way back before it was fixed to
 > >> work as you wish it to work. I believe there is a bit of state saying
 > >> "this is the original position to grow/shrink from" somewhere in text%
 > >> and it looks like it is getting lost. Maybe the thing to do is to add a
 > >> printf when that state changes and then for you to edit and keep an eye
 > >> on that printf. I bet that'll let you be able to tell us how to
 > >> reproduce it and then it'll probably be easy to fix.
 > >>
 > >> Robby
 > >>
 > >>
 > >> On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto <neil.toronto@gmail.com
 > >> <mailto:neil.toronto@gmail.com**>> wrote:
 > >>
 > >>     On 12/03/2012 10:28 PM, neil.toronto@gmail.com
 > >>     <mailto:neil.toronto@gmail.com**> wrote:
 > >>
 > >>         A new problem report is waiting at
 > >>         
 > http://bugs.racket-lang.org/__**query/?cmd=view&pr=13342<http://bugs.racket-lang
 > .org/__query/?cmd=view&pr=13342>
 > >>
 > >>         
 > <http://bugs.racket-lang.org/**query/?cmd=view&pr=13342<http://bugs.racket-lang.
 > org/query/?cmd=view&pr=13342>
 > >> >
 > >>
 > >>         Reported by Neil Toronto for release:
 > >>         5.3.1.9--2012-12-03(f1b47bb4/_**_d)
 > >>
 > >>
 > >>         *** Description:
 > >>         I can't provide steps to reproduce.
 > >>
 > >>         Sometimes the code editor gets into a weird state in which, with
 > >>         the shift key held down to select a block of text, it only grows
 > >>         the selection from the beginning when up/left is pressed, and
 > >>         only grows the selection from the end when down/right is
 > >>         pressed. It should always grow or shrink the selection from the
 > >>         last caret location.
 > >>
 > >>         It seemed to start happening after the changes to auto parens,
 > >>         which I don't use yet.
 > >>
 > >>
 > >>     Is anybody else getting this? My editor is in this state about half
 > >>     the time and it's driving me crazy. If I select more text than I
 > >>     want, I can't select less without starting over.
 > >>
 > >>     I've had to retrain myself in how to move text to the previous line.
 > >>     I used to be able to do this, where "." represents text, "*"
 > >>     represents selected text, and "|" is the caret:
 > >>
 > >>          (..........
 > >>           |....)
 > >>
 > >>          (|**********       Shift-Up
 > >>     *****....)
 > >>
 > >>          (..........|       [Holding Shift] End
 > >>     *****....)
 > >>
 > >>          (.......... ....)  Space (replaces selected text, including
 > >>     newline)
 > >>
 > >>     The "(Holding Shift) End" step doesn't work anymore half the time.
 > >>     It does this instead:
 > >>
 > >>          (..........
 > >>           |....)
 > >>
 > >>          (|**********       Shift-Up
 > >>     *****....)
 > >>
 > >>          (**********        [Holding Shift] End
 > >>     **********|
 > >>
 > >>     Since Shift-Up/Shift-End/Space doesn't work, I've had to learn
 > >>     Shift-Home/Delete/Delete/__**Space, which works consistently.
 > >>
 > >>
 > >>     Something related, which I think only happens when the editor is in
 > >>     this weird forgetful state: it also forgets the caret position when
 > >>     cursoring down past short lines and back into long ones. IOW, it
 > >>     should act like this when cursoring down:
 > >>
 > >>          ..........|
 > >>          .....
 > >>          ...............
 > >>
 > >>          ..........
 > >>          .....|
 > >>          ...............
 > >>
 > >>          ..........
 > >>          .....
 > >>          ..........|.....
 > >>
 > >>     But it acts like this sometimes:
 > >>
 > >>          ..........|
 > >>          .....
 > >>          ...............
 > >>
 > >>          ..........
 > >>          .....|
 > >>          ...............
 > >>
 > >>          ..........
 > >>          .....
 > >>          .....|..........
 > >>
 > >>     This also makes it difficult to select and delete text, since it
 > >>     sometimes does this when Shift is held.
 > >>
 > >>     Neil ‚ä•
 > >>
 > >>
 > >>
 > >
 
From: Neil Toronto <neil.toronto@gmail.com>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: Matthew Flatt <mflatt@cs.utah.edu>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly
 in response to shift-arrow presses
Date: Tue, 08 Jan 2013 16:39:01 -0700

 If it helps any, after the selection error starts happening, it keeps 
 happening on new editors. IOW, if I start DrRacket fresh and type a few 
 lines, selection works as it should. It keeps working fine if I open a 
 new tab and start typing.
 
 If it ever starts happening, if I open a new tab and type a few lines, 
 cursoring during selection works wrongly there as well.
 
 I can't recall whether it ever fixes itself.
 
 Neil ‚ä•
 
 On 01/08/2013 04:11 PM, Robby Findler wrote:
 > Ah, right. And that would indeed be an easy fix as soon as we can
 > reproduce the bug.
 >
 > Robby
 >
 >
 > On Tue, Jan 8, 2013 at 5:10 PM, Matthew Flatt <mflatt@cs.utah.edu
 > <mailto:mflatt@cs.utah.edu>> wrote:
 >
 >     Yes.
 >
 >     It may be that a `begin-edit-sequence' somewhere needs a #f second
 >     argument, which means "don't interrupt the current streak".
 >
 >     At Tue, 8 Jan 2013 15:54:01 -0600, Robby Findler wrote:
 >      > The move-position method in mred/private/wxme/text.rkt is the
 >     relevant code
 >      > I believe.
 >      >
 >      > This isn't code that I wrote so I could be missing something, but
 >       it sure
 >      > looks like you want to watch the variables extendstartpos
 >     extendendpos
 >      > and extend-streak?.
 >      >
 >      > Matthew may know better; he wrote the code.
 >      >
 >      > Robby
 >      >
 >      >
 >      > On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto
 >     <neil.toronto@gmail.com <mailto:neil.toronto@gmail.com>> wrote:
 >      >
 >      > > Cool. Where do I put the printf?
 >      > >
 >      > >
 >      > > On 01/08/2013 02:27 PM, Robby Findler wrote:
 >      > >
 >      > >> That is the way selection used to work way back before it was
 >     fixed to
 >      > >> work as you wish it to work. I believe there is a bit of state
 >     saying
 >      > >> "this is the original position to grow/shrink from" somewhere
 >     in text%
 >      > >> and it looks like it is getting lost. Maybe the thing to do is
 >     to add a
 >      > >> printf when that state changes and then for you to edit and
 >     keep an eye
 >      > >> on that printf. I bet that'll let you be able to tell us how to
 >      > >> reproduce it and then it'll probably be easy to fix.
 >      > >>
 >      > >> Robby
 >      > >>
 >      > >>
 >      > >> On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto
 >     <neil.toronto@gmail.com <mailto:neil.toronto@gmail.com>
 >      > >> <mailto:neil.toronto@gmail.com
 >     <mailto:neil.toronto@gmail.com>**>> wrote:
 >      > >>
 >      > >>     On 12/03/2012 10:28 PM, neil.toronto@gmail.com
 >     <mailto:neil.toronto@gmail.com>
 >      > >>     <mailto:neil.toronto@gmail.com
 >     <mailto:neil.toronto@gmail.com>**> wrote:
 >      > >>
 >      > >>         A new problem report is waiting at
 >      > >>
 >      >
 >     http://bugs.racket-lang.org/__**query/?cmd=view&pr=13342<http://bugs.racket-lang
 >      > .org/__query/?cmd=view&pr=13342>
 >      > >>
 >      > >>
 >      >
 >     <http://bugs.racket-lang.org/**query/?cmd=view&pr=13342<http://bugs.racket-lang.
 >      > org/query/?cmd=view&pr=13342>
 >      > >> >
 >      > >>
 >      > >>         Reported by Neil Toronto for release:
 >      > >>         5.3.1.9--2012-12-03(f1b47bb4/_**_d)
 >      > >>
 >      > >>
 >      > >>         *** Description:
 >      > >>         I can't provide steps to reproduce.
 >      > >>
 >      > >>         Sometimes the code editor gets into a weird state in
 >     which, with
 >      > >>         the shift key held down to select a block of text, it
 >     only grows
 >      > >>         the selection from the beginning when up/left is
 >     pressed, and
 >      > >>         only grows the selection from the end when down/right is
 >      > >>         pressed. It should always grow or shrink the selection
 >     from the
 >      > >>         last caret location.
 >      > >>
 >      > >>         It seemed to start happening after the changes to auto
 >     parens,
 >      > >>         which I don't use yet.
 >      > >>
 >      > >>
 >      > >>     Is anybody else getting this? My editor is in this state
 >     about half
 >      > >>     the time and it's driving me crazy. If I select more text
 >     than I
 >      > >>     want, I can't select less without starting over.
 >      > >>
 >      > >>     I've had to retrain myself in how to move text to the
 >     previous line.
 >      > >>     I used to be able to do this, where "." represents text, "*"
 >      > >>     represents selected text, and "|" is the caret:
 >      > >>
 >      > >>          (..........
 >      > >>           |....)
 >      > >>
 >      > >>          (|**********       Shift-Up
 >      > >>     *****....)
 >      > >>
 >      > >>          (..........|       [Holding Shift] End
 >      > >>     *****....)
 >      > >>
 >      > >>          (.......... ....)  Space (replaces selected text,
 >     including
 >      > >>     newline)
 >      > >>
 >      > >>     The "(Holding Shift) End" step doesn't work anymore half
 >     the time.
 >      > >>     It does this instead:
 >      > >>
 >      > >>          (..........
 >      > >>           |....)
 >      > >>
 >      > >>          (|**********       Shift-Up
 >      > >>     *****....)
 >      > >>
 >      > >>          (**********        [Holding Shift] End
 >      > >>     **********|
 >      > >>
 >      > >>     Since Shift-Up/Shift-End/Space doesn't work, I've had to learn
 >      > >>     Shift-Home/Delete/Delete/__**Space, which works consistently.
 >      > >>
 >      > >>
 >      > >>     Something related, which I think only happens when the
 >     editor is in
 >      > >>     this weird forgetful state: it also forgets the caret
 >     position when
 >      > >>     cursoring down past short lines and back into long ones.
 >     IOW, it
 >      > >>     should act like this when cursoring down:
 >      > >>
 >      > >>          ..........|
 >      > >>          .....
 >      > >>          ...............
 >      > >>
 >      > >>          ..........
 >      > >>          .....|
 >      > >>          ...............
 >      > >>
 >      > >>          ..........
 >      > >>          .....
 >      > >>          ..........|.....
 >      > >>
 >      > >>     But it acts like this sometimes:
 >      > >>
 >      > >>          ..........|
 >      > >>          .....
 >      > >>          ...............
 >      > >>
 >      > >>          ..........
 >      > >>          .....|
 >      > >>          ...............
 >      > >>
 >      > >>          ..........
 >      > >>          .....
 >      > >>          .....|..........
 >      > >>
 >      > >>     This also makes it difficult to select and delete text,
 >     since it
 >      > >>     sometimes does this when Shift is held.
 >      > >>
 >      > >>     Neil ‚ä•
 >      > >>
 >      > >>
 >      > >>
 >      > >
 >
 >
 
From: Robby Findler <robby@eecs.northwestern.edu>
To: Neil Toronto <neil.toronto@gmail.com>
Cc: Matthew Flatt <mflatt@cs.utah.edu>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Tue, 8 Jan 2013 18:40:50 -0600

 --e89a8ff1c7c66993dc04d2d050a9
 Content-Type: text/plain; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 Wait-- are you saying that when it gets confused and you open a new tab and
 it is confused in the new tab? That would be strange and not at all what we
 were expecting.
 
 Robby
 
 
 On Tue, Jan 8, 2013 at 5:39 PM, Neil Toronto <neil.toronto@gmail.com> wrote=
 :
 
 > If it helps any, after the selection error starts happening, it keeps
 > happening on new editors. IOW, if I start DrRacket fresh and type a few
 > lines, selection works as it should. It keeps working fine if I open a ne=
 w
 > tab and start typing.
 >
 > If it ever starts happening, if I open a new tab and type a few lines,
 > cursoring during selection works wrongly there as well.
 >
 > I can't recall whether it ever fixes itself.
 >
 > Neil =E2=8A=A5
 >
 >
 > On 01/08/2013 04:11 PM, Robby Findler wrote:
 >
 >> Ah, right. And that would indeed be an easy fix as soon as we can
 >> reproduce the bug.
 >>
 >> Robby
 >>
 >>
 >> On Tue, Jan 8, 2013 at 5:10 PM, Matthew Flatt <mflatt@cs.utah.edu
 >> <mailto:mflatt@cs.utah.edu>> wrote:
 >>
 >>     Yes.
 >>
 >>     It may be that a `begin-edit-sequence' somewhere needs a #f second
 >>     argument, which means "don't interrupt the current streak".
 >>
 >>     At Tue, 8 Jan 2013 15:54:01 -0600, Robby Findler wrote:
 >>      > The move-position method in mred/private/wxme/text.rkt is the
 >>     relevant code
 >>      > I believe.
 >>      >
 >>      > This isn't code that I wrote so I could be missing something, but
 >>       it sure
 >>      > looks like you want to watch the variables extendstartpos
 >>     extendendpos
 >>      > and extend-streak?.
 >>      >
 >>      > Matthew may know better; he wrote the code.
 >>      >
 >>      > Robby
 >>      >
 >>      >
 >>      > On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto
 >>     <neil.toronto@gmail.com <mailto:neil.toronto@gmail.com**>> wrote:
 >>      >
 >>      > > Cool. Where do I put the printf?
 >>      > >
 >>      > >
 >>      > > On 01/08/2013 02:27 PM, Robby Findler wrote:
 >>      > >
 >>      > >> That is the way selection used to work way back before it was
 >>     fixed to
 >>      > >> work as you wish it to work. I believe there is a bit of state
 >>     saying
 >>      > >> "this is the original position to grow/shrink from" somewhere
 >>     in text%
 >>      > >> and it looks like it is getting lost. Maybe the thing to do is
 >>     to add a
 >>      > >> printf when that state changes and then for you to edit and
 >>     keep an eye
 >>      > >> on that printf. I bet that'll let you be able to tell us how t=
 o
 >>      > >> reproduce it and then it'll probably be easy to fix.
 >>      > >>
 >>      > >> Robby
 >>      > >>
 >>      > >>
 >>      > >> On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto
 >>     <neil.toronto@gmail.com <mailto:neil.toronto@gmail.com**>
 >>      > >> <mailto:neil.toronto@gmail.com
 >>
 >>     <mailto:neil.toronto@gmail.com**>**>> wrote:
 >>      > >>
 >>      > >>     On 12/03/2012 10:28 PM, neil.toronto@gmail.com
 >>     <mailto:neil.toronto@gmail.com**>
 >>      > >>     <mailto:neil.toronto@gmail.com
 >>
 >>     <mailto:neil.toronto@gmail.com**>**> wrote:
 >>      > >>
 >>      > >>         A new problem report is waiting at
 >>      > >>
 >>      >
 >>     http://bugs.racket-lang.org/__****query/?cmd=3Dview&pr=3D13342<http:=
 //bugs.racket-lang.org/__**query/?cmd=3Dview&pr=3D13342>
 >> <htt**p://bugs.racket-lang <http://bugs.racket-lang>
 >>      > .org/__query/?cmd=3Dview&pr=3D**13342>
 >>      > >>
 >>      > >>
 >>      >
 >>     <http://bugs.racket-lang.org/****query/?cmd=3Dview&pr=3D13342<http:/=
 /bugs.racket-lang.org/**query/?cmd=3Dview&pr=3D13342>
 >> <http**://bugs.racket-lang <http://bugs.racket-lang>.
 >>      > org/query/?cmd=3Dview&pr=3D13342>
 >>      > >> >
 >>      > >>
 >>      > >>         Reported by Neil Toronto for release:
 >>      > >>         5.3.1.9--2012-12-03(f1b47bb4/_****_d)
 >>      > >>
 >>      > >>
 >>      > >>         *** Description:
 >>      > >>         I can't provide steps to reproduce.
 >>      > >>
 >>      > >>         Sometimes the code editor gets into a weird state in
 >>     which, with
 >>      > >>         the shift key held down to select a block of text, it
 >>     only grows
 >>      > >>         the selection from the beginning when up/left is
 >>     pressed, and
 >>      > >>         only grows the selection from the end when down/right =
 is
 >>      > >>         pressed. It should always grow or shrink the selection
 >>     from the
 >>      > >>         last caret location.
 >>      > >>
 >>      > >>         It seemed to start happening after the changes to auto
 >>     parens,
 >>      > >>         which I don't use yet.
 >>      > >>
 >>      > >>
 >>      > >>     Is anybody else getting this? My editor is in this state
 >>     about half
 >>      > >>     the time and it's driving me crazy. If I select more text
 >>     than I
 >>      > >>     want, I can't select less without starting over.
 >>      > >>
 >>      > >>     I've had to retrain myself in how to move text to the
 >>     previous line.
 >>      > >>     I used to be able to do this, where "." represents text, "=
 *"
 >>      > >>     represents selected text, and "|" is the caret:
 >>      > >>
 >>      > >>          (..........
 >>      > >>           |....)
 >>      > >>
 >>      > >>          (|**********       Shift-Up
 >>      > >>     *****....)
 >>      > >>
 >>      > >>          (..........|       [Holding Shift] End
 >>      > >>     *****....)
 >>      > >>
 >>      > >>          (.......... ....)  Space (replaces selected text,
 >>     including
 >>      > >>     newline)
 >>      > >>
 >>      > >>     The "(Holding Shift) End" step doesn't work anymore half
 >>     the time.
 >>      > >>     It does this instead:
 >>      > >>
 >>      > >>          (..........
 >>      > >>           |....)
 >>      > >>
 >>      > >>          (|**********       Shift-Up
 >>      > >>     *****....)
 >>      > >>
 >>      > >>          (**********        [Holding Shift] End
 >>      > >>     **********|
 >>      > >>
 >>      > >>     Since Shift-Up/Shift-End/Space doesn't work, I've had to
 >> learn
 >>      > >>     Shift-Home/Delete/Delete/__****Space, which works
 >> consistently.
 >>      > >>
 >>      > >>
 >>      > >>     Something related, which I think only happens when the
 >>     editor is in
 >>      > >>     this weird forgetful state: it also forgets the caret
 >>     position when
 >>      > >>     cursoring down past short lines and back into long ones.
 >>     IOW, it
 >>      > >>     should act like this when cursoring down:
 >>      > >>
 >>      > >>          ..........|
 >>      > >>          .....
 >>      > >>          ...............
 >>      > >>
 >>      > >>          ..........
 >>      > >>          .....|
 >>      > >>          ...............
 >>      > >>
 >>      > >>          ..........
 >>      > >>          .....
 >>      > >>          ..........|.....
 >>      > >>
 >>      > >>     But it acts like this sometimes:
 >>      > >>
 >>      > >>          ..........|
 >>      > >>          .....
 >>      > >>          ...............
 >>      > >>
 >>      > >>          ..........
 >>      > >>          .....|
 >>      > >>          ...............
 >>      > >>
 >>      > >>          ..........
 >>      > >>          .....
 >>      > >>          .....|..........
 >>      > >>
 >>      > >>     This also makes it difficult to select and delete text,
 >>     since it
 >>      > >>     sometimes does this when Shift is held.
 >>      > >>
 >>      > >>     Neil =E2=8A=A5
 >>      > >>
 >>      > >>
 >>      > >>
 >>      > >
 >>
 >>
 >>
 >
 
 --e89a8ff1c7c66993dc04d2d050a9
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">Wait-- are you saying that when it gets confused and you o=
 pen a new tab and it is confused in the new tab? That would be strange and =
 not at all what we were expecting.<div><br></div><div>Robby</div></div><div=
  class=3D"gmail_extra">
 <br><br><div class=3D"gmail_quote">On Tue, Jan 8, 2013 at 5:39 PM, Neil Tor=
 onto <span dir=3D"ltr">&lt;<a href=3D"mailto:neil.toronto@gmail.com" target=
 =3D"_blank">neil.toronto@gmail.com</a>&gt;</span> wrote:<br><blockquote cla=
 ss=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;pa=
 dding-left:1ex">
 If it helps any, after the selection error starts happening, it keeps happe=
 ning on new editors. IOW, if I start DrRacket fresh and type a few lines, s=
 election works as it should. It keeps working fine if I open a new tab and =
 start typing.<br>
 
 <br>
 If it ever starts happening, if I open a new tab and type a few lines, curs=
 oring during selection works wrongly there as well.<br>
 <br>
 I can&#39;t recall whether it ever fixes itself.<br>
 <br>
 Neil =E2=8A=A5<div class=3D"im"><br>
 <br>
 On 01/08/2013 04:11 PM, Robby Findler wrote:<br>
 </div><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-l=
 eft:1px #ccc solid;padding-left:1ex"><div class=3D"im">
 Ah, right. And that would indeed be an easy fix as soon as we can<br>
 reproduce the bug.<br>
 <br>
 Robby<br>
 <br>
 <br>
 On Tue, Jan 8, 2013 at 5:10 PM, Matthew Flatt &lt;<a href=3D"mailto:mflatt@=
 cs.utah.edu" target=3D"_blank">mflatt@cs.utah.edu</a><br></div><div class=
 =3D"im">
 &lt;mailto:<a href=3D"mailto:mflatt@cs.utah.edu" target=3D"_blank">mflatt@c=
 s.utah.edu</a>&gt;&gt; wrote:<br>
 <br>
 =C2=A0 =C2=A0 Yes.<br>
 <br>
 =C2=A0 =C2=A0 It may be that a `begin-edit-sequence&#39; somewhere needs a =
 #f second<br>
 =C2=A0 =C2=A0 argument, which means &quot;don&#39;t interrupt the current s=
 treak&quot;.<br>
 <br>
 =C2=A0 =C2=A0 At Tue, 8 Jan 2013 15:54:01 -0600, Robby Findler wrote:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; The move-position method in mred/private/wxme/text=
 .rkt is the<br>
 =C2=A0 =C2=A0 relevant code<br>
 =C2=A0 =C2=A0 =C2=A0&gt; I believe.<br>
 =C2=A0 =C2=A0 =C2=A0&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; This isn&#39;t code that I wrote so I could be mis=
 sing something, but<br>
 =C2=A0 =C2=A0 =C2=A0 it sure<br>
 =C2=A0 =C2=A0 =C2=A0&gt; looks like you want to watch the variables extends=
 tartpos<br>
 =C2=A0 =C2=A0 extendendpos<br>
 =C2=A0 =C2=A0 =C2=A0&gt; and extend-streak?.<br>
 =C2=A0 =C2=A0 =C2=A0&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; Matthew may know better; he wrote the code.<br>
 =C2=A0 =C2=A0 =C2=A0&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; Robby<br>
 =C2=A0 =C2=A0 =C2=A0&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto<br></=
 div><div class=3D"im">
 =C2=A0 =C2=A0 &lt;<a href=3D"mailto:neil.toronto@gmail.com" target=3D"_blan=
 k">neil.toronto@gmail.com</a> &lt;mailto:<a href=3D"mailto:neil.toronto@gma=
 il.com" target=3D"_blank">neil.toronto@gmail.com</a><u></u>&gt;&gt; wrote:<=
 br>
 =C2=A0 =C2=A0 =C2=A0&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt; Cool. Where do I put the printf?<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt; On 01/08/2013 02:27 PM, Robby Findler wrote:<=
 br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; That is the way selection used to work wa=
 y back before it was<br>
 =C2=A0 =C2=A0 fixed to<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; work as you wish it to work. I believe th=
 ere is a bit of state<br>
 =C2=A0 =C2=A0 saying<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; &quot;this is the original position to gr=
 ow/shrink from&quot; somewhere<br>
 =C2=A0 =C2=A0 in text%<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; and it looks like it is getting lost. May=
 be the thing to do is<br>
 =C2=A0 =C2=A0 to add a<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; printf when that state changes and then f=
 or you to edit and<br>
 =C2=A0 =C2=A0 keep an eye<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; on that printf. I bet that&#39;ll let you=
  be able to tell us how to<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; reproduce it and then it&#39;ll probably =
 be easy to fix.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; Robby<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; On Tue, Jan 8, 2013 at 2:58 PM, Neil Toro=
 nto<br>
 =C2=A0 =C2=A0 &lt;<a href=3D"mailto:neil.toronto@gmail.com" target=3D"_blan=
 k">neil.toronto@gmail.com</a> &lt;mailto:<a href=3D"mailto:neil.toronto@gma=
 il.com" target=3D"_blank">neil.toronto@gmail.com</a><u></u>&gt;<br></div>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; &lt;mailto:<a href=3D"mailto:neil.toronto=
 @gmail.com" target=3D"_blank">neil.toronto@gmail.com</a><div class=3D"im"><=
 br>
 =C2=A0 =C2=A0 &lt;mailto:<a href=3D"mailto:neil.toronto@gmail.com" target=
 =3D"_blank">neil.toronto@gmail.com</a><u></u>&gt;**&gt;&gt; wrote:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 On 12/03/2012 10:28 PM, <a =
 href=3D"mailto:neil.toronto@gmail.com" target=3D"_blank">neil.toronto@gmail=
 .com</a><br>
 =C2=A0 =C2=A0 &lt;mailto:<a href=3D"mailto:neil.toronto@gmail.com" target=
 =3D"_blank">neil.toronto@gmail.com</a><u></u>&gt;<br></div>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 &lt;mailto:<a href=3D"mailt=
 o:neil.toronto@gmail.com" target=3D"_blank">neil.toronto@gmail.com</a><div>=
 <div class=3D"h5"><br>
 =C2=A0 =C2=A0 &lt;mailto:<a href=3D"mailto:neil.toronto@gmail.com" target=
 =3D"_blank">neil.toronto@gmail.com</a><u></u>&gt;**&gt; wrote:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 A new problem=
  report is waiting at<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt;<br>
 =C2=A0 =C2=A0 <a href=3D"http://bugs.racket-lang.org/__**query/?cmd=3Dview&=
 amp;pr=3D13342" target=3D"_blank">http://bugs.racket-lang.org/__<u></u>**qu=
 ery/?cmd=3Dview&amp;pr=3D13342</a>&lt;<a href=3D"http://bugs.racket-lang" t=
 arget=3D"_blank">htt<u></u>p://bugs.racket-lang</a><br>
 
 =C2=A0 =C2=A0 =C2=A0&gt; .org/__query/?cmd=3Dview&amp;pr=3D<u></u>13342&gt;=
 <br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt;<br>
 =C2=A0 =C2=A0 &lt;<a href=3D"http://bugs.racket-lang.org/**query/?cmd=3Dvie=
 w&amp;pr=3D13342" target=3D"_blank">http://bugs.racket-lang.org/*<u></u>*qu=
 ery/?cmd=3Dview&amp;pr=3D13342</a>&lt;<a href=3D"http://bugs.racket-lang" t=
 arget=3D"_blank">http<u></u>://bugs.racket-lang</a>.<br>
 
 =C2=A0 =C2=A0 =C2=A0&gt; org/query/?cmd=3Dview&amp;pr=3D13342&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; &gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 Reported by N=
 eil Toronto for release:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 5.3.1.9--2012=
 -12-03(f1b47bb4/_<u></u>**_d)<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 *** Descripti=
 on:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 I can&#39;t p=
 rovide steps to reproduce.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 Sometimes the=
  code editor gets into a weird state in<br>
 =C2=A0 =C2=A0 which, with<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 the shift key=
  held down to select a block of text, it<br>
 =C2=A0 =C2=A0 only grows<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 the selection=
  from the beginning when up/left is<br>
 =C2=A0 =C2=A0 pressed, and<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 only grows th=
 e selection from the end when down/right is<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 pressed. It s=
 hould always grow or shrink the selection<br>
 =C2=A0 =C2=A0 from the<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 last caret lo=
 cation.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 It seemed to =
 start happening after the changes to auto<br>
 =C2=A0 =C2=A0 parens,<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 which I don&#=
 39;t use yet.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 Is anybody else getting thi=
 s? My editor is in this state<br>
 =C2=A0 =C2=A0 about half<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 the time and it&#39;s drivi=
 ng me crazy. If I select more text<br>
 =C2=A0 =C2=A0 than I<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 want, I can&#39;t select le=
 ss without starting over.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 I&#39;ve had to retrain mys=
 elf in how to move text to the<br>
 =C2=A0 =C2=A0 previous line.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 I used to be able to do thi=
 s, where &quot;.&quot; represents text, &quot;*&quot;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 represents selected text, a=
 nd &quot;|&quot; is the caret:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(......=
 ....<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 |....)=
 <br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(|*****=
 ***** =C2=A0 =C2=A0 =C2=A0 Shift-Up<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 *****....)<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(......=
 ....| =C2=A0 =C2=A0 =C2=A0 [Holding Shift] End<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 *****....)<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(......=
 .... ....) =C2=A0Space (replaces selected text,<br>
 =C2=A0 =C2=A0 including<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 newline)<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 The &quot;(Holding Shift) E=
 nd&quot; step doesn&#39;t work anymore half<br>
 =C2=A0 =C2=A0 the time.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 It does this instead:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(......=
 ....<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 |....)=
 <br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(|*****=
 ***** =C2=A0 =C2=A0 =C2=A0 Shift-Up<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 *****....)<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(******=
 **** =C2=A0 =C2=A0 =C2=A0 =C2=A0[Holding Shift] End<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 **********|<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 Since Shift-Up/Shift-End/Sp=
 ace doesn&#39;t work, I&#39;ve had to learn<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 Shift-Home/Delete/Delete/__=
 **<u></u>Space, which works consistently.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 Something related, which I =
 think only happens when the<br>
 =C2=A0 =C2=A0 editor is in<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 this weird forgetful state:=
  it also forgets the caret<br>
 =C2=A0 =C2=A0 position when<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 cursoring down past short l=
 ines and back into long ones.<br>
 =C2=A0 =C2=A0 IOW, it<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 should act like this when c=
 ursoring down:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ...|<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<b=
 r>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ........<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ...<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|<=
 br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ........<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ...<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<b=
 r>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ...|.....<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 But it acts like this somet=
 imes:<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ...|<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<b=
 r>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ........<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ...<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|<=
 br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ........<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.......=
 ...<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....<b=
 r>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0.....|.=
 .........<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 This also makes it difficul=
 t to select and delete text,<br>
 =C2=A0 =C2=A0 since it<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 sometimes does this when Sh=
 ift is held.<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt; =C2=A0 =C2=A0 Neil =E2=8A=A5<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;&gt;<br>
 =C2=A0 =C2=A0 =C2=A0&gt; &gt;<br>
 <br>
 <br>
 </div></div></blockquote>
 <br>
 </blockquote></div><br></div>
 
 --e89a8ff1c7c66993dc04d2d050a9--
From: Neil Toronto <neil.toronto@gmail.com>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: Matthew Flatt <mflatt@cs.utah.edu>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly
 in response to shift-arrow presses
Date: Tue, 08 Jan 2013 17:53:48 -0700

 That's what I'm saying. Unfortunately, sounds like. :/
 
 On 01/08/2013 05:40 PM, Robby Findler wrote:
 > Wait-- are you saying that when it gets confused and you open a new tab
 > and it is confused in the new tab? That would be strange and not at all
 > what we were expecting.
 >
 > Robby
 >
 >
 > On Tue, Jan 8, 2013 at 5:39 PM, Neil Toronto <neil.toronto@gmail.com
 > <mailto:neil.toronto@gmail.com>> wrote:
 >
 >     If it helps any, after the selection error starts happening, it
 >     keeps happening on new editors. IOW, if I start DrRacket fresh and
 >     type a few lines, selection works as it should. It keeps working
 >     fine if I open a new tab and start typing.
 >
 >     If it ever starts happening, if I open a new tab and type a few
 >     lines, cursoring during selection works wrongly there as well.
 >
 >     I can't recall whether it ever fixes itself.
 >
 >     Neil ‚ä•
 >
 >
 >     On 01/08/2013 04:11 PM, Robby Findler wrote:
 >
 >         Ah, right. And that would indeed be an easy fix as soon as we can
 >         reproduce the bug.
 >
 >         Robby
 >
 >
 >         On Tue, Jan 8, 2013 at 5:10 PM, Matthew Flatt
 >         <mflatt@cs.utah.edu <mailto:mflatt@cs.utah.edu>
 >         <mailto:mflatt@cs.utah.edu <mailto:mflatt@cs.utah.edu>>> wrote:
 >
 >              Yes.
 >
 >              It may be that a `begin-edit-sequence' somewhere needs a #f
 >         second
 >              argument, which means "don't interrupt the current streak".
 >
 >              At Tue, 8 Jan 2013 15:54:01 -0600, Robby Findler wrote:
 >               > The move-position method in mred/private/wxme/text.rkt
 >         is the
 >              relevant code
 >               > I believe.
 >               >
 >               > This isn't code that I wrote so I could be missing
 >         something, but
 >                it sure
 >               > looks like you want to watch the variables extendstartpos
 >              extendendpos
 >               > and extend-streak?.
 >               >
 >               > Matthew may know better; he wrote the code.
 >               >
 >               > Robby
 >               >
 >               >
 >               > On Tue, Jan 8, 2013 at 3:28 PM, Neil Toronto
 >              <neil.toronto@gmail.com <mailto:neil.toronto@gmail.com>
 >         <mailto:neil.toronto@gmail.com
 >         <mailto:neil.toronto@gmail.com>__>> wrote:
 >               >
 >               > > Cool. Where do I put the printf?
 >               > >
 >               > >
 >               > > On 01/08/2013 02:27 PM, Robby Findler wrote:
 >               > >
 >               > >> That is the way selection used to work way back
 >         before it was
 >              fixed to
 >               > >> work as you wish it to work. I believe there is a bit
 >         of state
 >              saying
 >               > >> "this is the original position to grow/shrink from"
 >         somewhere
 >              in text%
 >               > >> and it looks like it is getting lost. Maybe the thing
 >         to do is
 >              to add a
 >               > >> printf when that state changes and then for you to
 >         edit and
 >              keep an eye
 >               > >> on that printf. I bet that'll let you be able to tell
 >         us how to
 >               > >> reproduce it and then it'll probably be easy to fix.
 >               > >>
 >               > >> Robby
 >               > >>
 >               > >>
 >               > >> On Tue, Jan 8, 2013 at 2:58 PM, Neil Toronto
 >              <neil.toronto@gmail.com <mailto:neil.toronto@gmail.com>
 >         <mailto:neil.toronto@gmail.com <mailto:neil.toronto@gmail.com>__>
 >               > >> <mailto:neil.toronto@gmail.com
 >         <mailto:neil.toronto@gmail.com>
 >
 >              <mailto:neil.toronto@gmail.com
 >         <mailto:neil.toronto@gmail.com>__>**>> wrote:
 >               > >>
 >               > >>     On 12/03/2012 10:28 PM, neil.toronto@gmail.com
 >         <mailto:neil.toronto@gmail.com>
 >              <mailto:neil.toronto@gmail.com
 >         <mailto:neil.toronto@gmail.com>__>
 >               > >>     <mailto:neil.toronto@gmail.com
 >         <mailto:neil.toronto@gmail.com>
 >
 >              <mailto:neil.toronto@gmail.com
 >         <mailto:neil.toronto@gmail.com>__>**> wrote:
 >               > >>
 >               > >>         A new problem report is waiting at
 >               > >>
 >               >
 >         http://bugs.racket-lang.org/____**query/?cmd=view&pr=13342
 >         <http://bugs.racket-lang.org/__**query/?cmd=view&pr=13342><htt__p://bugs.racket-lang
 >         <http://bugs.racket-lang>
 >               > .org/__query/?cmd=view&pr=__13342>
 >               > >>
 >               > >>
 >               >
 >              <http://bugs.racket-lang.org/*__*query/?cmd=view&pr=13342
 >         <http://bugs.racket-lang.org/**query/?cmd=view&pr=13342><http__://bugs.racket-lang
 >         <http://bugs.racket-lang>.
 >               > org/query/?cmd=view&pr=13342>
 >               > >> >
 >               > >>
 >               > >>         Reported by Neil Toronto for release:
 >               > >>         5.3.1.9--2012-12-03(f1b47bb4/___**_d)
 >               > >>
 >               > >>
 >               > >>         *** Description:
 >               > >>         I can't provide steps to reproduce.
 >               > >>
 >               > >>         Sometimes the code editor gets into a weird
 >         state in
 >              which, with
 >               > >>         the shift key held down to select a block of
 >         text, it
 >              only grows
 >               > >>         the selection from the beginning when up/left is
 >              pressed, and
 >               > >>         only grows the selection from the end when
 >         down/right is
 >               > >>         pressed. It should always grow or shrink the
 >         selection
 >              from the
 >               > >>         last caret location.
 >               > >>
 >               > >>         It seemed to start happening after the
 >         changes to auto
 >              parens,
 >               > >>         which I don't use yet.
 >               > >>
 >               > >>
 >               > >>     Is anybody else getting this? My editor is in
 >         this state
 >              about half
 >               > >>     the time and it's driving me crazy. If I select
 >         more text
 >              than I
 >               > >>     want, I can't select less without starting over.
 >               > >>
 >               > >>     I've had to retrain myself in how to move text to the
 >              previous line.
 >               > >>     I used to be able to do this, where "."
 >         represents text, "*"
 >               > >>     represents selected text, and "|" is the caret:
 >               > >>
 >               > >>          (..........
 >               > >>           |....)
 >               > >>
 >               > >>          (|**********       Shift-Up
 >               > >>     *****....)
 >               > >>
 >               > >>          (..........|       [Holding Shift] End
 >               > >>     *****....)
 >               > >>
 >               > >>          (.......... ....)  Space (replaces selected
 >         text,
 >              including
 >               > >>     newline)
 >               > >>
 >               > >>     The "(Holding Shift) End" step doesn't work
 >         anymore half
 >              the time.
 >               > >>     It does this instead:
 >               > >>
 >               > >>          (..........
 >               > >>           |....)
 >               > >>
 >               > >>          (|**********       Shift-Up
 >               > >>     *****....)
 >               > >>
 >               > >>          (**********        [Holding Shift] End
 >               > >>     **********|
 >               > >>
 >               > >>     Since Shift-Up/Shift-End/Space doesn't work, I've
 >         had to learn
 >               > >>     Shift-Home/Delete/Delete/__**__Space, which works
 >         consistently.
 >               > >>
 >               > >>
 >               > >>     Something related, which I think only happens
 >         when the
 >              editor is in
 >               > >>     this weird forgetful state: it also forgets the caret
 >              position when
 >               > >>     cursoring down past short lines and back into
 >         long ones.
 >              IOW, it
 >               > >>     should act like this when cursoring down:
 >               > >>
 >               > >>          ..........|
 >               > >>          .....
 >               > >>          ...............
 >               > >>
 >               > >>          ..........
 >               > >>          .....|
 >               > >>          ...............
 >               > >>
 >               > >>          ..........
 >               > >>          .....
 >               > >>          ..........|.....
 >               > >>
 >               > >>     But it acts like this sometimes:
 >               > >>
 >               > >>          ..........|
 >               > >>          .....
 >               > >>          ...............
 >               > >>
 >               > >>          ..........
 >               > >>          .....|
 >               > >>          ...............
 >               > >>
 >               > >>          ..........
 >               > >>          .....
 >               > >>          .....|..........
 >               > >>
 >               > >>     This also makes it difficult to select and delete
 >         text,
 >              since it
 >               > >>     sometimes does this when Shift is held.
 >               > >>
 >               > >>     Neil ‚ä•
 >               > >>
 >               > >>
 >               > >>
 >               > >
 >
 >
 >
 >
 
From: Robby Findler <robby@eecs.northwestern.edu>
To: Neil Toronto <neil.toronto@gmail.com>
Cc: Matthew Flatt <mflatt@cs.utah.edu>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Wed, 9 Jan 2013 18:26:06 -0600

 --e89a8ff1ce42931b9104d2e43978
 Content-Type: text/plain; charset=UTF-8
 
 On Tuesday, January 8, 2013, Neil Toronto wrote:
 
 > That's what I'm saying. Unfortunately, sounds like. :/
 >
 >>
 Well, I still think this is a worthwhile experiment to try out.
 Unfortunately, the output is a little bit noisy. I tried to make it better,
 but got stuck quickly. Anyways, if you still have the interest, here's a
 diff to try.
 
 Robby
 
 diff --git a/collects/mred/private/wxme/text.rkt
 b/collects/mred/private/wxme/text.rkt
 index 61e8039..b7a6f86 100644
 --- a/collects/mred/private/wxme/text.rkt
 +++ b/collects/mred/private/wxme/text.rkt
 @@ -117,6 +117,28 @@
             after-edit-sequence
             on-display-size)
 
 +  (define-syntax (extend-changed stx)
 +    (syntax-case stx ()
 +      [(_ arg ...)
 +       (with-syntax ([line (syntax-line stx)])
 +         #'(let ([_extendstartpos extendstartpos]
 +                 [_extendendpos extendendpos]
 +                 [_extend-streak? extend-streak?])
 +             (parameterize ([in-extend-changed #t])
 +               arg ...)
 +             (unless (and (equal? _extendstartpos extendstartpos)
 +                          (equal? _extendendpos extendendpos)
 +                          (equal? _extend-streak? extend-streak?))
 +               (printf "~a:~a change ~s => ~s\n"
 +                       (eq-hash-code this)
 +                       line
 +                       (list _extendstartpos
 +                             _extendendpos
 +                             _extend-streak?)
 +                       (list extendstartpos
 +                             extendendpos
 +                             extend-streak?)))))]))
 +
    (define read-locked? #t)
    (define flow-locked? #t)
    (define write-locked? #t)
 @@ -995,7 +1017,8 @@
    ;; ----------------------------------------
 
    (def/public (extend-position [exact-nonnegative-integer? dest])
 -    (cond
 +    (extend-changed
 +     (cond
        [extend-streak?
         (values extendstartpos extendendpos)]
        [anchor-streak?
 @@ -1004,7 +1027,7 @@
        [else
         (set! extend-streak? #t)
         (set! extendstartpos startpos)
 -       (set! extendendpos endpos)])
 +       (set! extendendpos endpos)]))
 
      (define-values (start end bias)
        (cond
 @@ -1257,19 +1280,21 @@
                    (set! vcursor-streak? #t)))])
 
              (set! keep-anchor-streak? kas?)
 -            (when extend?
 +            (extend-changed
 +             (when extend?
                (set! extend-streak? #t))
 
              (when (or extend-streak? anchor-streak?)
                (set! extendendpos extendend)
 -              (set! extendstartpos extendstart)))))))
 +              (set! extendstartpos extendstart))))))))
 
    (def/public (set-anchor [any? on?])
      (let ([wason? anchor-streak?])
        (set! anchor-streak? (and on? #t))
        (when (and on? (not wason?))
 -        (set! extendendpos endpos)
 -        (set! extendstartpos startpos))))
 +        (extend-changed
 +         (set! extendendpos endpos)
 +        (set! extendstartpos startpos)))))
 
    (def/public (get-extend-start-position) (if (or extend-streak?
 anchor-streak?) extendstartpos startpos))
    (def/public (get-extend-end-position) (if (or extend-streak?
 anchor-streak?) extendendpos endpos))
 @@ -4561,7 +4586,7 @@
      (set! deletion-streak? #f)
      (when (not (memq 'cursor exceptions))
        (set! vcursor-streak? #f)
 -      (set! extend-streak? #f))
 +      (extend-changed (set! extend-streak? #f)))
 
      (when (and anchor-streak? (not keep-anchor-streak?))
        (set-anchor #f))
 @@ -4594,7 +4619,7 @@
        (set! vcursor-streak? save-vcursor-streak?)
        (set! kill-streak? save-kill-streak?)
        (set! anchor-streak? save-anchor-streak?)
 -      (set! extend-streak? save-extend-streak?)
 +      (extend-changed (set! extend-streak? save-extend-streak?))
        (set! prev-paste-start save-prev-paste-start)
        (set! prev-paste-end save-prev-paste-end)))
 
 --e89a8ff1ce42931b9104d2e43978
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 On Tuesday, January 8, 2013, Neil Toronto  wrote:<br><blockquote class=3D"g=
 mail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-l=
 eft:1ex">That&#39;s what I&#39;m saying. Unfortunately, sounds like. :/<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex"></blockquote></blockquote><div>=C2=A0</div><=
 div>Well, I still think this is a worthwhile experiment to try out. Unfortu=
 nately, the output is a little bit noisy. I tried to make it better, but go=
 t stuck quickly. Anyways, if you still have the interest, here&#39;s a diff=
  to try.</div>
 <div><br></div><div>Robby</div><div><br></div><div><div>diff --git a/collec=
 ts/mred/private/wxme/text.rkt b/collects/mred/private/wxme/text.rkt</div><d=
 iv>index 61e8039..b7a6f86 100644</div><div>--- a/collects/mred/private/wxme=
 /text.rkt</div>
 <div>+++ b/collects/mred/private/wxme/text.rkt</div><div>@@ -117,6 +117,28 =
 @@</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 after-edit-sequence<=
 /div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 on-display-size)</div><=
 div>=C2=A0 =C2=A0</div><div>+ =C2=A0(define-syntax (extend-changed stx)</di=
 v>
 <div>+ =C2=A0 =C2=A0(syntax-case stx ()</div><div>+ =C2=A0 =C2=A0 =C2=A0[(_=
  arg ...)=C2=A0</div><div>+ =C2=A0 =C2=A0 =C2=A0 (with-syntax ([line (synta=
 x-line stx)])</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 #&#39;(let ([_extends=
 tartpos extendstartpos]</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 [_extendendpos extendendpos]</div>
 <div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 [_extend-str=
 eak? extend-streak?])</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
  (parameterize ([in-extend-changed #t])</div><div>+ =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 arg ...)</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 (unless (and (equal? _extendstartpos extendstartpos)</div=
 >
 <div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0(equal? _extendendpos extendendpos)</div><div>+ =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0(equal? _extend-streak? extend-streak?))</div><div>+ =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (printf &quot;~a:~a change ~s =3D=
 &gt; ~s\n&quot;</div>
 <div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 (eq-hash-code this)</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 line</div><div>+ =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (list _e=
 xtendstartpos=C2=A0</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 _extendendpos=C2=A0=
 </div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
  =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 _extend-streak?)</div>
 <div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 (list extendstartpos=C2=A0</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 e=
 xtendendpos=C2=A0</div><div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 extend-streak?)))))]))=
 </div><div>+ =C2=A0</div><div>=C2=A0 =C2=A0(define read-locked? #t)</div>
 <div>=C2=A0 =C2=A0(define flow-locked? #t)</div><div>=C2=A0 =C2=A0(define w=
 rite-locked? #t)</div><div>@@ -995,7 +1017,8 @@</div><div>=C2=A0 =C2=A0;; -=
 ---------------------------------------</div><div>=C2=A0</div><div>=C2=A0 =
 =C2=A0(def/public (extend-position [exact-nonnegative-integer? dest])</div>
 <div>- =C2=A0 =C2=A0(cond</div><div>+ =C2=A0 =C2=A0(extend-changed</div><di=
 v>+ =C2=A0 =C2=A0 (cond</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0[extend-streak=
 ?</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 (values extendstartpos extendendpos=
 )]</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0[anchor-streak?</div><div>@@ -1004,=
 7 +1027,7 @@</div>
 <div>=C2=A0 =C2=A0 =C2=A0 =C2=A0[else</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0=
  (set! extend-streak? #t)</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! exten=
 dstartpos startpos)</div><div>- =C2=A0 =C2=A0 =C2=A0 (set! extendendpos end=
 pos)])</div><div>+ =C2=A0 =C2=A0 =C2=A0 (set! extendendpos endpos)]))</div>=
 <div>=C2=A0</div>
 <div>=C2=A0 =C2=A0 =C2=A0(define-values (start end bias)</div><div>=C2=A0 =
 =C2=A0 =C2=A0 =C2=A0(cond</div><div>@@ -1257,19 +1280,21 @@</div><div>=C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! vcu=
 rsor-streak? #t)))])</div><div>=C2=A0</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0=
  =C2=A0 =C2=A0 =C2=A0(set! keep-anchor-streak? kas?)</div>
 <div>- =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(when extend?</div><div>+ =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(extend-changed</div><div>+ =C2=A0=
  =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (when extend?</div><div>=C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extend-streak? #t))</div><di=
 v>=C2=A0</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(when (o=
 r extend-streak? anchor-streak?)</div>
 <div>=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extendend=
 pos extendend)</div><div>- =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 (set! extendstartpos extendstart)))))))</div><div>+ =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extendstartpos extendstart))))))))</div><d=
 iv>=C2=A0</div><div>=C2=A0 =C2=A0(def/public (set-anchor [any? on?])</div>
 <div>=C2=A0 =C2=A0 =C2=A0(let ([wason? anchor-streak?])</div><div>=C2=A0 =
 =C2=A0 =C2=A0 =C2=A0(set! anchor-streak? (and on? #t))</div><div>=C2=A0 =C2=
 =A0 =C2=A0 =C2=A0(when (and on? (not wason?))</div><div>- =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0(set! extendendpos endpos)</div><div>- =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0(set! extendstartpos startpos))))</div>
 <div>+ =C2=A0 =C2=A0 =C2=A0 =C2=A0(extend-changed</div><div>+ =C2=A0 =C2=A0=
  =C2=A0 =C2=A0 (set! extendendpos endpos)</div><div>+ =C2=A0 =C2=A0 =C2=A0 =
 =C2=A0(set! extendstartpos startpos)))))</div><div>=C2=A0</div><div>=C2=A0 =
 =C2=A0(def/public (get-extend-start-position) (if (or extend-streak? anchor=
 -streak?) extendstartpos startpos))</div>
 <div>=C2=A0 =C2=A0(def/public (get-extend-end-position) (if (or extend-stre=
 ak? anchor-streak?) extendendpos endpos))</div><div>@@ -4561,7 +4586,7 @@</=
 div><div>=C2=A0 =C2=A0 =C2=A0(set! deletion-streak? #f)</div><div>=C2=A0 =
 =C2=A0 =C2=A0(when (not (memq &#39;cursor exceptions))</div>
 <div>=C2=A0 =C2=A0 =C2=A0 =C2=A0(set! vcursor-streak? #f)</div><div>- =C2=
 =A0 =C2=A0 =C2=A0(set! extend-streak? #f))</div><div>+ =C2=A0 =C2=A0 =C2=A0=
 (extend-changed (set! extend-streak? #f)))</div><div>=C2=A0 =C2=A0 =C2=A0</=
 div><div>=C2=A0 =C2=A0 =C2=A0(when (and anchor-streak? (not keep-anchor-str=
 eak?))</div>
 <div>=C2=A0 =C2=A0 =C2=A0 =C2=A0(set-anchor #f))</div><div>@@ -4594,7 +4619=
 ,7 @@</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0(set! vcursor-streak? save-vcurs=
 or-streak?)</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0(set! kill-streak? save-ki=
 ll-streak?)</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0(set! anchor-streak? save-=
 anchor-streak?)</div>
 <div>- =C2=A0 =C2=A0 =C2=A0(set! extend-streak? save-extend-streak?)</div><=
 div>+ =C2=A0 =C2=A0 =C2=A0(extend-changed (set! extend-streak? save-extend-=
 streak?))</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0(set! prev-paste-start save-=
 prev-paste-start)</div><div>=C2=A0 =C2=A0 =C2=A0 =C2=A0(set! prev-paste-end=
  save-prev-paste-end)))</div>
 <div>=C2=A0</div></div>
 
 --e89a8ff1ce42931b9104d2e43978--
From: Neil Toronto <neil.toronto@gmail.com>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: Matthew Flatt <mflatt@cs.utah.edu>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly
 in response to shift-arrow presses
Date: Thu, 17 Jan 2013 14:29:25 -0700

 I haven't had time to try the patch yet, but I have more information. 
 When the editor is in this weird state,
 
   * Undo undoes *single letters* instead of spans.
 
   * After Shift-Up or Shift-Down, Ctrl-Home never moves the caret.
 
 Also, I've had instances now where the editor somehow gets out of this 
 weird state.
 
 Neil ‚ä•
 
 On 01/09/2013 05:26 PM, Robby Findler wrote:
 > On Tuesday, January 8, 2013, Neil Toronto wrote:
 >
 >     That's what I'm saying. Unfortunately, sounds like. :/
 >
 > Well, I still think this is a worthwhile experiment to try out.
 > Unfortunately, the output is a little bit noisy. I tried to make it
 > better, but got stuck quickly. Anyways, if you still have the interest,
 > here's a diff to try.
 >
 > Robby
 >
 > diff --git a/collects/mred/private/wxme/text.rkt
 > b/collects/mred/private/wxme/text.rkt
 > index 61e8039..b7a6f86 100644
 > --- a/collects/mred/private/wxme/text.rkt
 > +++ b/collects/mred/private/wxme/text.rkt
 > @@ -117,6 +117,28 @@
 >              after-edit-sequence
 >              on-display-size)
 > +  (define-syntax (extend-changed stx)
 > +    (syntax-case stx ()
 > +      [(_ arg ...)
 > +       (with-syntax ([line (syntax-line stx)])
 > +         #'(let ([_extendstartpos extendstartpos]
 > +                 [_extendendpos extendendpos]
 > +                 [_extend-streak? extend-streak?])
 > +             (parameterize ([in-extend-changed #t])
 > +               arg ...)
 > +             (unless (and (equal? _extendstartpos extendstartpos)
 > +                          (equal? _extendendpos extendendpos)
 > +                          (equal? _extend-streak? extend-streak?))
 > +               (printf "~a:~a change ~s => ~s\n"
 > +                       (eq-hash-code this)
 > +                       line
 > +                       (list _extendstartpos
 > +                             _extendendpos
 > +                             _extend-streak?)
 > +                       (list extendstartpos
 > +                             extendendpos
 > +                             extend-streak?)))))]))
 > +
 >     (define read-locked? #t)
 >     (define flow-locked? #t)
 >     (define write-locked? #t)
 > @@ -995,7 +1017,8 @@
 >     ;; ----------------------------------------
 >     (def/public (extend-position [exact-nonnegative-integer? dest])
 > -    (cond
 > +    (extend-changed
 > +     (cond
 >         [extend-streak?
 >          (values extendstartpos extendendpos)]
 >         [anchor-streak?
 > @@ -1004,7 +1027,7 @@
 >         [else
 >          (set! extend-streak? #t)
 >          (set! extendstartpos startpos)
 > -       (set! extendendpos endpos)])
 > +       (set! extendendpos endpos)]))
 >       (define-values (start end bias)
 >         (cond
 > @@ -1257,19 +1280,21 @@
 >                     (set! vcursor-streak? #t)))])
 >               (set! keep-anchor-streak? kas?)
 > -            (when extend?
 > +            (extend-changed
 > +             (when extend?
 >                 (set! extend-streak? #t))
 >               (when (or extend-streak? anchor-streak?)
 >                 (set! extendendpos extendend)
 > -              (set! extendstartpos extendstart)))))))
 > +              (set! extendstartpos extendstart))))))))
 >     (def/public (set-anchor [any? on?])
 >       (let ([wason? anchor-streak?])
 >         (set! anchor-streak? (and on? #t))
 >         (when (and on? (not wason?))
 > -        (set! extendendpos endpos)
 > -        (set! extendstartpos startpos))))
 > +        (extend-changed
 > +         (set! extendendpos endpos)
 > +        (set! extendstartpos startpos)))))
 >     (def/public (get-extend-start-position) (if (or extend-streak?
 > anchor-streak?) extendstartpos startpos))
 >     (def/public (get-extend-end-position) (if (or extend-streak?
 > anchor-streak?) extendendpos endpos))
 > @@ -4561,7 +4586,7 @@
 >       (set! deletion-streak? #f)
 >       (when (not (memq 'cursor exceptions))
 >         (set! vcursor-streak? #f)
 > -      (set! extend-streak? #f))
 > +      (extend-changed (set! extend-streak? #f)))
 >       (when (and anchor-streak? (not keep-anchor-streak?))
 >         (set-anchor #f))
 > @@ -4594,7 +4619,7 @@
 >         (set! vcursor-streak? save-vcursor-streak?)
 >         (set! kill-streak? save-kill-streak?)
 >         (set! anchor-streak? save-anchor-streak?)
 > -      (set! extend-streak? save-extend-streak?)
 > +      (extend-changed (set! extend-streak? save-extend-streak?))
 >         (set! prev-paste-start save-prev-paste-start)
 >         (set! prev-paste-end save-prev-paste-end)))
 
From: Robby Findler <robby@eecs.northwestern.edu>
To: Neil Toronto <neil.toronto@gmail.com>
Cc: Matthew Flatt <mflatt@cs.utah.edu>, bugs <bugs@racket-lang.org>,
        nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13342: Selection box sometimes grows wrongly in
 response to shift-arrow presses
Date: Thu, 17 Jan 2013 16:02:03 -0600

 --e89a8fb1f2aa213f2904d38325d2
 Content-Type: text/plain; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 That could be that begin-edit-sequence's state is getting confused. We'd
 want a different set of printouts for that (I don't know what they are
 offhand).
 
 Robby
 
 
 On Thu, Jan 17, 2013 at 3:29 PM, Neil Toronto <neil.toronto@gmail.com>wrote=
 :
 
 > I haven't had time to try the patch yet, but I have more information. Whe=
 n
 > the editor is in this weird state,
 >
 >  * Undo undoes *single letters* instead of spans.
 >
 >  * After Shift-Up or Shift-Down, Ctrl-Home never moves the caret.
 >
 > Also, I've had instances now where the editor somehow gets out of this
 > weird state.
 >
 > Neil =E2=8A=A5
 >
 >
 > On 01/09/2013 05:26 PM, Robby Findler wrote:
 >
 >> On Tuesday, January 8, 2013, Neil Toronto wrote:
 >>
 >>     That's what I'm saying. Unfortunately, sounds like. :/
 >>
 >> Well, I still think this is a worthwhile experiment to try out.
 >> Unfortunately, the output is a little bit noisy. I tried to make it
 >> better, but got stuck quickly. Anyways, if you still have the interest,
 >> here's a diff to try.
 >>
 >> Robby
 >>
 >> diff --git a/collects/mred/private/wxme/**text.rkt
 >> b/collects/mred/private/wxme/**text.rkt
 >> index 61e8039..b7a6f86 100644
 >> --- a/collects/mred/private/wxme/**text.rkt
 >> +++ b/collects/mred/private/wxme/**text.rkt
 >> @@ -117,6 +117,28 @@
 >>              after-edit-sequence
 >>              on-display-size)
 >> +  (define-syntax (extend-changed stx)
 >> +    (syntax-case stx ()
 >> +      [(_ arg ...)
 >> +       (with-syntax ([line (syntax-line stx)])
 >> +         #'(let ([_extendstartpos extendstartpos]
 >> +                 [_extendendpos extendendpos]
 >> +                 [_extend-streak? extend-streak?])
 >> +             (parameterize ([in-extend-changed #t])
 >> +               arg ...)
 >> +             (unless (and (equal? _extendstartpos extendstartpos)
 >> +                          (equal? _extendendpos extendendpos)
 >> +                          (equal? _extend-streak? extend-streak?))
 >> +               (printf "~a:~a change ~s =3D> ~s\n"
 >> +                       (eq-hash-code this)
 >> +                       line
 >> +                       (list _extendstartpos
 >> +                             _extendendpos
 >> +                             _extend-streak?)
 >> +                       (list extendstartpos
 >> +                             extendendpos
 >> +                             extend-streak?)))))]))
 >> +
 >>     (define read-locked? #t)
 >>     (define flow-locked? #t)
 >>     (define write-locked? #t)
 >> @@ -995,7 +1017,8 @@
 >>     ;; ------------------------------**----------
 >>     (def/public (extend-position [exact-nonnegative-integer? dest])
 >> -    (cond
 >> +    (extend-changed
 >> +     (cond
 >>         [extend-streak?
 >>          (values extendstartpos extendendpos)]
 >>         [anchor-streak?
 >> @@ -1004,7 +1027,7 @@
 >>         [else
 >>          (set! extend-streak? #t)
 >>          (set! extendstartpos startpos)
 >> -       (set! extendendpos endpos)])
 >> +       (set! extendendpos endpos)]))
 >>       (define-values (start end bias)
 >>         (cond
 >> @@ -1257,19 +1280,21 @@
 >>                     (set! vcursor-streak? #t)))])
 >>               (set! keep-anchor-streak? kas?)
 >> -            (when extend?
 >> +            (extend-changed
 >> +             (when extend?
 >>                 (set! extend-streak? #t))
 >>               (when (or extend-streak? anchor-streak?)
 >>                 (set! extendendpos extendend)
 >> -              (set! extendstartpos extendstart)))))))
 >> +              (set! extendstartpos extendstart))))))))
 >>     (def/public (set-anchor [any? on?])
 >>       (let ([wason? anchor-streak?])
 >>         (set! anchor-streak? (and on? #t))
 >>         (when (and on? (not wason?))
 >> -        (set! extendendpos endpos)
 >> -        (set! extendstartpos startpos))))
 >> +        (extend-changed
 >> +         (set! extendendpos endpos)
 >> +        (set! extendstartpos startpos)))))
 >>     (def/public (get-extend-start-position) (if (or extend-streak?
 >> anchor-streak?) extendstartpos startpos))
 >>     (def/public (get-extend-end-position) (if (or extend-streak?
 >> anchor-streak?) extendendpos endpos))
 >> @@ -4561,7 +4586,7 @@
 >>       (set! deletion-streak? #f)
 >>       (when (not (memq 'cursor exceptions))
 >>         (set! vcursor-streak? #f)
 >> -      (set! extend-streak? #f))
 >> +      (extend-changed (set! extend-streak? #f)))
 >>       (when (and anchor-streak? (not keep-anchor-streak?))
 >>         (set-anchor #f))
 >> @@ -4594,7 +4619,7 @@
 >>         (set! vcursor-streak? save-vcursor-streak?)
 >>         (set! kill-streak? save-kill-streak?)
 >>         (set! anchor-streak? save-anchor-streak?)
 >> -      (set! extend-streak? save-extend-streak?)
 >> +      (extend-changed (set! extend-streak? save-extend-streak?))
 >>         (set! prev-paste-start save-prev-paste-start)
 >>         (set! prev-paste-end save-prev-paste-end)))
 >>
 >
 >
 
 --e89a8fb1f2aa213f2904d38325d2
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">That could be that begin-edit-sequence&#39;s state is gett=
 ing confused. We&#39;d want a different set of printouts for that (I don&#3=
 9;t know what they are offhand).<div><br></div><div>Robby</div></div><div c=
 lass=3D"gmail_extra">
 <br><br><div class=3D"gmail_quote">On Thu, Jan 17, 2013 at 3:29 PM, Neil To=
 ronto <span dir=3D"ltr">&lt;<a href=3D"mailto:neil.toronto@gmail.com" targe=
 t=3D"_blank">neil.toronto@gmail.com</a>&gt;</span> wrote:<br><blockquote cl=
 ass=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;p=
 adding-left:1ex">
 I haven&#39;t had time to try the patch yet, but I have more information. W=
 hen the editor is in this weird state,<br>
 <br>
 =C2=A0* Undo undoes *single letters* instead of spans.<br>
 <br>
 =C2=A0* After Shift-Up or Shift-Down, Ctrl-Home never moves the caret.<br>
 <br>
 Also, I&#39;ve had instances now where the editor somehow gets out of this =
 weird state.<span class=3D"HOEnZb"><font color=3D"#888888"><br>
 <br>
 Neil =E2=8A=A5</font></span><div class=3D"HOEnZb"><div class=3D"h5"><br>
 <br>
 On 01/09/2013 05:26 PM, Robby Findler wrote:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex">
 On Tuesday, January 8, 2013, Neil Toronto wrote:<br>
 <br>
 =C2=A0 =C2=A0 That&#39;s what I&#39;m saying. Unfortunately, sounds like. :=
 /<br>
 <br>
 Well, I still think this is a worthwhile experiment to try out.<br>
 Unfortunately, the output is a little bit noisy. I tried to make it<br>
 better, but got stuck quickly. Anyways, if you still have the interest,<br>
 here&#39;s a diff to try.<br>
 <br>
 Robby<br>
 <br>
 diff --git a/collects/mred/private/wxme/<u></u>text.rkt<br>
 b/collects/mred/private/wxme/<u></u>text.rkt<br>
 index 61e8039..b7a6f86 100644<br>
 --- a/collects/mred/private/wxme/<u></u>text.rkt<br>
 +++ b/collects/mred/private/wxme/<u></u>text.rkt<br>
 @@ -117,6 +117,28 @@<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0after-edit-sequence<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0on-display-size)<br>
 + =C2=A0(define-syntax (extend-changed stx)<br>
 + =C2=A0 =C2=A0(syntax-case stx ()<br>
 + =C2=A0 =C2=A0 =C2=A0[(_ arg ...)<br>
 + =C2=A0 =C2=A0 =C2=A0 (with-syntax ([line (syntax-line stx)])<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 #&#39;(let ([_extendstartpos extendstartpos]<=
 br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 [_extendendpos ex=
 tendendpos]<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 [_extend-streak? =
 extend-streak?])<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (parameterize ([in-extend-chang=
 ed #t])<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 arg ...)<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (unless (and (equal? _extendsta=
 rtpos extendstartpos)<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0(equal? _extendendpos extendendpos)<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0(equal? _extend-streak? extend-streak?))<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (printf &quot;~a:~a chan=
 ge ~s =3D&gt; ~s\n&quot;<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 (eq-hash-code this)<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 line<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 (list _extendstartpos<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 _extendendpos<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 _extend-streak?)<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 (list extendstartpos<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 extendendpos<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
 =A0 =C2=A0 =C2=A0 =C2=A0 extend-streak?)))))]))<br>
 +<br>
 =C2=A0 =C2=A0 (define read-locked? #t)<br>
 =C2=A0 =C2=A0 (define flow-locked? #t)<br>
 =C2=A0 =C2=A0 (define write-locked? #t)<br>
 @@ -995,7 +1017,8 @@<br>
 =C2=A0 =C2=A0 ;; ------------------------------<u></u>----------<br>
 =C2=A0 =C2=A0 (def/public (extend-position [exact-nonnegative-integer? dest=
 ])<br>
 - =C2=A0 =C2=A0(cond<br>
 + =C2=A0 =C2=A0(extend-changed<br>
 + =C2=A0 =C2=A0 (cond<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 [extend-streak?<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(values extendstartpos extendendpos)]<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 [anchor-streak?<br>
 @@ -1004,7 +1027,7 @@<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 [else<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extend-streak? #t)<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extendstartpos startpos)<br>
 - =C2=A0 =C2=A0 =C2=A0 (set! extendendpos endpos)])<br>
 + =C2=A0 =C2=A0 =C2=A0 (set! extendendpos endpos)]))<br>
 =C2=A0 =C2=A0 =C2=A0 (define-values (start end bias)<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (cond<br>
 @@ -1257,19 +1280,21 @@<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set!=
  vcursor-streak? #t)))])<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! keep-anchor-streak? =
 kas?)<br>
 - =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(when extend?<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(extend-changed<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (when extend?<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! extend-streak=
 ? #t))<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (when (or extend-streak? a=
 nchor-streak?)<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! extendendpos =
 extendend)<br>
 - =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extendstartpos exte=
 ndstart)))))))<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extendstartpos exte=
 ndstart))))))))<br>
 =C2=A0 =C2=A0 (def/public (set-anchor [any? on?])<br>
 =C2=A0 =C2=A0 =C2=A0 (let ([wason? anchor-streak?])<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! anchor-streak? (and on? #t))<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (when (and on? (not wason?))<br>
 - =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extendendpos endpos)<br>
 - =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extendstartpos startpos))))<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0(extend-changed<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! extendendpos endpos)<br>
 + =C2=A0 =C2=A0 =C2=A0 =C2=A0(set! extendstartpos startpos)))))<br>
 =C2=A0 =C2=A0 (def/public (get-extend-start-position) (if (or extend-streak=
 ?<br>
 anchor-streak?) extendstartpos startpos))<br>
 =C2=A0 =C2=A0 (def/public (get-extend-end-position) (if (or extend-streak?<=
 br>
 anchor-streak?) extendendpos endpos))<br>
 @@ -4561,7 +4586,7 @@<br>
 =C2=A0 =C2=A0 =C2=A0 (set! deletion-streak? #f)<br>
 =C2=A0 =C2=A0 =C2=A0 (when (not (memq &#39;cursor exceptions))<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! vcursor-streak? #f)<br>
 - =C2=A0 =C2=A0 =C2=A0(set! extend-streak? #f))<br>
 + =C2=A0 =C2=A0 =C2=A0(extend-changed (set! extend-streak? #f)))<br>
 =C2=A0 =C2=A0 =C2=A0 (when (and anchor-streak? (not keep-anchor-streak?))<b=
 r>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set-anchor #f))<br>
 @@ -4594,7 +4619,7 @@<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! vcursor-streak? save-vcursor-streak?)<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! kill-streak? save-kill-streak?)<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! anchor-streak? save-anchor-streak?)<br>
 - =C2=A0 =C2=A0 =C2=A0(set! extend-streak? save-extend-streak?)<br>
 + =C2=A0 =C2=A0 =C2=A0(extend-changed (set! extend-streak? save-extend-stre=
 ak?))<br>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! prev-paste-start save-prev-paste-start)<b=
 r>
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 (set! prev-paste-end save-prev-paste-end)))<br>
 </blockquote>
 <br>
 </div></div></blockquote></div><br></div>
 
 --e89a8fb1f2aa213f2904d38325d2--
