From bugs+caf_=bugs=bugs.plt-scheme.org@plt-scheme.org Thu Jun 13 10:04:50 2013
Received: from mail-oa0-f54.google.com (mail-oa0-f54.google.com [209.85.219.54])
	by champlain.ccs.neu.edu (8.14.4/8.14.4) with ESMTP id r5DE4kAD010069
	for <bugs@bugs.plt-scheme.org>; Thu, 13 Jun 2013 10:04:47 -0400
Message-Id: <201306131404.r5DE4iGM010063@champlain.ccs.neu.edu>
Date: Thu, 13 Jun 2013 10:04:44 -0400
From: stephanh42@gmail.com
To: bugs@racket-lang.org
Subject: rounded-rectangle pict misses pixels to the right and bottom

>Number:         13850
>Category:       misc
>Synopsis:       rounded-rectangle pict misses pixels to the right and bottom
>Class:          sw-bug
>Responsible:    robby
>Severity:       non-critical
>Priority:       medium
>State:          open
>Confidential:   no
>Arrival-Date:   Thu Jun 13 10:08:01 -0400 2013
>Last-Modified:  Tue Oct 22 19:54:47 -0400 2013
>Originator:     Stephan Houben
>Organization:
plt
>Submitter-Id:   unknown
>Release:        5.3.4.12--2013-06-13(165b5e8a/d)
>Environment:
unix "Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed May 29 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux" (i386-linux/3m) (get-display-depth) = 32
Human Language: english
(current-memory-use) 229211200
Links: (links) = (); (links #:user? #f) = (); (links #:root? #t) = (); (links #:user? #f #:root? #t) = ()
raco pkg (show):
Installation-wide:
 [none]
User-specific, all-version:
 [none]
User-specific, version-specific (5.3.4.12):
 [none]



Collections:
("/home/stephanh/.racket/5.3.4.12/collects"
 (non-existent-path))
("/home/stephanh/racket/collects"
 ("gui-debugger" "repo-time-stamp" "net" "trace" "at-exp" "deinprogramm" "setup" "compiler" "json" "realm" "racket" "errortrace" "compatibility" "pkg" "browser" "texpict" "swindle" "embedded-gui" "scribble" "test-engine" "mred" "macro-debugger" "dynext" "future-visualizer" "pict" "meta" "r5rs" "images" "unstable" "raco" "syntax" "db" "r6rs" "scriblib" "mzlib" "mrlib" "xrepl" "tests" "defaults" "parser-tools" "redex" "games" "string-constants" "htdp" "2htdp" "reader" "help" "racklog" "html" "hierlist" "teachpack" "datalog" "mzcom" "lang" "syntax-color" "typed-racket" "drracket" "scheme" "rnrs" "wxme" "scribblings" "launcher" "data" "profile" "mzscheme" "make" "stepper" "algol60" "s-exp" "mysterx" "sgl" ".gitignore" "readline" "slatex" "slideshow" "picturing-programs" "math" "typed" "version" "planet" "eopl" "lazy" "plai" "drscheme" "contract-profile" "info-domain" "openssl" "frtime" "schemeunit" "icons" "config" "honu" "web-server" "graphics" "file" "xml" "framework" "srfi" "!
 plot" "rackunit" "preprocessor" "typed-scheme" "ffi"))

Computer Language: (("Determine language from source") (#(#t print mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main) (test)) #t))
>Description:
The rounded-rectangle pict misses pixels to the right and bottom.

Computation of bounding box doesn't take line width into account?
>How-To-Repeat:
;; in DrRacket definition window
#lang racket

(require pict)

(define r (rounded-rectangle 64 64))

;; in interaction window
r
>Fix:
>Audit-Trail:
From: Robby Findler <robby@eecs.northwestern.edu>
To: stephanh42@gmail.com, bugs <bugs@racket-lang.org>
Cc: nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13850: rounded-rectangle pict misses pixels to
 the right and bottom
Date: Thu, 13 Jun 2013 09:25:58 -0500

 --089e010d9898b5103404df09e888
 Content-Type: text/plain; charset=UTF-8
 
 Probably the issue is that the line draws outside the bounding box but
 DrRacket clips to the bounding box when drawing (technically, drracket
 clips one pixel to the right and below the bounding box for this kind of
 issue).
 
 I'm not sure that this is a bug but if you want to suggest a change to the
 code that implements rounded-rectangle (collects/texpict/utils.rkt around
 line 305), maybe there is something wrong there. A quick glance doesn't
 suggest anything, but I didn't scrutinize the docs on dc-path% and I see
 that rectangle draws directly.
 
 Robby
 
 
 On Thu, Jun 13, 2013 at 9:08 AM, <stephanh42@gmail.com> wrote:
 
 > A new problem report is waiting at
 >   http://bugs.racket-lang.org/query/?cmd=view&pr=13850
 >
 > Reported by Stephan Houben for release: 5.3.4.12--2013-06-13(165b5e8a/d)
 >
 > *** Description:
 > The rounded-rectangle pict misses pixels to the right and bottom.
 >
 > Computation of bounding box doesn't take line width into account?
 >
 > *** How to repeat:
 > ;; in DrRacket definition window
 > #lang racket
 >
 > (require pict)
 >
 > (define r (rounded-rectangle 64 64))
 >
 > ;; in interaction window
 > r
 >
 > *** Environment:
 > unix "Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed May 29
 > 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux" (i386-linux/3m)
 > (get-display-depth) = 32
 > Human Language: english
 > (current-memory-use) 229211200
 > Links: (links) = (); (links #:user? #f) = (); (links #:root? #t) = ();
 > (links #:user? #f #:root? #t) = ()
 > raco pkg (show):
 > Installation-wide:
 >  [none]
 > User-specific, all-version:
 >  [none]
 > User-specific, version-specific (5.3.4.12):
 >  [none]
 >
 >
 >
 > Collections:
 > ("/home/stephanh/.racket/5.3.4.12/collects"
 >  (non-existent-path))
 > ("/home/stephanh/racket/collects"
 >  ("gui-debugger" "repo-time-stamp" "net" "trace" "at-exp" "deinprogramm"
 > "setup" "compiler" "json" "realm" "racket" "errortrace" "compatibility"
 > "pkg" "browser" "texpict" "swindle" "embedded-gui" "scribble" "test-engine"
 > "mred" "macro-debugger" "dynext" "future-visualizer" "pict" "meta" "r5rs"
 > "images" "unstable" "raco" "syntax" "db" "r6rs" "scriblib" "mzlib" "mrlib"
 > "xrepl" "tests" "defaults" "parser-tools" "redex" "games"
 > "string-constants" "htdp" "2htdp" "reader" "help" "racklog" "html"
 > "hierlist" "teachpack" "datalog" "mzcom" "lang" "syntax-color"
 > "typed-racket" "drracket" "scheme" "rnrs" "wxme" "scribblings" "launcher"
 > "data" "profile" "mzscheme" "make" "stepper" "algol60" "s-exp" "mysterx"
 > "sgl" ".gitignore" "readline" "slatex" "slideshow" "picturing-programs"
 > "math" "typed" "version" "planet" "eopl" "lazy" "plai" "drscheme"
 > "contract-profile" "info-domain" "openssl" "frtime" "schemeunit" "icons"
 > "config" "honu" "web-server" "graphics" "file" "xml" "framework" "srfi" "!
 >  plot" "rackunit" "preprocessor" "typed-scheme" "ffi"))
 >
 > Computer Language: (("Determine language from source") (#(#t print
 > mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main)
 > (test)) #t))
 >
 >
 
 --089e010d9898b5103404df09e888
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">Probably the issue is that the line draws outside the boun=
 ding box but DrRacket clips to the bounding box when drawing (technically, =
 drracket clips one pixel to the right and below the bounding box for this k=
 ind of issue).<div>
 <br></div><div>I&#39;m not sure that this is a bug but if you want to sugge=
 st a change to the code that implements rounded-rectangle (collects/texpict=
 /utils.rkt around line 305), maybe there is something wrong there. A quick =
 glance doesn&#39;t suggest anything, but I didn&#39;t scrutinize the docs o=
 n dc-path% and I see that rectangle draws directly.<br>
 <div><div><br>Robby</div></div></div></div><div class=3D"gmail_extra"><br><=
 br><div class=3D"gmail_quote">On Thu, Jun 13, 2013 at 9:08 AM,  <span dir=
 =3D"ltr">&lt;<a href=3D"mailto:stephanh42@gmail.com" target=3D"_blank">step=
 hanh42@gmail.com</a>&gt;</span> wrote:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex">A new problem report is waiting at<br>
 =C2=A0 <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D13=
 850" target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=
 =3D13850</a><br>
 <br>
 Reported by Stephan Houben for release: 5.3.4.12--2013-06-13(165b5e8a/d)<br=
 >
 <br>
 *** Description:<br>
 The rounded-rectangle pict misses pixels to the right and bottom.<br>
 <br>
 Computation of bounding box doesn&#39;t take line width into account?<br>
 <br>
 *** How to repeat:<br>
 ;; in DrRacket definition window<br>
 #lang racket<br>
 <br>
 (require pict)<br>
 <br>
 (define r (rounded-rectangle 64 64))<br>
 <br>
 ;; in interaction window<br>
 r<br>
 <br>
 *** Environment:<br>
 unix &quot;Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed Ma=
 y 29 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux&quot; (i386-linux/3m) (get-=
 display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 229211200<br>
 Links: (links) =3D (); (links #:user? #f) =3D (); (links #:root? #t) =3D ()=
 ; (links #:user? #f #:root? #t) =3D ()<br>
 raco pkg (show):<br>
 Installation-wide:<br>
 =C2=A0[none]<br>
 User-specific, all-version:<br>
 =C2=A0[none]<br>
 User-specific, version-specific (5.3.4.12):<br>
 =C2=A0[none]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/home/stephanh/.racket/<a href=3D"http://5.3.4.12/collects" target=
 =3D"_blank">5.3.4.12/collects</a>&quot;<br>
 =C2=A0(non-existent-path))<br>
 (&quot;/home/stephanh/racket/collects&quot;<br>
 =C2=A0(&quot;gui-debugger&quot; &quot;repo-time-stamp&quot; &quot;net&quot;=
  &quot;trace&quot; &quot;at-exp&quot; &quot;deinprogramm&quot; &quot;setup&=
 quot; &quot;compiler&quot; &quot;json&quot; &quot;realm&quot; &quot;racket&=
 quot; &quot;errortrace&quot; &quot;compatibility&quot; &quot;pkg&quot; &quo=
 t;browser&quot; &quot;texpict&quot; &quot;swindle&quot; &quot;embedded-gui&=
 quot; &quot;scribble&quot; &quot;test-engine&quot; &quot;mred&quot; &quot;m=
 acro-debugger&quot; &quot;dynext&quot; &quot;future-visualizer&quot; &quot;=
 pict&quot; &quot;meta&quot; &quot;r5rs&quot; &quot;images&quot; &quot;unsta=
 ble&quot; &quot;raco&quot; &quot;syntax&quot; &quot;db&quot; &quot;r6rs&quo=
 t; &quot;scriblib&quot; &quot;mzlib&quot; &quot;mrlib&quot; &quot;xrepl&quo=
 t; &quot;tests&quot; &quot;defaults&quot; &quot;parser-tools&quot; &quot;re=
 dex&quot; &quot;games&quot; &quot;string-constants&quot; &quot;htdp&quot; &=
 quot;2htdp&quot; &quot;reader&quot; &quot;help&quot; &quot;racklog&quot; &q=
 uot;html&quot; &quot;hierlist&quot; &quot;teachpack&quot; &quot;datalog&quo=
 t; &quot;mzcom&quot; &quot;lang&quot; &quot;syntax-color&quot; &quot;typed-=
 racket&quot; &quot;drracket&quot; &quot;scheme&quot; &quot;rnrs&quot; &quot=
 ;wxme&quot; &quot;scribblings&quot; &quot;launcher&quot; &quot;data&quot; &=
 quot;profile&quot; &quot;mzscheme&quot; &quot;make&quot; &quot;stepper&quot=
 ; &quot;algol60&quot; &quot;s-exp&quot; &quot;mysterx&quot; &quot;sgl&quot;=
  &quot;.gitignore&quot; &quot;readline&quot; &quot;slatex&quot; &quot;slide=
 show&quot; &quot;picturing-programs&quot; &quot;math&quot; &quot;typed&quot=
 ; &quot;version&quot; &quot;planet&quot; &quot;eopl&quot; &quot;lazy&quot; =
 &quot;plai&quot; &quot;drscheme&quot; &quot;contract-profile&quot; &quot;in=
 fo-domain&quot; &quot;openssl&quot; &quot;frtime&quot; &quot;schemeunit&quo=
 t; &quot;icons&quot; &quot;config&quot; &quot;honu&quot; &quot;web-server&q=
 uot; &quot;graphics&quot; &quot;file&quot; &quot;xml&quot; &quot;framework&=
 quot; &quot;srfi&quot; &quot;!<br>
 
 =C2=A0plot&quot; &quot;rackunit&quot; &quot;preprocessor&quot; &quot;typed-=
 scheme&quot; &quot;ffi&quot;))<br>
 <br>
 Computer Language: ((&quot;Determine language from source&quot;) (#(#t prin=
 t mixed-fraction-e #f #t debug) (default) #() &quot;#lang racket\n&quot; #t=
  #t ((main) (test)) #t))<br>
 <br>
 </blockquote></div><br></div>
 
 --089e010d9898b5103404df09e888--
From: Stephan Houben <stephanh42@gmail.com>
To: Robby Findler <robby@eecs.northwestern.edu>
Cc: bugs <bugs@racket-lang.org>, nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13850: rounded-rectangle pict misses pixels to
 the right and bottom
Date: Fri, 14 Jun 2013 09:53:21 +0200

 --047d7b604a646cfac804df188a06
 Content-Type: text/plain; charset=UTF-8
 
 Hi Robby,
 
 The calculation of the bounding box does not take rounding due to the
 smoothing mode.
 
 DrRacket draws the picts in smoothing mode "aligned", which rounds to the
 right and down.
 Now the draw-rounded-rect method of dc<%> corrects for that, however, in
 this case
 we go through a general path.
 The general draw-path method does not (and probably cannot) account for the
 "aligned" smoothing mode.
 
 The following code demonstrates that this makes actually a difference:
 
 ;;;;;;;;;;;;;;;;
 #lang racket/gui
 
 (require pict)
 
 
 (define r (rounded-rectangle 64 64))
 (define r2 (dc (lambda (dc x y) (send dc draw-rounded-rectangle x y 64 64))
 64 64))
 (define r3 (dc (lambda (dc x y)
                  (let ((path (new dc-path%)))
                    (send path rounded-rectangle x y 64 64)
                    (send dc draw-path path)))
                64 64))
 ;;;;;;;;;;;;;;;;;;
 
 A fix would be to replace the drawing by a generic path by a direct call to
 draw-rounded-rectangle.
 
 I cannot suppress the notion that the "aligned" smoothing mode is a bit too
 clever for its own good,
 and that it is really surprising and unfortunate that r2 and r3 produce
 different results.
 
 Thanks,
 
 Stephan
 
 
 
 
 
 
 2013/6/13 Robby Findler <robby@eecs.northwestern.edu>
 
 > Probably the issue is that the line draws outside the bounding box but
 > DrRacket clips to the bounding box when drawing (technically, drracket
 > clips one pixel to the right and below the bounding box for this kind of
 > issue).
 >
 > I'm not sure that this is a bug but if you want to suggest a change to the
 > code that implements rounded-rectangle (collects/texpict/utils.rkt around
 > line 305), maybe there is something wrong there. A quick glance doesn't
 > suggest anything, but I didn't scrutinize the docs on dc-path% and I see
 > that rectangle draws directly.
 >
 > Robby
 >
 >
 > On Thu, Jun 13, 2013 at 9:08 AM, <stephanh42@gmail.com> wrote:
 >
 >> A new problem report is waiting at
 >>   http://bugs.racket-lang.org/query/?cmd=view&pr=13850
 >>
 >> Reported by Stephan Houben for release: 5.3.4.12--2013-06-13(165b5e8a/d)
 >>
 >> *** Description:
 >> The rounded-rectangle pict misses pixels to the right and bottom.
 >>
 >> Computation of bounding box doesn't take line width into account?
 >>
 >> *** How to repeat:
 >> ;; in DrRacket definition window
 >> #lang racket
 >>
 >> (require pict)
 >>
 >> (define r (rounded-rectangle 64 64))
 >>
 >> ;; in interaction window
 >> r
 >>
 >> *** Environment:
 >> unix "Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed May
 >> 29 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux" (i386-linux/3m)
 >> (get-display-depth) = 32
 >> Human Language: english
 >> (current-memory-use) 229211200
 >> Links: (links) = (); (links #:user? #f) = (); (links #:root? #t) = ();
 >> (links #:user? #f #:root? #t) = ()
 >> raco pkg (show):
 >> Installation-wide:
 >>  [none]
 >> User-specific, all-version:
 >>  [none]
 >> User-specific, version-specific (5.3.4.12):
 >>  [none]
 >>
 >>
 >>
 >> Collections:
 >> ("/home/stephanh/.racket/5.3.4.12/collects"
 >>  (non-existent-path))
 >> ("/home/stephanh/racket/collects"
 >>  ("gui-debugger" "repo-time-stamp" "net" "trace" "at-exp" "deinprogramm"
 >> "setup" "compiler" "json" "realm" "racket" "errortrace" "compatibility"
 >> "pkg" "browser" "texpict" "swindle" "embedded-gui" "scribble" "test-engine"
 >> "mred" "macro-debugger" "dynext" "future-visualizer" "pict" "meta" "r5rs"
 >> "images" "unstable" "raco" "syntax" "db" "r6rs" "scriblib" "mzlib" "mrlib"
 >> "xrepl" "tests" "defaults" "parser-tools" "redex" "games"
 >> "string-constants" "htdp" "2htdp" "reader" "help" "racklog" "html"
 >> "hierlist" "teachpack" "datalog" "mzcom" "lang" "syntax-color"
 >> "typed-racket" "drracket" "scheme" "rnrs" "wxme" "scribblings" "launcher"
 >> "data" "profile" "mzscheme" "make" "stepper" "algol60" "s-exp" "mysterx"
 >> "sgl" ".gitignore" "readline" "slatex" "slideshow" "picturing-programs"
 >> "math" "typed" "version" "planet" "eopl" "lazy" "plai" "drscheme"
 >> "contract-profile" "info-domain" "openssl" "frtime" "schemeunit" "icons"
 >> "config" "honu" "web-server" "graphics" "file" "xml" "framework" "srfi" "!
 >>  plot" "rackunit" "preprocessor" "typed-scheme" "ffi"))
 >>
 >> Computer Language: (("Determine language from source") (#(#t print
 >> mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main)
 >> (test)) #t))
 >>
 >>
 >
 
 --047d7b604a646cfac804df188a06
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr"><div><div><div><div>Hi Robby,<br><br></div>The calculation=
  of the bounding box does not take rounding due to the smoothing mode.<br><=
 br></div>DrRacket draws the picts in smoothing mode &quot;aligned&quot;, wh=
 ich rounds to the right and down.<br>
 </div>Now the draw-rounded-rect method of dc&lt;%&gt; corrects for that, ho=
 wever, in this case<br>we go through a general path.<br></div><div>The gene=
 ral draw-path method does not (and probably cannot) account for the &quot;a=
 ligned&quot; smoothing mode.<br>
 </div><div><br></div>The following code demonstrates that this makes actual=
 ly a difference:<br><div><br>;;;;;;;;;;;;;;;;<br>#lang racket/gui<br><br>(r=
 equire pict)<br><br><br>(define r (rounded-rectangle 64 64))<br>(define r2 =
 (dc (lambda (dc x y) (send dc draw-rounded-rectangle x y 64 64)) 64 64))<br=
 >
 (define r3 (dc (lambda (dc x y)<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
 =A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (let ((path (new =
 dc-path%)))<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
 =C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (send path rounded-rectang=
 le x y 64 64)<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
 =A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (send dc draw-path path=
 )))<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
 =C2=A0=C2=A0=C2=A0 64 64))<br>
 ;;;;;;;;;;;;;;;;;;<br><br></div><div>A fix would be to replace the drawing =
 by a generic path by a direct call to draw-rounded-rectangle.<br><br></div>=
 <div>I cannot suppress the notion that the &quot;aligned&quot; smoothing mo=
 de is a bit too clever for its own good,<br>
 and that it is really surprising and unfortunate that r2 and r3 produce dif=
 ferent results.<br><br></div><div>Thanks,<br><br>Stephan<br></div><div><br>=
 <br><br></div><div><br></div></div><div class=3D"gmail_extra"><br><br><div =
 class=3D"gmail_quote">
 2013/6/13 Robby Findler <span dir=3D"ltr">&lt;<a href=3D"mailto:robby@eecs.=
 northwestern.edu" target=3D"_blank">robby@eecs.northwestern.edu</a>&gt;</sp=
 an><br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-=
 left:1px #ccc solid;padding-left:1ex">
 <div dir=3D"ltr">Probably the issue is that the line draws outside the boun=
 ding box but DrRacket clips to the bounding box when drawing (technically, =
 drracket clips one pixel to the right and below the bounding box for this k=
 ind of issue).<div>
 
 <br></div><div>I&#39;m not sure that this is a bug but if you want to sugge=
 st a change to the code that implements rounded-rectangle (collects/texpict=
 /utils.rkt around line 305), maybe there is something wrong there. A quick =
 glance doesn&#39;t suggest anything, but I didn&#39;t scrutinize the docs o=
 n dc-path% and I see that rectangle draws directly.<br>
 
 <div><div><br>Robby</div></div></div></div><div class=3D"gmail_extra"><br><=
 br><div class=3D"gmail_quote">On Thu, Jun 13, 2013 at 9:08 AM,  <span dir=
 =3D"ltr">&lt;<a href=3D"mailto:stephanh42@gmail.com" target=3D"_blank">step=
 hanh42@gmail.com</a>&gt;</span> wrote:<br>
 
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex">A new problem report is waiting at<br>
 =C2=A0 <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D13=
 850" target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=
 =3D13850</a><br>
 <br>
 Reported by Stephan Houben for release: 5.3.4.12--2013-06-13(165b5e8a/d)<br=
 >
 <br>
 *** Description:<br>
 The rounded-rectangle pict misses pixels to the right and bottom.<br>
 <br>
 Computation of bounding box doesn&#39;t take line width into account?<br>
 <br>
 *** How to repeat:<br>
 ;; in DrRacket definition window<br>
 #lang racket<br>
 <br>
 (require pict)<br>
 <br>
 (define r (rounded-rectangle 64 64))<br>
 <br>
 ;; in interaction window<br>
 r<br>
 <br>
 *** Environment:<br>
 unix &quot;Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed Ma=
 y 29 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux&quot; (i386-linux/3m) (get-=
 display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 229211200<br>
 Links: (links) =3D (); (links #:user? #f) =3D (); (links #:root? #t) =3D ()=
 ; (links #:user? #f #:root? #t) =3D ()<br>
 raco pkg (show):<br>
 Installation-wide:<br>
 =C2=A0[none]<br>
 User-specific, all-version:<br>
 =C2=A0[none]<br>
 User-specific, version-specific (5.3.4.12):<br>
 =C2=A0[none]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/home/stephanh/.racket/<a href=3D"http://5.3.4.12/collects" target=
 =3D"_blank">5.3.4.12/collects</a>&quot;<br>
 =C2=A0(non-existent-path))<br>
 (&quot;/home/stephanh/racket/collects&quot;<br>
 =C2=A0(&quot;gui-debugger&quot; &quot;repo-time-stamp&quot; &quot;net&quot;=
  &quot;trace&quot; &quot;at-exp&quot; &quot;deinprogramm&quot; &quot;setup&=
 quot; &quot;compiler&quot; &quot;json&quot; &quot;realm&quot; &quot;racket&=
 quot; &quot;errortrace&quot; &quot;compatibility&quot; &quot;pkg&quot; &quo=
 t;browser&quot; &quot;texpict&quot; &quot;swindle&quot; &quot;embedded-gui&=
 quot; &quot;scribble&quot; &quot;test-engine&quot; &quot;mred&quot; &quot;m=
 acro-debugger&quot; &quot;dynext&quot; &quot;future-visualizer&quot; &quot;=
 pict&quot; &quot;meta&quot; &quot;r5rs&quot; &quot;images&quot; &quot;unsta=
 ble&quot; &quot;raco&quot; &quot;syntax&quot; &quot;db&quot; &quot;r6rs&quo=
 t; &quot;scriblib&quot; &quot;mzlib&quot; &quot;mrlib&quot; &quot;xrepl&quo=
 t; &quot;tests&quot; &quot;defaults&quot; &quot;parser-tools&quot; &quot;re=
 dex&quot; &quot;games&quot; &quot;string-constants&quot; &quot;htdp&quot; &=
 quot;2htdp&quot; &quot;reader&quot; &quot;help&quot; &quot;racklog&quot; &q=
 uot;html&quot; &quot;hierlist&quot; &quot;teachpack&quot; &quot;datalog&quo=
 t; &quot;mzcom&quot; &quot;lang&quot; &quot;syntax-color&quot; &quot;typed-=
 racket&quot; &quot;drracket&quot; &quot;scheme&quot; &quot;rnrs&quot; &quot=
 ;wxme&quot; &quot;scribblings&quot; &quot;launcher&quot; &quot;data&quot; &=
 quot;profile&quot; &quot;mzscheme&quot; &quot;make&quot; &quot;stepper&quot=
 ; &quot;algol60&quot; &quot;s-exp&quot; &quot;mysterx&quot; &quot;sgl&quot;=
  &quot;.gitignore&quot; &quot;readline&quot; &quot;slatex&quot; &quot;slide=
 show&quot; &quot;picturing-programs&quot; &quot;math&quot; &quot;typed&quot=
 ; &quot;version&quot; &quot;planet&quot; &quot;eopl&quot; &quot;lazy&quot; =
 &quot;plai&quot; &quot;drscheme&quot; &quot;contract-profile&quot; &quot;in=
 fo-domain&quot; &quot;openssl&quot; &quot;frtime&quot; &quot;schemeunit&quo=
 t; &quot;icons&quot; &quot;config&quot; &quot;honu&quot; &quot;web-server&q=
 uot; &quot;graphics&quot; &quot;file&quot; &quot;xml&quot; &quot;framework&=
 quot; &quot;srfi&quot; &quot;!<br>
 
 
 =C2=A0plot&quot; &quot;rackunit&quot; &quot;preprocessor&quot; &quot;typed-=
 scheme&quot; &quot;ffi&quot;))<br>
 <br>
 Computer Language: ((&quot;Determine language from source&quot;) (#(#t prin=
 t mixed-fraction-e #f #t debug) (default) #() &quot;#lang racket\n&quot; #t=
  #t ((main) (test)) #t))<br>
 <br>
 </blockquote></div><br></div>
 </blockquote></div><br></div>
 
 --047d7b604a646cfac804df188a06--
From: Robby Findler <robby@eecs.northwestern.edu>
To: Stephan Houben <stephanh42@gmail.com>
Cc: bugs <bugs@racket-lang.org>, nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13850: rounded-rectangle pict misses pixels to
 the right and bottom
Date: Fri, 14 Jun 2013 14:22:25 -0500

 --089e010d9898bd9e6a04df222abf
 Content-Type: text/plain; charset=UTF-8
 
 It looks like I broke this in 2008 with a commit that went from using
 draw-rounded-rectangle to using the dc-path%. I wrote "added an angle
 parameter to rounded-rectangle and filled-rounded-rectangle" in the commit
 message, so probably that means that I didn't realize that I was breaking
 it.
 
 Given backwards compatibility concerns I'm unsure what is the right thing
 to do here. My inclination is to just change it back to calling
 draw-rounded-rectangle directly, but lets see if anyone else has an opinion.
 
 Robby
 
 
 On Fri, Jun 14, 2013 at 2:53 AM, Stephan Houben <stephanh42@gmail.com>wrote:
 
 > Hi Robby,
 >
 > The calculation of the bounding box does not take rounding due to the
 > smoothing mode.
 >
 > DrRacket draws the picts in smoothing mode "aligned", which rounds to the
 > right and down.
 > Now the draw-rounded-rect method of dc<%> corrects for that, however, in
 > this case
 > we go through a general path.
 > The general draw-path method does not (and probably cannot) account for
 > the "aligned" smoothing mode.
 >
 > The following code demonstrates that this makes actually a difference:
 >
 > ;;;;;;;;;;;;;;;;
 > #lang racket/gui
 >
 >
 > (require pict)
 >
 >
 > (define r (rounded-rectangle 64 64))
 > (define r2 (dc (lambda (dc x y) (send dc draw-rounded-rectangle x y 64
 > 64)) 64 64))
 > (define r3 (dc (lambda (dc x y)
 >                  (let ((path (new dc-path%)))
 >                    (send path rounded-rectangle x y 64 64)
 >                    (send dc draw-path path)))
 >                64 64))
 > ;;;;;;;;;;;;;;;;;;
 >
 > A fix would be to replace the drawing by a generic path by a direct call
 > to draw-rounded-rectangle.
 >
 > I cannot suppress the notion that the "aligned" smoothing mode is a bit
 > too clever for its own good,
 > and that it is really surprising and unfortunate that r2 and r3 produce
 > different results.
 >
 > Thanks,
 >
 > Stephan
 >
 >
 >
 >
 >
 >
 > 2013/6/13 Robby Findler <robby@eecs.northwestern.edu>
 >
 >> Probably the issue is that the line draws outside the bounding box but
 >> DrRacket clips to the bounding box when drawing (technically, drracket
 >> clips one pixel to the right and below the bounding box for this kind of
 >> issue).
 >>
 >> I'm not sure that this is a bug but if you want to suggest a change to
 >> the code that implements rounded-rectangle (collects/texpict/utils.rkt
 >> around line 305), maybe there is something wrong there. A quick glance
 >> doesn't suggest anything, but I didn't scrutinize the docs on dc-path% and
 >> I see that rectangle draws directly.
 >>
 >> Robby
 >>
 >>
 >> On Thu, Jun 13, 2013 at 9:08 AM, <stephanh42@gmail.com> wrote:
 >>
 >>> A new problem report is waiting at
 >>>   http://bugs.racket-lang.org/query/?cmd=view&pr=13850
 >>>
 >>> Reported by Stephan Houben for release: 5.3.4.12--2013-06-13(165b5e8a/d)
 >>>
 >>> *** Description:
 >>> The rounded-rectangle pict misses pixels to the right and bottom.
 >>>
 >>> Computation of bounding box doesn't take line width into account?
 >>>
 >>> *** How to repeat:
 >>> ;; in DrRacket definition window
 >>> #lang racket
 >>>
 >>> (require pict)
 >>>
 >>> (define r (rounded-rectangle 64 64))
 >>>
 >>> ;; in interaction window
 >>> r
 >>>
 >>> *** Environment:
 >>> unix "Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed May
 >>> 29 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux" (i386-linux/3m)
 >>> (get-display-depth) = 32
 >>> Human Language: english
 >>> (current-memory-use) 229211200
 >>> Links: (links) = (); (links #:user? #f) = (); (links #:root? #t) = ();
 >>> (links #:user? #f #:root? #t) = ()
 >>> raco pkg (show):
 >>> Installation-wide:
 >>>  [none]
 >>> User-specific, all-version:
 >>>  [none]
 >>> User-specific, version-specific (5.3.4.12):
 >>>  [none]
 >>>
 >>>
 >>>
 >>> Collections:
 >>> ("/home/stephanh/.racket/5.3.4.12/collects"
 >>>  (non-existent-path))
 >>> ("/home/stephanh/racket/collects"
 >>>  ("gui-debugger" "repo-time-stamp" "net" "trace" "at-exp" "deinprogramm"
 >>> "setup" "compiler" "json" "realm" "racket" "errortrace" "compatibility"
 >>> "pkg" "browser" "texpict" "swindle" "embedded-gui" "scribble" "test-engine"
 >>> "mred" "macro-debugger" "dynext" "future-visualizer" "pict" "meta" "r5rs"
 >>> "images" "unstable" "raco" "syntax" "db" "r6rs" "scriblib" "mzlib" "mrlib"
 >>> "xrepl" "tests" "defaults" "parser-tools" "redex" "games"
 >>> "string-constants" "htdp" "2htdp" "reader" "help" "racklog" "html"
 >>> "hierlist" "teachpack" "datalog" "mzcom" "lang" "syntax-color"
 >>> "typed-racket" "drracket" "scheme" "rnrs" "wxme" "scribblings" "launcher"
 >>> "data" "profile" "mzscheme" "make" "stepper" "algol60" "s-exp" "mysterx"
 >>> "sgl" ".gitignore" "readline" "slatex" "slideshow" "picturing-programs"
 >>> "math" "typed" "version" "planet" "eopl" "lazy" "plai" "drscheme"
 >>> "contract-profile" "info-domain" "openssl" "frtime" "schemeunit" "icons"
 >>> "config" "honu" "web-server" "graphics" "file" "xml" "framework" "srfi" "!
 >>>  plot" "rackunit" "preprocessor" "typed-scheme" "ffi"))
 >>>
 >>> Computer Language: (("Determine language from source") (#(#t print
 >>> mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main)
 >>> (test)) #t))
 >>>
 >>>
 >>
 >
 
 --089e010d9898bd9e6a04df222abf
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">It looks like I broke this in 2008 with a commit that went=
  from using draw-rounded-rectangle to using the dc-path%. I wrote &quot;add=
 ed an angle parameter to rounded-rectangle and filled-rounded-rectangle&quo=
 t; in the commit message, so probably that means that I didn&#39;t realize =
 that I was breaking it.<div>
 <br></div><div style>Given backwards compatibility concerns I&#39;m unsure =
 what is the right thing to do here. My inclination is to just change it bac=
 k to calling draw-rounded-rectangle directly, but lets see if anyone else h=
 as an opinion.</div>
 <div><br></div><div style>Robby</div></div><div class=3D"gmail_extra"><br><=
 br><div class=3D"gmail_quote">On Fri, Jun 14, 2013 at 2:53 AM, Stephan Houb=
 en <span dir=3D"ltr">&lt;<a href=3D"mailto:stephanh42@gmail.com" target=3D"=
 _blank">stephanh42@gmail.com</a>&gt;</span> wrote:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex"><div dir=3D"ltr"><div><div><div><div>Hi Robb=
 y,<br><br></div>The calculation of the bounding box does not take rounding =
 due to the smoothing mode.<br>
 <br></div>DrRacket draws the picts in smoothing mode &quot;aligned&quot;, w=
 hich rounds to the right and down.<br>
 </div>Now the draw-rounded-rect method of dc&lt;%&gt; corrects for that, ho=
 wever, in this case<br>we go through a general path.<br></div><div>The gene=
 ral draw-path method does not (and probably cannot) account for the &quot;a=
 ligned&quot; smoothing mode.<br>
 
 </div><div><br></div>The following code demonstrates that this makes actual=
 ly a difference:<br><div><br>;;;;;;;;;;;;;;;;<br>#lang racket/gui<div class=
 =3D"im"><br><br>(require pict)<br><br><br>(define r (rounded-rectangle 64 6=
 4))<br>
 </div>(define r2 (dc (lambda (dc x y) (send dc draw-rounded-rectangle x y 6=
 4 64)) 64 64))<br>
 (define r3 (dc (lambda (dc x y)<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
 =A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (let ((path (new =
 dc-path%)))<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
 =C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (send path rounded-rectang=
 le x y 64 64)<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
 =A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (send dc draw-path path=
 )))<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
 =C2=A0=C2=A0=C2=A0 64 64))<br>
 
 ;;;;;;;;;;;;;;;;;;<br><br></div><div>A fix would be to replace the drawing =
 by a generic path by a direct call to draw-rounded-rectangle.<br><br></div>=
 <div>I cannot suppress the notion that the &quot;aligned&quot; smoothing mo=
 de is a bit too clever for its own good,<br>
 
 and that it is really surprising and unfortunate that r2 and r3 produce dif=
 ferent results.<br><br></div><div>Thanks,<br><br>Stephan<br></div><div><br>=
 <br><br></div><div><br></div></div><div class=3D"HOEnZb"><div class=3D"h5">
 <div class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">
 2013/6/13 Robby Findler <span dir=3D"ltr">&lt;<a href=3D"mailto:robby@eecs.=
 northwestern.edu" target=3D"_blank">robby@eecs.northwestern.edu</a>&gt;</sp=
 an><br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-=
 left:1px #ccc solid;padding-left:1ex">
 
 <div dir=3D"ltr">Probably the issue is that the line draws outside the boun=
 ding box but DrRacket clips to the bounding box when drawing (technically, =
 drracket clips one pixel to the right and below the bounding box for this k=
 ind of issue).<div>
 
 
 <br></div><div>I&#39;m not sure that this is a bug but if you want to sugge=
 st a change to the code that implements rounded-rectangle (collects/texpict=
 /utils.rkt around line 305), maybe there is something wrong there. A quick =
 glance doesn&#39;t suggest anything, but I didn&#39;t scrutinize the docs o=
 n dc-path% and I see that rectangle draws directly.<br>
 
 
 <div><div><br>Robby</div></div></div></div><div class=3D"gmail_extra"><br><=
 br><div class=3D"gmail_quote">On Thu, Jun 13, 2013 at 9:08 AM,  <span dir=
 =3D"ltr">&lt;<a href=3D"mailto:stephanh42@gmail.com" target=3D"_blank">step=
 hanh42@gmail.com</a>&gt;</span> wrote:<br>
 
 
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex">A new problem report is waiting at<br>
 =C2=A0 <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D13=
 850" target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=
 =3D13850</a><br>
 <br>
 Reported by Stephan Houben for release: 5.3.4.12--2013-06-13(165b5e8a/d)<br=
 >
 <br>
 *** Description:<br>
 The rounded-rectangle pict misses pixels to the right and bottom.<br>
 <br>
 Computation of bounding box doesn&#39;t take line width into account?<br>
 <br>
 *** How to repeat:<br>
 ;; in DrRacket definition window<br>
 #lang racket<br>
 <br>
 (require pict)<br>
 <br>
 (define r (rounded-rectangle 64 64))<br>
 <br>
 ;; in interaction window<br>
 r<br>
 <br>
 *** Environment:<br>
 unix &quot;Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed Ma=
 y 29 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux&quot; (i386-linux/3m) (get-=
 display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 229211200<br>
 Links: (links) =3D (); (links #:user? #f) =3D (); (links #:root? #t) =3D ()=
 ; (links #:user? #f #:root? #t) =3D ()<br>
 raco pkg (show):<br>
 Installation-wide:<br>
 =C2=A0[none]<br>
 User-specific, all-version:<br>
 =C2=A0[none]<br>
 User-specific, version-specific (5.3.4.12):<br>
 =C2=A0[none]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/home/stephanh/.racket/<a href=3D"http://5.3.4.12/collects" target=
 =3D"_blank">5.3.4.12/collects</a>&quot;<br>
 =C2=A0(non-existent-path))<br>
 (&quot;/home/stephanh/racket/collects&quot;<br>
 =C2=A0(&quot;gui-debugger&quot; &quot;repo-time-stamp&quot; &quot;net&quot;=
  &quot;trace&quot; &quot;at-exp&quot; &quot;deinprogramm&quot; &quot;setup&=
 quot; &quot;compiler&quot; &quot;json&quot; &quot;realm&quot; &quot;racket&=
 quot; &quot;errortrace&quot; &quot;compatibility&quot; &quot;pkg&quot; &quo=
 t;browser&quot; &quot;texpict&quot; &quot;swindle&quot; &quot;embedded-gui&=
 quot; &quot;scribble&quot; &quot;test-engine&quot; &quot;mred&quot; &quot;m=
 acro-debugger&quot; &quot;dynext&quot; &quot;future-visualizer&quot; &quot;=
 pict&quot; &quot;meta&quot; &quot;r5rs&quot; &quot;images&quot; &quot;unsta=
 ble&quot; &quot;raco&quot; &quot;syntax&quot; &quot;db&quot; &quot;r6rs&quo=
 t; &quot;scriblib&quot; &quot;mzlib&quot; &quot;mrlib&quot; &quot;xrepl&quo=
 t; &quot;tests&quot; &quot;defaults&quot; &quot;parser-tools&quot; &quot;re=
 dex&quot; &quot;games&quot; &quot;string-constants&quot; &quot;htdp&quot; &=
 quot;2htdp&quot; &quot;reader&quot; &quot;help&quot; &quot;racklog&quot; &q=
 uot;html&quot; &quot;hierlist&quot; &quot;teachpack&quot; &quot;datalog&quo=
 t; &quot;mzcom&quot; &quot;lang&quot; &quot;syntax-color&quot; &quot;typed-=
 racket&quot; &quot;drracket&quot; &quot;scheme&quot; &quot;rnrs&quot; &quot=
 ;wxme&quot; &quot;scribblings&quot; &quot;launcher&quot; &quot;data&quot; &=
 quot;profile&quot; &quot;mzscheme&quot; &quot;make&quot; &quot;stepper&quot=
 ; &quot;algol60&quot; &quot;s-exp&quot; &quot;mysterx&quot; &quot;sgl&quot;=
  &quot;.gitignore&quot; &quot;readline&quot; &quot;slatex&quot; &quot;slide=
 show&quot; &quot;picturing-programs&quot; &quot;math&quot; &quot;typed&quot=
 ; &quot;version&quot; &quot;planet&quot; &quot;eopl&quot; &quot;lazy&quot; =
 &quot;plai&quot; &quot;drscheme&quot; &quot;contract-profile&quot; &quot;in=
 fo-domain&quot; &quot;openssl&quot; &quot;frtime&quot; &quot;schemeunit&quo=
 t; &quot;icons&quot; &quot;config&quot; &quot;honu&quot; &quot;web-server&q=
 uot; &quot;graphics&quot; &quot;file&quot; &quot;xml&quot; &quot;framework&=
 quot; &quot;srfi&quot; &quot;!<br>
 
 
 
 =C2=A0plot&quot; &quot;rackunit&quot; &quot;preprocessor&quot; &quot;typed-=
 scheme&quot; &quot;ffi&quot;))<br>
 <br>
 Computer Language: ((&quot;Determine language from source&quot;) (#(#t prin=
 t mixed-fraction-e #f #t debug) (default) #() &quot;#lang racket\n&quot; #t=
  #t ((main) (test)) #t))<br>
 <br>
 </blockquote></div><br></div>
 </blockquote></div><br></div>
 </div></div></blockquote></div><br></div>
 
 --089e010d9898bd9e6a04df222abf--
From: Robby Findler <robby@eecs.northwestern.edu>
To: Stephan Houben <stephanh42@gmail.com>
Cc: bugs <bugs@racket-lang.org>, nobody <nobody@racket-lang.org>,
        bug-notification <bug-notification@racket-lang.org>
Subject: Re: [racket-bug] all/13850: rounded-rectangle pict misses pixels to
 the right and bottom
Date: Mon, 19 Aug 2013 08:08:41 -0500

 --089e0112cf68b138b204e44ca3fa
 Content-Type: text/plain; charset=UTF-8
 
 I went back and looked at this again and actually it is not quite so simple
 because of the angle parameter to rounded-rectangle.
 
 The general issue is the one described here:
 http://docs.racket-lang.org/teachpack/2htdpimage-guide.html#%28part._nitty-gritty%29
 
 I can special case the situation where the angle is zero and make
 rounded-rectangle's behavior match rectangle's in that case (keeping the
 right and bottom inside the bounding box). Or I can do nothing.
 
 I don't see a good solution, overall. Other ideas?
 
 Robby
 
 
 
 
 On Fri, Jun 14, 2013 at 2:22 PM, Robby Findler
 <robby@eecs.northwestern.edu>wrote:
 
 > It looks like I broke this in 2008 with a commit that went from using
 > draw-rounded-rectangle to using the dc-path%. I wrote "added an angle
 > parameter to rounded-rectangle and filled-rounded-rectangle" in the commit
 > message, so probably that means that I didn't realize that I was breaking
 > it.
 >
 > Given backwards compatibility concerns I'm unsure what is the right thing
 > to do here. My inclination is to just change it back to calling
 > draw-rounded-rectangle directly, but lets see if anyone else has an opinion.
 >
 > Robby
 >
 >
 > On Fri, Jun 14, 2013 at 2:53 AM, Stephan Houben <stephanh42@gmail.com>wrote:
 >
 >> Hi Robby,
 >>
 >> The calculation of the bounding box does not take rounding due to the
 >> smoothing mode.
 >>
 >> DrRacket draws the picts in smoothing mode "aligned", which rounds to the
 >> right and down.
 >> Now the draw-rounded-rect method of dc<%> corrects for that, however, in
 >> this case
 >> we go through a general path.
 >> The general draw-path method does not (and probably cannot) account for
 >> the "aligned" smoothing mode.
 >>
 >> The following code demonstrates that this makes actually a difference:
 >>
 >> ;;;;;;;;;;;;;;;;
 >> #lang racket/gui
 >>
 >>
 >> (require pict)
 >>
 >>
 >> (define r (rounded-rectangle 64 64))
 >> (define r2 (dc (lambda (dc x y) (send dc draw-rounded-rectangle x y 64
 >> 64)) 64 64))
 >> (define r3 (dc (lambda (dc x y)
 >>                  (let ((path (new dc-path%)))
 >>                    (send path rounded-rectangle x y 64 64)
 >>                    (send dc draw-path path)))
 >>                64 64))
 >> ;;;;;;;;;;;;;;;;;;
 >>
 >> A fix would be to replace the drawing by a generic path by a direct call
 >> to draw-rounded-rectangle.
 >>
 >> I cannot suppress the notion that the "aligned" smoothing mode is a bit
 >> too clever for its own good,
 >> and that it is really surprising and unfortunate that r2 and r3 produce
 >> different results.
 >>
 >> Thanks,
 >>
 >> Stephan
 >>
 >>
 >>
 >>
 >>
 >>
 >> 2013/6/13 Robby Findler <robby@eecs.northwestern.edu>
 >>
 >>> Probably the issue is that the line draws outside the bounding box but
 >>> DrRacket clips to the bounding box when drawing (technically, drracket
 >>> clips one pixel to the right and below the bounding box for this kind of
 >>> issue).
 >>>
 >>> I'm not sure that this is a bug but if you want to suggest a change to
 >>> the code that implements rounded-rectangle (collects/texpict/utils.rkt
 >>> around line 305), maybe there is something wrong there. A quick glance
 >>> doesn't suggest anything, but I didn't scrutinize the docs on dc-path% and
 >>> I see that rectangle draws directly.
 >>>
 >>> Robby
 >>>
 >>>
 >>> On Thu, Jun 13, 2013 at 9:08 AM, <stephanh42@gmail.com> wrote:
 >>>
 >>>> A new problem report is waiting at
 >>>>   http://bugs.racket-lang.org/query/?cmd=view&pr=13850
 >>>>
 >>>> Reported by Stephan Houben for release: 5.3.4.12--2013-06-13(165b5e8a/d)
 >>>>
 >>>> *** Description:
 >>>> The rounded-rectangle pict misses pixels to the right and bottom.
 >>>>
 >>>> Computation of bounding box doesn't take line width into account?
 >>>>
 >>>> *** How to repeat:
 >>>> ;; in DrRacket definition window
 >>>> #lang racket
 >>>>
 >>>> (require pict)
 >>>>
 >>>> (define r (rounded-rectangle 64 64))
 >>>>
 >>>> ;; in interaction window
 >>>> r
 >>>>
 >>>> *** Environment:
 >>>> unix "Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed May
 >>>> 29 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux" (i386-linux/3m)
 >>>> (get-display-depth) = 32
 >>>> Human Language: english
 >>>> (current-memory-use) 229211200
 >>>> Links: (links) = (); (links #:user? #f) = (); (links #:root? #t) = ();
 >>>> (links #:user? #f #:root? #t) = ()
 >>>> raco pkg (show):
 >>>> Installation-wide:
 >>>>  [none]
 >>>> User-specific, all-version:
 >>>>  [none]
 >>>> User-specific, version-specific (5.3.4.12):
 >>>>  [none]
 >>>>
 >>>>
 >>>>
 >>>> Collections:
 >>>> ("/home/stephanh/.racket/5.3.4.12/collects"
 >>>>  (non-existent-path))
 >>>> ("/home/stephanh/racket/collects"
 >>>>  ("gui-debugger" "repo-time-stamp" "net" "trace" "at-exp"
 >>>> "deinprogramm" "setup" "compiler" "json" "realm" "racket" "errortrace"
 >>>> "compatibility" "pkg" "browser" "texpict" "swindle" "embedded-gui"
 >>>> "scribble" "test-engine" "mred" "macro-debugger" "dynext"
 >>>> "future-visualizer" "pict" "meta" "r5rs" "images" "unstable" "raco"
 >>>> "syntax" "db" "r6rs" "scriblib" "mzlib" "mrlib" "xrepl" "tests" "defaults"
 >>>> "parser-tools" "redex" "games" "string-constants" "htdp" "2htdp" "reader"
 >>>> "help" "racklog" "html" "hierlist" "teachpack" "datalog" "mzcom" "lang"
 >>>> "syntax-color" "typed-racket" "drracket" "scheme" "rnrs" "wxme"
 >>>> "scribblings" "launcher" "data" "profile" "mzscheme" "make" "stepper"
 >>>> "algol60" "s-exp" "mysterx" "sgl" ".gitignore" "readline" "slatex"
 >>>> "slideshow" "picturing-programs" "math" "typed" "version" "planet" "eopl"
 >>>> "lazy" "plai" "drscheme" "contract-profile" "info-domain" "openssl"
 >>>> "frtime" "schemeunit" "icons" "config" "honu" "web-server" "graphics"
 >>>> "file" "xml" "framework" "srfi" "!
 >>>>  plot" "rackunit" "preprocessor" "typed-scheme" "ffi"))
 >>>>
 >>>> Computer Language: (("Determine language from source") (#(#t print
 >>>> mixed-fraction-e #f #t debug) (default) #() "#lang racket\n" #t #t ((main)
 >>>> (test)) #t))
 >>>>
 >>>>
 >>>
 >>
 >
 
 --089e0112cf68b138b204e44ca3fa
 Content-Type: text/html; charset=UTF-8
 Content-Transfer-Encoding: quoted-printable
 
 <div dir=3D"ltr">I went back and looked at this again and actually it is no=
 t quite so simple because of the angle parameter to rounded-rectangle.<div>=
 <br></div><div>The general issue is the one described here:=C2=A0<a href=3D=
 "http://docs.racket-lang.org/teachpack/2htdpimage-guide.html#%28part._nitty=
 -gritty%29">http://docs.racket-lang.org/teachpack/2htdpimage-guide.html#%28=
 part._nitty-gritty%29</a></div>
 <div><br></div><div>I can special case the situation where the angle is zer=
 o and make rounded-rectangle&#39;s behavior match rectangle&#39;s in that c=
 ase (keeping the right and bottom inside the bounding box). Or I can do not=
 hing.</div>
 <div><br></div><div>I don&#39;t see a good solution, overall. Other ideas?<=
 /div><div><br></div><div>Robby</div><div><br></div><div><br></div></div><di=
 v class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Fri, Jun 14, =
 2013 at 2:22 PM, Robby Findler <span dir=3D"ltr">&lt;<a href=3D"mailto:robb=
 y@eecs.northwestern.edu" target=3D"_blank">robby@eecs.northwestern.edu</a>&=
 gt;</span> wrote:<br>
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex"><div dir=3D"ltr">It looks like I broke this =
 in 2008 with a commit that went from using draw-rounded-rectangle to using =
 the dc-path%. I wrote &quot;added an angle parameter to rounded-rectangle a=
 nd filled-rounded-rectangle&quot; in the commit message, so probably that m=
 eans that I didn&#39;t realize that I was breaking it.<div>
 
 <br></div><div>Given backwards compatibility concerns I&#39;m unsure what i=
 s the right thing to do here. My inclination is to just change it back to c=
 alling draw-rounded-rectangle directly, but lets see if anyone else has an =
 opinion.</div>
 <span class=3D"HOEnZb"><font color=3D"#888888">
 <div><br></div><div>Robby</div></font></span></div><div class=3D"HOEnZb"><d=
 iv class=3D"h5"><div class=3D"gmail_extra"><br><br><div class=3D"gmail_quot=
 e">On Fri, Jun 14, 2013 at 2:53 AM, Stephan Houben <span dir=3D"ltr">&lt;<a=
  href=3D"mailto:stephanh42@gmail.com" target=3D"_blank">stephanh42@gmail.co=
 m</a>&gt;</span> wrote:<br>
 
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex"><div dir=3D"ltr"><div><div><div><div>Hi Robb=
 y,<br><br></div>The calculation of the bounding box does not take rounding =
 due to the smoothing mode.<br>
 
 <br></div>DrRacket draws the picts in smoothing mode &quot;aligned&quot;, w=
 hich rounds to the right and down.<br>
 </div>Now the draw-rounded-rect method of dc&lt;%&gt; corrects for that, ho=
 wever, in this case<br>we go through a general path.<br></div><div>The gene=
 ral draw-path method does not (and probably cannot) account for the &quot;a=
 ligned&quot; smoothing mode.<br>
 
 
 </div><div><br></div>The following code demonstrates that this makes actual=
 ly a difference:<br><div><br>;;;;;;;;;;;;;;;;<br>#lang racket/gui<div><br><=
 br>(require pict)<br><br><br>(define r (rounded-rectangle 64 64))<br>
 </div>(define r2 (dc (lambda (dc x y) (send dc draw-rounded-rectangle x y 6=
 4 64)) 64 64))<br>
 (define r3 (dc (lambda (dc x y)<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
 =A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (let ((path (new =
 dc-path%)))<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
 =C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (send path rounded-rectang=
 le x y 64 64)<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
 =A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 (send dc draw-path path=
 )))<br>=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
 =C2=A0=C2=A0=C2=A0 64 64))<br>
 
 
 ;;;;;;;;;;;;;;;;;;<br><br></div><div>A fix would be to replace the drawing =
 by a generic path by a direct call to draw-rounded-rectangle.<br><br></div>=
 <div>I cannot suppress the notion that the &quot;aligned&quot; smoothing mo=
 de is a bit too clever for its own good,<br>
 
 
 and that it is really surprising and unfortunate that r2 and r3 produce dif=
 ferent results.<br><br></div><div>Thanks,<br><br>Stephan<br></div><div><br>=
 <br><br></div><div><br></div></div><div><div>
 <div class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">
 2013/6/13 Robby Findler <span dir=3D"ltr">&lt;<a href=3D"mailto:robby@eecs.=
 northwestern.edu" target=3D"_blank">robby@eecs.northwestern.edu</a>&gt;</sp=
 an><br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-=
 left:1px #ccc solid;padding-left:1ex">
 
 
 <div dir=3D"ltr">Probably the issue is that the line draws outside the boun=
 ding box but DrRacket clips to the bounding box when drawing (technically, =
 drracket clips one pixel to the right and below the bounding box for this k=
 ind of issue).<div>
 
 
 
 <br></div><div>I&#39;m not sure that this is a bug but if you want to sugge=
 st a change to the code that implements rounded-rectangle (collects/texpict=
 /utils.rkt around line 305), maybe there is something wrong there. A quick =
 glance doesn&#39;t suggest anything, but I didn&#39;t scrutinize the docs o=
 n dc-path% and I see that rectangle draws directly.<br>
 
 
 
 <div><div><br>Robby</div></div></div></div><div class=3D"gmail_extra"><br><=
 br><div class=3D"gmail_quote">On Thu, Jun 13, 2013 at 9:08 AM,  <span dir=
 =3D"ltr">&lt;<a href=3D"mailto:stephanh42@gmail.com" target=3D"_blank">step=
 hanh42@gmail.com</a>&gt;</span> wrote:<br>
 
 
 
 <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
 x #ccc solid;padding-left:1ex">A new problem report is waiting at<br>
 =C2=A0 <a href=3D"http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=3D13=
 850" target=3D"_blank">http://bugs.racket-lang.org/query/?cmd=3Dview&amp;pr=
 =3D13850</a><br>
 <br>
 Reported by Stephan Houben for release: 5.3.4.12--2013-06-13(165b5e8a/d)<br=
 >
 <br>
 *** Description:<br>
 The rounded-rectangle pict misses pixels to the right and bottom.<br>
 <br>
 Computation of bounding box doesn&#39;t take line width into account?<br>
 <br>
 *** How to repeat:<br>
 ;; in DrRacket definition window<br>
 #lang racket<br>
 <br>
 (require pict)<br>
 <br>
 (define r (rounded-rectangle 64 64))<br>
 <br>
 ;; in interaction window<br>
 r<br>
 <br>
 *** Environment:<br>
 unix &quot;Linux stephanh-VirtualBox 3.2.0-45-generic #70-Ubuntu SMP Wed Ma=
 y 29 20:11:31 UTC 2013 i686 i686 i386 GNU/Linux&quot; (i386-linux/3m) (get-=
 display-depth) =3D 32<br>
 Human Language: english<br>
 (current-memory-use) 229211200<br>
 Links: (links) =3D (); (links #:user? #f) =3D (); (links #:root? #t) =3D ()=
 ; (links #:user? #f #:root? #t) =3D ()<br>
 raco pkg (show):<br>
 Installation-wide:<br>
 =C2=A0[none]<br>
 User-specific, all-version:<br>
 =C2=A0[none]<br>
 User-specific, version-specific (5.3.4.12):<br>
 =C2=A0[none]<br>
 <br>
 <br>
 <br>
 Collections:<br>
 (&quot;/home/stephanh/.racket/<a href=3D"http://5.3.4.12/collects" target=
 =3D"_blank">5.3.4.12/collects</a>&quot;<br>
 =C2=A0(non-existent-path))<br>
 (&quot;/home/stephanh/racket/collects&quot;<br>
 =C2=A0(&quot;gui-debugger&quot; &quot;repo-time-stamp&quot; &quot;net&quot;=
  &quot;trace&quot; &quot;at-exp&quot; &quot;deinprogramm&quot; &quot;setup&=
 quot; &quot;compiler&quot; &quot;json&quot; &quot;realm&quot; &quot;racket&=
 quot; &quot;errortrace&quot; &quot;compatibility&quot; &quot;pkg&quot; &quo=
 t;browser&quot; &quot;texpict&quot; &quot;swindle&quot; &quot;embedded-gui&=
 quot; &quot;scribble&quot; &quot;test-engine&quot; &quot;mred&quot; &quot;m=
 acro-debugger&quot; &quot;dynext&quot; &quot;future-visualizer&quot; &quot;=
 pict&quot; &quot;meta&quot; &quot;r5rs&quot; &quot;images&quot; &quot;unsta=
 ble&quot; &quot;raco&quot; &quot;syntax&quot; &quot;db&quot; &quot;r6rs&quo=
 t; &quot;scriblib&quot; &quot;mzlib&quot; &quot;mrlib&quot; &quot;xrepl&quo=
 t; &quot;tests&quot; &quot;defaults&quot; &quot;parser-tools&quot; &quot;re=
 dex&quot; &quot;games&quot; &quot;string-constants&quot; &quot;htdp&quot; &=
 quot;2htdp&quot; &quot;reader&quot; &quot;help&quot; &quot;racklog&quot; &q=
 uot;html&quot; &quot;hierlist&quot; &quot;teachpack&quot; &quot;datalog&quo=
 t; &quot;mzcom&quot; &quot;lang&quot; &quot;syntax-color&quot; &quot;typed-=
 racket&quot; &quot;drracket&quot; &quot;scheme&quot; &quot;rnrs&quot; &quot=
 ;wxme&quot; &quot;scribblings&quot; &quot;launcher&quot; &quot;data&quot; &=
 quot;profile&quot; &quot;mzscheme&quot; &quot;make&quot; &quot;stepper&quot=
 ; &quot;algol60&quot; &quot;s-exp&quot; &quot;mysterx&quot; &quot;sgl&quot;=
  &quot;.gitignore&quot; &quot;readline&quot; &quot;slatex&quot; &quot;slide=
 show&quot; &quot;picturing-programs&quot; &quot;math&quot; &quot;typed&quot=
 ; &quot;version&quot; &quot;planet&quot; &quot;eopl&quot; &quot;lazy&quot; =
 &quot;plai&quot; &quot;drscheme&quot; &quot;contract-profile&quot; &quot;in=
 fo-domain&quot; &quot;openssl&quot; &quot;frtime&quot; &quot;schemeunit&quo=
 t; &quot;icons&quot; &quot;config&quot; &quot;honu&quot; &quot;web-server&q=
 uot; &quot;graphics&quot; &quot;file&quot; &quot;xml&quot; &quot;framework&=
 quot; &quot;srfi&quot; &quot;!<br>
 
 
 
 
 =C2=A0plot&quot; &quot;rackunit&quot; &quot;preprocessor&quot; &quot;typed-=
 scheme&quot; &quot;ffi&quot;))<br>
 <br>
 Computer Language: ((&quot;Determine language from source&quot;) (#(#t prin=
 t mixed-fraction-e #f #t debug) (default) #() &quot;#lang racket\n&quot; #t=
  #t ((main) (test)) #t))<br>
 <br>
 </blockquote></div><br></div>
 </blockquote></div><br></div>
 </div></div></blockquote></div><br></div>
 </div></div></blockquote></div><br></div>
 
 --089e0112cf68b138b204e44ca3fa--

Responsible changed from "nobody" to "robby" by samth at Tue, 22 Oct 2013 19:54:47 -0400
Reason>>> .

