From nobody@cs.rice.edu  Mon Oct 19 17:42:23 1998
Received: from web.cs.rice.edu (web.cs.rice.edu [128.42.1.163])
	by cs.rice.edu (8.9.0/8.9.0) with ESMTP id RAA00115
	for <plt-gnats@cs.rice.edu>; Mon, 19 Oct 1998 17:42:23 -0500 (CDT)
Message-Id: <199810192242.RAA05137@web.cs.rice.edu>
Date: Mon, 19 Oct 1998 17:42:22 -0500 (CDT)
From: whoopee_foo_foo@brinckerhoff.org
Reply-To: whoopee_foo_foo@brinckerhoff.org
To: plt-gnats@cs.rice.edu
Subject: Crashing bug in MrSpidey/DrScheme 53 on the Mac 

>Number:         819
>Category:       mzscheme
>Synopsis:       Crashing bug in MrSpidey/DrScheme 53 on the Mac
>Confidential:   no
>Severity:       critical
>Priority:       high
>Responsible:    mflatt
>State:          closed
>Class:          sw-bug
>Submitter-Id:   unknown
>Arrival-Date:   Mon Oct 19 22:45:02 GMT 1998
>Last-Modified:  Thu Apr  8 09:01:45 CDT 1999
>Originator:     John Clements
>Organization:
titan
>Release:        
>Environment:
Mac PowerPC
>Description:
MrSpidey/DrScheme crashes when I perform the series of steps listed in the
next box.  I will include here the report generated by the 'StdLog' feature
of Macsbug; please note that in the stack traces, the most recent frames
are at the _bottom_ of the list.  This confused the heck out of me.

  MacsBug 6.5.4a4, Copyright Apple Computer, Inc. 1981-98
  
PowerPC access exception at 00264900 NQDEmptyRgn+00024
 
  19-Oct-1998 5:09:50 PM (since boot = 1 day, 49 minutes)
  Current application is “MrEd PPC”
  Machine = 312 (??), System $0810, sysu = $01008000
  ROM version $077D, $41F5, $0002 (ROMBase $FFC00000)
  VM is on; paging is currently safe
  NIL^ = $FFC10000
  Stack space used = +126230210
 Address 00264900 is in the System heap at 00002800 at NQDEmptyRgn+00024
 The address is in a CFM fragment “NQD” [non-write exec]
 It is 0000E000 bytes from the start of the fragment
 It is 0000E000 bytes into this heap block:
     Start    Length      Tag  Mstr Ptr Lock Prg  Type   ID   File      Name
  • 00256900 00037640+04   R   00002A8C   L       
 PowerPC 740/750 Registers
                         CR0  CR1  CR2  CR3  CR4  CR5  CR6  CR7
  PC  = 00264900     CR  0100 1010 0000 0000 0000 1000 0100 0000
  LR  = 00263994         <>=O XEVO
  CTR = 00264E30
  MSR = 00000000         SOC Compare Count
  Int = 0            XER 000   00     00
  
  R0  = 00000000     R8  = 00000001      R16 = 049BD000      R24 = 00000000
  SP  = 07471280     R9  = 00000000      R17 = 0535FE20      R25 = 00000000
  TOC = 002F3F3C     R10 = 00000000      R18 = 00000000      R26 = 063A6420
  R3  = 00000001     R11 = 002F5490      R19 = 00000000      R27 = 0440BD80
  R4  = C1000000     R12 = 4A000840      R20 = 05396FE0      R28 = 00000100
  R5  = 00000000     R13 = 043E71E0      R21 = 043A6F88      R29 = 00000001
  R6  = 04913BB8     R14 = FFFFFFFF      R22 = 043E7018      R30 = 04913BB8
  R7  = 04913BB8     R15 = 043E7158      R23 = 043E6F38      R31 = 00000004
 Disassembling PowerPC code from 002648D8
  NQDRectRgn
     +00054 002648D8   blr                                                | 4E800020
  NQDEmptyRgn
     +00000 002648DC   cmpwi      r3,0x0000                               | 2C030000
     +00004 002648E0   li         r0,0x0000                               | 38000000
     +00008 002648E4   sth        r0,0x0D6E(0)                            | B0000D6E
     +0000C 002648E8   li         r4,-0x02C1                              | 3880FD3F
     +00010 002648EC   bne        NQDEmptyRgn+00020          ; 0x002648FC | 40820010
     +00014 002648F0   sth        r4,0x0D6E(0)                            | B0800D6E
     +00018 002648F4   li         r3,0x0001                               | 38600001
     +0001C 002648F8   b          NQDEmptyRgn+0004C          ; 0x00264928 | 48000030
     +00020 002648FC   lwz        r4,0x0000(r3)                           | 80830000
     +00024 00264900  *lha        r3,0x0002(r4)                           | A8640002
     +00028 00264904   lha        r5,0x0006(r4)                           | A8A40006
     +0002C 00264908   cmpw       r3,r5                                   | 7C032800
     +00030 0026490C   bge        NQDEmptyRgn+00044          ; 0x00264920 | 40800014
     +00034 00264910   lha        r3,0x0008(r4)                           | A8640008
     +00038 00264914   lha        r4,0x0004(r4)                           | A8840004
     +0003C 00264918   cmpw       cr1,r4,r3                               | 7C841800
     +00040 0026491C   blt        cr1,NQDEmptyRgn+00048      ; 0x00264924 | 41840008
     +00044 00264920   li         r0,0x0001                               | 38000001
 Heap zones
  #1  Mod       10447K  00002800 to 00A364FF  SysZone^
  #2  Mod           7K    0000C590 to 0000E45F  ROM read-only zone
  #3  Mod          48K    00039D40 to 00045D3F
  #4  Mod         256K    0068A110 to 006CA10F
  #5  Mod      118444K  00A36500 to 07DE181F  Process Manager zone
  #6  Mod       49531K    04392FB0 to 073F1EAF  “MrEd PPC”  ApplZone^  TheZone^  TargetZone
  #7  Mod          16K    07471FC0 to 0747615F
  #8  Mod          32K    07B9D200 to 07BA54AF
  #9  Mod          10K    07C74910 to 07C7722F
  #10 Mod         896K    07CA55E0 to 07D858DF  “Finder”
  #11 Mod         187K    07D96160 to 07DC4E9F  “NotifyMail”
Checking all heaps
 The System heap at 00002800 is ok
 The ROM read-only heap at 0000C590 is ok
 The heap at 00039D40 is ok
 The heap at 0068A110 is ok
 The Process Manager heap at 00A36500 is ok
 The “MrEd PPC” heap at 04392FB0 is ok
 Totaling the “MrEd PPC” heap at 04392FB0
                                 Total Blocks    Total of Block Sizes
  Free                           0048      #72   00D2B290    #13808272
  Nonrelocatable                 006D     #109   02151EFC    #34938620
  Relocatable                    03F7    #1015   001E1D30     #1973552
    Locked                       000B      #11   00000580        #1408
    Purgeable and not locked     0000       #0   00000000           #0
  Heap size                      04AC    #1196   0305EEBC    #50720444
 The target heap is the System heap at 00002800
 Totaling the System heap at 00002800
                                 Total Blocks    Total of Block Sizes
  Free                           0066     #102   0004E510      #320784
  Nonrelocatable                 0A70    #2672   00463EAC     #4603564
  Relocatable                    0E82    #3714   00581900     #5773568
    Locked                       019A     #410   00352660     #3483232
    Purgeable and not locked     0145     #325   00108A30     #1083952
  Heap size                      1958    #6488   00A33CBC    #10697916
 The target heap is the “MrEd PPC” heap at 04392FB0
 Displaying File Control Blocks
  fRef File                   Vol         Type Fl Fork     LEof
  0002 System                 Barbican    zsys dW rsrc #5936574
  0060 **** EXTENTS B-TREE    Barbican    •••• dw data #4194304
  00BE **** CATALOG B-TREE    Barbican    •••• dw data #16777216
  011C **** VOLUME BITMAP     Barbican    •••• dw data  #126976
  017A PowerBook G3 Series E… Barbican    gbly dW rsrc  #956726
  01D8 VM Storage             Barbican    ZSYS dW data #134217728
  1492 PowerBook G3 Series E… Barbican    gbly dw data  #581244
  14F0 Open Tpt AppleTalk Li… Barbican    libr dw rsrc  #541754
  154E Open Transport Library Barbican    libr dw rsrc  #587352
  15AC OpenTransportLib       Barbican    shlb dw data  #563840
  160A Shared Library Manage… Barbican    INIT dw rsrc  #211694
  1668 Open Transport Library Barbican    libr dw rsrc  #587352
  16C6 IrLanScannerPPC        Barbican    libr dw rsrc    #6674
  1724 IrDALib                Barbican    shlb dw data  #234998
  1782 OpenTptAppleTalkLib    Barbican    shlb dw data   #54706
  17E0 OpenTptInternetLib     Barbican    shlb dw data  #275054
  183E Open Tpt AppleTalk Li… Barbican    libr dw rsrc  #541754
  189C Open Tpt Internet Lib… Barbican    libr dw rsrc  #485155
  18FA OpenTpt Remote Access  Barbican    libr dw rsrc  #541432
  1958 OpenTpt Modem          Barbican    libr dw rsrc   #85766
  19B6 OpenTpt Remote Access  Barbican    libr dw rsrc  #541432
  1A14 Remote Access Log      Barbican    lzlg dW data  #524288
  1A72 Open Transport Library Barbican    libr dw rsrc  #587352
  1AD0 Serial (Built-in)      Barbican    libr dw rsrc   #63254
  1B2E OpenTpt Serial Arbitr… Barbican    libr dw rsrc    #7638
  1B8C OpenTpt Serial Arbitr… Barbican    libr dw rsrc    #7638
  1BEA ATI Video Memory Mana… Barbican    shlb dw data   #18026
  1C48 Appearance Extension   Barbican    INIT dw rsrc  #633281
  1CA6 Appearance Extension   Barbican    INIT dw data  #121624
  1D04 Appearance Extension   Barbican    INIT dw rsrc  #633281
  1D62 Users & Groups Data F… Barbican    BTFL dW data   #65536
  1DC0 ColorSync™             Barbican    INIT dw data  #110576
  1E1E Contextual Menu Exten… Barbican    INIT dw data   #66103
  1E7C SOMobjects™ for Mac OS Barbican    shlb dw data  #128944
  1EDA QuickTime™             Barbican    INIT dw data  #369778
  1F38 Sound Manager          Barbican    INIT dw data   #15008
  1F96 Mac OS Easy Open       Barbican    cdev dw rsrc  #132666
  1FF4 QuickTime™ PowerPlug   Barbican    INIT dw data  #219218
  2052 Speech Manager         Barbican    INIT dw data    #4000
  20B0 ~ATM™                  Barbican    cdev dw data  #881790
  216C NotifyMail             Barbican    appe dW rsrc  #164664
  21CA Finder                 Barbican    FNDR dW rsrc  #502012
  2228 Finder                 Barbican    FNDR dw data #3631000
  2286 Apple Guide            Barbican    INIT dw data  #351914
  22E4 Color Picker           Barbican    INIT dw data    #6400
  2342 File Sharing Library   Barbican    shlb dw data   #91214
  23A0 Mac OS Easy Open       Barbican    cdev dw data    #8320
  23FE PrintingLib            Barbican    shlb dw data  #908576
  245C File Sharing Library   Barbican    shlb dw rsrc    #3483
  24BA Finder Preferences     Barbican    pref dW rsrc     #674
  2518 Desktop DB             Barbican    BTFL dW data  #393216
  2576 Desktop DF             Barbican    DTFL dW data #2720290
  25D4 NotifyMail             Barbican    appe dw data  #158393
  2632 AppleScriptLib         Barbican    shlb dw data   #22636
  2690 Open Tpt Internet Lib… Barbican    libr dw rsrc  #485155
  26EE MrEd PPC               Barbican    APPL dw data #2240410
  274C StdLog                 Barbican    TEXT dW data    #9023
  27AA MrEd PPC               Barbican    APPL dW rsrc   #17190
  #210 FCBs, #109 in use (including #51 fonts not listed), #101 free
 Displaying resource information:
  >   Map $04393138, flags $0000, file $27AA = MrEd PPC
   +  Map $0031B6CC, flags $001E, file $1C48 = Appearance Extension
   +  Map $000032E4, flags $001E, file $017A = PowerBook G3 Series Enabler
   +  Map $00003240, flags $801E, file $0003 = •ROM resources that override System•
    S Map $000032E0, flags $000D, file $0002 = System
      Map $00512AD4, flags $0000, file $1F96 = Mac OS Easy Open
      [Skipped $0033 maps belonging to font files]
 Calling chain using A6/R1 links
  Back chain  ISA  Caller
  00000000    PPC  08BFA908  try_dispatch(Scheme_Object*)+001E0
  07471A70    PPC  08D2D1A4  scheme_thread+00018
  07471A30    PPC  08D2D10C  make_subprocess+000B8
  074719D0    PPC  08D2CF88  start_child+00078
  07471980    PPC  08D022E0  scheme_apply_multi+00014
  07471940    PPC  08D02254  _apply+00034
  07471900    PPC  08D020D8  scheme_top_level_do+00298
  07471630    PPC  08D021DC  apply_k+00040
  074715F0    PPC  08CF86DC  scheme_do_eval+00638
  07471510    PPC  08BFA674  handle_events(void*, int, Scheme_Object**)+000B8
  074714B0    PPC  08BFA4BC  WaitJustALittleLonger(MrEdContext*)+000B8
  07471460    PPC  08BF9F34  DoTheEvent(MrEdContext*)+00070
  07471410    PPC  08BF9DB4  GoAhead(MrEdContext*)+00070
  074713C0    PPC  08BFDD3C  MrEdDispatchEvent(EventRecord*)+00090
  07471370    PPC  FFD6D2F8  UnionRgn+00024
  07471330    PPC  00264E58  NQDUnionRgn+00028
 Return addresses on the stack
  Stack Addr  Frame Addr   ISA   Caller
   07471638                PPC   08D020D8 scheme_top_level_do+00298
   074715F8    074715F0    PPC   08D021DC apply_k+00040
   074715B4                68K   0535FE1E
   07471518    07471510    PPC   08CF86DC scheme_do_eval+00638
   07471508                68K   0535FE1E
   07471500                68K   0535FE1E
   074714B8    074714B0    PPC   08BFA674 handle_events(void*, int, Scheme_Object**)+000B8
   07471468    07471460    PPC   08BFA4BC WaitJustALittleLonger(MrEdContext*)+000B8
   0747143C                68K   043E6F36
   07471428    07471420    PPC   08D050C0 scheme_get_milliseconds+0000C
   07471418    07471410    PPC   08BF9F34 DoTheEvent(MrEdContext*)+00070
   07471408                PPC   08D2E02C scheme_block_until+00058
   074713C8    074713C0    PPC   08BF9DB4 GoAhead(MrEdContext*)+00070
   074713AC                68K   043E6F36
   07471388    07471380    PPC   08D050C0 scheme_get_milliseconds+0000C
   07471378    07471370    PPC   08BFDD3C MrEdDispatchEvent(EventRecord*)+00090
   07471358    07471350    PPC   08D2E4E0 scheme_process_block+003FC
   07471338    07471330    PPC   FFD6D2F8 UnionRgn+00024
   07471318    07471310    PPC   08D2CDA4 scheme_swap_process+00050
   074712F8    074712F0    PPC   00264E58 NQDUnionRgn+00028
   074712D8    074712D0    PPC   08D3B02C scheme_reset_jmpup_buf+00060
   07471298    07471290    PPC   08D51604
 Displaying memory from 0
  00000000  FFC1 0000 0000 0000  0072 5EF6 0072 5EF8  •¡•••••••r^••r^•
  00000010  0072 5EFA 0072 5EFC  0065 588C 0065 588C  •r^••r^••eXå•eXå
 Closing log


>How-To-Repeat:
Let me describe how I got this to happen: I start up DrScheme 53 (with a 
huge memory partition of 50 meg).  I open a file.  I run MrSpidey. Then,
I close the MrSpidey report window.  Then I click on the original document
window (to hide the MrSpidey Progress Window). Then I crash horribly.


>Fix:

>Audit-Trail:

Responsible-Changed-From-To: steck->mflatt
Responsible-Changed-By: mflatt
Responsible-Changed-When: Fri Dec 11 19:55:51 1998
Responsible-Changed-Why:

State-Changed-From-To: open-closed
State-Changed-By: mflatt
State-Changed-When: Thu Apr  8 09:01:37 1999
State-Changed-Why:
100 fixed

>Unformatted:

This is reproducible on Cupertino.
