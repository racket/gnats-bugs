From bugs+caf_=bugs=bugs.plt-scheme.org@plt-scheme.org Fri Jan 29 01:05:40 2010
Received: from mail-yw0-f176.google.com (mail-yw0-f176.google.com [209.85.211.176])
	by champlain.ccs.neu.edu (8.14.3/8.14.3) with ESMTP id o0T65cgR009004
	for <bugs@bugs.plt-scheme.org>; Fri, 29 Jan 2010 01:05:38 -0500
Message-Id: <201001290605.o0T65XO1008995@champlain.ccs.neu.edu>
Date: Fri, 29 Jan 2010 01:05:33 -0500
From: jamessan@debian.org
To: bugs@plt-scheme.org
Subject: Segfault during build on ia64

>Number:         10723
>Category:       mzscheme
>Synopsis:       Segfault during build on ia64
>Class:          sw-bug
>Responsible:    mflatt
>Severity:       serious
>Priority:       medium
>State:          closed
>Confidential:   no
>Arrival-Date:   Fri Jan 29 01:08:01 -0500 2010
>Closed-Date:    Mon Jan 17 19:44:55 -0500 2011
>Last-Modified:  Mon Jan 17 19:44:55 -0500 2011
>Originator:     James Vega
>Organization:
plt
>Submitter-Id:   unknown
>Release:        4.2.4
>Environment:
linux-ubuntu
>Description:
I'm seeing the following segfault building on an ia64 system running Debian.  Similar crashes have been happening for a while, as can be seen at <https://buildd.debian.org/build.cgi?arch=ia64&pkg=plt-scheme>.

cd gc2; /usr/bin/make all
make[4]: Entering directory `/home/jamessan/plt-scheme-4.2.4/build/mzscheme/gc2'
/usr/bin/make xsrc/precomp.h
make[5]: Entering directory `/home/jamessan/plt-scheme-4.2.4/build/mzscheme/gc2'
env XFORM_PRECOMP=yes ../mzschemecgc -cqu /home/jamessan/plt-scheme-4.2.4/src/mzscheme/gc2/xform.ss --setup . --cpp "gcc -E -I./.. -I/home/jamessan/plt-scheme-4.2.4/src/mzscheme/gc2/../include -DNEWGC_BTC_ACCOUNT  "  --keep-lines -o xsrc/precomp.h /home/jamessan/plt-scheme-4.2.4/src/mzscheme/gc2/precomp.c
GC Warning: GC_register_stackbottom should be set with GC_stackbottom
Removing old xform-collects tree...
Copying tree...
Copying /home/jamessan/plt-scheme-4.2.4/src/mzscheme/gc2/./xform-mod.ss to xform-collects/xform/xform-mod.ss
Copying /home/jamessan/plt-scheme-4.2.4/collects/scheme/mzscheme.ss to /home/jamessan/plt-scheme-4.2.4/build/mzscheme/gc2/xform-collects/scheme/mzscheme.ss
...
Copying /home/jamessan/plt-scheme-4.2.4/collects/scheme/lang/reader.ss to /home/jamessan/plt-scheme-4.2.4/build/mzscheme/gc2/xform-collects/scheme/lang/reader.ss
Compiling xform support...
Segmentation fault (core dumped)
make[5]: *** [xsrc/precomp.h] Error 139
make[5]: Leaving directory `/home/jamessan/plt-scheme-4.2.4/build/mzscheme/gc2'
make[4]: *** [all] Error 2
make[4]: Leaving directory `/home/jamessan/plt-scheme-4.2.4/build/mzscheme/gc2'
make[3]: *** [3m] Error 2
make[3]: Leaving directory `/home/jamessan/plt-scheme-4.2.4/build/mzscheme'
make[2]: *** [3m] Error 2
make[2]: Leaving directory `/home/jamessan/plt-scheme-4.2.4/build'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/home/jamessan/plt-scheme-4.2.4/build'
make: *** [debian/stamp-makefile-build] Error 2


Core was generated by `../mzschemecgc -cqu /home/jamessan/plt-scheme-4.2.4/src/mzscheme/gc2/xform.ss -'.
Program terminated with signal 11, Segmentation fault.
#0  0x400000000034e151 in scheme_setjmpup_relative (b=Cannot access memory at address 0xffffffffffffffe2
) at /home/jamessan/plt-scheme-4.2.4/src/mzscheme/src/setjmpup.c:503
503       if (!(local = scheme_setjmp(b->buf))) {
(gdb) l 490
485     #else
486     # define ALIGN_VAR_STACK(vs, s) /* empty */
487     # define PAST_VAR_STACK(s) /* empty */
488     # define PAST_VAR_STACK_DELTA(s, d) /* empty */
489     #endif
490
491     int scheme_setjmpup_relative(Scheme_Jumpup_Buf *b, void *base,
492                                  void * volatile start, struct Scheme_Cont *c)
493     {
494       int local;
(gdb) l
495       long disguised_b;
496
497     #ifdef MZ_USE_JIT
498       scheme_flush_stack_cache();
499     #endif
500
501       FLUSH_REGISTER_WINDOWS;
502
503       if (!(local = scheme_setjmp(b->buf))) {
504         if (c) {
(gdb) bt
#0  0x400000000034e151 in scheme_setjmpup_relative (b=Cannot access memory at address 0xffffffffffffffe2
) at /home/jamessan/plt-scheme-4.2.4/src/mzscheme/src/setjmpup.c:503
#1  0x60000fffff9ad9b0 in ?? ()
#2  0x400000000034e150 in scheme_setjmpup_relative (b=0x0, base=0x0, start=0x0, c=0x0) at /home/jamessan/plt-scheme-4.2.4/src/mzscheme/src/setjmpup.c:503
#3  0x60000fffff9b0ed0 in ?? ()
#4  0x0000000000000000 in ?? ()
>How-To-Repeat:
>Fix:
>Audit-Trail:
From: Matthew Flatt <mflatt@cs.utah.edu>
To: jamessan@debian.org, bugs@plt-scheme.org
Cc: nobody@plt-scheme.org, bug-notification@plt-scheme.org
Subject: Re: [plt-bug] all/10723: Segfault during build on ia64
Date: Fri, 29 Jan 2010 04:19:41 -0700

 At Fri, 29 Jan 2010 01:08:02 -0500, jamessan@debian.org wrote:
 > I'm seeing the following segfault building on an ia64 system running Debian.  
 
 IA64 isn't currently supported. I expect the problem has to do with the
 IA64's register stack and they way that continuations and stack
 overflow are handled in MzScheme. (I'm not sure how difficult it would
 be to fix; I've never tried.)
 
From: James Vega <jamessan@debian.org>
To: Matthew Flatt <mflatt@cs.utah.edu>
Cc: bugs@plt-scheme.org, nobody@plt-scheme.org,
        bug-notification@plt-scheme.org
Subject: Re: [plt-bug] all/10723: Segfault during build on ia64
Date: Fri, 29 Jan 2010 08:25:36 -0500

 On Fri, Jan 29, 2010 at 04:19:41AM -0700, Matthew Flatt wrote:
 > At Fri, 29 Jan 2010 01:08:02 -0500, jamessan@debian.org wrote:
 > > I'm seeing the following segfault building on an ia64 system running Debian.  
 > 
 > IA64 isn't currently supported.
 
 Ah.  I saw IA64-related code in the source, so I figured it was.  Is
 src/README the definitive guide for what architectures are supportd?
 That will be helpful when I take a look at the various archs in Debian
 where plt-scheme fails to build (c.f., #10677 (hppa) and #10678
 (alpha)).
 
 -- 
 James
 GPG Key: 1024D/61326D40 2003-09-02 James Vega <jamessan@debian.org>
From: Matthew Flatt <mflatt@cs.utah.edu>
To: James Vega <jamessan@debian.org>
Cc: bugs@plt-scheme.org, nobody@plt-scheme.org,
        bug-notification@plt-scheme.org
Subject: Re: [plt-bug] all/10723: Segfault during build on ia64
Date: Fri, 29 Jan 2010 13:09:02 -0700

 At Fri, 29 Jan 2010 08:25:36 -0500, James Vega wrote:
 > Ah.  I saw IA64-related code in the source, so I figured it was.  Is
 > src/README the definitive guide for what architectures are supportd?
 
 Long forgotten, so let's fix it. I've pruned the list to platforms that
 I think someone has tried recently. 
 
 Do you know any that I should add?
 
 > That will be helpful when I take a look at the various archs in Debian
 > where plt-scheme fails to build (c.f., #10677 (hppa) and #10678
 > (alpha)).
 
 Sorry for not getting back to you on those. I'm not surprised that they
 no longer build or don't work with 3m. Is it worth spending effort on
 them, so should we just declare them to be unsupported?
 
From: James Vega <jamessan@debian.org>
To: Matthew Flatt <mflatt@cs.utah.edu>
Cc: bugs@plt-scheme.org, nobody@plt-scheme.org,
        bug-notification@plt-scheme.org
Subject: Re: [plt-bug] all/10723: Segfault during build on ia64
Date: Fri, 29 Jan 2010 15:56:12 -0500

 On Fri, Jan 29, 2010 at 3:09 PM, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > At Fri, 29 Jan 2010 08:25:36 -0500, James Vega wrote:
 >> Ah. =C2=A0I saw IA64-related code in the source, so I figured it was. =
 =C2=A0Is
 >> src/README the definitive guide for what architectures are supportd?
 >
 > Long forgotten, so let's fix it. I've pruned the list to platforms that
 > I think someone has tried recently.
 
 Thanks.
 
 > Do you know any that I should add?
 
 Simply from a "Does plt-scheme build?" perspective, I know that 4.2.1
 was successful on armel, x86, mips/mipsel, ppc, s390, and sparc.  The
 problem archs are alpha, hppa, ia64, and kfreebsd (gnu userland on a
 FreeBSD kernel) on x86/amd64.  For kfreebsd, I'd expect that to just
 need a few small tweaks to get working since plt-scheme already runs on
 Freebsd.
 
 I'll be uploading 4.2.4 in the next few days, so I can report back on
 whether there are any changes in the above.  I don't think it's likely
 to change too much, though.
 
 >> That will be helpful when I take a look at the various archs in Debian
 >> where plt-scheme fails to build (c.f., #10677 (hppa) and #10678
 >> (alpha)).
 >
 > Sorry for not getting back to you on those. I'm not surprised that they
 > no longer build or don't work with 3m. Is it worth spending effort on
 > them, so should we just declare them to be unsupported?
 
 From my perspective (working with Debian), it'd be ideal to have all the
 archs supported.  I understand, though, that your time spent trying to
 reach that goal is likely better spent elsewhere, especially given how
 few people probably use plt-scheme on our less mainstream archs.
 
 Would it be worthwhile for me to see where using cgc/sgc instead of 3m
 would be beneficial and/or seeing if I can provide patches to fix
 plt-scheme on the archs that aren't officially supported?  If I just
 need to switch the build to use cgc/sgc on some archs instead of 3m, I'm
 fine with that too.
 
 Thanks,
 
 --=20
 James
 GPG Key: 1024D/61326D40 2003-09-02 James Vega <jamessan@debian.org>



State changed from "open" to "closed" by eli at Mon, 17 Jan 2011 19:44:55 -0500
Reason>>> closed as "obsolete" with respect to v5.0.99.6 and later;
either the bug is long-since fixed, the relevant code
doesn't exist anymore, the relevant platform hasn't been
supported recently, or a new bug report is needed if the
problem really isn't fixed and someone actually cares

