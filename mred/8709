From bugs+caf_=bugs=bugs.plt-scheme.org@plt-scheme.org Wed May 30 12:05:13 2007
Received: from wr-out-0506.google.com (wr-out-0506.google.com [64.233.184.238])
	by champlain.ccs.neu.edu (8.13.8/8.13.7) with ESMTP id l4UG5DqO003034
	for <bugs@bugs.plt-scheme.org>; Wed, 30 May 2007 12:05:13 -0400
Message-Id: <200705301605.l4UG5AoW003029@champlain.ccs.neu.edu>
Date: Wed, 30 May 2007 12:05:10 -0400
From: jadudm@gmail.com
To: bugs@plt-scheme.org
Subject: Help Desk goes wild-crazy!

>Number:         8709
>Category:       mred
>Synopsis:       Help Desk goes wild-crazy!
>Class:          sw-bug
>Responsible:    mflatt
>Severity:       serious
>Priority:       medium
>State:          closed
>Confidential:   no
>Arrival-Date:   Wed May 30 12:10:01 -0400 2007
>Closed-Date:    Wed Jul 25 14:53:18 -0400 2007
>Last-Modified:  Wed Jul 25 14:53:18 -0400 2007
>Originator:     Matt Jadud
>Organization:
plt
>Submitter-Id:   unknown
>Release:        370
>Environment:
macosx "Darwin dhcp108e.kent.ac.uk 8.9.1 Darwin Kernel Version 8.9.1: Thu Feb 22 20:55:00 PST 2007; root:xnu-792.18.15~1/RELEASE_I386 i386 i386" (i386-macosx/3m) (get-display-depth) = 32
Docs Installed:
(("/Users/jadudm/apps/PLT Scheme v370/doc" "r5rs" "mzscheme" "mred" "help" "tour" "drscheme" "srfi" "mzlib" "misclib" "mrlib" "framework" "foreign" "mzc" "tools" "insidemz" "web-server" "swindle" "plot" "release-notes" "t-y-scheme" "tex2page" "beginning" "beginning-abbr" "intermediate" "intermediate-lambda" "advanced" "teachpack" "teachpack-htdc" "profj-beginner" "profj-intermediate" "profj-advanced"))
Human Language: english
(current-memory-use) 70480788

Collections:
(("/Users/jadudm/Library/PLT Scheme/370/collects" non-existent-path) ("/Users/jadudm/apps/PLT Scheme v370/collects" "afm" "algol60" "browser" "compiler" "config" "defaults" "drscheme" "dynext" "embedded-gui" "eopl" "errortrace" "ffi" "framework" "frtime" "games" "graphics" "help" "hierlist" "htdch" "htdp" "html" "icons" "info-domain" "lang" "launcher" "lazy" "macro-debugger" "make" "mred" "mrlib" "mzlib" "mzscheme" "mztake" "net" "openssl" "parser-tools" "planet" "plot" "preprocessor" "profj" "profjWizard" "r5rs" "readline" "setup" "sgl" "slatex" "slideshow" "srfi" "stepper" "string-constants" "swindle" "syntax" "syntax-color" "teachpack" "tex2page" "texpict" "trace" "version" "web-server" "wxme" "xml"))
Computer Language: (("Professional Languages" "(module ...)") (#6(#t write mixed-fraction-e #f #t debug) (default) #0()))
>Description:
When left unsupervised, the Help Desk behaves in unbecoming ways.

In particular, if I launch the Help Desk in a stand-alone configuration, and let it sit in the background, something spins. Badly. Aggressively. And on my MacBook, it clobbers the CPU, consuming 150%+ CPU (according to Activity Monitor). 

This seems bad.
>How-To-Repeat:
Launch Help Desk on a Mac (recent OSX 10.4, v370 Help Desk). Put it in the background. Play Desktop Tower Defense, or some other Flash-based game on the web. Wait for the fan to kick in. 

I believe it is reproducable. I saw this with 369.100, but didn't realize what was happening the first time. I can provide more information if this is a new/unknown thing.
>Fix:
>Audit-Trail:
From: "Robby Findler" <robby@cs.uchicago.edu>
To: jadudm@gmail.com, bugs@plt-scheme.org
Cc: nobody@plt-scheme.org, eli@plt-scheme.org, matthias@plt-scheme.org,
        sk@plt-scheme.org, mflatt@plt-scheme.org, clements@plt-scheme.org,
        jay@plt-scheme.org, meunier@plt-scheme.org, sowens@plt-scheme.org,
        kathyg@plt-scheme.org, awick@plt-scheme.org, jacobm@plt-scheme.org,
        cce@plt-scheme.org, dalev@plt-scheme.org, samth@plt-scheme.org,
        ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Wed, 30 May 2007 11:58:13 -0500

 I don't suppose this could be the web server?
 
 Robby
From: "Jay McCarthy" <jay.mccarthy@gmail.com>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: jadudm@gmail.com, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Wed, 30 May 2007 10:15:50 -0700

 I ran the test and didn't get the same behavior.
 
 Matt, did you use the Help Desk in anyway, or just start it? I tried
 leaving it on. And then I tried doing a search and then leaving it on.
 
 Jay
 
 On 5/30/07, Robby Findler <robby@cs.uchicago.edu> wrote:
 > I don't suppose this could be the web server?
 >
 > Robby
 >
 
 
 -- 
 Jay McCarthy <jay.mccarthy@gmail.com>
 http://jay.teammccarthy.org
From: "Matt Jadud" <jadudm@gmail.com>
To: "Jay McCarthy" <jay.mccarthy@gmail.com>
Cc: "Robby Findler" <robby@cs.uchicago.edu>, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Wed, 30 May 2007 19:16:55 +0100

 Hi Jay,
 
 The best I can do is give you a quick screen-cap movie of what I'm
 doing to get this behavior.
 
 curl -O http://www.jadud.com/people/mcj/files/help-desk-behavior.mov
 
 When it is in the foreground, it's happy. When it's in the background,
 it's not. If I can do anything else to help you, that would be great.
 
 Cheers,
 Matt
 
 On 5/30/07, Jay McCarthy <jay.mccarthy@gmail.com> wrote:
 > I ran the test and didn't get the same behavior.
 >
 > Matt, did you use the Help Desk in anyway, or just start it? I tried
 > leaving it on. And then I tried doing a search and then leaving it on.
 >
 > Jay
 >
 > On 5/30/07, Robby Findler <robby@cs.uchicago.edu> wrote:
 > > I don't suppose this could be the web server?
 > >
 > > Robby
 > >
 >
 >
 > --
 > Jay McCarthy <jay.mccarthy@gmail.com>
 > http://jay.teammccarthy.org
 >
From: "Jay McCarthy" <jay.mccarthy@gmail.com>
To: "Matt Jadud" <jadudm@gmail.com>
Cc: "Robby Findler" <robby@cs.uchicago.edu>, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Wed, 30 May 2007 11:24:46 -0700

 Thanks for the movie. That's a good bug reporting methodology.
 
 So, I did that too and it works fine, at least on my OS X (10.4.9)
 with SVN. Can you say if it happens with SVN?
 
 Jay
 
 On 5/30/07, Matt Jadud <jadudm@gmail.com> wrote:
 > Hi Jay,
 >
 > The best I can do is give you a quick screen-cap movie of what I'm
 > doing to get this behavior.
 >
 > curl -O http://www.jadud.com/people/mcj/files/help-desk-behavior.mov
 >
 > When it is in the foreground, it's happy. When it's in the background,
 > it's not. If I can do anything else to help you, that would be great.
 >
 > Cheers,
 > Matt
 >
 > On 5/30/07, Jay McCarthy <jay.mccarthy@gmail.com> wrote:
 > > I ran the test and didn't get the same behavior.
 > >
 > > Matt, did you use the Help Desk in anyway, or just start it? I tried
 > > leaving it on. And then I tried doing a search and then leaving it on.
 > >
 > > Jay
 > >
 > > On 5/30/07, Robby Findler <robby@cs.uchicago.edu> wrote:
 > > > I don't suppose this could be the web server?
 > > >
 > > > Robby
 > > >
 > >
 > >
 > > --
 > > Jay McCarthy <jay.mccarthy@gmail.com>
 > > http://jay.teammccarthy.org
 > >
 >
 
 
 -- 
 Jay McCarthy <jay.mccarthy@gmail.com>
 http://jay.teammccarthy.org
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Jay McCarthy" <jay.mccarthy@gmail.com>
Cc: "Matt Jadud" <jadudm@gmail.com>, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Wed, 30 May 2007 13:28:28 -0500

 I was using the latest svn and it happens easily.
 
 On 5/30/07, Jay McCarthy <jay.mccarthy@gmail.com> wrote:
 > Thanks for the movie. That's a good bug reporting methodology.
 >
 > So, I did that too and it works fine, at least on my OS X (10.4.9)
 > with SVN. Can you say if it happens with SVN?
 >
 > Jay
 >
 > On 5/30/07, Matt Jadud <jadudm@gmail.com> wrote:
 > > Hi Jay,
 > >
 > > The best I can do is give you a quick screen-cap movie of what I'm
 > > doing to get this behavior.
 > >
 > > curl -O http://www.jadud.com/people/mcj/files/help-desk-behavior.mov
 > >
 > > When it is in the foreground, it's happy. When it's in the background,
 > > it's not. If I can do anything else to help you, that would be great.
 > >
 > > Cheers,
 > > Matt
 > >
 > > On 5/30/07, Jay McCarthy <jay.mccarthy@gmail.com> wrote:
 > > > I ran the test and didn't get the same behavior.
 > > >
 > > > Matt, did you use the Help Desk in anyway, or just start it? I tried
 > > > leaving it on. And then I tried doing a search and then leaving it on.
 > > >
 > > > Jay
 > > >
 > > > On 5/30/07, Robby Findler <robby@cs.uchicago.edu> wrote:
 > > > > I don't suppose this could be the web server?
 > > > >
 > > > > Robby
 > > > >
 > > >
 > > >
 > > > --
 > > > Jay McCarthy <jay.mccarthy@gmail.com>
 > > > http://jay.teammccarthy.org
 > > >
 > >
 >
 >
 > --
 > Jay McCarthy <jay.mccarthy@gmail.com>
 > http://jay.teammccarthy.org
 >
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Jay McCarthy" <jay.mccarthy@gmail.com>
Cc: jadudm@gmail.com, bugs@plt-scheme.org,
        "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Wed, 30 May 2007 13:27:06 -0500

 Are you using a mac?
 
 For me, it takes over the CPU when Help Desk is in the background, so
 maybe it is unrelated to the web server.
 
 I tried putting printfs in all of the on-activate calls in the
 framework; none of them seem to be the issue. There don't seem to be
 any other relevant on-activate calls, except possibly in mred itself.
 
 I also tried this experiment.
 
 = I started up mred, created a new eventspace, and queue'd a callback
 to that eventspace to run help desk.
 
 = Moved mred to the background, cpu spiked.
 
 = Moved mred to the foreground, cpu back to normal.
 
 = Put (begin (sleep 10) (break-thread t)) where t is bound to the
 eventspace's handler thread (from the help desk eventspace), and put
 mred in the background. The cpu did not spike.
 
 Also, the CPU seems to be taking over more than 1 processor, which
 seems quite strange.
 
 Robby
 
 On 5/30/07, Jay McCarthy <jay.mccarthy@gmail.com> wrote:
 > I ran the test and didn't get the same behavior.
 >
 > Matt, did you use the Help Desk in anyway, or just start it? I tried
 > leaving it on. And then I tried doing a search and then leaving it on.
 >
 > Jay
 >
 > On 5/30/07, Robby Findler <robby@cs.uchicago.edu> wrote:
 > > I don't suppose this could be the web server?
 > >
 > > Robby
 > >
 >
 >
 > --
 > Jay McCarthy <jay.mccarthy@gmail.com>
 > http://jay.teammccarthy.org
 >
From: Matthew Flatt <mflatt@cs.utah.edu>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: "Jay McCarthy" <jay.mccarthy@gmail.com>, jadudm@gmail.com,
        bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Thu, 31 May 2007 13:16:46 +0800

 At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > For me, it takes over the CPU when Help Desk is in the background, so
 > maybe it is unrelated to the web server.
 
 Did you have to do anything remotely special? When I start Help Desk,
 and then bring Terminal back to the foreground, Help Desk doesn't start
 CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 under Mac OS X.
 
 > Also, the CPU seems to be taking over more than 1 processor, which
 > seems quite strange.
 
 When MrEd sleeps, it uses an OS-level thread to help it wake up. So if
 something is wrong in the sleep code, it could easily keep both threads
 spinning on both processors.
 
 Matthew
 
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Matthew Flatt" <mflatt@cs.utah.edu>
Cc: "Jay McCarthy" <jay.mccarthy@gmail.com>, jadudm@gmail.com,
        bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Thu, 31 May 2007 04:30:14 -0500

 Nothing remotely special, no. I started help desk from the command
 line and went back to the terminal and voila, off to the races. It was
 very reproducible for me. (I didn't do a clean build last time, tho.)
 
 Robby
 
 On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > For me, it takes over the CPU when Help Desk is in the background, so
 > > maybe it is unrelated to the web server.
 >
 > Did you have to do anything remotely special? When I start Help Desk,
 > and then bring Terminal back to the foreground, Help Desk doesn't start
 > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > under Mac OS X.
 >
 > > Also, the CPU seems to be taking over more than 1 processor, which
 > > seems quite strange.
 >
 > When MrEd sleeps, it uses an OS-level thread to help it wake up. So if
 > something is wrong in the sleep code, it could easily keep both threads
 > spinning on both processors.
 >
 > Matthew
 >
 >
From: Matthew Flatt <mflatt@cs.utah.edu>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: "Jay McCarthy" <jay.mccarthy@gmail.com>, jadudm@gmail.com,
        bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Fri, 1 Jun 2007 08:11:03 +0800

 I see this when I run v370 or the v370.2 installer from Wednesday, but
 not my latest build.
 
 It would make sense if the change I made for
 
  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 
 fixed the Help Desk bug, too, but unwinding that change doesn't bring
 back the bad behavior.
 
 So I'm stumped for the moment, but I'll keep looking into it. Maybe the
 next nightly build will give me a clue.
 
 Matthew
 
 At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > Nothing remotely special, no. I started help desk from the command
 > line and went back to the terminal and voila, off to the races. It was
 > very reproducible for me. (I didn't do a clean build last time, tho.)
 > 
 > Robby
 > 
 > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > For me, it takes over the CPU when Help Desk is in the background, so
 > > > maybe it is unrelated to the web server.
 > >
 > > Did you have to do anything remotely special? When I start Help Desk,
 > > and then bring Terminal back to the foreground, Help Desk doesn't start
 > > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > > under Mac OS X.
 > >
 > > > Also, the CPU seems to be taking over more than 1 processor, which
 > > > seems quite strange.
 > >
 > > When MrEd sleeps, it uses an OS-level thread to help it wake up. So if
 > > something is wrong in the sleep code, it could easily keep both threads
 > > spinning on both processors.
 > >
 > > Matthew
 > >
 > >
From: Matthew Flatt <mflatt@cs.utah.edu>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: "Jay McCarthy" <jay.mccarthy@gmail.com>, jadudm@gmail.com,
        bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Fri, 1 Jun 2007 09:35:26 +0800

 Yes.
 
 At Thu, 31 May 2007 20:35:15 -0500, "Robby Findler" wrote:
 > Does your build match the svn build?
 > 
 > Robby
 > 
 > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > I see this when I run v370 or the v370.2 installer from Wednesday, but
 > > not my latest build.
 > >
 > > It would make sense if the change I made for
 > >
 > >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 > >
 > > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > > back the bad behavior.
 > >
 > > So I'm stumped for the moment, but I'll keep looking into it. Maybe the
 > > next nightly build will give me a clue.
 > >
 > > Matthew
 > >
 > > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > > Nothing remotely special, no. I started help desk from the command
 > > > line and went back to the terminal and voila, off to the races. It was
 > > > very reproducible for me. (I didn't do a clean build last time, tho.)
 > > >
 > > > Robby
 > > >
 > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > > For me, it takes over the CPU when Help Desk is in the background, so
 > > > > > maybe it is unrelated to the web server.
 > > > >
 > > > > Did you have to do anything remotely special? When I start Help Desk,
 > > > > and then bring Terminal back to the foreground, Help Desk doesn't start
 > > > > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > > > > under Mac OS X.
 > > > >
 > > > > > Also, the CPU seems to be taking over more than 1 processor, which
 > > > > > seems quite strange.
 > > > >
 > > > > When MrEd sleeps, it uses an OS-level thread to help it wake up. So if
 > > > > something is wrong in the sleep code, it could easily keep both threads
 > > > > spinning on both processors.
 > > > >
 > > > > Matthew
 > > > >
 > > > >
 > >
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Matthew Flatt" <mflatt@cs.utah.edu>
Cc: "Jay McCarthy" <jay.mccarthy@gmail.com>, jadudm@gmail.com,
        bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Thu, 31 May 2007 20:35:15 -0500

 Does your build match the svn build?
 
 Robby
 
 On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > I see this when I run v370 or the v370.2 installer from Wednesday, but
 > not my latest build.
 >
 > It would make sense if the change I made for
 >
 >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 >
 > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > back the bad behavior.
 >
 > So I'm stumped for the moment, but I'll keep looking into it. Maybe the
 > next nightly build will give me a clue.
 >
 > Matthew
 >
 > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > Nothing remotely special, no. I started help desk from the command
 > > line and went back to the terminal and voila, off to the races. It was
 > > very reproducible for me. (I didn't do a clean build last time, tho.)
 > >
 > > Robby
 > >
 > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > For me, it takes over the CPU when Help Desk is in the background, so
 > > > > maybe it is unrelated to the web server.
 > > >
 > > > Did you have to do anything remotely special? When I start Help Desk,
 > > > and then bring Terminal back to the foreground, Help Desk doesn't start
 > > > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > > > under Mac OS X.
 > > >
 > > > > Also, the CPU seems to be taking over more than 1 processor, which
 > > > > seems quite strange.
 > > >
 > > > When MrEd sleeps, it uses an OS-level thread to help it wake up. So if
 > > > something is wrong in the sleep code, it could easily keep both threads
 > > > spinning on both processors.
 > > >
 > > > Matthew
 > > >
 > > >
 >
From: Matthew Flatt <mflatt@cs.utah.edu>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: jadudm@gmail.com, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Tue, 5 Jun 2007 09:02:07 +0800

 The nightly build still behaves badly for me, while my build works ok.
 
 In fact, if I use my "PLT_MrEd.framework" in place of the nightly
 build's then it fixes the problem.
 
 Is your machine used to build the x86 binaries? If so, can you tell me
 what `gcc -v' reports? It seems unlikely to me that the problem is
 related to different compilers, but I'm scrambling for clues.
 
 (Using gdb confirms that the problem is that sleep mode ends up
 busy-waiting; WaitNextEvent() returns too early, and I can't yet figure
 out why.)
 
 Thanks,
 Matthew
 
 At Thu, 31 May 2007 20:35:15 -0500, "Robby Findler" wrote:
 > Does your build match the svn build?
 > 
 > Robby
 > 
 > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > I see this when I run v370 or the v370.2 installer from Wednesday, but
 > > not my latest build.
 > >
 > > It would make sense if the change I made for
 > >
 > >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 > >
 > > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > > back the bad behavior.
 > >
 > > So I'm stumped for the moment, but I'll keep looking into it. Maybe the
 > > next nightly build will give me a clue.
 > >
 > > Matthew
 > >
 > > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > > Nothing remotely special, no. I started help desk from the command
 > > > line and went back to the terminal and voila, off to the races. It was
 > > > very reproducible for me. (I didn't do a clean build last time, tho.)
 > > >
 > > > Robby
 > > >
 > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > > For me, it takes over the CPU when Help Desk is in the background, so
 > > > > > maybe it is unrelated to the web server.
 > > > >
 > > > > Did you have to do anything remotely special? When I start Help Desk,
 > > > > and then bring Terminal back to the foreground, Help Desk doesn't start
 > > > > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > > > > under Mac OS X.
 > > > >
 > > > > > Also, the CPU seems to be taking over more than 1 processor, which
 > > > > > seems quite strange.
 > > > >
 > > > > When MrEd sleeps, it uses an OS-level thread to help it wake up. So if
 > > > > something is wrong in the sleep code, it could easily keep both threads
 > > > > spinning on both processors.
 > > > >
 > > > > Matthew
 > > > >
 > > > >
 > >
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Matthew Flatt" <mflatt@cs.utah.edu>
Cc: jadudm@gmail.com, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Mon, 4 Jun 2007 20:08:24 -0500

 Yes, I think that my machine at school is used. Do you want a password
 to it? It is vnc capable.  I've opened skype, but I can't stay too
 long (I'll be back later tonight, if necessary).
 
 Robby
 
 [penghu] ~% gcc -v
 Using built-in specs.
 Target: i686-apple-darwin8
 Configured with: /private/var/tmp/gcc/gcc-5250.obj~20/src/configure
 --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
 --enable-languages=c,objc,c++,obj-c++
 --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/
 --with-gxx-include-dir=/include/c++/4.0.0
 --build=powerpc-apple-darwin8 --with-arch=pentium-m
 --with-tune=prescott --program-prefix= --host=i686-apple-darwin8
 --target=i686-apple-darwin8
 Thread model: posix
 gcc version 4.0.1 (Apple Computer, Inc. build 5250)
 [penghu] ~%
 
 On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > The nightly build still behaves badly for me, while my build works ok.
 >
 > In fact, if I use my "PLT_MrEd.framework" in place of the nightly
 > build's then it fixes the problem.
 >
 > Is your machine used to build the x86 binaries? If so, can you tell me
 > what `gcc -v' reports? It seems unlikely to me that the problem is
 > related to different compilers, but I'm scrambling for clues.
 >
 > (Using gdb confirms that the problem is that sleep mode ends up
 > busy-waiting; WaitNextEvent() returns too early, and I can't yet figure
 > out why.)
 >
 > Thanks,
 > Matthew
 >
 > At Thu, 31 May 2007 20:35:15 -0500, "Robby Findler" wrote:
 > > Does your build match the svn build?
 > >
 > > Robby
 > >
 > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > I see this when I run v370 or the v370.2 installer from Wednesday, but
 > > > not my latest build.
 > > >
 > > > It would make sense if the change I made for
 > > >
 > > >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 > > >
 > > > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > > > back the bad behavior.
 > > >
 > > > So I'm stumped for the moment, but I'll keep looking into it. Maybe the
 > > > next nightly build will give me a clue.
 > > >
 > > > Matthew
 > > >
 > > > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > > > Nothing remotely special, no. I started help desk from the command
 > > > > line and went back to the terminal and voila, off to the races. It was
 > > > > very reproducible for me. (I didn't do a clean build last time, tho.)
 > > > >
 > > > > Robby
 > > > >
 > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > > > For me, it takes over the CPU when Help Desk is in the background, so
 > > > > > > maybe it is unrelated to the web server.
 > > > > >
 > > > > > Did you have to do anything remotely special? When I start Help Desk,
 > > > > > and then bring Terminal back to the foreground, Help Desk doesn't start
 > > > > > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > > > > > under Mac OS X.
 > > > > >
 > > > > > > Also, the CPU seems to be taking over more than 1 processor, which
 > > > > > > seems quite strange.
 > > > > >
 > > > > > When MrEd sleeps, it uses an OS-level thread to help it wake up. So if
 > > > > > something is wrong in the sleep code, it could easily keep both threads
 > > > > > spinning on both processors.
 > > > > >
 > > > > > Matthew
 > > > > >
 > > > > >
 > > >
 >
From: Matthew Flatt <mflatt@cs.utah.edu>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: jadudm@gmail.com, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Tue, 5 Jun 2007 10:00:26 +0800

 I have build 5367, and it looks like there's some chance that this is a
 compiler bug.
 
 When I inspect the stack, it looks like my WNE() wrapper function is
 correctly called with a -1.0 argument in both my build and the nightly
 build. WaitNextEvent(), though, seems to end up with a 0 argument
 (wrong) in the nightly build, and a 0x7FFFFFFF argument (correct) in my
 build.
 
 I committed a re-write of the call that might make the compiler do
 something different. If that doesn't work (and I'm skeptical), we may
 need to go the VNC route.
 
 Thanks,
 Matthew
 
 At Mon, 4 Jun 2007 20:08:24 -0500, "Robby Findler" wrote:
 > Yes, I think that my machine at school is used. Do you want a password
 > to it? It is vnc capable.  I've opened skype, but I can't stay too
 > long (I'll be back later tonight, if necessary).
 > 
 > Robby
 > 
 > [penghu] ~% gcc -v
 > Using built-in specs.
 > Target: i686-apple-darwin8
 > Configured with: /private/var/tmp/gcc/gcc-5250.obj~20/src/configure
 > --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
 > --enable-languages=c,objc,c++,obj-c++
 > --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/
 > --with-gxx-include-dir=/include/c++/4.0.0
 > --build=powerpc-apple-darwin8 --with-arch=pentium-m
 > --with-tune=prescott --program-prefix= --host=i686-apple-darwin8
 > --target=i686-apple-darwin8
 > Thread model: posix
 > gcc version 4.0.1 (Apple Computer, Inc. build 5250)
 > [penghu] ~%
 > 
 > On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > The nightly build still behaves badly for me, while my build works ok.
 > >
 > > In fact, if I use my "PLT_MrEd.framework" in place of the nightly
 > > build's then it fixes the problem.
 > >
 > > Is your machine used to build the x86 binaries? If so, can you tell me
 > > what `gcc -v' reports? It seems unlikely to me that the problem is
 > > related to different compilers, but I'm scrambling for clues.
 > >
 > > (Using gdb confirms that the problem is that sleep mode ends up
 > > busy-waiting; WaitNextEvent() returns too early, and I can't yet figure
 > > out why.)
 > >
 > > Thanks,
 > > Matthew
 > >
 > > At Thu, 31 May 2007 20:35:15 -0500, "Robby Findler" wrote:
 > > > Does your build match the svn build?
 > > >
 > > > Robby
 > > >
 > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > I see this when I run v370 or the v370.2 installer from Wednesday, but
 > > > > not my latest build.
 > > > >
 > > > > It would make sense if the change I made for
 > > > >
 > > > >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 > > > >
 > > > > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > > > > back the bad behavior.
 > > > >
 > > > > So I'm stumped for the moment, but I'll keep looking into it. Maybe the
 > > > > next nightly build will give me a clue.
 > > > >
 > > > > Matthew
 > > > >
 > > > > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > > > > Nothing remotely special, no. I started help desk from the command
 > > > > > line and went back to the terminal and voila, off to the races. It was
 > > > > > very reproducible for me. (I didn't do a clean build last time, tho.)
 > > > > >
 > > > > > Robby
 > > > > >
 > > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > > > > For me, it takes over the CPU when Help Desk is in the background, 
 > so
 > > > > > > > maybe it is unrelated to the web server.
 > > > > > >
 > > > > > > Did you have to do anything remotely special? When I start Help Desk,
 > > > > > > and then bring Terminal back to the foreground, Help Desk doesn't 
 > start
 > > > > > > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > > > > > > under Mac OS X.
 > > > > > >
 > > > > > > > Also, the CPU seems to be taking over more than 1 processor, which
 > > > > > > > seems quite strange.
 > > > > > >
 > > > > > > When MrEd sleeps, it uses an OS-level thread to help it wake up. So 
 > if
 > > > > > > something is wrong in the sleep code, it could easily keep both 
 > threads
 > > > > > > spinning on both processors.
 > > > > > >
 > > > > > > Matthew
 > > > > > >
 > > > > > >
 > > > >
 > >
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Matthew Flatt" <mflatt@cs.utah.edu>
Cc: jadudm@gmail.com, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Mon, 4 Jun 2007 21:06:05 -0500

 Nothing else tonight, then?
 
 Robby
 
 On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > I have build 5367, and it looks like there's some chance that this is a
 > compiler bug.
 >
 > When I inspect the stack, it looks like my WNE() wrapper function is
 > correctly called with a -1.0 argument in both my build and the nightly
 > build. WaitNextEvent(), though, seems to end up with a 0 argument
 > (wrong) in the nightly build, and a 0x7FFFFFFF argument (correct) in my
 > build.
 >
 > I committed a re-write of the call that might make the compiler do
 > something different. If that doesn't work (and I'm skeptical), we may
 > need to go the VNC route.
 >
 > Thanks,
 > Matthew
 >
 > At Mon, 4 Jun 2007 20:08:24 -0500, "Robby Findler" wrote:
 > > Yes, I think that my machine at school is used. Do you want a password
 > > to it? It is vnc capable.  I've opened skype, but I can't stay too
 > > long (I'll be back later tonight, if necessary).
 > >
 > > Robby
 > >
 > > [penghu] ~% gcc -v
 > > Using built-in specs.
 > > Target: i686-apple-darwin8
 > > Configured with: /private/var/tmp/gcc/gcc-5250.obj~20/src/configure
 > > --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
 > > --enable-languages=c,objc,c++,obj-c++
 > > --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/
 > > --with-gxx-include-dir=/include/c++/4.0.0
 > > --build=powerpc-apple-darwin8 --with-arch=pentium-m
 > > --with-tune=prescott --program-prefix= --host=i686-apple-darwin8
 > > --target=i686-apple-darwin8
 > > Thread model: posix
 > > gcc version 4.0.1 (Apple Computer, Inc. build 5250)
 > > [penghu] ~%
 > >
 > > On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > The nightly build still behaves badly for me, while my build works ok.
 > > >
 > > > In fact, if I use my "PLT_MrEd.framework" in place of the nightly
 > > > build's then it fixes the problem.
 > > >
 > > > Is your machine used to build the x86 binaries? If so, can you tell me
 > > > what `gcc -v' reports? It seems unlikely to me that the problem is
 > > > related to different compilers, but I'm scrambling for clues.
 > > >
 > > > (Using gdb confirms that the problem is that sleep mode ends up
 > > > busy-waiting; WaitNextEvent() returns too early, and I can't yet figure
 > > > out why.)
 > > >
 > > > Thanks,
 > > > Matthew
 > > >
 > > > At Thu, 31 May 2007 20:35:15 -0500, "Robby Findler" wrote:
 > > > > Does your build match the svn build?
 > > > >
 > > > > Robby
 > > > >
 > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > I see this when I run v370 or the v370.2 installer from Wednesday, but
 > > > > > not my latest build.
 > > > > >
 > > > > > It would make sense if the change I made for
 > > > > >
 > > > > >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 > > > > >
 > > > > > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > > > > > back the bad behavior.
 > > > > >
 > > > > > So I'm stumped for the moment, but I'll keep looking into it. Maybe the
 > > > > > next nightly build will give me a clue.
 > > > > >
 > > > > > Matthew
 > > > > >
 > > > > > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > > > > > Nothing remotely special, no. I started help desk from the command
 > > > > > > line and went back to the terminal and voila, off to the races. It was
 > > > > > > very reproducible for me. (I didn't do a clean build last time, tho.)
 > > > > > >
 > > > > > > Robby
 > > > > > >
 > > > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > > > > > For me, it takes over the CPU when Help Desk is in the background,
 > > so
 > > > > > > > > maybe it is unrelated to the web server.
 > > > > > > >
 > > > > > > > Did you have to do anything remotely special? When I start Help Desk,
 > > > > > > > and then bring Terminal back to the foreground, Help Desk doesn't
 > > start
 > > > > > > > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > > > > > > > under Mac OS X.
 > > > > > > >
 > > > > > > > > Also, the CPU seems to be taking over more than 1 processor, which
 > > > > > > > > seems quite strange.
 > > > > > > >
 > > > > > > > When MrEd sleeps, it uses an OS-level thread to help it wake up. So
 > > if
 > > > > > > > something is wrong in the sleep code, it could easily keep both
 > > threads
 > > > > > > > spinning on both processors.
 > > > > > > >
 > > > > > > > Matthew
 > > > > > > >
 > > > > > > >
 > > > > >
 > > >
 >
From: "Matt Jadud" <jadudm@gmail.com>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: "Matthew Flatt" <mflatt@cs.utah.edu>, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Tue, 5 Jun 2007 10:15:41 +0100

 If you tell me where/how to look, I can build from scratch and
 investigate this as well. That is to say, are you setting a breakpoint
 and then inspecting the stack from GDB? I think I have enough C-fu to
 help with this kind of inspection, but I'm not sure where in sources I
 should be looking.
 
 My machine seems to have a similar compiler spec to Matthew:
 
 [ ~ ] gcc -v
 Using built-in specs.
 Target: i686-apple-darwin8
 Configured with: /private/var/tmp/gcc/gcc-5367.obj~1/src/configure
 --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
 --enable-languages=c,objc,c++,obj-c++
 --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/
 --with-gxx-include-dir=/include/c++/4.0.0 --with-slibdir=/usr/lib
 --build=powerpc-apple-darwin8 --with-arch=nocona --with-tune=generic
 --program-prefix= --host=i686-apple-darwin8
 --target=i686-apple-darwin8
 Thread model: posix
 gcc version 4.0.1 (Apple Computer, Inc. build 5367)
 
 Cheers,
 Matt
 
 On 6/5/07, Robby Findler <robby@cs.uchicago.edu> wrote:
 > Nothing else tonight, then?
 >
 > Robby
 >
 > On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > I have build 5367, and it looks like there's some chance that this is a
 > > compiler bug.
 > >
 > > When I inspect the stack, it looks like my WNE() wrapper function is
 > > correctly called with a -1.0 argument in both my build and the nightly
 > > build. WaitNextEvent(), though, seems to end up with a 0 argument
 > > (wrong) in the nightly build, and a 0x7FFFFFFF argument (correct) in my
 > > build.
 > >
 > > I committed a re-write of the call that might make the compiler do
 > > something different. If that doesn't work (and I'm skeptical), we may
 > > need to go the VNC route.
 > >
 > > Thanks,
 > > Matthew
 > >
 > > At Mon, 4 Jun 2007 20:08:24 -0500, "Robby Findler" wrote:
 > > > Yes, I think that my machine at school is used. Do you want a password
 > > > to it? It is vnc capable.  I've opened skype, but I can't stay too
 > > > long (I'll be back later tonight, if necessary).
 > > >
 > > > Robby
 > > >
 > > > [penghu] ~% gcc -v
 > > > Using built-in specs.
 > > > Target: i686-apple-darwin8
 > > > Configured with: /private/var/tmp/gcc/gcc-5250.obj~20/src/configure
 > > > --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
 > > > --enable-languages=c,objc,c++,obj-c++
 > > > --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/
 > > > --with-gxx-include-dir=/include/c++/4.0.0
 > > > --build=powerpc-apple-darwin8 --with-arch=pentium-m
 > > > --with-tune=prescott --program-prefix= --host=i686-apple-darwin8
 > > > --target=i686-apple-darwin8
 > > > Thread model: posix
 > > > gcc version 4.0.1 (Apple Computer, Inc. build 5250)
 > > > [penghu] ~%
 > > >
 > > > On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > The nightly build still behaves badly for me, while my build works ok.
 > > > >
 > > > > In fact, if I use my "PLT_MrEd.framework" in place of the nightly
 > > > > build's then it fixes the problem.
 > > > >
 > > > > Is your machine used to build the x86 binaries? If so, can you tell me
 > > > > what `gcc -v' reports? It seems unlikely to me that the problem is
 > > > > related to different compilers, but I'm scrambling for clues.
 > > > >
 > > > > (Using gdb confirms that the problem is that sleep mode ends up
 > > > > busy-waiting; WaitNextEvent() returns too early, and I can't yet figure
 > > > > out why.)
 > > > >
 > > > > Thanks,
 > > > > Matthew
 > > > >
 > > > > At Thu, 31 May 2007 20:35:15 -0500, "Robby Findler" wrote:
 > > > > > Does your build match the svn build?
 > > > > >
 > > > > > Robby
 > > > > >
 > > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > > I see this when I run v370 or the v370.2 installer from Wednesday, but
 > > > > > > not my latest build.
 > > > > > >
 > > > > > > It would make sense if the change I made for
 > > > > > >
 > > > > > >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 > > > > > >
 > > > > > > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > > > > > > back the bad behavior.
 > > > > > >
 > > > > > > So I'm stumped for the moment, but I'll keep looking into it. Maybe the
 > > > > > > next nightly build will give me a clue.
 > > > > > >
 > > > > > > Matthew
 > > > > > >
 > > > > > > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > > > > > > Nothing remotely special, no. I started help desk from the command
 > > > > > > > line and went back to the terminal and voila, off to the races. It was
 > > > > > > > very reproducible for me. (I didn't do a clean build last time, tho.)
 > > > > > > >
 > > > > > > > Robby
 > > > > > > >
 > > > > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > > > > > > For me, it takes over the CPU when Help Desk is in the background,
 > > > so
 > > > > > > > > > maybe it is unrelated to the web server.
 > > > > > > > >
 > > > > > > > > Did you have to do anything remotely special? When I start Help Desk,
 > > > > > > > > and then bring Terminal back to the foreground, Help Desk doesn't
 > > > start
 > > > > > > > > CPU. DrScheme and stand-alone Help Desk both behave correctly for me
 > > > > > > > > under Mac OS X.
 > > > > > > > >
 > > > > > > > > > Also, the CPU seems to be taking over more than 1 processor, which
 > > > > > > > > > seems quite strange.
 > > > > > > > >
 > > > > > > > > When MrEd sleeps, it uses an OS-level thread to help it wake up. So
 > > > if
 > > > > > > > > something is wrong in the sleep code, it could easily keep both
 > > > threads
 > > > > > > > > spinning on both processors.
 > > > > > > > >
 > > > > > > > > Matthew
 > > > > > > > >
 > > > > > > > >
 > > > > > >
 > > > >
 > >
 >
From: Matthew Flatt <mflatt@cs.utah.edu>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: jadudm@gmail.com, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Tue, 5 Jun 2007 19:59:11 +0800

 Since the nightly build failed last night, can you try building with
 the latest on that machine, and check whether Help Desk behaves
 differently?
 
 Thanks,
 Matthew
 
 At Mon, 4 Jun 2007 21:06:05 -0500, "Robby Findler" wrote:
 > Nothing else tonight, then?
 > 
 > Robby
 > 
 > On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > I have build 5367, and it looks like there's some chance that this is a
 > > compiler bug.
 > >
 > > When I inspect the stack, it looks like my WNE() wrapper function is
 > > correctly called with a -1.0 argument in both my build and the nightly
 > > build. WaitNextEvent(), though, seems to end up with a 0 argument
 > > (wrong) in the nightly build, and a 0x7FFFFFFF argument (correct) in my
 > > build.
 > >
 > > I committed a re-write of the call that might make the compiler do
 > > something different. If that doesn't work (and I'm skeptical), we may
 > > need to go the VNC route.
 > >
 > > Thanks,
 > > Matthew
 > >
 > > At Mon, 4 Jun 2007 20:08:24 -0500, "Robby Findler" wrote:
 > > > Yes, I think that my machine at school is used. Do you want a password
 > > > to it? It is vnc capable.  I've opened skype, but I can't stay too
 > > > long (I'll be back later tonight, if necessary).
 > > >
 > > > Robby
 > > >
 > > > [penghu] ~% gcc -v
 > > > Using built-in specs.
 > > > Target: i686-apple-darwin8
 > > > Configured with: /private/var/tmp/gcc/gcc-5250.obj~20/src/configure
 > > > --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
 > > > --enable-languages=c,objc,c++,obj-c++
 > > > --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/
 > > > --with-gxx-include-dir=/include/c++/4.0.0
 > > > --build=powerpc-apple-darwin8 --with-arch=pentium-m
 > > > --with-tune=prescott --program-prefix= --host=i686-apple-darwin8
 > > > --target=i686-apple-darwin8
 > > > Thread model: posix
 > > > gcc version 4.0.1 (Apple Computer, Inc. build 5250)
 > > > [penghu] ~%
 > > >
 > > > On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > The nightly build still behaves badly for me, while my build works ok.
 > > > >
 > > > > In fact, if I use my "PLT_MrEd.framework" in place of the nightly
 > > > > build's then it fixes the problem.
 > > > >
 > > > > Is your machine used to build the x86 binaries? If so, can you tell me
 > > > > what `gcc -v' reports? It seems unlikely to me that the problem is
 > > > > related to different compilers, but I'm scrambling for clues.
 > > > >
 > > > > (Using gdb confirms that the problem is that sleep mode ends up
 > > > > busy-waiting; WaitNextEvent() returns too early, and I can't yet figure
 > > > > out why.)
 > > > >
 > > > > Thanks,
 > > > > Matthew
 > > > >
 > > > > At Thu, 31 May 2007 20:35:15 -0500, "Robby Findler" wrote:
 > > > > > Does your build match the svn build?
 > > > > >
 > > > > > Robby
 > > > > >
 > > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > > I see this when I run v370 or the v370.2 installer from Wednesday, 
 > but
 > > > > > > not my latest build.
 > > > > > >
 > > > > > > It would make sense if the change I made for
 > > > > > >
 > > > > > >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 > > > > > >
 > > > > > > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > > > > > > back the bad behavior.
 > > > > > >
 > > > > > > So I'm stumped for the moment, but I'll keep looking into it. Maybe 
 > the
 > > > > > > next nightly build will give me a clue.
 > > > > > >
 > > > > > > Matthew
 > > > > > >
 > > > > > > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > > > > > > Nothing remotely special, no. I started help desk from the command
 > > > > > > > line and went back to the terminal and voila, off to the races. It 
 > was
 > > > > > > > very reproducible for me. (I didn't do a clean build last time, 
 > tho.)
 > > > > > > >
 > > > > > > > Robby
 > > > > > > >
 > > > > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > > > > > > For me, it takes over the CPU when Help Desk is in the 
 > background,
 > > > so
 > > > > > > > > > maybe it is unrelated to the web server.
 > > > > > > > >
 > > > > > > > > Did you have to do anything remotely special? When I start Help 
 > Desk,
 > > > > > > > > and then bring Terminal back to the foreground, Help Desk doesn't
 > > > start
 > > > > > > > > CPU. DrScheme and stand-alone Help Desk both behave correctly 
 > for me
 > > > > > > > > under Mac OS X.
 > > > > > > > >
 > > > > > > > > > Also, the CPU seems to be taking over more than 1 processor, 
 > which
 > > > > > > > > > seems quite strange.
 > > > > > > > >
 > > > > > > > > When MrEd sleeps, it uses an OS-level thread to help it wake up. 
 > So
 > > > if
 > > > > > > > > something is wrong in the sleep code, it could easily keep both
 > > > threads
 > > > > > > > > spinning on both processors.
 > > > > > > > >
 > > > > > > > > Matthew
 > > > > > > > >
 > > > > > > > >
 > > > > > >
 > > > >
 > >
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Matthew Flatt" <mflatt@cs.utah.edu>
Cc: jadudm@gmail.com, bugs@plt-scheme.org
Subject: Re: [plt-bug] all/8709: Help Desk goes wild-crazy!
Date: Tue, 5 Jun 2007 08:10:57 -0500

 Looks like it works now. If you want to look at the framework:
 
   http://www.cs.uchicago.edu/~robby/tmp/PLT_MrEd.framework.tar.gz
 
 Robby
 
 On 6/5/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > Since the nightly build failed last night, can you try building with
 > the latest on that machine, and check whether Help Desk behaves
 > differently?
 >
 > Thanks,
 > Matthew
 >
 > At Mon, 4 Jun 2007 21:06:05 -0500, "Robby Findler" wrote:
 > > Nothing else tonight, then?
 > >
 > > Robby
 > >
 > > On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > I have build 5367, and it looks like there's some chance that this is a
 > > > compiler bug.
 > > >
 > > > When I inspect the stack, it looks like my WNE() wrapper function is
 > > > correctly called with a -1.0 argument in both my build and the nightly
 > > > build. WaitNextEvent(), though, seems to end up with a 0 argument
 > > > (wrong) in the nightly build, and a 0x7FFFFFFF argument (correct) in my
 > > > build.
 > > >
 > > > I committed a re-write of the call that might make the compiler do
 > > > something different. If that doesn't work (and I'm skeptical), we may
 > > > need to go the VNC route.
 > > >
 > > > Thanks,
 > > > Matthew
 > > >
 > > > At Mon, 4 Jun 2007 20:08:24 -0500, "Robby Findler" wrote:
 > > > > Yes, I think that my machine at school is used. Do you want a password
 > > > > to it? It is vnc capable.  I've opened skype, but I can't stay too
 > > > > long (I'll be back later tonight, if necessary).
 > > > >
 > > > > Robby
 > > > >
 > > > > [penghu] ~% gcc -v
 > > > > Using built-in specs.
 > > > > Target: i686-apple-darwin8
 > > > > Configured with: /private/var/tmp/gcc/gcc-5250.obj~20/src/configure
 > > > > --disable-checking -enable-werror --prefix=/usr --mandir=/share/man
 > > > > --enable-languages=c,objc,c++,obj-c++
 > > > > --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/
 > > > > --with-gxx-include-dir=/include/c++/4.0.0
 > > > > --build=powerpc-apple-darwin8 --with-arch=pentium-m
 > > > > --with-tune=prescott --program-prefix= --host=i686-apple-darwin8
 > > > > --target=i686-apple-darwin8
 > > > > Thread model: posix
 > > > > gcc version 4.0.1 (Apple Computer, Inc. build 5250)
 > > > > [penghu] ~%
 > > > >
 > > > > On 6/4/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > The nightly build still behaves badly for me, while my build works ok.
 > > > > >
 > > > > > In fact, if I use my "PLT_MrEd.framework" in place of the nightly
 > > > > > build's then it fixes the problem.
 > > > > >
 > > > > > Is your machine used to build the x86 binaries? If so, can you tell me
 > > > > > what `gcc -v' reports? It seems unlikely to me that the problem is
 > > > > > related to different compilers, but I'm scrambling for clues.
 > > > > >
 > > > > > (Using gdb confirms that the problem is that sleep mode ends up
 > > > > > busy-waiting; WaitNextEvent() returns too early, and I can't yet figure
 > > > > > out why.)
 > > > > >
 > > > > > Thanks,
 > > > > > Matthew
 > > > > >
 > > > > > At Thu, 31 May 2007 20:35:15 -0500, "Robby Findler" wrote:
 > > > > > > Does your build match the svn build?
 > > > > > >
 > > > > > > Robby
 > > > > > >
 > > > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > > > I see this when I run v370 or the v370.2 installer from Wednesday,
 > > but
 > > > > > > > not my latest build.
 > > > > > > >
 > > > > > > > It would make sense if the change I made for
 > > > > > > >
 > > > > > > >  http://list.cs.brown.edu/pipermail/plt-scheme/2007-May/018503.html
 > > > > > > >
 > > > > > > > fixed the Help Desk bug, too, but unwinding that change doesn't bring
 > > > > > > > back the bad behavior.
 > > > > > > >
 > > > > > > > So I'm stumped for the moment, but I'll keep looking into it. Maybe
 > > the
 > > > > > > > next nightly build will give me a clue.
 > > > > > > >
 > > > > > > > Matthew
 > > > > > > >
 > > > > > > > At Thu, 31 May 2007 04:30:14 -0500, "Robby Findler" wrote:
 > > > > > > > > Nothing remotely special, no. I started help desk from the command
 > > > > > > > > line and went back to the terminal and voila, off to the races. It
 > > was
 > > > > > > > > very reproducible for me. (I didn't do a clean build last time,
 > > tho.)
 > > > > > > > >
 > > > > > > > > Robby
 > > > > > > > >
 > > > > > > > > On 5/31/07, Matthew Flatt <mflatt@cs.utah.edu> wrote:
 > > > > > > > > > At Wed, 30 May 2007 13:27:06 -0500, "Robby Findler" wrote:
 > > > > > > > > > > For me, it takes over the CPU when Help Desk is in the
 > > background,
 > > > > so
 > > > > > > > > > > maybe it is unrelated to the web server.
 > > > > > > > > >
 > > > > > > > > > Did you have to do anything remotely special? When I start Help
 > > Desk,
 > > > > > > > > > and then bring Terminal back to the foreground, Help Desk doesn't
 > > > > start
 > > > > > > > > > CPU. DrScheme and stand-alone Help Desk both behave correctly
 > > for me
 > > > > > > > > > under Mac OS X.
 > > > > > > > > >
 > > > > > > > > > > Also, the CPU seems to be taking over more than 1 processor,
 > > which
 > > > > > > > > > > seems quite strange.
 > > > > > > > > >
 > > > > > > > > > When MrEd sleeps, it uses an OS-level thread to help it wake up.
 > > So
 > > > > if
 > > > > > > > > > something is wrong in the sleep code, it could easily keep both
 > > > > threads
 > > > > > > > > > spinning on both processors.
 > > > > > > > > >
 > > > > > > > > > Matthew
 > > > > > > > > >
 > > > > > > > > >
 > > > > > > >
 > > > > >
 > > >
 >


State changed from "open" to "closed" by mflatt at Wed, 25 Jul 2007 14:53:18 -0400
Reason>>> Fixed (worked around compiler bug)

