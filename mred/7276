From apache@plt-scheme.org Tue Mar 15 19:01:13 2005
Received: from champlain.ccs.neu.edu (champlain.ccs.neu.edu [127.0.0.1])
	by champlain.ccs.neu.edu (8.12.10/8.12.10) with ESMTP id j2G01CnN027456
	for <bugs@plt-scheme.org>; Tue, 15 Mar 2005 19:01:12 -0500
Message-Id: <200503160001.j2G01Cmp027454@champlain.ccs.neu.edu>
Date: Tue, 15 Mar 2005 19:01:12 -0500
From: eli@barzilay.org
To: bugs@plt-scheme.org
Subject: No text in title for DrScheme on Linux

>Number:         7276
>Category:       mred
>Synopsis:       No text in title for DrScheme on Linux
>Class:          sw-bug
>Responsible:    mflatt
>Notify-List:    eli@barzilay.org
>Severity:       serious
>Priority:       medium
>State:          closed
>Confidential:   no
>Arrival-Date:   Tue Mar 15 19:05:01 -0500 2005
>Closed-Date:    Tue Jul 11 13:46:58 -0400 2006
>Last-Modified:  Tue Jul 11 13:46:58 -0400 2006
>Originator:     Eli Barzilay
>Organization:
plt
>Submitter-Id:   unknown
>Release:        299.100-cvs15mar2005
>Environment:
unix "Linux winooski.ccs.neu.edu 2.6.10-1.14_FC2 #1 Thu Feb 10 17:13:14 EST 2005 i686 i686 i386 GNU/Linux" (i386-linux) (get-display-depth) = 24
Docs Installed:
(#<path:/proj/scheme/plt/collects/doc/misclib> #<path:/proj/scheme/plt/collects/doc/foreign> #<path:/proj/scheme/plt/collects/doc/plot> #<path:/proj/scheme/plt/collects/doc/tools> #<path:/proj/scheme/plt/collects/doc/srfi> #<path:/proj/scheme/plt/collects/doc/profj-advanced> #<path:/proj/scheme/plt/collects/doc/drscheme> #<path:/proj/scheme/plt/collects/doc/profj-beginner> #<path:/proj/scheme/plt/collects/doc/mrlib> #<path:/proj/scheme/plt/collects/doc/tour> #<path:/proj/scheme/plt/collects/doc/t-y-scheme> #<path:/proj/scheme/plt/collects/doc/teachpack> #<path:/proj/scheme/plt/collects/doc/tex2page> #<path:/proj/scheme/plt/collects/doc/profj-intermediate> #<path:/proj/scheme/plt/collects/doc/mzscheme> #<path:/proj/scheme/plt/collects/doc/beginning> #<path:/proj/scheme/plt/collects/doc/swindle> #<path:/proj/scheme/plt/collects/doc/mzlib> #<path:/proj/scheme/plt/collects/doc/help> #<path:/proj/scheme/plt/collects/doc/insidemz> #<path:/proj/scheme/plt/collects/doc/web-server> #<path:/proj/scheme/plt/collects/doc/framework> #<path:/proj/scheme/plt/collects/doc/mred> #<path:/proj/scheme/plt/collects/doc/intermediate> #<path:/proj/scheme/plt/collects/doc/advanced> #<path:/proj/scheme/plt/collects/doc/mzc> #<path:/proj/scheme/plt/collects/doc/beginning-abbr> #<path:/proj/scheme/plt/collects/doc/intermediate-lambda> #<path:/proj/scheme/plt/collects/doc/r5rs>)
Collections:
((#<path:/home/eli/.plt-scheme/299.100/collects> "non-existent path") (#<path:/proj/scheme/plt/collects> (#<path:browser> #<path:handin-server> #<path:errortrace> #<path:htdp> #<path:version> #<path:slideshow> #<path:setup> #<path:ffi> #<path:defaults> #<path:make> #<path:mrdemo> #<path:slatex> #<path:openssl> #<path:finish-install> #<path:embedded-gui> #<path:xelda> #<path:doc> #<path:mysterx> #<path:tests> #<path:mred> #<path:syntax-color> #<path:dynext> #<path:net> #<path:framework> #<path:games> #<path:ssax> #<path:web-server> #<path:help> #<path:srpersist> #<path:mzlib> #<path:swindle> #<path:mzcom> #<path:graphics> #<path:compiler> #<path:sirmail> #<path:mzscheme> #<path:eopl> #<path:xml> #<path:lang> #<path:honu-module> #<path:string-constants> #<path:handin-client> #<path:frtime> #<path:tex2page> #<path:slibinit> #<path:mrflow> #<path:CVS> #<path:hierlist> #<path:trace> #<path:syntax> #<path:html> #<path:mrlib> #<path:icons> #<path:profj> #<path:reduction-semantics> #<path:afm> #<path:launcher> #<path:readline> #<path:skipper> #<path:test-suite> #<path:drscheme> #<path:algol60> #<path:info-domain> #<path:parser-tools> #<path:srfi> #<path:sgl> #<path:planet> #<path:plot> #<path:profjBoxes> #<path:waterworld> #<path:cvs-time-stamp> #<path:preprocessor> #<path:texpict> #<path:stepper> #<path:guibuilder>)))
Human Language: english
Teachpack filenames: ()
Computer Language: (("Professional Languages" "PLT" "Pretty Big (includes MrEd and Advanced)") #6(#t write mixed-fraction-e #f #t debug))
>Description:
If I change the settings to open files in tabs, I'm getting
no text in the titlebars.
>How-To-Repeat:
>Fix:
>Audit-Trail:
Responsible changed from "nobody" to "robby" by eli at Tue, 15 Mar 2005 19:07:14 -0500
Reason>>> drscheme

From: Robby Findler <robby@cs.uchicago.edu>
To: bugs@plt-scheme.org, mflatt@cs.utah.edu
Cc: nobody@plt-scheme.org, eli@plt-scheme.org, eli@barzilay.org
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Tue, 15 Mar 2005 18:10:43 -0600

 I don't think that this is my bug.
 
 It seems to work under mac os x.
 
 Robby
 
 At Tue, 15 Mar 2005 19:07:14 -0500, eli@plt-scheme.org wrote:
 > 
 > Responsible changed from "nobody" to "robby" by eli at Tue, 15 Mar 2005 19:07:14 -0500
 > Reason>>> drscheme
 > 
 > 
 > View:
 >   http://bugs.plt-scheme.org/query/?cmd=view&pr=7276
From: Eli Barzilay <eli@barzilay.org>
To: Robby Findler <robby@cs.uchicago.edu>
Cc: bugs@plt-scheme.org, mflatt@cs.utah.edu
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Tue, 15 Mar 2005 19:12:43 -0500

 On Mar 15, Robby Findler wrote:
 > I don't think that this is my bug.
 > 
 > It seems to work under mac os x.
 
 The thing is that when I don't use tabs, the titles are fine -- I
 don't think that there is a relation between having a tab control
 somewhere on the screen and the existence of title strings...?
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Robby Findler <robby@cs.uchicago.edu>
To: Eli Barzilay <eli@barzilay.org>
Cc: bugs@plt-scheme.org, mflatt@cs.utah.edu
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Tue, 15 Mar 2005 18:15:40 -0600

 At Tue, 15 Mar 2005 19:12:43 -0500, Eli Barzilay wrote:
 > On Mar 15, Robby Findler wrote:
 > > I don't think that this is my bug.
 > > 
 > > It seems to work under mac os x.
 > 
 > The thing is that when I don't use tabs, the titles are fine -- I
 > don't think that there is a relation between having a tab control
 > somewhere on the screen and the existence of title strings...?
 
 Probably the title mutator method is being called when you use tabs
 (since the title bar changes when change around between tabs) and not
 when you don't (since it can just pass a string to the frame
 constructor).
 
 Robby
From: Eli Barzilay <eli@barzilay.org>
To: Robby Findler <robby@cs.uchicago.edu>
Cc: bugs@plt-scheme.org, mflatt@cs.utah.edu
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Tue, 15 Mar 2005 19:43:01 -0500

 On Mar 15, Robby Findler wrote:
 > At Tue, 15 Mar 2005 19:12:43 -0500, Eli Barzilay wrote:
 > > On Mar 15, Robby Findler wrote:
 > > > I don't think that this is my bug.
 > > > 
 > > > It seems to work under mac os x.
 > > 
 > > The thing is that when I don't use tabs, the titles are fine -- I
 > > don't think that there is a relation between having a tab control
 > > somewhere on the screen and the existence of title strings...?
 > 
 > Probably the title mutator method is being called when you use tabs
 > (since the title bar changes when change around between tabs) and not
 > when you don't (since it can just pass a string to the frame
 > constructor).
 
 I did try to switch tabs, and still no title...
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Matthew Flatt <mflatt@cs.utah.edu>
To: Eli Barzilay <eli@barzilay.org>
Cc: Robby Findler <robby@cs.uchicago.edu>, bugs@plt-scheme.org
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Tue, 15 Mar 2005 19:14:39 -0700

 At Tue, 15 Mar 2005 19:43:01 -0500, Eli Barzilay wrote:
 > On Mar 15, Robby Findler wrote:
 > > At Tue, 15 Mar 2005 19:12:43 -0500, Eli Barzilay wrote:
 > > > On Mar 15, Robby Findler wrote:
 > > > > I don't think that this is my bug.
 > > > > 
 > > > > It seems to work under mac os x.
 > > > 
 > > > The thing is that when I don't use tabs, the titles are fine -- I
 > > > don't think that there is a relation between having a tab control
 > > > somewhere on the screen and the existence of title strings...?
 > > 
 > > Probably the title mutator method is being called when you use tabs
 > > (since the title bar changes when change around between tabs) and not
 > > when you don't (since it can just pass a string to the frame
 > > constructor).
 > 
 > I did try to switch tabs, and still no title...
 
 It's working for me.
 
 Not that I'll be able to do much with the information, but what window
 manager do you use?
 
 Also, without using tabs, what happens when you save an "Untitled"
 file? Does the title update correctly?
 
 Matthew
 
From: Eli Barzilay <eli@barzilay.org>
To: Robby Findler <robby@cs.uchicago.edu>, Matthew Flatt <mflatt@cs.utah.edu>
Cc: bugs@plt-scheme.org
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Tue, 15 Mar 2005 21:52:32 -0500

 On Mar 15, Robby Findler wrote:
 > At Tue, 15 Mar 2005 19:43:01 -0500, Eli Barzilay wrote:
 > > On Mar 15, Robby Findler wrote:
 > > > 
 > > > Probably the title mutator method is being called when you use tabs
 > > > (since the title bar changes when change around between tabs) and not
 > > > when you don't (since it can just pass a string to the frame
 > > > constructor).
 > > 
 > > I did try to switch tabs, and still no title...
 > 
 > which would suggest I'm right...
 
 I'm not following this anymore...  If the title mutator is called when
 you switch tabs, then I would assume that switching tabs would mutate
 the title and make it appear.
 
 
 On Mar 15, Matthew Flatt wrote:
 > 
 > Not that I'll be able to do much with the information, but what window
 > manager do you use?
 
 Sawfish.
 
 
 > Also, without using tabs, what happens when you save an "Untitled"
 > file? Does the title update correctly?
 
 Can you tell me a specific set of operations to try?  What I see now
 is:
 
 * - Start DrScheme, get an untitled window with "untitled" title,
   - open a recent file -- the title becomes blank.
 
 * - Start DrScheme, get an untitled window with "untitled" title,
   - type something, save the file -- the title becomes blank.
 
 * - Start DrScheme, get an untitled window with "untitled" title,
   - save the (blank) file -- the title becomes blank.
 
 Sawfish allows me to get properties of windows, this is the
 information when it starts (when things are fine) and after I save a
 blank file -- its a mixture of sawfish properties and X properties,
 I'm removing some of the obviously irrelevant stuff which is equal in
 both places:
 
   ("Untitled - DrScheme" "mred"
    (type default) [...] (order 1707) (icon-position (315 . 736))
    (_NET_WM_ICON_GEOMETRY (CARDINAL 32 [315 736 177 32]))
    (WM_STATE (WM_STATE 32 [1 0]))
    (_NET_WM_DESKTOP (CARDINAL 32 [0]))
    (_NET_WM_STATE (ATOM 32 []))
    (WM_PROTOCOLS (ATOM 32 [WM_DELETE_WINDOW]))
    (WM_LOCALE_NAME (STRING 8 "en_US"))
    (WM_CLASS (STRING 8 "frame\000mred\000"))
    (WM_HINTS (WM_HINTS 32 [39 1 1 41943064 0 4294967295 4294967295 41943062 2]))
    (WM_NORMAL_HINTS (WM_SIZE_HINTS 32 [113 156 849 140214000 106 695 166 32000 32000 1 1 135284368 140134800 2 3221217300 134959353 138937720 192695488]))
    (WM_CLIENT_MACHINE (STRING 8 "winooski.ccs.neu.edu"))
    (WM_ICON_NAME (STRING 8 "Untitled - DrScheme"))
    (WM_NAME (UTF8_STRING 8 "Untitled - DrScheme")))
 
   ("" "mred"
    (type default) [...] (order 1715) (icon-position (315 . 736))
    (_NET_WM_ICON_GEOMETRY (CARDINAL 32 [315 736 177 32]))
    (WM_STATE (WM_STATE 32 [1 0]))
    (_NET_WM_DESKTOP (CARDINAL 32 [0]))
    (_NET_WM_STATE (ATOM 32 []))
    (WM_PROTOCOLS (ATOM 32 [WM_DELETE_WINDOW]))
    (WM_LOCALE_NAME (STRING 8 "en_US"))
    (WM_CLASS (STRING 8 "frame\000mred\000"))
    (WM_HINTS (WM_HINTS 32 [39 1 1 41943064 0 4294967295 4294967295 41943062 2]))
    (WM_NORMAL_HINTS (WM_SIZE_HINTS 32 [113 156 849 140214000 106 695 166 32000 32000 1 1 135284368 140134800 2 3221217300 134959353 138937720 192695488]))
    (WM_CLIENT_MACHINE (STRING 8 "winooski.ccs.neu.edu"))
    (WM_ICON_NAME (STRING 8 "x.ss - DrScheme"))
    (WM_NAME (UTF8_STRING 8 "x.ss - DrScheme")))
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Robby Findler <robby@cs.uchicago.edu>
To: Eli Barzilay <eli@barzilay.org>
Cc: Matthew Flatt <mflatt@cs.utah.edu>, bugs@plt-scheme.org
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Tue, 15 Mar 2005 20:55:51 -0600

 At Tue, 15 Mar 2005 21:52:32 -0500, Eli Barzilay wrote:
 > I'm not following this anymore...  If the title mutator is called when
 > you switch tabs, then I would assume that switching tabs would mutate
 > the title and make it appear.
 
 Eli, I was suggesting how there might be a bug in the infrastructure
 and not in drscheme. This is all in response to you giving me the pr
 and then being confused how I could possibly send it to Matthew.
 
 Forget it.
 
 Robby
From: Matthew Flatt <mflatt@cs.utah.edu>
To: Eli Barzilay <eli@barzilay.org>
Cc: Robby Findler <robby@cs.uchicago.edu>, bugs@plt-scheme.org
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Tue, 15 Mar 2005 21:14:02 -0700

 At Tue, 15 Mar 2005 21:52:32 -0500, Eli Barzilay wrote:
 >   ("Untitled - DrScheme" "mred"
 >    (type default) [...] (order 1707) (icon-position (315 . 736))
 > [...]
 >    (WM_ICON_NAME (STRING 8 "Untitled - DrScheme"))
 >    (WM_NAME (UTF8_STRING 8 "Untitled - DrScheme")))
 
 Does you know where the initial string comes from?
 
 I see that MrEd should set the icon name encoding in addition to the
 title encoding. I've made that change.
 
 Matthew
 
From: Eli Barzilay <eli@barzilay.org>
To: Matthew Flatt <mflatt@cs.utah.edu>
Cc: Robby Findler <robby@cs.uchicago.edu>, bugs@plt-scheme.org
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Wed, 16 Mar 2005 00:45:54 -0500

 On Mar 15, Matthew Flatt wrote:
 > At Tue, 15 Mar 2005 21:52:32 -0500, Eli Barzilay wrote:
 > >   ("Untitled - DrScheme" "mred"
 > >    (type default) [...] (order 1707) (icon-position (315 . 736))
 > > [...]
 > >    (WM_ICON_NAME (STRING 8 "Untitled - DrScheme"))
 > >    (WM_NAME (UTF8_STRING 8 "Untitled - DrScheme")))
 > 
 > Does you know where the initial string comes from?
 
 No.  That's just all the information that the WM gave me.
 
 
 > I see that MrEd should set the icon name encoding in addition to the
 > title encoding. I've made that change.
 
 I'll try it tomorrow, but I doubt that this is the problem...
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Eli Barzilay <eli@barzilay.org>
To: Matthew Flatt <mflatt@cs.utah.edu>
Cc: Robby Findler <robby@cs.uchicago.edu>, bugs@plt-scheme.org
Subject: Re: drscheme/7276 No text in title for DrScheme on Linux
Date: Wed, 16 Mar 2005 14:56:04 -0500

 On Mar 15, Matthew Flatt wrote:
 > I see that MrEd should set the icon name encoding in addition to the
 > title encoding. I've made that change.
 
 Rebuilt, and still behaves in the same way.
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!

Responsible changed from "robby" to "mflatt" by eli at Wed, 07 Jun 2006 23:25:31 -0400
Reason>>> mred

State changed from "open" to "closed" by eli at Wed, 07 Jun 2006 23:25:31 -0400
Reason>>> I finally traced this all the way to what looks like a bug 
in sawfish: it reacts to a title change where the 
`actual_type_return' is STRING or COMPOUND_TEXT, but not 
UTF8_STRING.


State changed from "closed" to "open" by eli at Fri, 16 Jun 2006 16:09:49 -0400
Reason>>> This is a MrEd bug after all, more info in a followup email

From: Eli Barzilay <eli@barzilay.org>
To: bugs@plt-scheme.org
Cc: mflatt@cs.utah.edu
Subject: Re: mred/7276 No text in title for DrScheme on Linux
Date: Fri, 16 Jun 2006 16:21:23 -0400

 On Jun 16, eli@barzilay.org wrote:
 > 
 > Reason>>> This is a MrEd bug after all, more info in a followup email
 
 I got these replies from someone on the Sawfish list.  Also, I checked
 the sources of the current wxWindows (wxWidgets now) and they simply
 use <title>.toAscii as the value to set for the title, and no UTF8 thing.
 
 
 On Jun  8, Timo.Korvola@iki.fi wrote:
 > Eli Barzilay <eli@barzilay.org> writes:
 > > It turns out that the atom that is received when this happens is
 > > "UTF8_STRING", which is omitted from the above condition.
 > 
 > It appears that the bug is in your application rather than in Sawfish.
 > There is no mention of UTF8_STRING in the ICCCM.  The valid types for
 > text are COMPOUND_TEXT, STRING and C_STRING.  The latter does not
 > specify an encoding and is thus inappropriate here.  This leaves the
 > two types that appear in the if statement.
 > 
 > UTF-8 support is defined in the EWMH spec instead.  Applications can
 > use the properties _NET_WM_NAME and _NET_WM_ICON_NAME as UTF-8 encoded
 > replacements for WM_NAME and WM_ICON_NAME.  The WM should use the _NET
 > properties in preference to the traditional ones.  I am not sure if
 > Sawfish does that.  If not, that would be a bug in Sawfish.
 
 On Jun  9, Timo Korvola wrote:
 >  > Any hints or pointers what should be done instead?
 > 
 > I assume the Latin-1 character set (STRING) is not suited for your
 > purposes?  Perhaps the compound text encoding would be if you can
 > somehow convert the UTF-8 titles into that.  Or you could try to use
 > the EWMH properties, but they might not be so widely supported.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!

State changed from "open" to "closed" by mflatt at Tue, 11 Jul 2006 13:46:58 -0400
Reason>>> Fixed (well enough for modern WMs)

