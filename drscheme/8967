From bugs+caf_=bugs=bugs.plt-scheme.org@plt-scheme.org Thu Sep 27 05:20:59 2007
Received: from mu-out-0910.google.com (mu-out-0910.google.com [209.85.134.186])
	by champlain.ccs.neu.edu (8.13.8/8.13.7) with ESMTP id l8R9KwfT006191
	for <bugs@bugs.plt-scheme.org>; Thu, 27 Sep 2007 05:20:58 -0400
Message-Id: <200709270920.l8R9KqbQ006184@champlain.ccs.neu.edu>
Date: Thu, 27 Sep 2007 05:20:52 -0400
From: eli@barzilay.org
To: bugs@plt-scheme.org
Subject: DrScheme saves preferences too eagerly

>Number:         8967
>Category:       drscheme
>Synopsis:       DrScheme saves preferences too eagerly
>Class:          sw-bug
>Responsible:    eli
>Severity:       serious
>Priority:       medium
>State:          closed
>Confidential:   no
>Arrival-Date:   Thu Sep 27 05:25:01 -0400 2007
>Last-Modified:  Tue Oct 07 01:46:11 -0400 2008
>Originator:     Eli Barzilay
>Organization:
plt
>Submitter-Id:   unknown
>Release:        371
>Environment:
unix "Linux winooski.ccs.neu.edu 2.6.22.4-65.fc7 #1 SMP Tue Aug 21 21:50:50 EDT 2007 x86_64 x86_64 x86_64 GNU/Linux" (x86_64-linux/3m) (get-display-depth) = 16
Docs Installed:
(("/home/eli/plt/doc" "r5rs" "mzscheme" "mred" "help" "tour" "drscheme" "srfi" "mzlib" "misclib" "mrlib" "framework" "foreign" "mzc" "tools" "insidemz" "web-server" "swindle" "plot" "release-notes" "t-y-scheme" "tex2page" "beginning" "beginning-abbr" "intermediate" "intermediate-lambda" "advanced" "teachpack" "teachpack-htdc" "profj-beginner" "profj-intermediate" "profj-intermediate-access" "profj-advanced"))
Human Language: english
(current-memory-use) 119773216

Collections:
(("/home/eli/.plt-scheme/371/collects" "CSU660" "info-domain") ("/home/eli/plt/collects" "icons" "ffi" "mred" "dynext" "mzscheme" "make" "preprocessor" "openssl" "sgl" "htdch" "slideshow" "graphics" "mztake" "frtime" "wxme" "lazy" "mzlib" "macro-debugger" "scribble" "syntax-color" "help" "swindle" "config" "net" "hierlist" "test-box-recovery" "trace" "mrlib" "algol60" "browser" "profj" "framework" "info-domain" "compiler" "errortrace" "eopl" "syntax" "combinator-parser" "string-constants" "html" "slatex" "stepper" "launcher" "htdp" "profjWizard" "lang" "setup" "plot" "teachpack" "xml" "planet" "readline" "parser-tools" "embedded-gui" "drscheme" "defaults" "srfi" "afm" "version" "texpict" "games" "tex2page" "web-server" "r5rs"))
Computer Language: (("Teaching Languages" "CSU660" "CSU660 Course Language") #6(#t current-print mixed-fraction-e #t #t test-coverage))
>Description:
At least under X, the DrScheme window can move when the preferences-locked error popup
shows.  To see the problem that this makes, manually touch the ".LOCKplt-prefs.ss" file,
and move the DrScheme window.  What happens next is that every movement throws up a new
prefs-locked dialog, so you get a ton of dialogs in seconds.

In general, it sounds like a bad idea to save preferences as soon as they change.  The
idea of writing the whole preference file on every pixel move sounds horrifying to me,
even assuming some OS caching for writes.  (Esp since writing the preference involves
reading it, merging preferences, then writing it.)  (Now that I know about it, I tried
wiggling a DrScheme window, and I do see both my cpu and my disk monitors going up.)
It would be much better to write it once when leaving, and perhaps in other selected
checkpoints like after the preference dialog is dismissed, and maybe in random
intervals.

Also, I think that it would be better to just ignore a lock error when writing
preferences unless it's the last write before exiting (ignore = don't popup a dialog,
just don't save it).

[And by the way, the above example is cooked, but I had this problem for real: I had
two DrSchemes open, and I switched viewports -- in X this is implemented by moving all
windows, so both the dr windows moved at the same time, which means that for every such
move I had a new lock-error popup appear.]
>How-To-Repeat:
>Fix:
>Audit-Trail:
From: "Robby Findler" <robby@cs.uchicago.edu>
To: eli@barzilay.org, bugs@plt-scheme.org
Cc: nobody@plt-scheme.org, eli@plt-scheme.org, matthias@plt-scheme.org,
        sk@plt-scheme.org, mflatt@plt-scheme.org, clements@plt-scheme.org,
        jay@plt-scheme.org, meunier@plt-scheme.org, sowens@plt-scheme.org,
        kathyg@plt-scheme.org, awick@plt-scheme.org, jacobm@plt-scheme.org,
        cce@plt-scheme.org, dalev@plt-scheme.org, samth@plt-scheme.org,
        ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Thu, 27 Sep 2007 09:06:16 -0500

 I like the way that the preferences are saved on each preferences:set,
 as a general default (this has saved my butt in a few cases and it
 seems much better than what we had before wen preferences were saved
 much less frequently).
 
 But I think that perhaps we need a way to change that behavior for
 particular calls to set or perhaps for particular preferences and
 moving the window would use that.
 
 Sound reasonable?
 
 Robby
From: Matthias Felleisen <matthias@ccs.neu.edu>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: eli@barzilay.org, bugs@plt-scheme.org, nobody@plt-scheme.org,
        eli@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Thu, 27 Sep 2007 11:18:04 -0400

 It sounds awfully inefficient that every pixel event triggers save  
 action. -- Matthias
 
 
 
 On Sep 27, 2007, at 10:06 AM, Robby Findler wrote:
 
 > I like the way that the preferences are saved on each preferences:set,
 > as a general default (this has saved my butt in a few cases and it
 > seems much better than what we had before wen preferences were saved
 > much less frequently).
 >
 > But I think that perhaps we need a way to change that behavior for
 > particular calls to set or perhaps for particular preferences and
 > moving the window would use that.
 >
 > Sound reasonable?
 >
 > Robby
 
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Matthias Felleisen" <matthias@ccs.neu.edu>
Cc: eli@barzilay.org, bugs@plt-scheme.org, nobody@plt-scheme.org,
        eli@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Thu, 27 Sep 2007 10:39:14 -0500

 I'm not sure what you're saying with that, but here are some responses:
 
 - Yet you've not noticed it until someone told you. So why do you
 care? (But, maybe macos only sends the event that triggers the save
 when you finish moving the window.)
 
 - I'm proposing that we change that.
 
 Robby
 
 On 9/27/07, Matthias Felleisen <matthias@ccs.neu.edu> wrote:
 >
 > It sounds awfully inefficient that every pixel event triggers save
 > action. -- Matthias
 >
 >
 >
 > On Sep 27, 2007, at 10:06 AM, Robby Findler wrote:
 >
 > > I like the way that the preferences are saved on each preferences:set,
 > > as a general default (this has saved my butt in a few cases and it
 > > seems much better than what we had before wen preferences were saved
 > > much less frequently).
 > >
 > > But I think that perhaps we need a way to change that behavior for
 > > particular calls to set or perhaps for particular preferences and
 > > moving the window would use that.
 > >
 > > Sound reasonable?
 > >
 > > Robby
 >
 >
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Thu, 27 Sep 2007 11:48:32 -0400

 On Sep 27, Robby Findler wrote:
 > I like the way that the preferences are saved on each
 > preferences:set, as a general default (this has saved my butt in a
 > few cases and it seems much better than what we had before wen
 > preferences were saved much less frequently).
 > 
 > But I think that perhaps we need a way to change that behavior for
 > particular calls to set or perhaps for particular preferences and
 > moving the window would use that.
 
 Well, I offered several things (some implicit), where each would be a
 step to solving the problem, and, IMO, all make enough sense to be
 used:
 
 * Unless you're doing the pre-exit preference save, don't tell the
   user about locks.  It does not matter at that point.  (In other
   words, if DrScheme crashes, nobody will be too surprised if it
   didn't remember their pre-crash settings.)
 
 * Don't write preferences immediately.  Fire up a timer that will make
   them written in, say, 4 seconds.  Don't fire up the time if one is
   already counting.  (So even if stuff keeps changing, you get a
   checkpoint at least every 4 seconds.)
 
 * Make certain preferences setting not write the new preference.
   Moving the window is one candidate, changing stuff in the preference
   dialog (before clicking OK) is another.  (For example, say that for
   some reason using a "really big" font crashes drscheme -- I grab the
   font size slider and my hand slips to the "really big" zone;
   drscheme crashes right after writing the setting to the preference
   file, and now my drscheme crashes every time I run it.)
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: "Matthias Felleisen" <matthias@ccs.neu.edu>, bugs@plt-scheme.org,
        nobody@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Thu, 27 Sep 2007 11:50:39 -0400

 On Sep 27, Robby Findler wrote:
 > I'm not sure what you're saying with that, but here are some
 > responses:
 > 
 > - Yet you've not noticed it until someone told you. So why do you
 > care? (But, maybe macos only sends the event that triggers the save
 > when you finish moving the window.)
 
 I can say why I didn't notice it: I rarely move a window (I rarely use
 the mouse).  The problem that I've seen this morning was due to
 switching viewports with more than one drscheme, which is also
 something I rarely have (and wouldn't make a noticeable effect on cpu
 use).
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!

Responsible changed from "nobody" to "eli" by robby at Mon, 08 Oct 2007 15:18:31 -0400
Reason>>> Got a use-case? (as in followup email)

From: "Robby Findler" <robby@cs.uchicago.edu>
To: eli@barzilay.org, bugs@plt-scheme.org
Cc: nobody@plt-scheme.org, eli@plt-scheme.org, matthias@plt-scheme.org,
        sk@plt-scheme.org, mflatt@plt-scheme.org, clements@plt-scheme.org,
        jay@plt-scheme.org, meunier@plt-scheme.org, sowens@plt-scheme.org,
        kathyg@plt-scheme.org, awick@plt-scheme.org, jacobm@plt-scheme.org,
        cce@plt-scheme.org, dalev@plt-scheme.org, samth@plt-scheme.org,
        ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 14:18:55 -0500

 For now, I've just made the preferences system only nag you when the
 first preference write fails or when one fails after one has already
 succeeded.
 
 It sounds like the pixel-by-pixel problem may just be a theory (macos
 doesn't behave like that, in any case) so I'll leave off the more
 significant work of delaying preference writes until we have a real
 use case I can play with.
 
 (I'll move the PR to Eli and he can either close it or move it back to
 me if the use-case really exists and I'm just not understanding.)
 
 Robby
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 17:40:37 -0400

 On Oct  8, Robby Findler wrote:
 > For now, I've just made the preferences system only nag you when the
 > first preference write fails or when one fails after one has already
 > succeeded.
 
 I tried it, and it didn't work.  It still pops up a message on every
 movement.
 
 BTW#1: the above "or" seems redundant -- IIUC, then the second
 condition is a superset of the first.
 
 BTW#2: I like my suggestion much better -- nag you when it fails to
 save preferences on exit only.  Assuming a common case of SrScheme not
 crashing, then people will get a nag anyway, and at a point that
 matters more.
 
 
 > It sounds like the pixel-by-pixel problem may just be a theory
 > (macos doesn't behave like that, in any case) so I'll leave off the
 > more significant work of delaying preference writes until we have a
 > real use case I can play with.
 > 
 > (I'll move the PR to Eli and he can either close it or move it back
 > to me if the use-case really exists and I'm just not understanding.)
 
 I'm not sure why you moved the PR to me.  The bug really does exist.
 (I think I listed these steps and additional problems at some point.)
 
 
 The way that I've actually had this as a problem (requires the a
 window manager with viewports):
 
 * Start DrScheme on Linux, using a window manager that provides
   multiple viewports (= each workspace is made of a bunch of view
   ports, each spans the whole screen, and you can move between them.
   Useful for either multiple windows or for rare cases when you need a
   really big window).
 
 * Start another one.
 
 * Switch viewports -- every switch pops up the preference dialog.
 
 
 A second way to see the problem involves faking a lockfile:
 
 * Touch your ~/.plt-scheme/.LOCKplt-prefs.ss
 
 * Start a drscheme, move the window -- every pixel movement pops up a
   dialog.
 
 Looks like this is working a little better now -- if you click "Try
 Again", it will give up and tell you that it won't try to save
 preferences anymore.  But that's not a good solution IMO (=> it should
 still try to save the preferences when you quit).
 
 
 Related problems that are still in effect:
 
 * If things work fine, moving a window saves the prefs file on every
   move.  Very expensive -- spins both your CPU and your HD.  I'm sure
   that doing that when your home dir is mounted through NFS is not
   much fun.
 
 * DrScheme never gives you an option to delete the lock file (in Emacs
   terms -- "steal the lock").  Probably not a problem on Linux, but
   there is a high frequency of related PRs on Windows where it's not
   easy to find the lock file.
 
 * The core problem of saving each individual preference change instead
   of batching them is still there.  (A generalization of the first
   item.)
 
 * If I start a second DrScheme when I'm on the wrong viewport, it will
   remember the geometry as something that is outside the screen, and
   as a result the second DrScheme is off-screen too.  The result is
   that you don't see any window, and every time it happens to me I'm
   convinced that something is horribly broken.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 18:30:20 -0500

 Thanks, Eli. I'll work on this more. Just one comment, in reply to the
 very last bullet: yes, something is broken, but it sounds like it is X
 or the window manager or something, not DrScheme. Too bad we have to
 hack around it. (No other platforms fake a "hide window" with "move
 window to some funny coordinate" ...)
 
 Robby
 
 On 10/8/07, Eli Barzilay <eli@barzilay.org> wrote:
 > On Oct  8, Robby Findler wrote:
 > > For now, I've just made the preferences system only nag you when the
 > > first preference write fails or when one fails after one has already
 > > succeeded.
 >
 > I tried it, and it didn't work.  It still pops up a message on every
 > movement.
 >
 > BTW#1: the above "or" seems redundant -- IIUC, then the second
 > condition is a superset of the first.
 >
 > BTW#2: I like my suggestion much better -- nag you when it fails to
 > save preferences on exit only.  Assuming a common case of SrScheme not
 > crashing, then people will get a nag anyway, and at a point that
 > matters more.
 >
 >
 > > It sounds like the pixel-by-pixel problem may just be a theory
 > > (macos doesn't behave like that, in any case) so I'll leave off the
 > > more significant work of delaying preference writes until we have a
 > > real use case I can play with.
 > >
 > > (I'll move the PR to Eli and he can either close it or move it back
 > > to me if the use-case really exists and I'm just not understanding.)
 >
 > I'm not sure why you moved the PR to me.  The bug really does exist.
 > (I think I listed these steps and additional problems at some point.)
 >
 >
 > The way that I've actually had this as a problem (requires the a
 > window manager with viewports):
 >
 > * Start DrScheme on Linux, using a window manager that provides
 >   multiple viewports (= each workspace is made of a bunch of view
 >   ports, each spans the whole screen, and you can move between them.
 >   Useful for either multiple windows or for rare cases when you need a
 >   really big window).
 >
 > * Start another one.
 >
 > * Switch viewports -- every switch pops up the preference dialog.
 >
 >
 > A second way to see the problem involves faking a lockfile:
 >
 > * Touch your ~/.plt-scheme/.LOCKplt-prefs.ss
 >
 > * Start a drscheme, move the window -- every pixel movement pops up a
 >   dialog.
 >
 > Looks like this is working a little better now -- if you click "Try
 > Again", it will give up and tell you that it won't try to save
 > preferences anymore.  But that's not a good solution IMO (=> it should
 > still try to save the preferences when you quit).
 >
 >
 > Related problems that are still in effect:
 >
 > * If things work fine, moving a window saves the prefs file on every
 >   move.  Very expensive -- spins both your CPU and your HD.  I'm sure
 >   that doing that when your home dir is mounted through NFS is not
 >   much fun.
 >
 > * DrScheme never gives you an option to delete the lock file (in Emacs
 >   terms -- "steal the lock").  Probably not a problem on Linux, but
 >   there is a high frequency of related PRs on Windows where it's not
 >   easy to find the lock file.
 >
 > * The core problem of saving each individual preference change instead
 >   of batching them is still there.  (A generalization of the first
 >   item.)
 >
 > * If I start a second DrScheme when I'm on the wrong viewport, it will
 >   remember the geometry as something that is outside the screen, and
 >   as a result the second DrScheme is off-screen too.  The result is
 >   that you don't see any window, and every time it happens to me I'm
 >   convinced that something is horribly broken.
 >
 > --
 >           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
 >                   http://www.barzilay.org/                 Maze is Life!
 >
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 18:49:59 -0500

 I've committed a possible fix for the repeated move problem. Can you
 try just moving the window around with the newest version of
 collects/drscheme/private/unit.ss? Is that any better? (If not, I'll
 try fancier stuff and test on my own, but it is tricky to get to linux
 for me.)
 
 Thanks,
 Robby
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Matthew Flatt" <mflatt@cs.utah.edu>
Cc: bugs <bugs@plt-scheme.org>, "Eli Barzilay" <eli@barzilay.org>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 19:32:29 -0500

 Matthew: do you think it would be a bad idea to, when the preference
 write fails (due to a lockfile conflict) to just queue an event to try
 again, instead of trying again right away?
 
 I don't see any a priori problems with that, but perhaps I'm not
 thinking of everything.
 
 Robby
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Matthew Flatt" <mflatt@cs.utah.edu>
Cc: bugs <bugs@plt-scheme.org>, "Eli Barzilay" <eli@barzilay.org>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 19:32:45 -0500

 (Or Eli! Sorry...)
 
 On 10/8/07, Robby Findler <robby@cs.uchicago.edu> wrote:
 > Matthew: do you think it would be a bad idea to, when the preference
 > write fails (due to a lockfile conflict) to just queue an event to try
 > again, instead of trying again right away?
 >
 > I don't see any a priori problems with that, but perhaps I'm not
 > thinking of everything.
 >
 > Robby
 >
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 20:59:31 -0400

 On Oct  8, Robby Findler wrote:
 > I've committed a possible fix for the repeated move problem. Can you
 > try just moving the window around with the newest version of
 > collects/drscheme/private/unit.ss? Is that any better? (If not, I'll
 > try fancier stuff and test on my own, but it is tricky to get to linux
 > for me.)
 
 It seems to be happening less frequently, but it stil happens.
 
 The basic problem is that every such viewport move will make all
 drscheme windows to move at the same time.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: "Matthew Flatt" <mflatt@cs.utah.edu>, bugs <bugs@plt-scheme.org>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 20:56:57 -0400

 On Oct  8, Robby Findler wrote:
 > Matthew: do you think it would be a bad idea to, when the preference
 > write fails (due to a lockfile conflict) to just queue an event to try
 > again, instead of trying again right away?
 > 
 > I don't see any a priori problems with that, but perhaps I'm not
 > thinking of everything.
 
 Sounds like a stray lock-file will get it stuck in a loop.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 21:16:48 -0400

 On Oct  8, Robby Findler wrote:
 > Thanks, Eli. I'll work on this more. Just one comment, in reply to
 > the very last bullet: yes, something is broken, but it sounds like
 > it is X or the window manager or something, not DrScheme. Too bad we
 > have to hack around it. (No other platforms fake a "hide window"
 > with "move window to some funny coordinate" ...)
 
 Well, it's not only for hiding windows.  It's also for having a bigger
 desktop than the physical screen size, and moving around the virtual
 screen is achieved by moving all windows.  But the same applies for
 Windows when you move the DrScheme window so only a tiny corner is
 visible.
 
 
 > > * If I start a second DrScheme when I'm on the wrong viewport, it will
 > >   remember the geometry as something that is outside the screen, and
 > >   as a result the second DrScheme is off-screen too.  The result is
 > >   that you don't see any window, and every time it happens to me I'm
 > >   convinced that something is horribly broken.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 20:57:30 -0500

 I don't agree.
 
 On 10/8/07, Eli Barzilay <eli@barzilay.org> wrote:
 > On Oct  8, Robby Findler wrote:
 > > Thanks, Eli. I'll work on this more. Just one comment, in reply to
 > > the very last bullet: yes, something is broken, but it sounds like
 > > it is X or the window manager or something, not DrScheme. Too bad we
 > > have to hack around it. (No other platforms fake a "hide window"
 > > with "move window to some funny coordinate" ...)
 >
 > Well, it's not only for hiding windows.  It's also for having a bigger
 > desktop than the physical screen size, and moving around the virtual
 > screen is achieved by moving all windows.  But the same applies for
 > Windows when you move the DrScheme window so only a tiny corner is
 > visible.
 >
 >
 > > > * If I start a second DrScheme when I'm on the wrong viewport, it will
 > > >   remember the geometry as something that is outside the screen, and
 > > >   as a result the second DrScheme is off-screen too.  The result is
 > > >   that you don't see any window, and every time it happens to me I'm
 > > >   convinced that something is horribly broken.
 >
 > --
 >           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
 >                   http://www.barzilay.org/                 Maze is Life!
 >
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: "Matthew Flatt" <mflatt@cs.utah.edu>, bugs <bugs@plt-scheme.org>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 20:57:48 -0500

 I'm not planning on writing a loop.
 
 Robby
 
 On 10/8/07, Eli Barzilay <eli@barzilay.org> wrote:
 > On Oct  8, Robby Findler wrote:
 > > Matthew: do you think it would be a bad idea to, when the preference
 > > write fails (due to a lockfile conflict) to just queue an event to try
 > > again, instead of trying again right away?
 > >
 > > I don't see any a priori problems with that, but perhaps I'm not
 > > thinking of everything.
 >
 > Sounds like a stray lock-file will get it stuck in a loop.
 >
 > --
 >           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
 >                   http://www.barzilay.org/                 Maze is Life!
 >
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 20:59:00 -0500

 Yeah, okay. (This is irritating -- if the window manager would just
 hide the windows with some kind of a "hide" message, this wouldn't
 happen at all....)
 
 Matthew: I don't suppose there is a problem at the mred layer?
 
 Robby
 
 On 10/8/07, Eli Barzilay <eli@barzilay.org> wrote:
 > On Oct  8, Robby Findler wrote:
 > > I've committed a possible fix for the repeated move problem. Can you
 > > try just moving the window around with the newest version of
 > > collects/drscheme/private/unit.ss? Is that any better? (If not, I'll
 > > try fancier stuff and test on my own, but it is tricky to get to linux
 > > for me.)
 >
 > It seems to be happening less frequently, but it stil happens.
 >
 > The basic problem is that every such viewport move will make all
 > drscheme windows to move at the same time.
 >
 > --
 >           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
 >                   http://www.barzilay.org/                 Maze is Life!
 >
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: "Matthew Flatt" <mflatt@cs.utah.edu>, bugs <bugs@plt-scheme.org>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 22:32:49 -0400

 So if you fail then you queue an event that will try to write again,
 and if that fails then you *don't* queue a retry event?  (Since if you
 do then that gets into a loop.)
 
 The two attempts will probably end up being too close together so both
 are likely to fail.
 
 
 On Oct  8, Robby Findler wrote:
 > I'm not planning on writing a loop.
 > 
 > Robby
 > 
 > On 10/8/07, Eli Barzilay <eli@barzilay.org> wrote:
 > > On Oct  8, Robby Findler wrote:
 > > > Matthew: do you think it would be a bad idea to, when the preference
 > > > write fails (due to a lockfile conflict) to just queue an event to try
 > > > again, instead of trying again right away?
 > > >
 > > > I don't see any a priori problems with that, but perhaps I'm not
 > > > thinking of everything.
 > >
 > > Sounds like a stray lock-file will get it stuck in a loop.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 22:44:46 -0400

 On Oct  8, Robby Findler wrote:
 > Yeah, okay. (This is irritating -- if the window manager would just
 > hide the windows with some kind of a "hide" message, this wouldn't
 > happen at all....)
 
 I think that you still don't understand what the WM is doing -- it is
 very specifically not doing windows hiding.
 
 * My desktop has 3 workspaces; windows that are not on the current
   workspace are hidden.  (So this bit is not a problem.)
 
 * Each of these workspaces is 2 screens over 2 screens.
   - I can switch between the 4 parts -or- I can move in between.
   - I usually put windows on each of the 4 parts, but some windows are
     between them, and some windows are bigger than the physical
     screen.
   This can only be done by moving windows.
 
 
 > Matthew: I don't suppose there is a problem at the mred layer?
 
 It's not a mred problem.  The core problem is that you assume that
 preference changes do not occur to more than one drscheme process at
 the same time, at least not frequently.  This assumption is can be
 wrong (simultaneous changes can be frequent).  More than that,
 locking the file repeatedly and very fast is very likely to hit make
 lockfile-related problems more severe.  (I'm surprised that nobody had
 an NFS-related issue with this.)
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs@plt-scheme.org, matthias@plt-scheme.org, sk@plt-scheme.org,
        mflatt@plt-scheme.org, clements@plt-scheme.org, jay@plt-scheme.org,
        meunier@plt-scheme.org, sowens@plt-scheme.org, kathyg@plt-scheme.org,
        awick@plt-scheme.org, jacobm@plt-scheme.org, cce@plt-scheme.org,
        dalev@plt-scheme.org, samth@plt-scheme.org, ryanc@plt-scheme.org
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Mon, 8 Oct 2007 22:48:55 -0400

 On Oct  8, Robby Findler wrote:
 > I don't agree.
 
 I don't know what you don't agree with.  If it's the general
 implementation of a viewport feature, then I'm happy that you didn't
 design my WM since it's very useful for me.  If you don't agree that
 the same applies to Windows then I can point you at Windows tools that
 can move a window off the screen.
 
 
 > On 10/8/07, Eli Barzilay <eli@barzilay.org> wrote:
 > > On Oct  8, Robby Findler wrote:
 > > > Thanks, Eli. I'll work on this more. Just one comment, in reply
 > > > to the very last bullet: yes, something is broken, but it sounds
 > > > like it is X or the window manager or something, not
 > > > DrScheme. Too bad we have to hack around it. (No other platforms
 > > > fake a "hide window" with "move window to some funny coordinate"
 > > > ...)
 > >
 > > Well, it's not only for hiding windows.  It's also for having a
 > > bigger desktop than the physical screen size, and moving around
 > > the virtual screen is achieved by moving all windows.  But the
 > > same applies for Windows when you move the DrScheme window so only
 > > a tiny corner is visible.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 07:05:35 -0500

 On 10/8/07, Eli Barzilay <eli@barzilay.org> wrote:
 > On Oct  8, Robby Findler wrote:
 > > Yeah, okay. (This is irritating -- if the window manager would just
 > > hide the windows with some kind of a "hide" message, this wouldn't
 > > happen at all....)
 >
 > I think that you still don't understand what the WM is doing -- it is
 > very specifically not doing windows hiding.
 >
 > * My desktop has 3 workspaces; windows that are not on the current
 >   workspace are hidden.  (So this bit is not a problem.)
 >
 > * Each of these workspaces is 2 screens over 2 screens.
 >   - I can switch between the 4 parts -or- I can move in between.
 >   - I usually put windows on each of the 4 parts, but some windows are
 >     between them, and some windows are bigger than the physical
 >     screen.
 >   This can only be done by moving windows.
 >
 
 Oh, I see. This was not clear to me before.
 
 How about you stop making new drschemes and just use the same one?
 
 Robby
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 08:13:17 -0400

 On Oct  9, Robby Findler wrote:
 > On 10/8/07, Eli Barzilay <eli@barzilay.org> wrote:
 > > On Oct  8, Robby Findler wrote:
 > > > Yeah, okay. (This is irritating -- if the window manager would just
 > > > hide the windows with some kind of a "hide" message, this wouldn't
 > > > happen at all....)
 > >
 > > I think that you still don't understand what the WM is doing -- it is
 > > very specifically not doing windows hiding.
 > >
 > > * My desktop has 3 workspaces; windows that are not on the current
 > >   workspace are hidden.  (So this bit is not a problem.)
 > >
 > > * Each of these workspaces is 2 screens over 2 screens.
 > >   - I can switch between the 4 parts -or- I can move in between.
 > >   - I usually put windows on each of the 4 parts, but some windows are
 > >     between them, and some windows are bigger than the physical
 > >     screen.
 > >   This can only be done by moving windows.
 > >
 > 
 > Oh, I see. This was not clear to me before.
 > 
 > How about you stop making new drschemes and just use the same one?
 
 I have two vnc sessions -- one for class, and I forgot a running
 drscheme on the work session.  Not an unreasonable thing.  It happens
 a few times since then.
 
 But I really don't know why you stick with the preference saving on
 every move.  It's bad enough that I'd complain even without a problem.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 07:19:38 -0500

 On 10/9/07, Eli Barzilay <eli@barzilay.org> wrote:
 > But I really don't know why you stick with the preference saving on
 > every move.  It's bad enough that I'd complain even without a problem.
 
 It doesn't do that anymore... currently it queues a low priority event
 so if you move the window a lot, you don't save a lot. I hope to try
 this out later on today myself, when I can get to linux box.
 
 Note that this is only a problem under some window managers on linux.
 That's why I didn't even notice it until now.
 
 Robby
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 10:31:03 -0400

 On Oct  9, Robby Findler wrote:
 > 
 > It doesn't do that anymore... currently it queues a low priority
 > event so if you move the window a lot, you don't save a lot. I hope
 > to try this out later on today myself, when I can get to linux box.
 
 It still happens -- the file still changes as I'm dragging the
 window.  (Which is not surprising -- it does have time to redraw the
 window.)
 
 
 > Note that this is only a problem under some window managers on
 > linux.  That's why I didn't even notice it until now.
 
 I'm think that this is because you don't use linux much -- window
 managers that display the contents of windows while moving them will
 do that, and that has been the default mode for practically all WMs in
 the last ~5 years.  TWM is probably the only ancient leftover that
 uses wireframes.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 09:33:35 -0500

 Wireframes is not the only option, of course. Try dragging a window on
 the mac sometime and keep in mind that on-move is only called once.
 
 Still, your point is taken. I need to deal with this.
 
 Robby
 
 On 10/9/07, Eli Barzilay <eli@barzilay.org> wrote:
 > On Oct  9, Robby Findler wrote:
 > >
 > > It doesn't do that anymore... currently it queues a low priority
 > > event so if you move the window a lot, you don't save a lot. I hope
 > > to try this out later on today myself, when I can get to linux box.
 >
 > It still happens -- the file still changes as I'm dragging the
 > window.  (Which is not surprising -- it does have time to redraw the
 > window.)
 >
 >
 > > Note that this is only a problem under some window managers on
 > > linux.  That's why I didn't even notice it until now.
 >
 > I'm think that this is because you don't use linux much -- window
 > managers that display the contents of windows while moving them will
 > do that, and that has been the default mode for practically all WMs in
 > the last ~5 years.  TWM is probably the only ancient leftover that
 > uses wireframes.
 >
 > --
 >           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
 >                   http://www.barzilay.org/                 Maze is Life!
 >
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 10:43:36 -0400

 On Oct  9, Robby Findler wrote:
 > Wireframes is not the only option, of course. Try dragging a window
 > on the mac sometime and keep in mind that on-move is only called
 > once.
 
 Yeah, I actually verified this on Matthias's' machine 30 minutes ago,
 and forgot to say that this is *unlike* OSX.  I'm sure that the reason
 that it's only wireframe or lots of movements on X is related to the X
 protocol being the monster that it is.  (And that is something that
 many peoiple complain about, very frequently.)
 
 
 > Still, your point is taken. I need to deal with this.
 > 
 > Robby
 > 
 > On 10/9/07, Eli Barzilay <eli@barzilay.org> wrote:
 > > On Oct  9, Robby Findler wrote:
 > > >
 > > > It doesn't do that anymore... currently it queues a low priority
 > > > event so if you move the window a lot, you don't save a lot. I hope
 > > > to try this out later on today myself, when I can get to linux box.
 > >
 > > It still happens -- the file still changes as I'm dragging the
 > > window.  (Which is not surprising -- it does have time to redraw the
 > > window.)
 > >
 > >
 > > > Note that this is only a problem under some window managers on
 > > > linux.  That's why I didn't even notice it until now.
 > >
 > > I'm think that this is because you don't use linux much -- window
 > > managers that display the contents of windows while moving them will
 > > do that, and that has been the default mode for practically all WMs in
 > > the last ~5 years.  TWM is probably the only ancient leftover that
 > > uses wireframes.
 > >
 > > --
 > >           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
 > >                   http://www.barzilay.org/                 Maze is Life!
 > >
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 11:23:34 -0500

 Eli: I don't suppose you use ubuntu, or know how I can configure it so
 that it behaves like your setup, do you?
 
 Robby
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 14:25:14 -0400

 On Oct  9, Robby Findler wrote:
 > Eli: I don't suppose you use ubuntu, or know how I can configure it
 > so that it behaves like your setup, do you?
 
 No, I use Fedora, and I use a non-default WM (sawfish).  But I did
 check that the default Gnome WM (Metacity) behaves the same when
 dragging windows.  (It does the opaque move by default.)
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 13:45:21 -0500

 Oh, sorry. I was wondering about the window switching setup.
 
 Robby
 
 On 10/9/07, Eli Barzilay <eli@barzilay.org> wrote:
 > On Oct  9, Robby Findler wrote:
 > > Eli: I don't suppose you use ubuntu, or know how I can configure it
 > > so that it behaves like your setup, do you?
 >
 > No, I use Fedora, and I use a non-default WM (sawfish).  But I did
 > check that the default Gnome WM (Metacity) behaves the same when
 > dragging windows.  (It does the opaque move by default.)
 >
 > --
 >           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
 >                   http://www.barzilay.org/                 Maze is Life!
 >
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Tue, 9 Oct 2007 15:17:07 -0400

 Ah.  AFAIK, Metacity doesn't do viewports as a principle.  There are
 several WMs that can do that -- sawfish is the one I'm using, and also
 fvwm can do that.  I'm not sure about the others since I tend to stick
 to my own WM...
 
 If you can install one of the above (sawfish/fvwm/fvwm2) then I can
 tell you how to configure it.  But I'm perfectly fine with being a
 guinea pig and test patches for you.
 
 (I've asked around, and didn't find anything.  The problem is that
 newer WMs switch the focus to fancy 3d effects.)
 
 
 On Oct  9, Robby Findler wrote:
 > Oh, sorry. I was wondering about the window switching setup.
 > 
 > Robby
 > 
 > On 10/9/07, Eli Barzilay <eli@barzilay.org> wrote:
 > > On Oct  9, Robby Findler wrote:
 > > > Eli: I don't suppose you use ubuntu, or know how I can configure it
 > > > so that it behaves like your setup, do you?
 > >
 > > No, I use Fedora, and I use a non-default WM (sawfish).  But I did
 > > check that the default Gnome WM (Metacity) behaves the same when
 > > dragging windows.  (It does the opaque move by default.)
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Wed, 10 Oct 2007 14:16:22 -0500

 Okay, I finally got to linux to try this out. I put in a printf in
 preferences:set (in plt/collects/framework/preferences.ss) so I could
 see how often things happened and then I grabbed a drs window and
 waved it around vigorously for a while. Way more than any normal
 person would do. The preferences got saved only 9 times. I barely
 noticed a flicker in the little disk activity lights.
 
 Do you see something substantially worse, or am I not doing the right test?
 
 Thanks,
 Robby
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Wed, 10 Oct 2007 16:21:55 -0400

 On Oct 10, Robby Findler wrote:
 > Okay, I finally got to linux to try this out. I put in a printf in
 > preferences:set (in plt/collects/framework/preferences.ss) so I
 > could see how often things happened and then I grabbed a drs window
 > and waved it around vigorously for a while. Way more than any normal
 > person would do. The preferences got saved only 9 times. I barely
 > noticed a flicker in the little disk activity lights.
 > 
 > Do you see something substantially worse, or am I not doing the
 > right test?
 
 I just tried that -- I added a (foo) call right before the
 (preferences:low-level-put-preferences) line, with this definition for
 `foo':
 
   (define foo
     (let ([c 0])
       (lambda ()
         (set! c (add1 c))
         (with-output-to-file "/dev/stdout"
           (lambda () (printf ">>> ~s\n" c))
           'truncate))))
 
 Moving the window from the top-left to the bottom right made about 200
 writes.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Wed, 10 Oct 2007 15:32:21 -0500

 Oh, okay. For me: 3. I'll do something better.
 
 Robby
 
 On 10/10/07, Eli Barzilay <eli@barzilay.org> wrote:
 > On Oct 10, Robby Findler wrote:
 > > Okay, I finally got to linux to try this out. I put in a printf in
 > > preferences:set (in plt/collects/framework/preferences.ss) so I
 > > could see how often things happened and then I grabbed a drs window
 > > and waved it around vigorously for a while. Way more than any normal
 > > person would do. The preferences got saved only 9 times. I barely
 > > noticed a flicker in the little disk activity lights.
 > >
 > > Do you see something substantially worse, or am I not doing the
 > > right test?
 >
 > I just tried that -- I added a (foo) call right before the
 > (preferences:low-level-put-preferences) line, with this definition for
 > `foo':
 >
 >   (define foo
 >     (let ([c 0])
 >       (lambda ()
 >         (set! c (add1 c))
 >         (with-output-to-file "/dev/stdout"
 >           (lambda () (printf ">>> ~s\n" c))
 >           'truncate))))
 >
 > Moving the window from the top-left to the bottom right made about 200
 > writes.
 >
 > --
 >           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
 >                   http://www.barzilay.org/                 Maze is Life!
 >
From: Eli Barzilay <eli@barzilay.org>
To: "Robby Findler" <robby@cs.uchicago.edu>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Wed, 10 Oct 2007 17:00:59 -0400

 On Oct 10, Robby Findler wrote:
 > Oh, okay. For me: 3. I'll do something better.
 
 I'm just guessing here -- but maybe you're running through some
 virtual machine that tries to minimize the number of movement events?
 
 In any case, I tried to do the same experiment with v371 -- and got
 the same number of writes.  So at least the new stuff (before your
 recent commits) didn't change that.
 
 -- 
           ((lambda (x) (x x)) (lambda (x) (x x)))          Eli Barzilay:
                   http://www.barzilay.org/                 Maze is Life!
From: "Robby Findler" <robby@cs.uchicago.edu>
To: "Eli Barzilay" <eli@barzilay.org>
Cc: bugs <bugs@plt-scheme.org>, "Matthew Flatt" <mflatt@cs.utah.edu>
Subject: Re: [plt-bug] all/8967: DrScheme saves preferences too eagerly
Date: Wed, 10 Oct 2007 16:34:03 -0500

 Okay, I've checked in some changes to the preferences system.
 
 I didn't do a global timer to delay all writes, since I still find
 some value in the write-right-away semantics. Instead, I just delay
 the moves. If we start to get more of these problems, I'll revisit
 this, of course.
 
 Anyways, please let me know if moving the window works ok now and
 please also check on the two-drschemes-that-both-move-simultaneously
 thing too. That should also work better now.
 
 Thanks,
 Robby

State changed from "open" to "closed" by eli at Tue, 07 Oct 2008 01:46:11 -0400
Reason>>> solved

